{"pages":[{"title":"WecTeam | äº¬ä¸œç¤¾äº¤ç”µå•†å‰ç«¯å›¢é˜Ÿ","text":"ç»´Cå›¢ç®€ä»‹ç»´Cå›¢(WecTeam)æ˜¯äº¬ä¸œç¤¾äº¤ç”µå•†éƒ¨ä¸€ç¾¤çƒ­çˆ±æŠ€æœ¯ã€ä¹äºåˆ†äº«çš„å‰ç«¯å·¥ç¨‹å¸ˆè‡ªå‘æˆç«‹çš„ä¸€ä¸ªå‰ç«¯æŠ€æœ¯å›¢é˜Ÿï¼Œå¸Œæœ›é€šè¿‡æŠ€æœ¯å®è·µæ€»ç»“ã€æ–°æŠ€æœ¯æ¢ç§˜ã€Bugæ·±åº¦åˆ†æã€ä¼˜è´¨è‹±æ–‡èµ„æ–™å¼•å…¥ç­‰æ–¹å¼ï¼Œå‚ä¸å’Œæ¨åŠ¨å‰ç«¯æŠ€æœ¯çš„å‘å±•ï¼Œä¸ºå…¬å¸åŠè¡Œä¸šå¸¦æ¥ä»·å€¼ï¼ è”ç³»æˆ‘ä»¬","link":"/about/index.html"}],"posts":[{"title":"CSS Houdiniå®ç°åŠ¨æ€æ³¢æµªçº¹","text":"ä½œè€…ï¼šé»„æµ©ç¾¤ CSS Houdini å·ç§° CSS é¢†åŸŸæœ€ä»¤äººæŒ¯å¥‹çš„é©æ–°ã€‚CSS æœ¬èº«é•¿æœŸæ¬ ç¼ºè¯­æ³•ç‰¹æ€§ï¼Œå¯æ‹“å±•æ€§å‡ ä¹ä¸ºé›¶ï¼Œå¹¶ä¸”æ–°ç‰¹æ€§çš„æ”¯æŒæ•ˆç‡å¤ªä½ï¼Œå…¼å®¹æ€§å·®ã€‚è€Œ Houdini ç›´æ¥å°† CSS çš„ API æš´éœ²ç»™å¼€å‘è€…ï¼Œä»¥å¾€å®Œå…¨é»‘ç›’çš„æµè§ˆå™¨è§£ææµå¼€å§‹å¯¹å¤–å¼€æ”¾ï¼Œå¼€å‘è€…å¯ä»¥è‡ªå®šä¹‰å±äºè‡ªå·±çš„ CSS å±æ€§ï¼Œä»è€Œå®šåˆ¶å’Œæ‰©å±•æµè§ˆå™¨çš„å±•ç¤ºè¡Œä¸ºã€‚ èƒŒæ™¯æˆ‘ä»¬çŸ¥é“ï¼Œæµè§ˆå™¨åœ¨æ¸²æŸ“é¡µé¢æ—¶ï¼Œé¦–å…ˆä¼šè§£æé¡µé¢çš„ HTML å’Œ CSSï¼Œç”Ÿæˆæ¸²æŸ“æ ‘ï¼ˆrendering treeï¼‰ï¼Œå†ç»ç”±å¸ƒå±€ï¼ˆlayoutï¼‰å’Œç»˜åˆ¶ï¼ˆpaintingï¼‰ï¼Œå‘ˆç°å‡ºæ•´ä¸ªé¡µé¢å†…å®¹ã€‚åœ¨ Houdini å‡ºç°ä¹‹å‰ï¼Œè¿™ä¸ªæµç¨‹ä¸Šæˆ‘ä»¬èƒ½æ“ä½œçš„ç©ºé—´å°‘ä¹‹ç”šå°‘ï¼Œå°¤å…¶æ˜¯ layout å’Œ painting ç¯èŠ‚ï¼Œå¯ä»¥è¯´æ˜¯å®Œå…¨å°é—­ï¼Œä½¿å¾—æˆ‘ä»¬å¾ˆéš¾é€šè¿‡ polyfill ç­‰ç±»ä¼¼çš„æ‰‹æ®µä¸ºæ¬ æ”¯æŒçš„ CSS ç‰¹æ€§æä¾›å…¼å®¹ã€‚è€Œå¦ä¸€æ–¹é¢ï¼Œè¯­æ³•ç‰¹æ€§çš„ç¼ºå¤±ä¹Ÿæå¤§åœ°é™åˆ¶äº† CSS çš„ç¼–ç¨‹çµæ´»æ€§ï¼Œç¤¾åŒºä¸­ sassã€lessã€stylus ç­‰ CSS é¢„å¤„ç†æŠ€æœ¯çš„å‡ºç°å¤§å¤šéƒ½æºäºè¿™ä¸ªåŸå› ï¼Œå®ƒä»¬éƒ½å¸Œæœ›é€šè¿‡é¢„ç¼–è¯‘ï¼Œçªç ´ CSS çš„å±€é™æ€§ï¼Œè®© CSS æ‹¥æœ‰æ›´å¼ºå¤§çš„ç»„ç»‡å’Œç¼–å†™èƒ½åŠ›ã€‚æ‰€ä»¥æ…¢æ…¢åœ°ï¼Œæˆ‘ä»¬éƒ½ä¸å†æ‰‹å†™ CSSï¼Œæ›´æ–¹ä¾¿ã€æ›´çµæ´»çš„ CSS æ‰©å±•è¯­è¨€æˆäº† web å¼€å‘çš„ä¸»è§’ã€‚çœ‹åˆ°è¿™æ ·çš„æƒ…å†µï¼ŒCSS Houdini ç»ˆäºåä¸ä½äº†ã€‚ ä»€ä¹ˆæ˜¯ CSS Houdiniï¼ŸCSS Houdini å¯¹å¤–å¼€æ”¾äº†æµè§ˆå™¨è§£ææµç¨‹çš„ä¸€ç³»åˆ— APIï¼Œè¿™äº› API å…è®¸å¼€å‘è€…ä»‹å…¥æµè§ˆå™¨çš„ CSS engine è¿ä½œï¼Œå¸¦æ¥äº†æ›´å¤šçš„ CSS è§£å†³æ–¹æ¡ˆã€‚ CSS Houdini ç›®å‰ä¸»è¦æä¾›äº†ä»¥ä¸‹å‡ ä¸ª APIï¼š CSS Properties and Values API å…è®¸åœ¨ CSS ä¸­å®šä¹‰å˜é‡å’Œä½¿ç”¨å˜é‡ï¼Œæ˜¯ç›®å‰æ”¯æŒç¨‹åº¦æœ€é«˜çš„ä¸€ä¸ª APIã€‚CSS å˜é‡ä»¥ -- å¼€å¤´ï¼Œé€šè¿‡ var() è°ƒç”¨ï¼š 1234div { --font-color: #9e4a9b; color: var(--font-color);} æ­¤å¤–ï¼ŒCSS å˜é‡ä¹Ÿå¯ä»¥åœ¨å…¶ä»–èŠ‚ç‚¹ä¸­ä½¿ç”¨ï¼Œåªä¸è¿‡æ˜¯æœ‰ä½œç”¨åŸŸé™åˆ¶çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è‡ªèº«å®šä¹‰çš„ CSS å˜é‡åªèƒ½è¢«è‡ªèº«æˆ–è‡ªèº«çš„å­èŠ‚ç‚¹ä½¿ç”¨ï¼š 123456.container { --font-color: #9e4a9b;}.container .text { color: var(--font-color);} å®šä¹‰å’Œä½¿ç”¨ CSS å˜é‡å¯ä»¥è®©æˆ‘ä»¬çš„ CSS ä»£ç å˜å¾—æ›´åŠ ç®€æ´æ˜äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥å•çº¯é€šè¿‡æ”¹å˜å˜é‡æ¥æ”¹å˜ box-shadow çš„é¢œè‰²ï¼š 1234567.text { --box-shadow-color: #3a4ba2; box-shadow: 0 0 30px var(--box-shadow-color);}.text:hover { --box-shadow-color: #7f2c2b;} Painting API å…è®¸å¼€å‘è€…ç¼–å†™è‡ªå·±çš„ Paint Moduleï¼Œè‡ªå®šä¹‰è¯¸å¦‚ background-image è¿™ç±»çš„ç»˜åˆ¶å±æ€§ã€‚è‡ªå®šä¹‰çš„é‡ç‚¹åœ¨äºï¼Œâ€æ€ä¹ˆç”»â€ çš„é€»è¾‘éœ€è¦æˆ‘ä»¬æ¥æè¿°ï¼Œå› æ­¤æˆ‘ä»¬åˆ©ç”¨ registerPaint æ¥æè¿°æˆ‘ä»¬çš„ç»˜åˆ¶é€»è¾‘ï¼š 12345registerPaint('rect', class { paint(ctx, size, properties, args) { // @TODO }}); registerPaint æ–¹æ³•æ³¨å†Œäº†ä¸€ä¸ª Paint ç±» rect ä»¥ä¾›è°ƒç”¨ï¼Œè¿™ä¸ªç±»çš„æ ¸å¿ƒåœ¨äºå®ƒçš„ paint æ–¹æ³•ã€‚paint æ–¹æ³•ç”¨äºæè¿°è‡ªå®šä¹‰çš„ç»˜åˆ¶é€»è¾‘ï¼Œå®ƒæ¥æ”¶å››ä¸ªå‚æ•°ï¼š ctxï¼šä¸€ä¸ª Canvas çš„ Context å¯¹è±¡ï¼Œå› æ­¤ paint ä¸­çš„ç»˜åˆ¶æ–¹å¼è·Ÿ canvas ç»˜åˆ¶æ˜¯ä¸€æ ·çš„ã€‚ sizeï¼šåŒ…å«èŠ‚ç‚¹çš„å°ºå¯¸ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ canvas å¯ç»˜åˆ¶èŒƒå›´ï¼ˆç”»æ¿ï¼‰çš„å°ºå¯¸ä¿¡æ¯ã€‚ propertiesï¼šåŒ…å«èŠ‚ç‚¹çš„ CSS å±æ€§ï¼Œéœ€è¦è°ƒç”¨é™æ€æ–¹æ³• inputProperties å£°æ˜æ³¨å…¥ã€‚ args: CSS ä¸­è°ƒç”¨ Paint ç±»æ—¶ä¼ å…¥çš„å‚æ•°ï¼Œéœ€è¦è°ƒç”¨é™æ€æ–¹æ³• inputArguments å£°æ˜æ³¨å…¥ã€‚ ç¼–å†™å®Œ Paint ç±»ä¹‹åï¼Œæˆ‘ä»¬åœ¨ CSS ä¸­åªéœ€è¦è¿™æ ·è°ƒç”¨ï¼Œå°±èƒ½åº”ç”¨åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„ç»˜åˆ¶é€»è¾‘ï¼š 123.wrapper { background-image: paint(rect);} Painting API ç›®å‰åœ¨é«˜ç‰ˆæœ¬ Chromeã€Opera æµè§ˆå™¨å·²æœ‰æ”¯æŒï¼Œä¸”å®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œåè¾¹æˆ‘ä»¬è¿˜å°†é€šè¿‡ demo è¿›ä¸€æ­¥æ¼”ç¤ºã€‚ Layout APIå…è®¸å¼€å‘è€…ç¼–å†™è‡ªå·±çš„ Layout Moduleï¼Œè‡ªå®šä¹‰è¯¸å¦‚ display è¿™ç±»çš„å¸ƒå±€å±æ€§ã€‚åŒæ ·çš„ï¼Œâ€å¦‚ä½•å¸ƒå±€â€ çš„é€»è¾‘éœ€è¦æˆ‘ä»¬è‡ªå·±ç¼–å†™ï¼š 1234567891011registerLayout('block-like', class { layout(children, edges, constraints, properties, breakToken) { // @TODO return { // inlineSize: number, // blockSize: number, // autoBlockSize: number, // childFragments: sequence&lt;LayoutFragment&gt; } }}) registerLayout æ–¹æ³•ç”¨äºæ³¨å†Œä¸€ä¸ª Layout ç±»ä»¥ä¾›è°ƒç”¨ï¼Œå®ƒçš„ layout æ–¹æ³•ç”¨äºæè¿°è‡ªå®šä¹‰çš„å¸ƒå±€é€»è¾‘ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ªåŒ…å«å¸ƒå±€åçš„ä½ç½®å°ºå¯¸ä¿¡æ¯å’Œå­èŠ‚ç‚¹åºåˆ—ä¿¡æ¯çš„å¯¹è±¡ï¼Œå¼•æ“å°†æ ¹æ®è¿™ä¸ªå¯¹è±¡è¿›è¡Œå¸ƒå±€æ¸²æŸ“ã€‚ åŒæ ·çš„ï¼Œè°ƒç”¨æ—¶åªéœ€ï¼š 123.wrapper { display: layout('block-like');} å› æ­¤åˆ©ç”¨ Layout APIï¼Œä½ å®Œå…¨å¯ä»¥å®ç°å¯¹ flex å¸ƒå±€çš„æ‰‹å·¥å…¼å®¹ã€‚ç›¸æ¯” Paintingï¼ŒLayout çš„ç¼–å†™æ˜¾å¾—æ›´åŠ å¤æ‚ï¼Œæ¶‰åŠåˆ°ç›’æ¨¡å‹çš„æ·±å…¥æ¦‚å¿µï¼Œä¸”æ”¯æŒåº¦ä¸é«˜ï¼Œè¿™é‡Œå°±ä¸ç»†è®²äº†ã€‚ WorkletsregisterPaintã€registerLayout è¿™äº› API åœ¨å…¨å±€ä¸Šå¹¶ä¸å­˜åœ¨ï¼Œä¸ºä»€ä¹ˆå¯ä»¥ç›´æ¥è°ƒç”¨å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºä¸Šè¿°çš„ JS ä»£ç å¹¶ä¸æ˜¯ç›´æ¥æ‰§è¡Œçš„ï¼Œè€Œæ˜¯é€šè¿‡ Worklets è½½å…¥æ‰§è¡Œçš„ã€‚Worklets ç±»ä¼¼äº Web Workerï¼Œæ˜¯ä¸€ä¸ªè¿è¡Œäºä¸»ä»£ç ä¹‹å¤–çš„ç‹¬ç«‹å·¥ä½œè¿›ç¨‹ï¼Œä½†æ¯” Worker æ›´ä¸ºè½»é‡ï¼Œè´Ÿè´£ CSS æ¸²æŸ“ä»»åŠ¡æ˜¯æœ€åˆé€‚çš„äº†ã€‚å’Œ Web Worker ä¸€æ ·ï¼ŒWorklets æ‹¥æœ‰ä¸€ä¸ªéš”ç¦»äºä¸»è¿›ç¨‹çš„å…¨å±€ç©ºé—´ï¼Œåœ¨è¿™ä¸ªç©ºé—´é‡Œï¼Œæ²¡æœ‰ window å¯¹è±¡ï¼Œå´æœ‰ registerPaintã€registerLayout è¿™äº›å…¨å±€ APIã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è¿™æ ·å¼•å…¥è‡ªå®šä¹‰ JS ä»£ç ï¼š 123if (\"paintWorklet\" in CSS) { CSS.paintWorklet.addModule(\"paintworklet.js\");} 123if (\"layoutWorklet\" in CSS) { CSS.layoutWorklet.addModule(\"layoutworklet.js\");} åŸºç¡€ï¼šä¸‰æ­¥ç”¨ä¸Š Painting APIæˆ‘ä»¬æ¥è‡ªå®šä¹‰ background-image å±æ€§ï¼Œå®ƒå°†ç”¨äºç»™ä½œç”¨èŠ‚ç‚¹ç»˜åˆ¶ä¸€ä¸ªçŸ©å½¢èƒŒæ™¯ï¼ŒèƒŒæ™¯è‰²å€¼ç”±è¯¥èŠ‚ç‚¹ä¸Šçš„ä¸€ä¸ª CSS å˜é‡ --rect-color æŒ‡å®šã€‚ 1ã€ç¼–å†™ä¸€ä¸ª Paint ç±»ï¼šæ–°å»ºä¸€ä¸ª paintworklet.jsï¼Œåˆ©ç”¨ registerPaint æ–¹æ³•æ³¨å†Œä¸€ä¸ª Paint ç±» rectï¼Œå®šä¹‰å±æ€§çš„ç»˜åˆ¶é€»è¾‘ï¼š 12345678910registerPaint(\"rect\", class { static get inputProperties() { return [\"--rect-color\"]; } paint(ctx, geom, properties) { const color = properties.get(\"--rect-color\")[0]; ctx.fillStyle = color; ctx.fillRect(0, 0, geom.width, geom.height); }}); ä¸Šè¾¹å®šä¹‰äº†ä¸€ä¸ªåä¸º rect çš„ Paint ç±»ï¼Œå½“ rect è¢«ä½¿ç”¨æ—¶ï¼Œä¼šå®ä¾‹åŒ– rect å¹¶è‡ªåŠ¨è§¦å‘ paint æ–¹æ³•æ‰§è¡Œæ¸²æŸ“ã€‚paint æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è·å–èŠ‚ç‚¹ CSS å®šä¹‰çš„ --rect-color å˜é‡ï¼Œå¹¶å°†å…ƒç´ çš„èƒŒæ™¯å¡«å……ä¸ºæŒ‡å®šé¢œè‰²ã€‚ç”±äºéœ€è¦ä½¿ç”¨å±æ€§ --rect-colorï¼Œæˆ‘ä»¬éœ€è¦åœ¨é™æ€æ–¹æ³• inputProperties ä¸­å£°æ˜ã€‚ 2ã€Worklets åŠ è½½ Paint ç±»ï¼šHTML ä¸­é€šè¿‡ Worklets è½½å…¥ä¸Šä¸€æ­¥éª¤å®ç°çš„ paintworklet.js å¹¶æ³¨å†Œ Paint ç±»ï¼š 123456&lt;div class=\"rect\"&gt;&lt;/div&gt;&lt;script&gt; if (\"paintWorklet\" in CSS) { CSS.paintWorklet.addModule(\"paintworklet.js\"); }&lt;/script&gt; 3ã€ä½¿ç”¨ Paint ç±»ï¼šCSS ä¸­ä½¿ç”¨çš„æ—¶å€™ï¼Œåªéœ€è¦è°ƒç”¨ paint æ–¹æ³•ï¼š 123456.rect { width: 100vw; height: 100vh; background-image: paint(rect); --rect-color: rgb(255, 64, 129);} å¯ä»¥çœ‹å¾—å‡ºåˆ©ç”¨ CSS Houdiniï¼Œæˆ‘ä»¬å¯ä»¥åƒæ“ä½œ canvas ä¸€æ ·çµæ´»è‡ªå¦‚åœ°å®ç°æˆ‘ä»¬æƒ³è¦çš„æ ·å¼åŠŸèƒ½ã€‚ è¿›é˜¶ï¼šå®ç°åŠ¨æ€æ³¢çº¹æ ¹æ®ä¸Šè¿°æ­¥éª¤ï¼Œæˆ‘ä»¬æ¼”ç¤ºä¸€ä¸‹å¦‚ä½•ç”¨ CSS Painting API å®ç°ä¸€ä¸ªåŠ¨æ€æ³¢æµªçš„æ•ˆæœï¼š 1234567891011121314151617181920212223242526&lt;!-- index.html --&gt;&lt;div id=\"wave\"&gt;&lt;/div&gt;&lt;style&gt; #wave { width: 20%; height: 70vh; margin: 10vh auto; background-color: #ff3e81; background-image: paint(wave); }&lt;/style&gt;&lt;script&gt; if (\"paintWorklet\" in CSS) { CSS.paintWorklet.addModule(\"paintworklet.js\"); const wave = document.querySelector(\"#wave\"); let tick = 0; requestAnimationFrame(function raf(now) { tick += 1; wave.style.cssText = `--animation-tick: ${tick};`; requestAnimationFrame(raf); }); }&lt;/script&gt; 12345678910111213141516171819202122232425262728// paintworklet.jsregisterPaint('wave', class { static get inputProperties() { return ['--animation-tick']; } paint(ctx, geom, properties) { let tick = Number(properties.get('--animation-tick')); const { width, height } = geom; const initY = height * 0.4; tick = tick * 2; ctx.beginPath(); ctx.moveTo(0, initY + Math.sin(tick / 20) * 10); for (let i = 1; i &lt;= width; i++) { ctx.lineTo(i, initY + Math.sin((i + tick) / 20) * 10); } ctx.lineTo(width, height); ctx.lineTo(0, height); ctx.lineTo(0, initY + Math.sin(tick / 20) * 10); ctx.closePath(); ctx.fillStyle = 'rgba(255, 255, 255, 0.5)'; ctx.fill(); }}) paintworklet ä¸­ï¼Œåˆ©ç”¨ sin å‡½æ•°ç»˜åˆ¶æ³¢æµªçº¿ï¼Œç”±äº AnimationWorklets å°šå¤„äºå®éªŒé˜¶æ®µï¼Œå¼€æ”¾è¾ƒå°‘ï¼Œè¿™é‡Œæˆ‘ä»¬åœ¨ worklet å¤–éƒ¨ç”¨ requestAnimationFrame API æ¥åšåŠ¨ç”»é©±åŠ¨ï¼Œè®©æ³¢æµªçº¹åŠ¨èµ·æ¥ã€‚å®Œæˆåèƒ½çœ‹åˆ°ä¸‹è¾¹è¿™æ ·çš„æ•ˆæœã€‚ ç„¶è€Œäº‹å®ä¸Šè¿™ä¸ªæ•ˆæœç•¥æ˜¾åƒµç¡¬ï¼Œsin å‡½æ•°å¤ªè¿‡äºè§„åˆ™äº†ï¼Œç°å®ä¸­çš„æ³¢æµªåº”è¯¥æ˜¯ä¸è§„åˆ™æ³¢åŠ¨çš„ï¼Œè¿™ç§ä¸è§„åˆ™ä¸»è¦ä½“ç°åœ¨ä¸¤ä¸ªæ–¹é¢ï¼š 1ï¼‰æ³¢çº¹é«˜åº¦ï¼ˆYï¼‰éšä½ç½®ï¼ˆXï¼‰å˜åŒ–è€Œä¸è§„åˆ™å˜åŒ– æŠŠå›¾æŒ‰ç…§ x-y æ­£äº¤åˆ†è§£ä¹‹åï¼Œæˆ‘ä»¬å¸Œæœ›çš„ä¸è§„åˆ™ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å›ºå®šæŸä¸€æ—¶åˆ»ï¼Œéšç€ x è½´å˜åŒ–ï¼Œæ³¢çº¹é«˜åº¦ y å‘ˆç°ä¸è§„åˆ™å˜åŒ–ï¼› 2ï¼‰å›ºå®šæŸç‚¹ï¼ˆX å›ºå®šï¼‰ï¼Œæ³¢çº¹é«˜åº¦ï¼ˆYï¼‰éšæ—¶é—´æ¨è¿›è€Œä¸è§„åˆ™å˜åŒ–åŠ¨æ€è¿‡ç¨‹éœ€è¦è€ƒè™‘æ—¶é—´ç»´åº¦ï¼Œæˆ‘ä»¬å¸Œæœ›çš„ä¸è§„åˆ™ï¼Œè¿˜éœ€è¦ä½“ç°åœ¨æ—¶é—´çš„å½±å“ä¸­ï¼Œæ¯”å¦‚é£å¹è¿‡çš„å‰ä¸€ç§’å’Œåä¸€ç§’ï¼ŒåŒä¸€ä¸ªä½ç½®çš„æ³¢æµªé«˜åº¦è‚¯å®šæ˜¯ä¸è§„åˆ™å˜åŒ–çš„ã€‚ æåˆ°ä¸è§„åˆ™ï¼Œæœ‰æœ‹å‹å¯èƒ½æƒ³åˆ°äº†ç”¨ Math.random æ–¹æ³•ï¼Œç„¶è€Œè¿™é‡Œçš„ä¸è§„åˆ™å¹¶ä¸é€‚åˆç”¨éšæœºæ•°æ¥å®ç°ï¼Œå› ä¸ºå‰åä¸¤æ¬¡å–çš„éšæœºæ•°æ˜¯ä¸è¿ç»­çš„ï¼Œè€Œå‰åä¸¤ä¸ªç‚¹çš„æ³¢æµªæ˜¯è¿ç»­çš„ã€‚è¿™ä¸ªä¸éš¾ç†è§£ï¼Œä½ è§è¿‡é•¿æˆé”¯é½¿çŠ¶çš„æ³¢æµªå—ï¼Ÿåˆæˆ–è€…ä½ è§è¿‡ä¸Šä¸€åˆ» 10 ç±³é«˜ã€ä¸‹ä¸€åˆ»å°±æ‰åˆ° 2 ç±³çš„æ³¢æµªå—ï¼Ÿ ä¸ºäº†å®ç°è¿™ç§è¿ç»­ä¸è§„åˆ™çš„ç‰¹å¾ï¼Œæˆ‘ä»¬å¼ƒç”¨ sin å‡½æ•°ï¼Œå¼•å…¥äº†ä¸€ä¸ªåŒ… simplex-noiseã€‚ç”±äºå½±å“æ³¢é«˜çš„æœ‰ä¸¤ä¸ªç»´åº¦ï¼Œä½ç½® X å’Œæ—¶é—´ Tï¼Œè¿™é‡Œéœ€è¦ç”¨åˆ° noise2D æ–¹æ³•ï¼Œå®ƒæå‰åœ¨ä¸€ä¸ªä¸‰ç»´çš„ç©ºé—´ä¸­ï¼Œæ„å»ºäº†ä¸€ä¸ªè¿ç»­çš„ä¸è§„åˆ™æ›²é¢ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142// paintworklet.jsimport SimplexNoise from 'simplex-noise';const sim = new SimplexNoise(() =&gt; 1);registerPaint('wave', class { static get inputProperties() { return ['--animation-tick']; } paint(ctx, geom, properties) { const tick = Number(properties.get('--animation-tick')); this.drawWave(ctx, geom, 'rgba(255, 255, 255, 0.4)', 0.004, tick, 15, 0.4); this.drawWave(ctx, geom, 'rgba(255, 255, 255, 0.5)', 0.006, tick, 12, 0.4); } /** * ç»˜åˆ¶æ³¢çº¹ */ drawWave(ctx, geom, fillColor, ratio, tick, amp, ih) { const { width, height } = geom; const initY = height * ih; const speedT = tick * ratio; ctx.beginPath(); for (let x = 0, speedX = 0; x &lt;= width; x++) { speedX += ratio * 1; var y = initY + sim.noise2D(speedX, speedT) * amp; ctx[x === 0 ? 'moveTo' : 'lineTo'](x, y); } ctx.lineTo(width, height); ctx.lineTo(0, height); ctx.lineTo(0, initY + sim.noise2D(0, speedT) * amp); ctx.closePath(); ctx.fillStyle = fillColor; ctx.fill(); }}) ä¿®æ”¹å³°å€¼å’Œåç½®é¡¹ç­‰å‚æ•°ï¼Œå¯ä»¥å†ç”»å¤šä¸€ä¸ªä¸ä¸€æ ·çš„æ³¢æµªçº¹ï¼Œæ•ˆæœå¦‚ä¸‹ï¼Œå®Œå·¥ï¼ å‚è€ƒæ–‡ç«  CSS Painting API Level 1CSS Layout API Level 1CSS é­”è¡“å¸« Houdini API ä»‹ç´¹","link":"/2019/07/12/CSS Houdiniå®ç°åŠ¨æ€æ³¢æµªçº¹/"},{"title":"JavascriptæŠ½è±¡è¯­æ³•æ ‘ä¸Šç¯‡(åŸºç¡€ç¯‡)","text":"ä½œè€…ï¼šé™ˆæ™“å¼º ä¸€ã€åŸºç¡€ä¸ºä»€ä¹ˆè¦äº†è§£æŠ½è±¡è¯­æ³•æ ‘æ—¥å¸¸å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä¼šç¢°åˆ°jsä»£ç è§£æçš„åœºæ™¯ï¼Œæ¯”å¦‚åˆ†æä»£ç ä¸­requireäº†å“ªäº›åŒ…ï¼Œæœ‰äº›ä»€ä¹ˆå…³é”®APIè°ƒç”¨ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥å¤„ç†ï¼Œå¯ä¸€æ—¦åœºæ™¯å¤æ‚ï¼Œæˆ–è€…ä¾èµ–äºä»£ç ä¸Šä¸‹æ–‡æ—¶ï¼Œæ­£åˆ™å°±å¾ˆéš¾å¤„ç†äº†ï¼Œè¿™æ—¶å€™å°±è¦ç”¨åˆ°æŠ½è±¡è¯­æ³•æ ‘ã€‚å¸¸è§çš„uglifyã€eslintã€babelã€webpackç­‰ç­‰éƒ½æ˜¯åŸºäºæŠ½è±¡è¯­æ³•æ ‘æ¥å¤„ç†çš„ï¼Œå¦‚æ­¤å¼ºå¤§ï¼Œæœ‰å¿…è¦å¥½å¥½äº†è§£ä¸€ä¸‹ã€‚ ä»€ä¹ˆæ˜¯æŠ½è±¡è¯­æ³•æ ‘æŠ½è±¡è¯­æ³•æ ‘å³ï¼šAbstract Syntax Treeã€‚ç®€ç§°ASTï¼Œè§ä¸‹å›¾ã€‚ å›¾ä¸­codeå…ˆç»è¿‡parseè½¬æ¢æˆä¸€ä¸ªæ ‘çŠ¶æ•°æ®ç»“æ„ æ¥ç€å¯¹æ ‘ä¸­èŠ‚ç‚¹è¿›è¡Œè½¬æ¢ï¼Œå›¾ä¸­å°†å¶å­èŠ‚ç‚¹å¯¹æ¢ä½ç½® å°†æ ‘çŠ¶ç»“æ„é€šè¿‡generateå†ç”Ÿæˆcode å›¾ä¸­æ ‘çŠ¶æ•°æ®ç»“æ„å³ASTï¼Œä»è¿™ä¸ªè¿‡ç¨‹å¯ä»¥çœ‹åˆ°å°†ä»£ç è½¬æˆASTåï¼Œé€šè¿‡æ“ä½œèŠ‚ç‚¹æ¥æ”¹å˜ä»£ç ã€‚ å¦‚ä½•è·å¾—æŠ½è±¡è¯­æ³•æ ‘è·å¾—æŠ½è±¡è¯­æ³•æ ‘çš„è¿‡ç¨‹ä¸ºï¼šä»£ç  =&gt; è¯æ³•åˆ†æ =&gt; è¯­æ³•åˆ†æ =&gt; ASTè¯æ³•åˆ†æï¼šæŠŠå­—ç¬¦ä¸²å½¢å¼çš„ä»£ç è½¬æ¢ä¸ºä»¤ç‰Œï¼ˆtokensï¼‰æµã€‚è¯­æ³•åˆ†æï¼šæŠŠä¸€ä¸ªä»¤ç‰Œæµè½¬æ¢æˆ AST çš„å½¢å¼ã€‚è¿™ä¸ªé˜¶æ®µä¼šä½¿ç”¨ä»¤ç‰Œä¸­çš„ä¿¡æ¯æŠŠå®ƒä»¬è½¬æ¢æˆä¸€ä¸ª AST çš„è¡¨è¿°ç»“æ„ï¼Œè¿™æ ·æ›´æ˜“äºåç»­çš„æ“ä½œã€‚å¦‚ä¸‹å›¾ï¼Œä»£ç ä¸ºä¸€ä¸ªç®€å•çš„å‡½æ•°å£°æ˜ã€‚è¯æ³•åˆ†æé˜¶æ®µï¼Œå°†ä»£ç ä½œä¸ºå­—ç¬¦ä¸²è¾“å…¥è·å¾—å…³é”®è¯ï¼Œå›¾ä¸­functionã€squareã€(ã€)ã€{ã€}ç­‰éƒ½è¢«è¯†åˆ«ä¸ºå…³é”®è¯(ç¨å¾®å›å¿†ä¸‹ç¼–è¯‘åŸç†ï¼Œå­—ç¬¦æŒ¨ä¸ªå…¥æ ˆï¼Œç¬¦åˆä¸€å®šè§„åˆ™å³å‡ºæ ˆ)ã€‚è¯­æ³•åˆ†æé˜¶æ®µï¼Œå¯¹å…³é”®è¯çš„ç»„åˆå½¢æˆä¸€ä¸ªä¸ªèŠ‚ç‚¹ï¼Œå¦‚n*nè¿™3ä¸ªå…³é”®è¯ç»„åˆæˆäºŒå…ƒè¡¨è¾¾å¼ï¼Œå…³é”®è¯returnä¸äºŒå…ƒè¡¨è¾¾å¼ç»„åˆæˆreturnè¯­å¥ã€‚æœ€åç»„åˆæˆä¸€ä¸ªå‡½æ•°å£°æ˜è¯­å¥ã€‚ äºŒã€è§„èŒƒå¦‚ä½•è·å¾—ASTå·²ç»ç®€å•ä»‹ç»äº†ï¼Œé‚£ASTæœ€ç»ˆåº”è¯¥ä»¥ä»€ä¹ˆæ ·çš„æ•°æ®ç»“æ„å­˜åœ¨å‘¢ï¼Œå…ˆçœ‹çœ‹ä¸Šè¿°å‡½æ•°å£°æ˜çš„ASTç»“æ„ é‚£è§£æçš„ä¾æ®æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦ä»¥ä¸Šå›¾çš„ç»“æ„å‡ºç°ï¼Œä¸šç•Œå·²ç»æœ‰äº†ä¸€å¥—æˆç†Ÿçš„è§„èŒƒã€‚ è§„èŒƒèµ·æºåœ¨v8å¼•æ“ä¹‹å‰ï¼Œæœ€æ—©jså¼•æ“æ˜¯SpiderMonkeyï¼Œç¬¬ä¸€ä¸ªç‰ˆæœ¬ç”±jsä½œè€…Brendan Eichè®¾è®¡ï¼Œåäº¤ç»™Mozillaç»„ç»‡ç»´æŠ¤ã€‚jså¼•æ“åœ¨æ‰§è¡Œjsæ–‡ä»¶æ—¶ï¼Œéƒ½ä¼šå…ˆå°†jsä»£ç è½¬æ¢æˆæŠ½è±¡è¯­æ³•æ ‘(AST)ã€‚æœ‰ä¸€å¤©ï¼Œä¸€ä½Mozillaå·¥ç¨‹å¸ˆåœ¨FireFoxä¸­å…¬å¼€äº†è¿™ä¸ªå°†ä»£ç è½¬æˆASTçš„è§£æå™¨Apiï¼Œä¹Ÿå°±æ˜¯Parser_API[1]ï¼Œåæ¥è¢«äººæ•´ç†åˆ°githubé¡¹ç›®estree[2]ï¼Œæ…¢æ…¢çš„æˆäº†ä¸šç•Œçš„è§„èŒƒã€‚ è§„èŒƒè§£è¯»ä¸Šé¢æåˆ°çš„Parser_APIæ˜¯è§„èŒƒçš„åŸæ–‡ï¼Œä¸­æ–‡ç‰ˆ:Parser_API[3]ï¼Œä½†è¯»èµ·æ¥å¹¶ä¸å¤ªå‹å¥½ï¼Œæ¨èç›´æ¥è¯»æ•´ç†åçš„gité¡¹ç›®estreeï¼Œæ‰“å¼€é¡¹ç›®åœ°å€ï¼Œå¦‚ä¸‹å›¾å…¶ä¸­æœ€ä¸‹é¢çš„es5.mdä¸ºES5è§„èŒƒï¼Œä»…åˆ—å‡ºES5çš„å†…å®¹ï¼Œes2015.mdä¸ºES6è§„èŒƒï¼Œä½†åªåˆ—å‡ºäº†é’ˆå¯¹ES5æ–°å¢çš„å†…å®¹ï¼Œä¾æ¬¡ç±»æ¨ï¼Œæœ€åçš„es2019.mdå³ES10æ˜¯å¯¹ES9çš„è¡¥å……ï¼Œä»…æœ‰ä¸€æ¡è§„åˆ™ã€‚ æ‰“å¼€æœ€åŸºç¡€çš„es5.mdï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰è¯­æ³•åŸºç¡€ï¼Œè¿™é‡Œè·Ÿå¤§å®¶ä¸€èµ·è¯»ä¸€ä¸‹å¤§ç±»ï¼Œç»†åˆ†ç±»åˆ«å°±ç•¥è¿‡äº†ã€‚è¯»è§„èŒƒæ—¶å¯ä»¥ä½¿ç”¨https://astexplorer.net/ è¾…åŠ©é˜…è¯»ï¼Œå¯ä»¥å®æ—¶è¾“å‡ºASTã€‚ Node objects Programs Identifier Literal Functions Statements Declarations Expressions Patterns Node objects1234interface Node { type: string; loc: SourceLocation | null;} å®šä¹‰ASTä¸­èŠ‚ç‚¹åŸºæœ¬ç±»å‹ï¼Œå…¶ä»–æ‰€æœ‰å…·ä½“èŠ‚ç‚¹éƒ½éœ€è¦å®ç°ä»¥ä¸Šæ¥å£ï¼Œå³æ¯ä¸ªèŠ‚ç‚¹éƒ½å¿…é¡»åŒ…å«typeã€locä¸¤ä¸ªå­—æ®µ typeå­—æ®µè¡¨ç¤ºä¸åŒçš„èŠ‚ç‚¹ç±»å‹ï¼Œä¸‹è¾¹ä¼šå†è®²ä¸€ä¸‹å„ä¸ªç±»å‹çš„æƒ…å†µï¼Œåˆ†åˆ«å¯¹åº”äº† JavaScript ä¸­çš„ä»€ä¹ˆè¯­æ³•ã€‚ä½ å¯ä»¥ä»è¿™ä¸ªå­—æ®µçœ‹å‡ºè¿™ä¸ªèŠ‚ç‚¹å®ç°äº†å“ªä¸ªæ¥å£locå­—æ®µè¡¨ç¤ºæºç çš„ä½ç½®ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰ç›¸å…³ä¿¡æ¯çš„è¯ä¸º nullï¼Œå¦åˆ™æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†å¼€å§‹å’Œç»“æŸçš„ä½ç½®ã€‚æ¥å£å¦‚ä¸‹ 12345interface SourceLocation { source: string | null; start: Position; end: Position;} æ¯ä¸ª Position å¯¹è±¡åŒ…å«äº†è¡Œï¼ˆä»1å¼€å§‹ï¼‰å’Œåˆ—ï¼ˆä»0å¼€å§‹ï¼‰ä¿¡æ¯ï¼Œæ¥å£å¦‚ä¸‹ 1234interface Position { line: number; // &gt;= 1 column: number; // &gt;= 0} Programs1234interface Program &lt;: Node { type: \"Program\"; body: [ Directive | Statement ];} ä¸€æ£µå®Œæ•´çš„ç¨‹åºä»£ç æ ‘ï¼Œä¸€èˆ¬ä½œä¸ºæ ¹èŠ‚ç‚¹ Identifier1234interface Identifier &lt;: Expression, Pattern { type: \"Identifier\"; name: string;} æ ‡è¯†ç¬¦ï¼Œæˆ‘ä»¬å†™ä»£ç æ—¶è‡ªå®šä¹‰çš„åç§°ï¼Œå¦‚å˜é‡åã€å‡½æ•°åã€å±æ€§åã€‚ Literal1234interface Literal &lt;: Expression { type: \"Literal\"; value: string | boolean | null | number | RegExp;} å­—é¢é‡ï¼Œå¦‚â€œhelloâ€ã€trueã€nullã€100ã€/\\d/è¿™äº›ï¼Œæ³¨æ„å­—é¢é‡æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼è¯­å¥(ExpressionStatement) Functions12345interface Function &lt;: Node { id: Identifier | null; params: [ Pattern ]; body: FunctionBody;} ä¸€ä¸ªå‡½æ•°å£°æ˜æˆ–è€…è¡¨è¾¾å¼ï¼Œidæ˜¯å‡½æ•°åï¼Œparamsæ˜¯æ ‡è¯†ç¬¦æ•°ç»„ï¼Œbodyæ˜¯å‡½æ•°ä½“ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªè¯­å¥å—ã€‚ Statements1interface Statement &lt;: Node { } è¯­å¥ï¼Œå­ç±»æœ‰å¾ˆå¤šï¼Œå—è¯­å¥ã€if/switchè¯­å¥ã€returnè¯­å¥ã€for/whileè¯­å¥ã€withè¯­å¥ç­‰ç­‰ Declarations1interface Declaration &lt;: Statement { } å£°æ˜ï¼Œå­ç±»ä¸»è¦æœ‰å˜é‡ç”³æ˜ã€å‡½æ•°å£°æ˜ã€‚ Expressions1interface Expression &lt;: Node { } è¡¨è¾¾å¼ï¼Œå­ç±»å¾ˆå¤šï¼Œæœ‰äºŒå…ƒè¡¨è¾¾å¼(n*n)ã€å‡½æ•°è¡¨è¾¾å¼(var fun = function(){})ã€æ•°ç»„è¡¨è¾¾å¼(var arr = [])ã€å¯¹è±¡è¡¨è¾¾å¼(var obj = {})ã€èµ‹å€¼è¡¨è¾¾å¼(a = 1)ç­‰ç­‰ Patterns1interface Pattern &lt;: Node { } æ¨¡å¼ï¼Œä¸»è¦åœ¨ ES6 çš„è§£æ„èµ‹å€¼ä¸­æœ‰æ„ä¹‰(let {name} = userï¼Œå…¶ä¸­{name}éƒ¨åˆ†ä¸ºObjectPattern)ï¼Œåœ¨ ES5 ä¸­ï¼Œå¯ä»¥ç†è§£ä¸ºå’ŒIdentifier å·®ä¸å¤šçš„ä¸œè¥¿ã€‚ ä¸‰ã€ç°çŠ¶é€šè¿‡ä»¥ä¸Šè§„èŒƒè§£è¯»ï¼ŒçŸ¥é“äº†æœ€ç»ˆè¦ç”Ÿæˆçš„ASTä»¥ä»€ä¹ˆæ ·çš„ç»“æ„å­˜åœ¨ï¼Œå¯¹äºjavascriptçš„è§£æï¼Œä¸šç•Œå·²ç»æœ‰å¾ˆå¤šæˆç†Ÿçš„è§£æå™¨ï¼Œå¯ä»¥å°†jsä»£ç è½¬æ¢æˆç¬¦åˆè§„èŒƒçš„AST Esprimaï¼Œæ¯”è¾ƒç»å…¸ï¼Œå‡ºç°çš„æ¯”è¾ƒæ—© Acornï¼Œforkè‡ªEsprimaï¼Œä»£ç æ›´ç²¾ç®€ã€‚webpackä½¿ç”¨acornè¿›è¡Œæ¨¡å—è§£æ UglifyJS2ï¼Œä¸»è¦ç”¨äºä»£ç å‹ç¼© babylonï¼Œbabelè§£æå™¨ï¼Œforkè‡ªAcornï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬æ˜¯babylon7,å¯¹åº”npmåŒ…@babel/parser Espreeï¼Œeslinté»˜è®¤çš„è§£æå™¨ï¼Œç”±äºéµå¾ªåŒä¸€å¥—è§„èŒƒï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨babelçš„è§£æå™¨æ›¿ä»£ flowã€shiftç­‰ç­‰ ASTåŸºç¡€ç¯‡ä»‹ç»å®Œæ¯•ï¼Œä¸‹ç¯‡å°†ä»å®è·µçš„è§’åº¦ç»§ç»­ä»‹ç» References[1] Parser_APIï¼šhttps://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/Parser_API[2] estreeï¼šhttps://github.com/estree/estree[3] Parser_API(ä¸­æ–‡)ï¼šhttps://developer.mozilla.org/zh-CN/docs/Mozilla/Projects/SpiderMonkey/Parser_API","link":"/2019/07/19/JavascriptæŠ½è±¡è¯­æ³•æ ‘ä¸Šç¯‡(åŸºç¡€ç¯‡)/"},{"title":"ç¢°æ’æ£€æµ‹çš„å‘é‡å®ç°","text":"ä½œè€…ï¼š å´å† ç¦§ æ³¨ï¼š1ã€æœ¬æ–‡åªè®¨è®º2då›¾å½¢ç¢°æ’æ£€æµ‹ã€‚2ã€æœ¬æ–‡è®¨è®ºåœ†å½¢ä¸åœ†å½¢ï¼ŒçŸ©å½¢ä¸çŸ©å½¢ã€åœ†å½¢ä¸çŸ©å½¢ç¢°æ’æ£€æµ‹çš„å‘é‡å®ç° å‰è¨€2Dæ¸¸æˆä¸­ï¼Œé€šå¸¸ä½¿ç”¨çŸ©å½¢ã€åœ†å½¢ç­‰æ¥ä»£æ›¿å¤æ‚å›¾å½¢çš„ç›¸äº¤æ£€æµ‹ã€‚å› ä¸ºè¿™ä¸¤ç§å½¢çŠ¶çš„ç¢°æ’æ£€æµ‹é€Ÿåº¦æ˜¯æœ€å¿«çš„ã€‚å…¶ä¸­çŸ©å½¢åŒ…å›´ç›’åˆå¯ä»¥åˆ†ä¸ºè½´å¯¹é½åŒ…å›´ç›’ï¼ˆAABB, Axis Aligned Bounding Boxï¼‰ä¸è½¬å‘åŒ…å›´ç›’ï¼ˆOBB, Oriented Bounding Boxï¼‰ã€‚AABBä¸OBBçš„åŒºåˆ«åœ¨äºï¼ŒAABBä¸­çš„çŸ©å½¢çš„å…¶ä¸­ä¸€æ¡è¾¹å’Œåæ ‡è½´å¹³è¡Œï¼ŒOBBçš„è®¡ç®—å¤æ‚åº¦è¦é«˜äºAABBã€‚æ ¹æ®ä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œå¯ä»¥ç”¨ä¸åŒçš„æ–¹æ¡ˆã€‚ å¦‚ä¸Šå›¾ï¼Œæ˜æ˜¾çš®å¡è¶…é€‚åˆç”¨åŒ…å›´ç›’ï¼Œç²¾çµçƒé€‚åˆç”¨åŒ…å›´çƒã€‚ å‘é‡å‘é‡ä½œä¸ºä¸€ç§æ•°å­¦å·¥å…·ï¼Œåœ¨ç¢°æ’æ£€æµ‹ä¸­å‘æŒ¥å¾ˆå¤§ä½œç”¨ï¼Œåé¢çš„è®¡ç®—éƒ½æ˜¯é€šè¿‡å‘é‡æ¥å®Œæˆï¼Œæ‰€ä»¥å…ˆæ¥å¤ä¹ ä¸€ä¸‹å‘é‡ã€‚ å‘é‡çš„ä»£æ•°è¡¨ç¤ºå‘é‡çš„ä»£æ•°è¡¨ç¤ºæŒ‡åœ¨æŒ‡å®šäº†ä¸€ä¸ªåæ ‡ç³»ä¹‹åï¼Œç”¨ä¸€ä¸ªå‘é‡åœ¨è¯¥åæ ‡ç³»ä¸‹çš„åæ ‡æ¥è¡¨ç¤ºè¯¥å‘é‡ï¼Œå…¼å…·äº†ç¬¦å·çš„æŠ½è±¡æ€§å’Œå‡ ä½•å½¢è±¡æ€§ï¼Œå› è€Œå…·æœ‰æœ€é«˜çš„å®ç”¨æ€§ï¼Œè¢«å¹¿æ³›é‡‡ç”¨äºéœ€è¦å®šé‡åˆ†æçš„æƒ…å½¢ã€‚ å¯¹äºè‡ªç”±å‘é‡ï¼Œå°†å‘é‡çš„èµ·ç‚¹å¹³ç§»åˆ°åæ ‡åŸç‚¹åï¼Œå‘é‡å°±å¯ä»¥ç”¨ä¸€ä¸ªåæ ‡ç³»ä¸‹çš„ä¸€ä¸ªç‚¹æ¥è¡¨ç¤ºï¼Œè¯¥ç‚¹çš„åæ ‡å€¼å³å‘é‡çš„ç»ˆç‚¹åæ ‡ã€‚ 123456789// äºŒç»´å¹³é¢å‘é‡class Vector2d{ constructor(vx=1,vy=1){ this.vx = vx; this.vy = vy; }}const vecA = new Vector2d(1,2);const vecB = new Vector2d(3,1); å‘é‡è¿ç®—åŠ æ³•ï¼šå‘é‡çš„åŠ æ³•æ»¡è¶³å¹³è¡Œå››è¾¹å½¢æ³•åˆ™å’Œä¸‰è§’å½¢æ³•åˆ™ã€‚å…·ä½“çš„ï¼Œä¸¤å‘é‡ç›¸åŠ è¿˜æ˜¯ä¸€ä¸ªå‘é‡ï¼Œåˆ†åˆ«æ˜¯xä¸yä¸¤ä¸ªåˆ†é‡çš„ç›¸åŠ ã€‚ 123456// å‘é‡çš„åŠ æ³•è¿ç®—static add(vec,vec2){ const vx = vec.vx + vec2.vx; const vy = vec.vy + vec2.vy; return new Vector2d(vx,vy);} å‡æ³•ï¼šä¸¤ä¸ªå‘é‡aå’Œbçš„ç›¸å‡å¾—åˆ°çš„å‘é‡å¯ä»¥è¡¨ç¤ºä¸ºaå’Œbçš„èµ·ç‚¹é‡åˆåï¼Œä»bçš„ç»ˆç‚¹æŒ‡å‘açš„ç»ˆç‚¹çš„å‘é‡ï¼š 123456// å‘é‡çš„å‡æ³•è¿ç®—static sub(vec,vec2){ const vx = vec.vx - vec2.vx; const vy = vec.vy - vec2.vy; return new Vector2d(vx,vy);} å¤§å°ï¼šå‘é‡çš„å¤§å°ï¼Œæ˜¯å…¶å„ä¸ªåˆ†é‡çš„å¹³æ–¹å’Œå¼€æ–¹ã€‚ 1234// è·å–å‘é‡é•¿åº¦length(){ return Math.sqrt(this.vx * this.vx + this.vy * this.vy);} ç‚¹ç§¯ï¼šä»ä»£æ•°è§’åº¦çœ‹ï¼Œå…ˆå¯¹ä¸¤ä¸ªæ•°å­—åºåˆ—ä¸­çš„æ¯ç»„å¯¹åº”å…ƒç´ æ±‚ç§¯ï¼Œå†å¯¹æ‰€æœ‰ç§¯æ±‚å’Œï¼Œç»“æœå³ä¸ºç‚¹ç§¯ã€‚ 1234// å‘é‡çš„æ•°é‡ç§¯static dot(vec,vec2){ return vec.vx * vec2.vx + vec.vy * vec2.vy;} æ—‹è½¬ï¼šå‘é‡çš„æ—‹è½¬å¯ä»¥ç”¨æ—‹è½¬çŸ©é˜µæ±‚è§£ 12345678//å‘é‡çš„æ—‹è½¬ static rotate(vec,angle){ const cosVal = Math.cos(angle); const sinVal = Math.sin(angle); const vx = vec.vx * cosVal - vec.vy * sinVal; const vy = vec.vx * sinVal + vec.vy * cosVal; return new Vector2d(vx,vy);} åœ†åœ†å½¢æ¯”è¾ƒç®€å•ï¼Œåªè¦ç¡®è®¤åœ†å¿ƒx,yå’ŒåŠå¾„rå°±è¡Œäº†,ç„¶åæ¨å¯¼å‡ºåœ†å¿ƒå‘é‡ã€‚ 123456789class Circle{ // x,yæ˜¯åœ†çš„åœ†å¿ƒ ræ˜¯åŠå¾„ constructor(x=0,y=0,r=1){ this.x = x; this.y = y; this.r = r; } get P(){ return new Vector2d(this.x,this.y) } // åœ†å¿ƒå‘é‡} çŸ©å½¢çŸ©å½¢å°±è¾ƒä¸ºå¤æ‚ï¼Œå®šä¹‰ä¸€ä¸ªçŸ©å½¢éœ€è¦ä¸­å¿ƒåæ ‡çš„x,yã€ä¸¤è¾¹é•¿wå’Œhï¼Œè¿˜æœ‰æ ¹æ®ä¸­å¿ƒçš„æ—‹è½¬è§’åº¦rotation 12345678910export class Rect{ // x,yæ˜¯çŸ©å½¢ä¸­å¿ƒçš„åæ ‡ wæ˜¯å®½ hæ˜¯é«˜ rotationæ˜¯è§’åº¦å•ä½deg constructor(x=0,y=0,w=1,h=1,rotation=0){ this.x = x; this.y = y; this.w = w; this.h = h; this.rotation = rotation; }} ä¸¤åœ†ç›¸äº¤ ä¸¤åœ†ç›¸äº¤æ¯”è¾ƒç®€å•ï¼Œåªéœ€åˆ¤æ–­ä¸¤åœ†å¿ƒä¹‹é—´çš„è·ç¦»å°äºä¸¤åœ†çš„åŠå¾„ä¹‹å’Œã€‚ ä¸¤åœ†å¿ƒè·ç¦»å¯ä»¥ç”¨åœ†å¿ƒå‘é‡ç›¸å‡ï¼Œç„¶åæ±‚ç›¸å‡å‘é‡çš„é•¿åº¦ã€‚ 12345678circleCircleIntersect(circle1,circle2){ const P1 = circle1.P; const P2 = circle2.P; const r1 = circle1.r; const r2 = circle2.r; const u = Vector2d.sub(P1,P2); return u.length() &lt;= r1 + r2 ;} åœ†å’ŒçŸ©å½¢ç›¸äº¤æ¶‰åŠåˆ°çŸ©å½¢çš„ç›¸äº¤é—®é¢˜éƒ½å…ˆè¦åˆ¤æ–­æ˜¯å¦è½´å¯¹ç§°ã€‚ çŸ©å½¢è½´å¯¹ç§° å…ˆçœ‹è½´å¯¹ç§°çš„æƒ…å†µï¼Œä¸‹é¢æ˜¯æ¥è‡ªçŸ¥ä¹é—®é¢˜æ€æ ·åˆ¤æ–­å¹³é¢ä¸Šä¸€ä¸ªçŸ©å½¢å’Œä¸€ä¸ªåœ†å½¢æ˜¯å¦æœ‰é‡å ï¼Ÿã€ŒMilo Yipã€çš„å›ç­”æ¬è¿ï¼š è®¾cä¸ºçŸ©å½¢ä¸­å¿ƒï¼Œhä¸ºçŸ©å½¢åŠé•·ï¼Œpä¸ºåœ†å¿ƒï¼Œrä¸ºåŠå¾„ã€‚ æ–¹æ³•æ˜¯è®¡ç®—åœ†å¿ƒä¸çŸ©å½¢çš„æœ€çŸ­è·ç¦» uï¼Œè‹¥ u çš„é•¿åº¦å°äº r åˆ™ä¸¤è€…ç›¸äº¤ã€‚ é¦–å…ˆåˆ©ç”¨ç»å¯¹å€¼æŠŠ p - c è½¬ç§»åˆ°ç¬¬ä¸€è±¡é™ï¼Œä¸‹å›¾æ˜¾ç¤ºä¸åŒè±¡é™çš„åœ†å¿ƒä¹Ÿèƒ½æ˜ å°„è‡³ç¬¬ä¸€è±¡é™ï¼Œè¿™ä¸å½±å“ç›¸äº¤æµ‹è¯•çš„ç»“æœï¼š ç„¶åï¼ŒæŠŠ v å‡å» hï¼Œè´Ÿæ•°çš„åˆ†é‡è®¾ç½®ä¸º0ï¼Œå°±å¾—åˆ°åœ†å¿ƒä¸çŸ©å½¢æœ€çŸ­è·ç¦»çš„çŸ¢é‡ uã€‚ä¸‹å›¾å±•ç¤ºäº†4ç§æƒ…å†µï¼Œçº¢è‰²çš„uæ˜¯ç»“æœã€‚ æœ€åè¦æ¯”è¾ƒ u å’Œ r çš„é•¿åº¦ï¼Œè‹¥è·ç¦»å°‘äº rï¼Œåˆ™ä¸¤è€…ç›¸äº¤ã€‚å¯ä»¥åªæ±‚ u çš„é•¿åº¦å¹³æ–¹æ˜¯å¦å°äº r çš„å¹³æ–¹ã€‚ ä¸‹é¢æˆ‘ç”¨jså®ç°ä¸€ä¸‹ï¼š å…¶ä¸­çŸ©å½¢çš„å››ä¸ªé¡¶ç‚¹å‘½åä¸ºA1ï¼ŒA2ï¼ŒA3ï¼ŒA4ï¼ŒçŸ©å½¢åœ¨ç¬¬ä¸€è±¡é™çš„åŠé•·hç­‰äºCA3 1234567891011121314151617181920212223class Rect{ // x,yæ˜¯çŸ©å½¢ä¸­å¿ƒçš„åæ ‡ wæ˜¯å®½ hæ˜¯é«˜ rotationæ˜¯è§’åº¦å•ä½deg constructor(x=0,y=0,w=1,h=1,rotation=0){ this.x = x; this.y = y; this.w = w; this.h = h; this.rotation = rotation; } get C(){ return new Vector2d(this.x,this.y); } // çŸ©å½¢ä¸­å¿ƒå‘é‡ get A3(){ return new Vector2d(this.x+this.w/2,this.y+this.h/2); } // é¡¶ç‚¹A3å‘é‡}rectCircleIntersect(rect,circle){ const C = rect.C; const r = circle.r; const A3 = rect.A3; const P = circle.P; const h = Vector2d.sub(A3,C); // çŸ©å½¢åŠé•¿ const v = new Vector2d(Math.abs(P.vx - C.vx),Math.abs(P.vy - C.vy)); const u = new Vector2d(Math.max(v.vx - h.vx,0),Math.max(v.vy - h.vy,0)); return u.lengthSquared() &lt;= r * r;} çŸ©å½¢éè½´å¯¹ç§° è¿™ä¸ªé—®é¢˜å…¶å®ä¹Ÿå¾ˆå¥½è§£å†³ï¼Œå°†çŸ©å½¢ä¸­å¿ƒè§†ä¸ºæ—‹è½¬ä¸­å¿ƒï¼Œå°†çŸ©å½¢å’Œåœ†å½¢ä¸€èµ·åå‘æ—‹è½¬å°†çŸ©å½¢è½¬ä¸ºè½´å¯¹ç§°ï¼Œç„¶åå°±å¯ä»¥å¥—ç”¨ä¸Šé¢çš„è§£æ³•ã€‚ çŸ©å½¢ä¸­å¿ƒåˆ°åœ†å¿ƒå‘é‡ä¸ºæ˜¯CP åå‘æ—‹è½¬Î¸åº¦å¾—å‘é‡CPâ€™ ç„¶åæ ¹æ®å‘é‡å¾—ä¸‰è§’å½¢å®šå¾‹å¾—OPâ€™ = OC + CPâ€™ åé¢å°±ä»£å…¥çŸ©å½¢æ˜¯è½´å¯¹ç§°çš„å…¬å¼è¿›è¡Œè®¡ç®— 12345678910111213141516171819202122232425262728293031323334353637class Rect{ // x,yæ˜¯çŸ©å½¢ä¸­å¿ƒçš„åæ ‡ wæ˜¯å®½ hæ˜¯é«˜ rotationæ˜¯è§’åº¦å•ä½deg constructor(x=0,y=0,w=1,h=1,rotation=0){ this.x = x; this.y = y; this.w = w; this.h = h; this.rotation = rotation; } get C(){ return new Vector2d(this.x,this.y); } // çŸ©å½¢ä¸­å¿ƒå‘é‡ get A3(){ return new Vector2d(this.x+this.w/2,this.y+this.h/2); } // é¡¶ç‚¹A3å‘é‡ get _rotation(){ return this.rotation / 180 * Math.PI; } // è§’åº¦å•ä½è½¬æ¢}p(rect,circle){ const rotation = rect.rotation; const C = rect.C; let P; if (rotation % 360 === 0) { P = circle.P; // è½´å¯¹ç§°ç›´æ¥è¾“å‡ºP } else { P = Vector2d.add(C,Vector2d.rotate(Vector2d.sub(circle.P,C),rect._rotation*-1)); // éè½´å¯¹ç§°ï¼Œè®¡ç®—Pâ€˜ } return P;}rectCircleIntersect(rect,circle){ const rotation = rect.rotation; const C = rect.C; const r = circle.r; const A3 = rect.A3; const P = p(rect,circle); const h = Vector2d.sub(A3,C); const v = new Vector2d(Math.abs(P.vx - C.vx),Math.abs(P.vy - C.vy)); const u = new Vector2d(Math.max(v.vx - h.vx,0),Math.max(v.vy - h.vy,0)); return u.lengthSquared() &lt;= r * r;} æŸ¥çœ‹Demo1 https://rococolate.github.io/blog/gom/test1.html ä¸¤çŸ©å½¢ç›¸äº¤ä¸¤çŸ©å½¢éƒ½è½´å¯¹ç§°AABB æƒ³è±¡ä¸€ä¸‹ä¸¤ä¸ªçŸ©å½¢Aå’ŒBï¼ŒBè´´ç€Açš„è¾¹èµ°äº†ä¸€åœˆï¼ŒBçš„çŸ©å½¢ä¸­å¿ƒçš„è½¨è¿¹æ˜¯ä¸€ä¸ªæ–°çš„çŸ©å½¢ï¼Œè¿™æ ·å°±ç®€åŒ–æˆæ–°çŸ©å½¢ä¸Bä¸­å¿ƒç‚¹è¿™ä¸€ç‚¹çš„ç›¸äº¤é—®é¢˜ï¼Œåˆå› ä¸ºç‚¹å¯ä»¥çœ‹æˆæ˜¯åŠå¾„ä¸º0çš„åœ†ï¼Œæ‰€ä»¥é—®é¢˜åˆè½¬æ¢ä¸ºåœ†å½¢å’ŒçŸ©å½¢ç›¸äº¤ã€‚ 1234567891011121314151617181920212223242526class Rect{ // x,yæ˜¯çŸ©å½¢ä¸­å¿ƒçš„åæ ‡ wæ˜¯å®½ hæ˜¯é«˜ rotationæ˜¯è§’åº¦å•ä½deg constructor(x=0,y=0,w=1,h=1,rotation=0){ this.x = x; this.y = y; this.w = w; this.h = h; this.rotation = rotation; } get C(){ return new Vector2d(this.x,this.y); } // çŸ©å½¢ä¸­å¿ƒå‘é‡ get A3(){ return new Vector2d(this.x+this.w/2,this.y+this.h/2); } // é¡¶ç‚¹A3å‘é‡ get _rotation(){ return this.rotation / 180 * Math.PI; } // è§’åº¦å•ä½è½¬æ¢}AABBrectRectIntersect(rect1,rect2){ const P = rect2.C; const w2 = rect2.w; const h2 = rect2.h; const {w,h,x,y} = rect1; const C = rect1.C; const A3 = new Vector2d(x+w/2+w2/2,y+h/2+h2/2); // æ–°çŸ©å½¢çš„åŠé•¿ const H = Vector2d.sub(A3,C); const v = new Vector2d(Math.abs(P.vx - C.vx),Math.abs(P.vy - C.vy)); const u = new Vector2d(Math.max(v.vx - H.vx,0),Math.max(v.vy - H.vy,0)); return u.lengthSquared() === 0; // ç‚¹å¯ä»¥çœ‹æˆæ˜¯åŠå¾„ä¸º0çš„åœ†} ä¸¤çŸ©å½¢ç›¸äº¤éè½´å¯¹ç§°OBB ä¸¤ä¸ªçŸ©å½¢çš„OBBæ£€æµ‹ä½¿ç”¨åˆ†ç¦»è½´å®šç†ï¼ˆSeparating Axis Theoremï¼‰ åˆ†ç¦»è½´å®šç†ï¼šé€šè¿‡åˆ¤æ–­ä»»æ„ä¸¤ä¸ªçŸ©å½¢ åœ¨ä»»æ„è§’åº¦ä¸‹çš„æŠ•å½±æ˜¯å¦å‡å­˜åœ¨é‡å ï¼Œæ¥åˆ¤æ–­æ˜¯å¦å‘ç”Ÿç¢°æ’ã€‚è‹¥åœ¨æŸä¸€è§’åº¦å…‰æºä¸‹ï¼Œä¸¤ç‰©ä½“çš„æŠ•å½±å­˜åœ¨é—´éš™ï¼Œåˆ™ä¸ºä¸ç¢°æ’ï¼Œå¦åˆ™ä¸ºå‘ç”Ÿç¢°æ’ã€‚ å› ä¸ºçŸ©å½¢çš„å¯¹è¾¹å¹³è¡Œï¼Œæ‰€ä»¥åªè¦åˆ¤æ–­å››æ¡å¯¹ç§°è½´ä¸Šçš„æŠ•å½±å³å¯ã€‚ å¦‚ä½•æŠ•å½±ï¼Ÿè¿™é‡Œè¡¥å……ä¸€ä¸‹å‘é‡ç‚¹ç§¯çš„å‡ ä½•æ„ä¹‰ã€‚ åœ¨æ¬§å‡ é‡Œå¾—ç©ºé—´ä¸­ï¼Œç‚¹ç§¯å¯ä»¥ç›´è§‚åœ°å®šä¹‰ä¸º AÂ·B = |A||B|cosÎ¸ ,å…¶ä¸­|A|cosÎ¸æ˜¯Aåˆ°Bçš„æŠ•å½±ï¼Œå¦‚æœBæ˜¯å•ä½å‘é‡ï¼Œé‚£ä¹ˆAÂ·Bå°±æ˜¯Aåˆ°å•ä½å‘é‡Bçš„æŠ•å½± å›åˆ°çŸ©å½¢ï¼Œå°†çŸ©å½¢4ä¸ªé¡¶ç‚¹éƒ½æŠ•å½±åˆ°å¯¹ç§°è½´ä¸Šï¼Œæˆ‘ä»¬åˆ†åˆ«å°†å…¶ç‚¹ä¹˜å³å¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051class Rect{ // x,yæ˜¯çŸ©å½¢ä¸­å¿ƒçš„åæ ‡ wæ˜¯å®½ hæ˜¯é«˜ rotationæ˜¯è§’åº¦å•ä½deg constructor(x=0,y=0,w=1,h=1,rotation=0){ this.x = x; this.y = y; this.w = w; this.h = h; this.rotation = rotation; } get C(){ return new Vector2d(this.x,this.y); } get _A1(){ return new Vector2d(this.x-this.w/2,this.y-this.h/2); } // 4è§’é¡¶ç‚¹ get _A2(){ return new Vector2d(this.x+this.w/2,this.y-this.h/2); } get _A3(){ return new Vector2d(this.x+this.w/2,this.y+this.h/2); } get _A4(){ return new Vector2d(this.x-this.w/2,this.y+this.h/2); } get _axisX(){ return new Vector2d(1,0); } // æœªæ—‹è½¬æ—¶çš„å¯¹ç§°è½´X get _axisY(){ return new Vector2d(0,1); } // æœªæ—‹è½¬æ—¶çš„å¯¹ç§°è½´Y get _CA1(){ return Vector2d.sub(this._A1,this.C); } get _CA2(){ return Vector2d.sub(this._A2,this.C); } get _CA3(){ return Vector2d.sub(this._A3,this.C); } get _CA4(){ return Vector2d.sub(this._A4,this.C); } get _rotation(){ return this.rotation / 180 * Math.PI; } get A1(){ return this.rotation % 360 === 0 ? this._A1 : Vector2d.add(this.C,Vector2d.rotate(this._CA1,this._rotation)); } // è®¡ç®—ä¸Šæ—‹è½¬å4è§’é¡¶ç‚¹ get A2(){ return this.rotation % 360 === 0 ? this._A2 : Vector2d.add(this.C,Vector2d.rotate(this._CA2,this._rotation)); } get A3(){ return this.rotation % 360 === 0 ? this._A3 : Vector2d.add(this.C,Vector2d.rotate(this._CA3,this._rotation)); } get A4(){ return this.rotation % 360 === 0 ? this._A4 : Vector2d.add(this.C,Vector2d.rotate(this._CA4,this._rotation)); } get axisX(){ return this.rotation % 360 === 0 ? this._axisX : Vector2d.rotate(this._axisX,this._rotation); } // è®¡ç®—ä¸Šæ—‹è½¬åçš„å¯¹ç§°è½´X get axisY(){ return this.rotation % 360 === 0 ? this._axisY : Vector2d.rotate(this._axisY,this._rotation); } // è®¡ç®—ä¸Šæ—‹è½¬åçš„å¯¹ç§°è½´Y get _vertexs(){ return [this._A1,this._A2,this._A3,this._A4]; } get vertexs(){ return [this.A1,this.A2,this.A3,this.A4]; } // 4è§’é¡¶ç‚¹æ•°ç»„}OBBrectRectIntersect(rect1,rect2){ const rect1AxisX = rect1.axisX; const rect1AxisY = rect1.axisY; const rect2AxisX = rect2.axisX; const rect2AxisY = rect2.axisY; if (!cross(rect1,rect2,rect1AxisX)) return false; // ä¸€æ—¦æœ‰ä¸ç›¸äº¤çš„è½´å°±å¯ä»¥return false if (!cross(rect1,rect2,rect1AxisY)) return false; if (!cross(rect1,rect2,rect2AxisX)) return false; if (!cross(rect1,rect2,rect2AxisY)) return false; return true; // 4è½´æŠ•å½±éƒ½ç›¸äº¤ return true}cross(rect1,rect2,axis){ const vertexs1ScalarProjection = rect1.vertexs.map(vex =&gt; Vector2d.dot(vex,axis)).sort((a,b)=&gt;a-b); // çŸ©å½¢1çš„4ä¸ªé¡¶ç‚¹æŠ•å½±å¹¶æ’åº const vertexs2ScalarProjection = rect2.vertexs.map(vex =&gt; Vector2d.dot(vex,axis)).sort((a,b)=&gt;a-b); // çŸ©å½¢2çš„4ä¸ªé¡¶ç‚¹æŠ•å½±å¹¶æ’åº const rect1Min = vertexs1ScalarProjection[0]; // çŸ©å½¢1æœ€å°é•¿åº¦ const rect1Max = vertexs1ScalarProjection[vertexs1ScalarProjection.length - 1]; // çŸ©å½¢1æœ€å¤§é•¿åº¦ const rect2Min = vertexs2ScalarProjection[0]; // çŸ©å½¢2æœ€å°é•¿åº¦ const rect2Max = vertexs2ScalarProjection[vertexs1ScalarProjection.length - 1]; // çŸ©å½¢2æœ€å¤§é•¿åº¦ return rect1Max &gt;= rect2Min &amp;&amp; rect2Max &gt;= rect1Min; // ç›¸äº¤åˆ¤æ–­ } æœ€åæ”¾ä¸Šä¸€ä¸ªç›¸äº¤çš„åº”ç”¨Demo https://rococolate.github.io/blog/gom/test2.html,Demoé‡Œçš„å½¢çŠ¶éƒ½å¯ä»¥æ‹–æ‹½ï¼Œå½“ç¢°åˆ°å…¶ä»–å½¢çŠ¶æ—¶ä¼šå˜é€æ˜ã€‚ å‚è€ƒæ–‡ç« ç¬¬åäº”ç« ï¼šç¢°æ’æ£€æµ‹ http://blog.jmecn.net/chapter-15-collision-detection/ æ–¹å—çš„æˆ˜äº‰ï¼šæµ…è°ˆæ ¼æ–—æ¸¸æˆçš„ç²¾é«“ http://daily.zhihu.com/story/4761397 æ€æ ·åˆ¤æ–­å¹³é¢ä¸Šä¸€ä¸ªçŸ©å½¢å’Œä¸€ä¸ªåœ†å½¢æ˜¯å¦æœ‰é‡å ï¼Ÿ https://www.zhihu.com/question/24251545 â€œç­‰ä¸€ä¸‹ï¼Œæˆ‘ç¢°ï¼â€â€”â€”å¸¸è§çš„2Dç¢°æ’æ£€æµ‹ https://aotu.io/notes/2017/02/16/2d-collision-detection/index.html ç å†œå¹²è´§ç³»åˆ—ã€1ã€‘â€“æ–¹å‘åŒ…å›´ç›’(OBB)ç¢°æ’æ£€æµ‹ https://www.cnblogs.com/iamzhanglei/archive/2012/06/07/2539751.html Rotation matrix https://en.wikipedia.org/wiki/Rotation_matrix æ•°é‡ç§¯ https://zh.wikipedia.org/wiki/%E7%82%B9%E7%A7%AF å‘é‡ https://zh.wikipedia.org/wiki/%E5%90%91%E9%87%8F","link":"/2019/06/27/collision-detection/"},{"title":"JavascriptæŠ½è±¡è¯­æ³•æ ‘ä¸‹ç¯‡(å®è·µç¯‡)","text":"ä½œè€…ï¼šé™ˆæ™“å¼º ä¸Šç¯‡å·²ç»å¯¹ASTåŸºç¡€åšäº†ä»‹ç»ï¼Œæœ¬ç¯‡ä»‹ç»ASTçš„è¿ç”¨ ASTåº”ç”¨çš„ä¸‰ä¸ªè¦ç‚¹ éœ€è¦ä¸€ä¸ªè§£æå™¨ï¼Œå°†ä»£ç è½¬æ¢ä¸ºAST éœ€è¦ä¸€ä¸ªéå†å™¨ï¼Œèƒ½å¤Ÿéå†AST,å¹¶èƒ½å¤Ÿæ–¹ä¾¿çš„å¯¹ASTèŠ‚ç‚¹è¿›è¡Œå¢åˆ æ”¹æŸ¥ç­‰æ“ä½œ éœ€è¦ä¸€ä¸ªä»£ç ç”Ÿæˆå™¨ï¼Œèƒ½å¤Ÿå°†ASTè½¬æ¢ä¸ºä»£ç  esprimaä¸babelå¸¸ç”¨çš„æ»¡è¶³ä¸Šè¿°3ä¸ªè¦ç‚¹çš„å·¥å…·åŒ…æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯esprimaï¼Œä¸€ä¸ªæ˜¯babel esprimaç›¸å…³åŒ…åŠä½¿ç”¨å¦‚ä¸‹ 1234567891011const esprima = require('esprima'); // code =&gt; astconst estraverse = require('estraverse'); //astéå†const escodegen = require('escodegen'); // ast =&gt; codelet code = 'const a = 1';const ast = esprima.parseScript(code);estraverse.traverse(ast, { enter: function (node) { //èŠ‚ç‚¹æ“ä½œ }});const transformCode = escodegen.generate(ast); babelç›¸å…³åŒ…åŠä½¿ç”¨å¦‚ä¸‹ 123456789101112const parser = require('@babel/parser'); //code =&gt; astconst traverse = require('@babel/traverse').default; // astéå†ï¼ŒèŠ‚ç‚¹å¢åˆ æ”¹æŸ¥ï¼Œä½œç”¨åŸŸå¤„ç†ç­‰const generate = require('@babel/generator').default; // ast =&gt; codeconst t = require('@babel/types'); // ç”¨äºASTèŠ‚ç‚¹çš„Lodashå¼å·¥å…·åº“,å„èŠ‚ç‚¹æ„é€ ã€éªŒè¯ç­‰let code = 'const a = 1';let ast = parser.parse(sourceCode);traverse(ast, { enter (path) { //èŠ‚ç‚¹æ“ä½œ }})const transformCode = escodegen.generate(ast); ç›®å‰babelä¸ç®¡æ˜¯ä»ç”Ÿæ€ä¸Šè¿˜æ˜¯æ–‡æ¡£ä¸Šæ¯”esprimaè¦å¥½å¾ˆå¤šï¼Œå› æ­¤æ¨èå¤§å®¶ä½¿ç”¨babelå·¥å…·ï¼Œæœ¬æ–‡ç¤ºä¾‹ä¹Ÿä½¿ç”¨babelæ¥åšæ¼”ç¤ºã€‚ ä½¿ç”¨babelå·¥å…·æ“ä½œASTå¦‚ä¸Šä¸€ç« èŠ‚æ‰€ç¤º @babel/parserç”¨äºå°†ä»£ç è½¬æ¢ä¸ºAST @babel/traverseç”¨äºå¯¹ASTçš„éå†ï¼ŒåŒ…æ‹¬èŠ‚ç‚¹å¢åˆ æ”¹æŸ¥ã€ä½œç”¨åŸŸç­‰å¤„ç† @babel/generator ç”¨äºå°†ASTè½¬æ¢æˆä»£ç  @babel/types ç”¨äºASTèŠ‚ç‚¹æ“ä½œçš„Lodashå¼å·¥å…·åº“,å„èŠ‚ç‚¹æ„é€ ã€éªŒè¯ç­‰ æ›´å¤šapiè¯¦è§babelæ‰‹å†Œ[1] ä¸‹é¢é€šè¿‡ç®€å•æ¡ˆä¾‹æ¥ä»‹ç»å¦‚ä½•æ“ä½œASTï¼Œæ³¨æ„æ¡ˆä¾‹åªæ˜¯ç¤ºä¾‹ï¼Œç”±äºç¯‡å¹…å¯¹éƒ¨åˆ†è¾¹ç•Œé—®é¢˜åªä¼šæ³¨é‡Šè¯´æ˜ï¼Œå®é™…å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦è€ƒè™‘å‘¨å…¨ã€‚ æ¡ˆä¾‹1:å»æ‰ä»£ç ä¸­çš„console.log()å®ç°ä»£ç  123456789101112131415161718192021const parser = require('@babel/parser');const traverse = require('@babel/traverse').default;const generate = require('@babel/generator').default;const t = require('@babel/types');let sourceCode = `function square(n) { console.log(n); console.warn(n); return n * n;}`let ast = parser.parse(sourceCode);traverse(ast, { CallExpression(path) { let { callee } = path.node; if (callee.type === â€˜MemberExpressionâ€™ &amp;&amp; callee.object.name === â€˜consoleâ€™ &amp;&amp; callee.property.name === â€˜logâ€™ ) { path.remove(); // æ³¨æ„è€ƒè™‘å¯¹è±¡æŒ‚è½½çš„è¯†åˆ«ï¼Œå¦‚global.console.log()ï¼Œæ­¤æ—¶removeåå‰©ä¸‹global.,ä¼šå¯¼è‡´è¯­æ³•é”™è¯¯ï¼Œæ­¤æ—¶å¯ä»¥åˆ¤æ–­çˆ¶èŠ‚ç‚¹ç±»å‹æ¥æ’é™¤ } }})console.log(generate(ast).code); å¤„ç†ç»“æœ 12345function square(n) {- console.log(n); console.warn(n); return n * n;} æ­¤æ¡ˆä¾‹æ¶‰åŠçŸ¥è¯†ç‚¹ å¦‚ä½•é€šè¿‡traverseéå†ç‰¹å®šèŠ‚ç‚¹ è¯†åˆ«å‡ºconsole.log()åœ¨è§„èŒƒä¸­å±äºå‡½æ•°è°ƒç”¨è¡¨è¾¾å¼,èŠ‚ç‚¹ç±»å‹ä¸ºCallExpressionã€‚ console.logæœ¬èº«å³calleeæ˜¯åœ¨å¯¹è±¡consoleä¸Šçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå› æ­¤console.logæ˜¯ä¸€ä¸ªæˆå‘˜è¡¨è¾¾å¼ï¼Œç±»å‹ä¸ºMemberExpressionã€‚ MemberExpressionæ ¹æ®è§„èŒƒæœ‰ä¸€ä¸ªobjectå±æ€§ä»£è¡¨è¢«è®¿é—®çš„å¯¹è±¡ï¼Œæœ‰ä¸€ä¸ªpropertyä»£è¡¨è®¿é—®çš„æˆå‘˜ã€‚ é€šè¿‡path.remove()apiå¯ä»¥å¯¹èŠ‚ç‚¹è¿›è¡Œåˆ é™¤ã€‚ å¯ä»¥é€šè¿‡https://astexplorer.net/ æ¥è¾…åŠ©å¯¹ä»£ç èŠ‚ç‚¹çš„è¯†åˆ«ã€‚æ³¨æ„é€‰æ‹©babylon7ï¼Œå³babe7,å¯¹åº”@babel/parser æ¡ˆä¾‹2:å˜é‡æ··æ·†å®ç°ä»£ç  12345678910111213141516171819const parser = require('@babel/parser');const traverse = require('@babel/traverse').default;const generate = require('@babel/generator').default;const t = require('@babel/types');let sourceCode = `function square(number) { console.warn(number); return number * number;}`let ast = parser.parse(sourceCode);traverse(ast, { FunctionDeclaration(path) { let unia = path.scope.generateUidIdentifier(\"a\"); path.scope.rename(\"number\",unia.name); }})console.log(generate(ast).code); å¤„ç†ç»“æœ 1234567-function square(number) {+ function square(_a) {- console.warn(number);+ console.warn(_a);- return number * number;+ return _a * _a;} æ­¤æ¡ˆä¾‹æ¶‰åŠçŸ¥è¯†ç‚¹ path.scopeä¿å­˜äº†å½“å‰ä½œç”¨åŸŸçš„ç›¸å…³ä¿¡æ¯ å¯ä»¥é€šè¿‡apiå¯¹ä½œç”¨åŸŸå†…çš„å˜é‡åè¿›è¡Œæ‰¹é‡ä¿®æ”¹æ“ä½œ é€šè¿‡path.scopeå¯ä»¥è·å¾—å½“å‰ä½œç”¨åŸŸå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œé¿å…å˜é‡åå†²çª æ¡ˆä¾‹3:è½¬æ¢ç®­å¤´å‡½æ•°å¹¶å»æ‰æœªä½¿ç”¨å‚æ•°å®ç°ä»£ç  123456789101112131415161718192021222324252627const parser = require('@babel/parser');const traverse = require('@babel/traverse').default;const generate = require('@babel/generator').default;const t = require('@babel/types');let sourceCode = `new Promise((resolve,reject)=&gt;{ setTimeout(()=&gt;{ resolve(1); },200)});`let ast = parser.parse(sourceCode);traverse(ast, { ArrowFunctionExpression (path) { let { id, params, body } = path.node; for(let key in path.scope.bindings){ //æ³¨æ„è€ƒè™‘ç®­å¤´å‡½æ•°çš„thisç‰¹æ€§ï¼Œè‹¥å‘ç°å‡½æ•°ä½“ä¸­æœ‰thisè°ƒç”¨ï¼Œåˆ™éœ€è¦åœ¨å½“å‰ä½œç”¨åŸŸç»‘å®šå…¶çˆ¶ä½œç”¨åŸŸçš„this if(!path.scope.bindings[key].referenced){ params = params.filter(param=&gt;{ return param.name!==key; }) } } path.replaceWith(t.functionExpression(id, params, body)); }})console.log(generate(ast).code); å¤„ç†ç»“æœ 1234567-new Promise((resolve,reject)=&gt;{+new Promise(function(resolve){- setTimeout(()=&gt;{+ setTimeout(function(){ resolve(1); },200)}); æ­¤æ¡ˆä¾‹æ¶‰åŠçŸ¥è¯†ç‚¹ ç®­å¤´å‡½æ•°èŠ‚ç‚¹ï¼šArrowFunctionExpression é€šè¿‡path.scopeå¯ä»¥è¯†åˆ«å˜é‡å¼•ç”¨æƒ…å†µï¼Œæ˜¯å¦æœ‰è¢«å¼•ç”¨ï¼Œè¢«å“ªäº›è·¯å¾„å¼•ç”¨ é€šè¿‡@babel/typeså¯ä»¥å¾ˆæ–¹ä¾¿çš„æ„å»ºä»»æ„ç±»å‹èŠ‚ç‚¹ é€šè¿‡path.replaceWith()å¯ä»¥è¿›è¡ŒèŠ‚ç‚¹æ›¿æ¢ æ¡ˆä¾‹4:äº¬ä¸œè´­ç‰©å°ç¨‹åºçš„Tree-shakingåˆ æ‰å°ç¨‹åºä¸­çš„å†—ä½™ä»£ç ï¼Œéƒ¨åˆ†å®ç°ä»£ç ç¤ºä¾‹å¦‚ä¸‹ 1234567891011121314151617181920212223242526272829const parser = require('@babel/parser');const traverse = require('@babel/traverse').default;const generate = require('@babel/generator').default;const t = require('@babel/types');let sourceCode = `export function square (x) { return x * x;}export function cube (x) { return x * x * x;}`let ast = parser.parse(sourceCode);traverse(ast, { ExportNamedDeclaration (path) { let unused = ['cube'] // å€ŸåŠ©webpackï¼Œæˆ‘ä»¬èƒ½è·å¾—å¯¼å‡ºçš„æ–¹æ³•ä¸­ï¼Œå“ªäº›æ˜¯æ²¡æœ‰è¢«ä½¿ç”¨è¿‡çš„ let { declaration = {} } = path.node; if (declaration.type === 'FunctionDeclaration') { unused.forEach(exportItem =&gt; { // references=1è¡¨ç¤ºä»…æœ‰ä¸€æ¬¡å¼•ç”¨ï¼Œå³exportçš„å¼•ç”¨ï¼Œæ²¡æœ‰åœ¨åˆ«å¤„è°ƒç”¨ if (declaration.id.name === exportItem &amp;&amp; path.scope.bindings[exportItem].references === 1) { path.remove(); } }); } }})console.log(generate(ast).code); å¤„ç†ç»“æœ 123456export function square (x) { return x * x;}-export function cube (x) {- return x * x * x;-} æ­¤æ¡ˆä¾‹æ¶‰åŠçŸ¥è¯†ç‚¹ exportèŠ‚ç‚¹ï¼šExportNamedDeclaration æ¡ˆä¾‹5:å°†ä»£ç è½¬æ¢æˆsvgæµç¨‹å›¾æ­¤æ¡ˆä¾‹æ˜¯gitä¸Šä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„å¼€æºé¡¹ç›®ï¼Œé€šè¿‡ASTå°†ä»£ç è½¬æ¢ä¸ºsvgæµç¨‹å›¾ï¼Œè¯¦è§js-code-to-svg-flowchart[2] å¯ä»¥ä½“éªŒä¸€ä¸‹ï¼šdemo[3] é€šè¿‡ä»¥ä¸Šç¤ºä¾‹ï¼Œå¯ä»¥çœ‹åˆ°é€šè¿‡ASTæˆ‘ä»¬å¯ä»¥å¯¹ä»£ç ä»»æ„è¹‚èºï¼Œåšå‡ºå¾ˆå¤šæœ‰æ„æ€çš„äº‹æƒ… ASTåœ¨å…¶ä»–è¯­è¨€çš„åº”ç”¨é™¤äº†Javascriptï¼Œå…¶ä»–è¯­è¨€å¦‚HTMLã€CSSã€SQLç­‰ä¹Ÿæœ‰å¹¿æ³›çš„ASTåº”ç”¨ã€‚å¦‚ä¸‹å›¾ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å¯¹åº”è¯­è¨€çš„è§£æå™¨ï¼Œå¼€å¯ASTä¹‹é—¨ã€‚ ç»“è¯­åœ¨ä¸Šè¿°ASTç½‘ç«™ä¸­ï¼Œå¯ä»¥çœ‹åˆ°HTMLçš„è§£æå™¨æœ‰ä¸ªvueé€‰é¡¹ï¼Œè¯»è¿‡vueæºç çš„åŒå­¦åº”è¯¥çŸ¥é“vueæ¨¡æ¿åœ¨è½¬æ¢æˆHTMLä¹‹å‰ä¼šå…ˆå°†æ¨¡æ¿è½¬æ¢æˆASTç„¶åç”Ÿæˆrender functionè¿›è€Œç”ŸæˆVirtualDOMã€‚æˆ‘ä»¬å¹³æ—¶å¼€å‘å¯¹ASTä½¿ç”¨æ¯”è¾ƒå°‘ï¼Œä½†å…¶å®åˆ°å¤„éƒ½èƒ½è§åˆ°ASTçš„å½±å­ï¼šbabelã€webpackã€eslintã€taroç­‰ç­‰ã€‚å¸Œæœ›èƒ½æŠ›ç –å¼•ç‰ï¼Œä½¿åŒå­¦ä»¬åœ¨å„è‡ªå›¢é˜Ÿäº§å‡ºæ›´å¤šåŸºäºASTçš„ä¼˜ç§€å·¥å…·ã€é¡¹ç›®ã€‚ References[1] babelæ‰‹å†Œï¼šhttps://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md[2] js-code-to-svg-flowchartï¼šhttps://github.com/Bogdan-Lyashenko/js-code-to-svg-flowchart[3] demoï¼šhttps://bogdan-lyashenko.github.io/js-code-to-svg-flowchart/docs/live-editor/index.html","link":"/2019/07/20/JavascriptæŠ½è±¡è¯­æ³•æ ‘ä¸‹ç¯‡(å®è·µç¯‡)/"},{"title":"TypeScriptå®‰åˆ©æŒ‡å—","text":"ä½œè€…ï¼šæé€¸å› éªšå¹´ï¼Œä½ æ„Ÿå—è¿‡debugä¸€å¹´æ‰¾ä¸åˆ°é—®é¢˜ï¼Œæœ€åå‘ç°æ˜¯å˜é‡åå†™é”™æ—¶çš„ç»æœ›å—ï¼Ÿéªšå¹´ï¼Œä½ æ„Ÿå—è¿‡ç”Ÿäº§çº¿ä¸Šä»£ç å‡ºç°Uncaught TypeErroræ—¶çš„ææƒ§å—ï¼Ÿéªšå¹´ï¼Œä½ æ„Ÿå—è¿‡å†™ä»£ç æ‰¾ä¸€ä¸‡ä¸ªæ–‡ä»¶è¿˜æ‰¾ä¸åˆ°æ–¹æ³•å®šä¹‰æ—¶å§”å±ˆå—ï¼Ÿ æ‹¿èµ·é”®ç›˜ï¼Œè®©æˆ‘ä»¬å¯¹è°‹å®³ç”Ÿå‘½çš„ä»£ç æ‹–è¿›åƒåœ¾ç®±ï¼(åˆ’æ‰) å‰è¨€æ®äº†è§£ï¼Œç›®å‰æœ‰ç›¸å½“ä¸€éƒ¨åˆ†åŒå­¦ä¸æƒ³å»å­¦ä¹ tsï¼Œæ¯•ç«Ÿæ²¡(xue)æ—¶(bu)é—´(dong)ã€‚å¾ˆä¸å¹¸ä¸¤ä¸ªæœˆå‰æˆ‘ä¹Ÿæ˜¯å…¶ä¸­çš„ä¸€å‘˜ã€‚åœ¨çœ‹åˆ°å°¤å¤§å¤§éƒ½ç”¨tså†™vue3äº†ï¼Œè ¢è ¢æ¬²åŠ¨çš„æˆ‘å°å¿ƒç¿¼ç¿¼çš„è¸å…¥äº†è¿™ä¸ªæ·±å‘ã€‚åœ¨ç»å†äº†é•¿è¾¾ä¸€å¤©çš„æ‘¸çˆ¬æ»šæ‰“ä¹‹åï¼Œé¢†æ‚Ÿåˆ°äº†çœŸè°› ç»è¿‡äº†ä¸€æ®µæ—¶é—´çš„ç†è§£ä¹‹åï¼Œå†™äº†è¿™ç¯‡æ–‡ç« ï¼Œæ—¨åœ¨ç»™çŠ¹è±«æ˜¯å¦å­¦ä¹ æˆ–è€…è¿˜åœ¨è§‚æœ›TypeScriptçš„åŒå­¦åšä¸ªä½¿ç”¨tsçš„æ”¶ç›Šåˆ†æï¼Œå¸Œæœ›èƒ½å¤Ÿæ‰“åŠ¨å±å¹•é¢å‰çš„ä½ ã€‚ å®‰åˆ©tséš¾å†™å—ï¼Ÿä¸éš¾ã€‚æœ€ç®€å•çš„åšæ³•ä¸‰æ­¥å°±æå®šã€‚ æ‰¾ä¸€ä¸ªjsæ–‡ä»¶ æŒ‰ä¸‹é‡å‘½å æŠŠ.jsæ”¹æˆ.ts å¤§åŠŸå‘Šæˆï¼ ï¼ˆæ‰“äººåˆ«æ‰“è„¸ï¼Œè¿˜è¦é å®ƒåƒé¥­çš„â€¦ï¼‰ â¬‡ï¸ tsåˆä½“éªŒ -tsæ˜¯ä»€ä¹ˆtsæ˜¯jsçš„è¶…é›†ï¼Œæ„å‘³ç€jsæœ¬èº«çš„è¯­æ³•åœ¨tsé‡Œé¢ä¹Ÿèƒ½è·‘çš„é€šã€‚tsä¸€æ–¹é¢æ˜¯å¯¹jsåŠ ä¸Šäº†å¾ˆå¤šæ¡æ¡æ¡†æ¡†çš„é™åˆ¶ï¼Œå¦ä¸€æ–¹é¢æ˜¯æ‹“å±•äº†jsçš„ä¸€äº›èƒ½åŠ›ï¼Œå°±åƒes6æä¾›äº†é‚£ä¹ˆå¤šç¥å¥‡çš„è¯­æ³•ç³–ä¸€æ ·ã€‚åªè¦æŒ‰ç…§ä¸€å®šçš„è§„åˆ™å»ä¹¦å†™jsï¼Œå°±èƒ½äº«å—åˆ°tså¸¦æ¥çš„å¥½å¤„ã€‚ å½“ç„¶å› ä¸ºç°åœ¨çš„tsè¶³å¤Ÿå¼ºå¤§ï¼Œå¹¶ä¸”æœ‰è‡ªå®¶çš„vscodeä¿é©¾æŠ¤èˆªï¼Œæ‰æ–¹ä¾¿äº†æˆ‘ä»¬è¿™äº›è¿‡å»æƒ³éƒ½ä¸(lan)æ•¢(de)æƒ³çš„è‹¦é€¼ç¨‹åºå‘˜ã€‚ jsæ”¹é€ æˆtsçš„å·¥ä½œé‡å¾ˆå¤§ç¨‹åº¦å–å†³äºä½ æƒ³å¯¹è‡ªå·±çš„ä»£ç é™åˆ¶çš„æœ‰å¤šç»†è‡´ï¼Œæè¿°çš„æœ‰å¤šå®Œå–„ã€‚æœ€ç®€å•çš„å°±åƒä¸Šé¢è¯´çš„ï¼Œæ”¹ä¸ªæ‹“å±•åå°±è¡Œäº†(å½“ç„¶å¾ˆå¤§ç¨‹åº¦ä¸Šå¯èƒ½ä¼šé€šè¿‡ä¸äº†å„ç§é™æ€æ£€æŸ¥)ã€‚å¦‚æœä½ å†™çš„è¶Šå¤šï¼Œç”¨ä½ ä»£ç çš„åŒå¿—å°±è¶Šå¤§å¯èƒ½å–œæ¬¢ä½ å†™çš„ä¸œè¥¿ã€‚ ä¸‹é¢å…ˆç®€å•ä»‹ç»ä¸€ä¸‹tsè¯­æ³•ï¼Œä¾¿äºåé¢çš„ç†è§£ã€‚ -tsè¯­æ³•ç®€ä»‹1234567891011121314151617181920212223242526272829303132// 'xxx: number' è¡¨ç¤ºå£°æ˜ä¸€ä¸ªnumberç±»å‹const num: number = 123// å£°æ˜ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ç±»å‹(numberä»¥åŠany)å’Œè¿”å›å€¼(void)function fn (arg1: number, arg2: any): void { // todo}fn(num, [1,2,3,4])// å£°æ˜ä¸€ä¸ªæ¥å£interface IPerson { name: string // IPersonéœ€è¦åŒ…å«ä¸€ä¸ªnameå±æ€§ï¼Œç±»å‹æ˜¯string age: number // IPersonéœ€è¦åŒ…å«ä¸€ä¸ªageå±æ€§ï¼Œç±»å‹æ˜¯number family: Array&lt;string&gt; // IPersonéœ€è¦åŒ…å«ä¸€ä¸ªfamilyå±æ€§ï¼Œç±»å‹æ˜¯æ•°ç»„ï¼Œæ•°ç»„é‡Œé¢éƒ½æ˜¯stringç±»å‹çš„æ•°æ® sex?: 'ç”·' | 'å¥³' // IPersonå¯é€‰ä¸€ä¸ªsexå±æ€§ï¼Œå€¼ä¸º'ç”·'æˆ–è€…'å¥³'æˆ–è€…undefined}// ä½¿ç”¨IPersonæ¥å£å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœå¯¹è±¡ä¸ç¬¦åˆIPersonçš„å®šä¹‰ï¼Œç¼–è¯‘å™¨ä¼šé£˜çº¢æŠ¥é”™const person: IPerson = { name: 'å°ç‹', age: 12, family: ['çˆ¹', 'å¨˜'],}// typeç±»ä¼¼interfaceï¼Œä»¥ä¸‹å†™æ³•ç­‰åŒç”¨interfaceå£°æ˜IPersontype IPerson2 = { name: string age: number family: Array&lt;string&gt; sex?: 'ç”·' | 'å¥³'}// å› æ­¤å¯ä»¥ç›´æ¥å®šä¹‰è¿‡æ¥const person2: IPerson2 = person å¯èƒ½æœ‰çš„åŒå­¦çœ‹äº†ä¸Šé¢çš„ä»‹ç»ï¼Œä¼šè¯´ï¼š â€œè¦å†™è¿™ä¹ˆå¤šå…¶ä»–ä»£ç ï¼Œè¿˜å¢åŠ äº†æ–‡ä»¶ä½“ç§¯ï¼Œæä¸ªå•¥å­å’§â€ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œtséœ€è¦ç¼–è¯‘æˆjsæ‰èƒ½è¿è¡Œã€‚ç¼–è¯‘åé•¿è¿™æ ·ï¼š 123456789101112131415// 'xxx: number' è¡¨ç¤ºå£°æ˜ä¸€ä¸ªnumberç±»å‹var num = 123;// å£°æ˜ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ç±»å‹(numberä»¥åŠany)å’Œè¿”å›å€¼(void)function fn(arg1, arg2) { // todo}fn(num, [1, 2, 3, 4]);// ä½¿ç”¨IPersonæ¥å£å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœå¯¹è±¡ä¸ç¬¦åˆIPersonçš„å®šä¹‰ï¼Œç¼–è¯‘å™¨ä¼šé£˜çº¢æŠ¥é”™var person = { name: 'å°ç‹', age: 12, family: ['çˆ¹', 'å¨˜'],};// å› æ­¤å¯ä»¥ç›´æ¥å®šä¹‰è¿‡æ¥var person2 = person; é€šè¿‡äººè‚‰diffï¼Œå‘ç°ç¼–è¯‘åçš„å»æ‰äº†tsçš„æ‰€æœ‰ä»£ç ã€‚ å¯èƒ½å°±åˆæœ‰åŒå­¦æƒ³é—®äº†ï¼š â€œå­¦è¿™äº›æœ‰å•¥å¥½å¤„?â€ åˆ«æ€¥ï¼Œæ¥ç€å¾€ä¸‹çœ‹ğŸ¤“ åº”ç”¨åœºæ™¯è¿™å—ä»‹ç»tsçš„å‡ ä¸ªåº”ç”¨åœºæ™¯ï¼Œç»™ç‚¹å¯å‘~ -ç”¨æˆ‘çš„ä»£ç å°±è¦å¬æˆ‘çš„å¹³æ—¶ä¸ºäº†ä»£ç çš„å¥å£®æ€§ï¼Œä¸å¾—ä¸å¯¹ä»£ç åšå¾ˆå¤šå®¹é”™çš„æ“ä½œã€‚ å‡å¦‚æˆåŠŸé¿å…äº†å› ä¸ºè‡ªå·±å¹´é¾„å¤§äº†è€Œçœ¼ç›èŠ±äº†ï¼Œä½¿ç”¨è‡ªå·±å†™çš„æ–¹æ³•æ—¶è¿™é‡Œæ¼äº†ä¸€ä¸ªå‚æ•°ï¼Œé‚£é‡Œä¼ é”™äº†å‚æ•°ç±»å‹ã€‚ç»å¸¸ä¼šæœ‰äº›ä¸é è°±çš„ä½¿ç”¨è€…ï¼Œä¸çœ‹ä½ è¾›è¾›è‹¦è‹¦è€•è€˜çš„apiæ–‡æ¡£ï¼Œçjbä¼ å‚ã€‚æœ€åå‡ºäº†é—®é¢˜è¿˜æ€ªä½ æ²¡æœ‰åšå¥½å…¼å®¹å¤„ç†ï¼Œé¢†å¯¼ç¾¤é‡Œä¸€é¡¿æ•°è½ã€‚ æˆ‘ä»¬å°±å¾—åƒå­©å­ä»–å¦ˆä¸€æ ·ï¼Œè€ƒè™‘ç†Šå­©å­ä¼šä¼ äº›ä»€ä¹ˆä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿è¿›æ¥ï¼Œç„¶ååœ¨ä»£ç é‡Œé¢åŠ ä¸Šå„ç§åˆ†æ”¯ã€‚ ç°åœ¨ç”¨tsï¼Œå°±å¯ä»¥åœ¨ä¼ å‚çš„æ—¶å€™å‹å¥½çš„æç¤ºå‡ºæ¥â€œä½ å†™äº†ä¸ªä»€ä¹ˆç©æ„â€çš„æ„æ€ã€‚ é¦–å…ˆç”¨tså®šä¹‰ä¸€ä¸ªå‡½æ•° 12345678interface IArgs { name: string age: string}function youFoo (arg1: string, arg2: 'a'|'b', arg3: IArgs) { // è¿™é‡Œå•¥éƒ½ä¸å¹²ï¼Œä½ ä¼ å‚å§} å‡å¦‚åŒäº‹å°æ˜è¿™ä¹ˆå†™ 1234youFoo('sss', 'c', { name: 'xiaoming', age: 18}) ä»–å°±ä¼šå‘ç°å“ªé‡Œå¥½åƒä¸å¤ªå¯¹ ç¬¬äºŒä¸ªå‚æ•°è¦æ±‚â€™aâ€™æˆ–è€…â€™bâ€™ï¼Œäºæ˜¯å°æ˜é»˜é»˜çš„æ”¹è¿‡æ¥äº†ï¼Œä½†æ˜¯åˆå‘ç° åŸæ¥ageæ˜¯è¦æ±‚ä¼ stringç±»å‹ã€‚ äºæ˜¯å°æ˜ä¸€è¾¹å¿ƒé‡Œmmpä¸€è¾¹æ”¹äº†è¿‡æ¥ã€‚ -æ‰¾æ–‡æ¡£å¹³æ—¶åœ¨å¹²æ´»çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬å–œæ¬¢å¤šä¸€ä¸ªå±å¹•ï¼Œå¯ä»¥å¼€ä¸ªchromeï¼ŒæŸ¥æŸ¥é—®é¢˜æ‰¾æ‰¾æ–‡æ¡£ç­‰ã€‚ä¸è¿‡ç»å¸¸è¿˜å¾—çœ‹ç½‘é€Ÿï¼Œç”¨æœç´¢å»æœapiå•¥çš„ï¼Œé‡åˆ°åœ¨ä¹¡ä¸‹å†™ä»£ç ï¼Œåˆ†åˆ†é’Ÿæœ‰æƒ³shiçš„å¿ƒã€‚ æœ‰äº†tsï¼Œæˆ‘ä»¬å°±å®Œ(da)ç¾(gai)çš„å†³æ‰äº†è¿™ä¸ªé—®é¢˜: é¦–å…ˆæŒ‰ç…§è¿™æ ·çš„ç»“æ„å»å†™æ–¹æ³•ï¼š 12345678910111213141516/** * ä¸€ä¸ªæ–¹æ³•ï¼šç”Ÿæˆé”™è¯¯æç¤ºä¿¡æ¯ * * @param {string} message æç¤ºä¿¡æ¯ï¼Œæ¯”å¦‚`you have a error` * @param {number | string} code é”™è¯¯ç ï¼Œæ•°å­—å’Œå­—ç¬¦éƒ½è¡Œ * @param {string} type ç±»å‹ï¼Œè¯·å†™`demo1`æˆ–è€…`demo2` * * [è¿˜ä¸æ‡‚ï¼Ÿç‚¹è¿™é‡Œå§](https://www.google.com) * * // demo * genErrMsg('demo', 10086) * */export function genErrMsg (message: string, code: number | string, type?: ('demo1' | 'demo2')): string { return (message || `ç½‘ç»œç¹å¿™ï¼Œè¯·ç¨å€™å†è¯•`) + (code ? `(${code})` : ``)} ç„¶ååœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­çš„ä½“éªŒå¦‚ä¸‹ï¼š åœ¨æ›´å®Œå–„çš„libå½“ä¸­ï¼Œä½“éªŒæ›´ä½³ï¼Œé™¤äº†å¼€å¤´çš„jqueryå¤–ï¼Œè¿˜æ¯”å¦‚ï¼š -ç²—å¿ƒå¤§æ„é˜…è¯»ä»¥ä¸‹jsä»£ç ï¼Œæé—®ï¼šåˆ†å‰²çº¿ä»¥ä¸‹çš„ä»£ç æœ‰å‡ å¤„bugï¼Ÿ 12345678910111213141516171819202122// careless.jslet foooo = 1let fooo = 1let fooooooo = 1let foo = 1let foooooo = 1let test = 12const obj = { fn1 () {}, fn2 () {}, fn4 () {},}/*************** åˆ†å‰²çº¿ä»¥ä¸‹çš„ä»£ç æœ‰å“ªäº›åœ°æ–¹æœ‰bugï¼Ÿ **************** */obj.fn3()console.leg(fooooo)function test () { alert(tast)} /* ** ** * ç­”æ¡ˆåˆ†ç•Œçº¿ * ** ** */ æ˜¯ä¸æ˜¯è§‰å¾—çœ¼ç›æœ‰ç‚¹è¦çäº†ï¼Ÿ è¯•è¯•æŠŠ.jsæ”¹æˆ.ts -éšè—çš„é—®é¢˜å¦‚æœè¯´ä¹‹å‰çš„jsä»£ç è¿˜èƒ½å‡­çœ¼ç¥ç«‹åˆ»çœ‹å‡ºå“ªé‡Œä¸å¯¹ï¼Œé‚£ä¹ˆä¸‹é¢è¿™äº›å°±æ²¡é‚£ä¹ˆç®€å•äº† é˜…è¯»ä»¥ä¸‹jsä»£ç ï¼Œæé—®ï¼šä»£ç æœ‰å‡ å¤„bugï¼Ÿ 123456import * as utils from './utils'utils.genErrMsg(10086, 'this is error') // ä¸Šé¢æåˆ°çš„genErrMsgå‡½æ•°let dom = window.document.getElementById('foo')dom.className = 'add' /* ** ** * ç­”æ¡ˆåˆ†ç•Œçº¿ * ** ** */ è¯•è¯•æŠŠ.jsæ”¹æˆ.ts å¯çŸ¥é—®é¢˜å¦‚ä¸‹ï¼š 1.genErrMsgçš„ç¬¬ä¸€ä¸ªå‚æ•°åº”è¯¥æ˜¯string 2.getElementByIdè¿”å›å€¼è¿˜å¯èƒ½æ˜¯null -æ¥å£æ•°æ®ä¸çŸ¥é“åœ¨ç»´æŠ¤ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ç»å¸¸é‡åˆ°æŸä¸ªæ¥å£ä¸çŸ¥é“æœ‰å•¥æ•°æ®ï¼Œé€šå¸¸è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦å»æŸ¥æ¥å£æ–‡æ¡£ã€‚ç„¶è€Œå½“æ¬¡æ•°ä¸€å¤šï¼Œæˆ–è€…åå°å¤§ä½¬ä¸€å‘èµ·æ¥ï¼Œæ”¹äº†å­—æ®µï¼Œå¯èƒ½ä¼šæŸ¥åˆ°æ€€ç–‘äººç”Ÿã€‚ å¦‚æœä½¿ç”¨tsï¼Œå¯èƒ½æ‰‹é‡Œçš„å‰§æœ¬å°±ä¸ä¸€æ ·äº† å‡å¦‚æœ‰ä¸ªæ¥å£å¦‚ä¸‹æ‰€ç¤º æˆ‘ä»¬é’ˆå¯¹è¿™ä¸ªæ¥å£å†™å‡ºäº†å¦‚ä¸‹tsä»£ç ï¼š 123456789101112131415161718192021222324interface IPriceData { /** æ ‡è¯† */ cbf: string /** id */ id: string /** å¸‚åœºä»·æ ¼ */ m: string /** åå°ä»· */ op: string /** å‰å°ä»· */ p: string}// å°†IPriceDataå¡è¿›æ•°ç»„é‡Œtype IPriceDataArray = Array&lt;IPriceData&gt;function getPrice () { // Promiseçš„æ³›å‹å‚æ•°ä½¿ç”¨äº†IPriceDataArrayç±»å‹ï¼Œthené‡Œé¢è¿”å›çš„æ•°æ®å°±æ˜¯IPriceDataArrayç±»å‹ return new Promise&lt;IPriceDataArray&gt;((resolve, reject) =&gt; { $.get('https://xxxxxxx/prices/pgets?ids=P_100012&amp;area=&amp;source=', data =&gt; { resolve(data) }) })} å½“è°ƒç”¨getPriceå‡½æ•°æ—¶ï¼Œä½“éªŒå¦‚ä¸‹ï¼š ä»¥åæ¯æ¬¡ç»´æŠ¤è¿™æ®µå‡½æ•°çš„æ—¶å€™éƒ½ä¸éœ€è¦å»çœ‹æ–‡æ¡£å•¦ã€‚å¦‚æœåå°çªç„¶æ”¹äº†å­—æ®µï¼Œåœ¨æ£€æŸ¥çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬å¯ä»¥é©¬ä¸Šå‘ç°é—®é¢˜ï¼Œç„¶åæ‹¿ç€æ•°æ®å»è´¨é—®ï¼šä½ tmæ”¹äº†ä¸œè¥¿è®©æˆ‘æ¥èƒŒé”…â€¦(æ­¤å¤„çœç•¥1ä¸‡ä¸ªå­—) -å¢å¼ºåçš„classå’Œenumä¼—æ‰€å‘¨çŸ¥ï¼Œjsé‡Œé¢çš„classå°±æ˜¯ä¸ªè¯­æ³•ç³–ï¼Œæƒ³å­¦å¼ºç±»å‹è¯­è¨€ï¼Œå†™æ³•åˆæ˜¯ä¸ªåŠåŠå­ã€‚ ä½†æ˜¯åœ¨tså½“ä¸­ï¼Œclassè¢«å¢å¼ºäº†(å½“ç„¶è¿˜æ˜¯ä¸ªè¯­æ³•ç³–ï¼Œåªä¸è¿‡æ›´ç”œäº†) å’±ä»¬çœ‹å›¾è¯´è¯ï¼š vscodeä¸­å¯¹tsä¸‹çš„å…±æœ‰å±æ€§ã€ç§æœ‰å±æ€§ã€ä¿æŠ¤å±æ€§å’Œé™æ€å±æ€§å¼€äº†å°ç¶ï¼Œå®ä¾‹ä¸‹åªæœ‰å…¬æœ‰å±æ€§æ‰ä¼šè¢«å…è®¸ä½¿ç”¨å’Œæç¤ºå‡ºæ¥ã€‚ å¦å¤–tsè¿˜æä¾›äº†enumè¯­æ³•ç³–ï¼š 12345678910111213141516171819enum HttpCode { /** æˆåŠŸ */ '200_OK' = 200, /** å·²ç”Ÿæˆäº†æ–°çš„èµ„æº */ '201_Created' = 201, /** è¯·æ±‚ç¨åä¼šè¢«å¤„ç† */ '202_Accepted' = 202, /** èµ„æºå·²ç»ä¸å­˜åœ¨ */ '204_NoContent' = 204, /** è¢«è¯·æ±‚çš„èµ„æºæœ‰ä¸€ç³»åˆ—å¯ä¾›é€‰æ‹©çš„å›é¦ˆä¿¡æ¯ */ '300_MultipleChoices' = 300, /** æ°¸ä¹…æ€§è½¬ç§» */ '301_MovedPermanently' = 301, /** æš‚æ—¶æ€§è½¬ç§» */ '302_MoveTemporarily' = 302,}HttpCode['200_OK']HttpCode[200] ç›¸æ¯”ç®€å•å¯¹è±¡å®šä¹‰çš„key-valueï¼Œåªèƒ½é€šè¿‡keyå»è®¿é—®valueï¼Œä¸èƒ½é€šè¿‡valueè®¿é—®keyã€‚ä½†æ˜¯åœ¨enumå½“ä¸­ï¼Œæ­£åéƒ½å¯ä»¥å½“åškeyæ¥ç”¨ã€‚ ç¼–è¯‘åçš„ä»£ç æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥äº†è§£ä¸‹~ 1234567891011121314151617181920\"use strict\";var HttpCode;(function (HttpCode) { /** æˆåŠŸ */ HttpCode[HttpCode[\"200_OK\"] = 200] = \"200_OK\"; /** å·²ç”Ÿæˆäº†æ–°çš„èµ„æº */ HttpCode[HttpCode[\"201_Created\"] = 201] = \"201_Created\"; /** è¯·æ±‚ç¨åä¼šè¢«å¤„ç† */ HttpCode[HttpCode[\"202_Accepted\"] = 202] = \"202_Accepted\"; /** èµ„æºå·²ç»ä¸å­˜åœ¨ */ HttpCode[HttpCode[\"204_NoContent\"] = 204] = \"204_NoContent\"; /** è¢«è¯·æ±‚çš„èµ„æºæœ‰ä¸€ç³»åˆ—å¯ä¾›é€‰æ‹©çš„å›é¦ˆä¿¡æ¯ */ HttpCode[HttpCode[\"300_MultipleChoices\"] = 300] = \"300_MultipleChoices\"; /** æ°¸ä¹…æ€§è½¬ç§» */ HttpCode[HttpCode[\"301_MovedPermanently\"] = 301] = \"301_MovedPermanently\"; /** æš‚æ—¶æ€§è½¬ç§» */ HttpCode[HttpCode[\"302_MoveTemporarily\"] = 302] = \"302_MoveTemporarily\";})(HttpCode || (HttpCode = {}));HttpCode['200_OK'];HttpCode[200]; ä¼˜ç‚¹ä»¥åŠä¸è¶³é€šè¿‡ä¸Šé¢çš„å‡ ä¸ªæ —å­ï¼Œå¤§æ¦‚å¯ä»¥çœ‹å‡ºä½¿ç”¨äº†tsåï¼Œå¯ä»¥è·å¾—ä»¥ä¸‹æŠ€èƒ½ç‚¹ï¼š æ¸…æ™°çš„å‡½æ•°å‚æ•°/æ¥å£å±æ€§ï¼Œå¢åŠ äº†ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ é™æ€æ£€æŸ¥ ç”ŸæˆAPIæ–‡æ¡£ é…åˆç°ä»£ç¼–è¾‘å™¨ï¼Œå„ç§æç¤º æ´»è·ƒçš„ç¤¾åŒº ä»¥åŠå¯¹åº”çš„æŠ€æœ¯æˆæœ¬ ç»´æŠ¤è€…(åŒ…çš„ä½œè€…) ä½¿ç”¨è€… æ”¶ç›Š æ¸…æ™°çš„å‡½æ•°å‚æ•°/æ¥å£å±æ€§ é™æ€æ£€æŸ¥ ç”Ÿæˆapiæ–‡æ¡£ æ¸…æ™°çš„å‡½æ•°å‚æ•°/æ¥å£å±æ€§ é…åˆç°ä»£ç¼–è¾‘å™¨ï¼Œå„ç§æç¤º ä»£ä»· æ ‡è®°ç±»å‹ å£°æ˜(interface/type) å’ŒæŸäº›åº“ç»“åˆçš„ä¸æ˜¯å¾ˆå®Œç¾(æ²¡é”™ï¼Œè¯´çš„å°±æ˜¯vue 2.x) è¿™é‡Œæåˆ°çš„vue2.xç”±äºtså…ˆå¤©èƒ½åŠ›çš„ä¸è¶³ï¼Œå¯¼è‡´vueçš„tsè¯­æ³•éœ€è¦ä½¿ç”¨classé£æ ¼(è¿è¡Œæ—¶ä¼šè¢«è½¬æ¢å›åŸæœ¬çš„vueæ„é€ å‡½æ•°çš„è¯­æ³•)ï¼Œå’Œæˆ‘ä»¬å¹³æ—¶ç†Ÿæ‚‰çš„vueé£æ ¼æœ‰äº›å·®å¼‚ è¿™é‡Œæ˜¯å› ä¸ºvueçš„thisä¸‹çš„ç¯å¢ƒæ¯”è¾ƒå¤æ‚ï¼Œå¯¹äºideæ¥è¯´éœ€è¦åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šï¼Œå› æ­¤åœ¨ç¼–å†™tsçš„æ—¶å€™éœ€è¦æ‰‹åŠ¨å»è®¾ç½®å±æ€§(æ¯”å¦‚props,data,methodsç­‰)åˆ°thisä¸‹é¢ï¼Œéå¸¸éº»çƒ¦ã€‚æ—©æœŸtså¹¶ä¸æ”¯æŒæ‰‹åŠ¨ç¼–å†™thisçš„ä½œç”¨åŸŸï¼Œåæ¥ä¸“é—¨ä¸ºå…¶è®¾è®¡äº†ä¸€ä¸ªThisTypeçš„æ–¹æ³•ã€‚ åœ¨ä¸Šé¢çš„ä»£ç é‡Œç”¨äº†classçš„å†™æ³•ï¼Œæœ¬èº«æ‰€æœ‰éœ€è¦çš„å±æ€§å°±åœ¨thisä¸‹ï¼Œè§„é¿äº†è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šthisä¸‹éœ€è¦çš„ä½œç”¨åŸŸçš„é—®é¢˜ã€‚ å¦ä¸€æ–¹é¢ï¼Œç”±äºtsæç¤ºèƒ½åŠ›æ¯”è¾ƒå±€é™ï¼Œæ¯”å¦‚åœ¨å‡½æ•°åœºæ™¯ä¸­ï¼Œå¦‚æœæ•°æ®æ¥æºæ˜¯ç‹¬ç«‹çš„å¯¹è±¡ï¼Œä½“éªŒå°±ä¼šæ¯”è¾ƒç³Ÿç³•ã€‚ è¯·é˜…è¯»ä»¥ä¸‹æ —å­(è¿™ä¸€å—ç¨å¾®è¶…çº²äº†æ ‡é¢˜â€™å®‰åˆ©â€™çš„èŒƒç•´ï¼Œä¸å¤ªç†è§£çš„æ–°åŒå­¦å¯ä»¥å…¥å‘ä»¥åå†æ¶ˆåŒ–~) 1234567891011121314151617181920212223interface IOptions { name: string age: number extra: { data: Object methods: Object }}// å‚æ•°optionsè¦æ±‚ç¬¦åˆIOptionså®šä¹‰çš„è§„åˆ™function sthConstructor (options: IOptions) {}// optionså¯¹è±¡å½“ä¸­å¹¶æ²¡æœ‰ä»»ä½•tsçš„é™æ€æ£€æŸ¥å’Œæç¤ºconst options = { name: 'peter', age: '13', // error: ageåº”è¯¥ä¸ºæ•°å­— extra: { data: [], methods: {} }}// optionsé£˜çº¢æŠ¥é”™ï¼Œç„¶è€Œæç¤ºå†…å®¹åºŸè¯å¤ªå¤šï¼Œå…³é”®ä¿¡æ¯è—å¾—å¤ªæ·±sthConstructor(options) åœ¨ä¸Šé¢çš„åœºæ™¯ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨optionså½“ä¸­èƒ½å¤Ÿè·å¾—å®Œæ•´çš„tsæ£€æŸ¥èƒ½åŠ›ã€‚è¾¾æˆè¿™ä¸ªç›®çš„æœ‰ä¸‰ç§æ–¹æ³•ï¼š 1.å°†optionsé‡Œé¢çš„ä¸œè¥¿æŒªè¿›å‡½æ•°å½“ä¸­ 2.å°†optionsç”¨IObjectå®šä¹‰ 3.æä¾›ä¸€ä¸ªhelperæ–¹æ³• è¿™ä¸‰ç§æ–¹å¼å½“ä¸­ï¼š æ–¹æ³•1æ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼Œä½†æ˜¯åœ¨å¤§å‹é¡¹ç›®å½“ä¸­ï¼Œè¿™æ ·çš„å†™æ³•åè€Œå¾ˆå°‘è§åˆ°ã€‚ æ–¹æ³•2æ˜¯ç»´æŠ¤è€…å¸¸ç”¨çš„æ–¹å¼ï¼Œä½†æ˜¯å¯¹äºä½¿ç”¨è€…è€Œè¨€ï¼Œæˆæœ¬è¾ƒé«˜ã€‚å› ä¸ºä½¿ç”¨è€…éœ€è¦å»libé‡Œç¿»åˆ°æ–¹æ³•å¯¹åº”çš„typeç±»å‹ï¼Œå°†å®ƒimportè¿›æ¥ã€‚ æ–¹æ³•3æ˜¯ä¸ªäººè§‰å¾—ç›¸å¯¹æ¯”è¾ƒå¥½çš„æ–¹å¼ï¼Œåªè¦ç»´æŠ¤è€…æä¾›ä¸€ä¸ªç±»ä¼¼helperçš„å‡½æ•°åŒ…è£…ä¸€ä¸‹ï¼Œå°±å¯ä»¥è·å¾—å¯¹åº”çš„æç¤ºã€‚æ˜¯ä¸æ˜¯å¾ˆåƒvue tsçš„è£…é¥°å™¨? ä½†ä¸Šè¿°ä¸‰ç§è§£å†³æ–¹å¼æˆ‘è§‰å¾—éƒ½ä¸ä¼˜é›…ï¼Œè¿™å°±æ˜¯tså½“å‰çš„ä¸è¶³ä¹‹ä¸€ã€‚ tsåœ¨jsä¸­çš„ç©æ³•TypeScriptæ˜¯å’Œvscodeéƒ½æ˜¯å¾®è½¯çš„äº²å„¿å­ï¼Œä»–ä»¬å…„å¼Ÿä¿©ç›¸äº’åä½œè‚¯å®šä¼šæœ‰æ›´å¤šå°èŠ±æ ·ï¼Œç”šè‡³ä½ ç”¨çš„åªæ˜¯jsæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥äº«å—åˆ°ã€‚ è¿™é‡ŒæŠ›ç –å¼•ç‰åˆ—å‡ºä¸¤æ¡ï¼š -é…ç½®æ–‡ä»¶è‡ªåŠ¨æç¤ºåªè¦æœ‰typesæ–‡ä»¶ï¼Œæ‰€æœ‰é…ç½®éƒ½å¯ä»¥è‡ªåŠ¨æç¤ºï¼š 12345678910/** * webpacké…ç½®è‡ªåŠ¨æç¤º * * å…ˆå®‰è£…å¯¹åº”çš„typesåŒ…ï¼š `npm i @types/webpack -D` * * @type {import(&apos;webpack&apos;).Configuration} */const config = { } -jsè¯­æ³•æ£€æŸ¥åœ¨jsä¸­ä¹Ÿå¯ä»¥è·å¾—è‡ªåŠ¨æç¤ºå’Œé™æ€æ£€æŸ¥ã€‚åªè¦åœ¨vscodeçš„settingå½“ä¸­å‹¾ä¸ŠCheck JSå³å¯ã€‚è™½ç„¶ä½ çš„jsä»£ç å¯èƒ½ä¼šè¢«å„ç§é£˜çº¢ğŸ¤ª â¬‡ï¸ ä¹‹å‰çš„ä¾‹å­åœ¨jsä¸­ä¹Ÿå¯ä»¥æç¤ºå‡ºä¸€äº›bugäº† å†™åœ¨æœ€åæœ‰çš„åŒå­¦ä¼šé—®ï¼šæˆ‘æ‰å­¦jsï¼Œå¯ä»¥å­¦tså—ï¼Ÿå¯ä»¥ï¼Œå¹¶ä¸”å»ºè®®ï¼Œå› ä¸ºä¼šå¯¹jsåŸºç¡€çŸ¥è¯†åŠ æ·±ç†è§£ã€‚æœ‰ç”¨æ³•é—®é¢˜åœ¨stackoverflowä¸Šæœæœå°±è§£å†³äº†ã€‚ é‚£ä¹ˆè¿™ä¹ˆæœ‰ç”¨çš„å·¥å…·ï¼Œå»å“ªå¯ä»¥å­¦åˆ°å‘¢ï¼Ÿæˆ–è®¸ä½ å¯ä»¥å‚è€ƒä¸‹æˆ‘å­¦ä¹ çš„è½¨è¿¹ï¼š ä¼ é€é—¨â€“TypeScript å…¥é—¨æ•™ç¨‹ (å¢™è£‚æ¨è) ä¼ é€é—¨â€“ä¸º Vue3 å­¦ç‚¹ TypeScript , ä½“éªŒ TypeScript ä¼ é€é—¨â€“ä¸€ç¯‡æœ´å®çš„æ–‡ç« å¸¦ä½ 30åˆ†é’Ÿæ‹å®ŒTypeScript,æ–¹æ³•æ˜¯æ­£åå¯¹æ¯” ä¼ é€é—¨â€“stack overflow (å¢™è£‚æ¨è) ä¼ é€é—¨â€“google ä»Šå¹´tsçªç„¶éåœ°å¼€èŠ±ï¼Œä¼¼ä¹æˆä¸ºäº†æ½®æµã€‚å„ç§tsæ”¹é€ ã€å­¦ä¹ æ•™ç¨‹ã€å¿ƒå¾—å‡ºç°åœ¨äº†å„å¤§å­¦ä¹ ã€äº¤å‹ç½‘ç«™ä¸Šã€‚æœ‰çš„åŒå­¦å¯èƒ½ä¹Ÿå‘ç°äº†ï¼šè¿™ä¸å°±å°±æ˜¯javaè¿™ç±»è¯­è¨€ç©å‰©äº†çš„ä¸œè¥¿äº†å—ï¼Ÿ é‚£å¹´è½»çš„æ—¶å€™è°ä¸éƒ½æƒ³è‡ªç”±å˜›ï¼Œç„¶è€Œéšç€å¹´é¾„å¤§äº†éƒ½è¢«ç®¡çš„æœæœå¸–å¸–çš„","link":"/2019/10/08/TypeScriptå®‰åˆ©æŒ‡å—/"},{"title":"Vue.js 3.0ç¼–è¯‘å™¨compiler-coreæºç è§£æ","text":"ä½œè€…ï¼šæ·±å±±èš‚èš Vue.js 3.0çš„æºä»£ç æ­£åœ¨å›½åº†å‡æœŸå°±è¿™ä¹ˆçªç„¶æ”¾å‡ºæ¥äº†ï¼Œå‡æœŸè¿˜æ²¡ç»“æŸï¼Œé™†é™†ç»­ç»­çœ‹åˆ°åŠªåŠ›çš„ç å†œå°±åœ¨å„ç§åˆ†æäº†ã€‚ ç›®å‰è¿˜æ˜¯ pre Alphaï¼Œä¹è§‚ä¼°è®¡è¿˜æœ‰ Alphaï¼ŒBetaç‰ˆæœ¬ï¼Œæœ€åæ‰æ˜¯æ­£å¼ç‰ˆã€‚ è¯ä¸å¤šè¯´ï¼Œçœ‹ Pre-Alphaã€‚ ç§ compiler-core çƒ­é—¨çš„ reactivity è¢«å¤§ä½¬ç¿»æ¥è¦†å»å†ç ”ç©¶äº†ï¼Œæˆ‘å°±å’Œå¤§ä¼™ä¸€èµ·æ¥è§£è¯»ä¸€ä¸‹ â€å†·é—¨â€œ çš„ compiler å§ï¼ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ å¦‚æœä½ å¯¹ AST è¿˜ä¸å¤ªç†Ÿæ‚‰ï¼Œæˆ–è€…å¯¹å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„ ASTè§£æå™¨ è¿˜ä¸å¤ªç†Ÿæ‚‰ï¼Œå¯ä»¥çŒ›æˆ³ï¼šæ‰‹æŠŠæ‰‹æ•™ä½ å†™ä¸€ä¸ª AST è§£æå™¨ vue3.0çš„æ¨¡æ¿è§£æå’Œvue2.0å·®å¼‚æ¯”è¾ƒå¤§ï¼Œä½†æ˜¯æ— è®ºæ€æ ·å˜åŒ–ï¼ŒåŸºæœ¬åŸç†æ˜¯ä¸€è‡´çš„ï¼Œæˆ‘ä»¬å†™çš„å„ç§ html ä»£ç ï¼Œjsä½¿ç”¨çš„æ—¶å€™å…¶å®å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå°†éç»“æ„åŒ–çš„å­—ç¬¦ä¸²æ•°æ®ï¼Œè½¬æ¢æˆç»“æ„åŒ–çš„ ASTï¼Œæˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨å¼ºå¤§çš„æ­£åˆ™è¡¨è¾¾å¼å’ŒindexOfæ¥åˆ¤æ–­ã€‚compiler-core çš„ä¸€ä¸ªæ ¸å¿ƒä½œç”¨å°±æ˜¯å°†å­—ç¬¦ä¸²è½¬æ¢æˆ æŠ½è±¡å¯¹è±¡è¯­æ³•æ ‘ASTã€‚ Letâ€™s do IT ! ç›®å½•ç»“æ„ _tests_ æµ‹è¯•ç”¨ä¾‹ src/ast tsè¯­æ³•çš„å¤§ä½¬çš„ç±»å‹å®šä¹‰ï¼Œæ¯”å¦‚typeï¼Œenumï¼Œinterfaceç­‰ src/codegen å°†ç”Ÿæˆçš„astè½¬æ¢æˆrenderå­—ç¬¦ä¸² src/errors å®šä¹‰ compiler é”™è¯¯ç±»å‹ src/index å…¥å£æ–‡ä»¶ï¼Œä¸»è¦æœ‰ä¸€ä¸ª baseCompile ï¼Œç”¨æ¥ç¼–è¯‘æ¨¡æ¿æ–‡ä»¶çš„ src/parse å°†æ¨¡æ¿å­—ç¬¦ä¸²è½¬æ¢æˆ AST src/runtimeHelper ç”Ÿæˆcodeçš„æ—¶å€™çš„å®šä¹‰å¸¸é‡å¯¹åº”å…³ç³» src/transform å¤„ç† AST ä¸­çš„ vue ç‰¹æœ‰è¯­æ³•ï¼Œæ¯”å¦‚ v-if ,v-on çš„è§£æ è¿›å…¥ compiler-core ç›®å½•ä¸‹ï¼Œç»“æ„ä¸€ç›®äº†ç„¶ã€‚è¿™é‡Œè¯´ä¸‹ _tests_ ç›®å½•ï¼Œæ˜¯vueçš„jestæµ‹è¯•ç”¨ä¾‹ã€‚é˜…è¯»æºç å‰å…ˆçœ‹çœ‹ç”¨ä¾‹ï¼Œå¯¹é˜…è¯»æºç æœ‰å¾ˆå¤§å¸®åŠ©å“¦ã€‚ å¦‚ä¸‹ï¼Œæµ‹è¯•ä¸€ä¸ªç®€å•çš„textï¼Œæ‰§è¡Œparseæ–¹æ³•ä¹‹åï¼Œå¾—åˆ° astï¼ŒæœŸæœ› ast çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸å®šä¹‰çš„å¯¹è±¡æ˜¯ä¸€è‡´çš„ã€‚åŒç†å…¶ä»–çš„æ¨¡å—æµ‹è¯•ç”¨ä¾‹ï¼Œåœ¨é˜…è¯»æºç å‰å¯ä»¥å…ˆç„ä¸€çœ¼ï¼ŒçŸ¥é“è¿™ä¸ªæ¨¡å—å¦‚ä½•ä½¿ç”¨ï¼Œè¾“å…¥è¾“å‡ºæ˜¯å•¥ã€‚ 1234567891011121314test('simple text', () =&gt; { const ast = parse('some text') const text = ast.children[0] as TextNode expect(text).toStrictEqual({ type: NodeTypes.TEXT, content: 'some text', isEmpty: false, loc: { start: { offset: 0, line: 1, column: 1 }, end: { offset: 9, line: 1, column: 10 }, source: 'some text' } })}) å…ˆçœ‹ä¸€å¼ å›¾ï¼Œé‡ç‚¹æ˜¯å››å—ï¼š èµ·å§‹æ ‡ç­¾ ç»“æŸæ ‡ç­¾ åŠ¨æ€å†…å®¹ æ™®é€šå†…å®¹ å…¶ä¸­èµ·å§‹æ ‡ç­¾ä¼šç”¨åˆ°é€’å½’æ¥å¤„ç†å­èŠ‚ç‚¹ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¼€å§‹è·Ÿç€æºç æ¥é˜…è¯»å§! parseï¼šå°†å­—ç¬¦ä¸²æ¨¡æ¿è½¬æ¢æˆ AST æŠ½è±¡è¯­æ³•æ ‘è¿™ä¸ªæ˜¯å¯¹å¤–æš´éœ²çš„æ ¸å¿ƒæ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆæµ‹è¯•ä¸‹ç»“æœï¼š 12345678const source = ` &lt;div id=\"test\" :class=\"cls\"&gt; &lt;span&gt;{{ name }}&lt;/span&gt; &lt;MyCom&gt;&lt;/MyCom&gt; &lt;/div&gt;`.trim()import { parse } from './compiler-core.cjs'const result = parse(source) output: ä¸€ä¸ªç®€å•çš„è½¬æ¢ç»“æœå°±å‘ˆç°å‡ºæ¥äº†ï¼Œä»ç”Ÿæˆçš„ç»“æ„æ¥çœ‹ï¼Œç›¸å¯¹äºvue2.xæœ‰å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„å˜åŒ–ï¼š æ–°å¢äº† loc å±æ€§ æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½è®°å½•äº†è¯¥èŠ‚ç‚¹åœ¨æºç å½“ä¸­çš„ start å’Œ endï¼Œæ ‡è¯†äº†ä»£ç çš„è¯¦ç»†ä½ç½®ï¼Œcolumn,line,offsetã€‚ vu3.0å¯¹äºå¼€å‘é‡åˆ°çš„é—®é¢˜éƒ½è¦è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºä¹ŸåŸºäºæ­¤ï¼Œå¦å¤–æ”¯æŒ source-map æ–°å¢äº† tagType å±æ€§ tagType å±æ€§æ ‡è¯†è¯¥èŠ‚ç‚¹æ˜¯ä»€ä¹ˆç±»å‹çš„ã€‚æˆ‘ä»¬çŸ¥é“ vue2.x åˆ¤æ–­èŠ‚ç‚¹ç±»å‹æ˜¯è¿è¡Œæ—¶æ‰æœ‰çš„ï¼Œvu3.0å°†åˆ¤æ–­æå‰åˆ°ç¼–è¯‘é˜¶æ®µäº†ï¼Œæå‡äº†æ€§èƒ½ã€‚ ç›®å‰tagTypeæœ‰ä¸‰ç§ç±»å‹ï¼š0 element,1 component,2 slot,3 template æ–°å¢ isStatic å±æ€§ å°†æ¨¡æ¿æå‰ç¼–è¯‘å¥½ï¼Œæ ‡è¯†æ˜¯å¦ä¸ºåŠ¨æ€å˜åŒ–çš„ï¼Œæ¯”å¦‚åŠ¨æ€æŒ‡ä»¤ â€¦â€¦ æ–°ç‰ˆçš„ AST æ˜æ˜¾æ¯” vue2.x è¦å¤æ‚äº›ï¼Œå¯ä»¥çœ‹åˆ°vue3.0å°†å¾ˆå¤šå¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µå°±èƒ½ç¡®å®šçš„å°±åœ¨ç¼–è¯‘é˜¶æ®µç¡®å®šï¼Œæ ‡è¯†ç¼–è¯‘ç»“æœï¼Œä¸éœ€è¦ç­‰åˆ°è¿è¡Œæ—¶å†å»åˆ¤æ–­ï¼ŒèŠ‚çœå†…å­˜å’Œæ€§èƒ½ã€‚è¿™ä¸ªä¹Ÿæ˜¯å°¤å¤§å¤§é‡ç‚¹è¯´äº†çš„ï¼Œä¼˜åŒ–ç¼–è¯‘ï¼Œæå‡æ€§èƒ½ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸‹è½¬æ¢çš„ä»£ç ï¼Œä¸»è¦æœ‰å¦‚ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š parse &amp; parseChildren ä¸»å…¥å£ parseTag å¤„ç†æ ‡ç­¾ parseAttribute å¤„ç†æ ‡ç­¾ä¸Šçš„å±æ€§ parseElement å¤„ç†èµ·å§‹æ ‡ç­¾ parseInterpolation å¤„ç†åŠ¨æ€æ–‡æœ¬å†…å®¹ parseText å¤„ç†é™æ€æ–‡æœ¬å†…å®¹ parse &amp; parseChildren ä¸»å…¥å£parse çš„ä¸»å…¥å£ï¼Œè¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ª parseContextï¼Œæœ‰åˆ©äºåç»­ç›´æ¥ä» context ä¸Šæ‹¿åˆ° contentï¼Œoptions ç­‰ã€‚getCursor è·å–å½“å‰å¤„ç†çš„æŒ‡é’ˆä½ç½®ï¼Œç”¨æˆ·ç”Ÿæˆ loc,åˆå§‹éƒ½æ˜¯1ã€‚ 1234567891011121314export function parse(content: string, options: ParserOptions = {}): RootNode { const context = createParserContext(content, options) const start = getCursor(context) return { type: NodeTypes.ROOT, children: parseChildren(context, TextModes.DATA, []), helpers: [], components: [], directives: [], hoists: [], codegenNode: undefined, loc: getSelection(context, start) }} é‡ç‚¹çœ‹ä¸‹ parseChildren ï¼Œè¿™æ˜¯è½¬æ¢çš„ä¸»å…¥å£æ–¹æ³•ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849function parseChildren( context: ParserContext, mode: TextModes, ancestors: ElementNode[]): TemplateChildNode[] { const parent = last(ancestors) const ns = parent ? parent.ns : Namespaces.HTML const nodes: TemplateChildNode[] = [] while (!isEnd(context, mode, ancestors)) { const s = context.source let node: TemplateChildNode | TemplateChildNode[] | undefined = undefined if (startsWith(s, context.options.delimiters[0])) { // '{{' node = parseInterpolation(context, mode) } else if (mode === TextModes.DATA &amp;&amp; s[0] === '&lt;') { // https://html.spec.whatwg.org/multipage/parsing.html#tag-open-state if (s.length === 1) { emitError(context, ErrorCodes.EOF_BEFORE_TAG_NAME, 1) } else if (s[1] === '!') { // &lt;!DOCTYPE &lt;![CDATA[ ç­‰éèŠ‚ç‚¹å…ƒç´  æš‚ä¸è®¨è®º } else if (s[1] === '/') { if (s.length === 2) { } else if (s[2] === '&gt;') { advanceBy(context, 3) continue } else if (/[a-z]/i.test(s[2])) { parseTag(context, TagType.End, parent) continue } else { } } else if (/[a-z]/i.test(s[1])) { node = parseElement(context, ancestors) } else if (s[1] === '?') { } else { } } if (!node) { node = parseText(context, mode) } if (Array.isArray(node)) { for (let i = 0; i &lt; node.length; i++) { pushNode(context, nodes, node[i]) } } else { pushNode(context, nodes, node) } } return nodes} ancestors ç”¨æ¥å­˜å‚¨æœªåŒ¹é…çš„èµ·å§‹èŠ‚ç‚¹ï¼Œä¸ºåè¿›å…ˆå‡ºçš„stackã€‚ å¾ªç¯å¤„ç† sourceï¼Œå¾ªç¯æˆªæ­¢æ¡ä»¶æ˜¯ isEnd æ–¹æ³•è¿”å›trueï¼Œå³æ˜¯å¤„ç†å®Œæˆäº†ï¼Œç»“æŸæœ‰ä¸¤ä¸ªæ¡ä»¶: context.source ä¸ºç©ºï¼Œå³æ•´ä¸ªæ¨¡æ¿éƒ½å¤„ç†å®Œæˆã€‚ ç¢°åˆ°æˆªæ­¢èŠ‚ç‚¹æ ‡ç­¾(&lt;/)ï¼Œä¸”èƒ½åœ¨æœªåŒ¹é…çš„èµ·å§‹æ ‡ç­¾ï¼ˆancestorsï¼‰é‡Œé¢æ‰¾åˆ°å¯¹å¯¹åº”çš„tagã€‚è¿™ä¸ªå¯¹åº” parseChildren çš„å­èŠ‚ç‚¹å¤„ç†å®Œæˆã€‚ åŒ¹é…å°šæœªç»“æŸï¼Œåˆ™è¿›å…¥å¾ªç¯åŒ¹é…ã€‚æœ‰ä¸‰ç§æƒ…å†µï¼š if(startsWith(s,context.options.delimiters[0]))è¯­å¥ï¼Œ delimitersæ˜¯åˆ†å‰²ç¬¦åˆï¼Œå¯¹äºVueæ¥è¯´å°±æ˜¯â€˜â€™ã€‚å¼€å§‹åŒ¹é…åˆ°Vueçš„æ–‡æœ¬è¾“å‡ºå†…å®¹ï¼Œåˆ™æ„å‘³ç€éœ€è¦å¤„ç†æ–‡æœ¬å†…å®¹æ’å…¥ã€‚ else if (mode === TextModes.DATA &amp;&amp; s[0] === â€˜&lt;â€™) å†…å®¹æ˜¯ä»¥&lt;å¼€å¤´ï¼Œå³htmlæ ‡ç­¾çš„æ ‡è¯†ç¬¦å·ï¼Œåˆ™å¼€å§‹å¤„ç†èµ·å§‹æ ‡ç­¾å’Œæˆªæ­¢æ ‡ç­¾ä¸¤ç§æƒ…å†µã€‚ ä»¥ä¸Šæ¡ä»¶éƒ½ä¸æ˜¯ï¼Œæˆ–è€…åŒ¹é…æœªæˆåŠŸ,é‚£ä¹ˆå°±æ˜¯åŠ¨æ€æ–‡æœ¬å†…å®¹äº†ã€‚ å¦‚æœæ˜¯ç¬¬ä¸‰ç§åŠ¨æ€æ–‡æœ¬æ’å…¥ï¼Œåˆ™æ‰§è¡Œ parseInterpolation ç»„è£…æ–‡æœ¬èŠ‚ç‚¹ï¼Œå…¶ä¸­ isStatic=false æ ‡è¯†æ˜¯å˜é‡ï¼Œæ¯”è¾ƒç®€å•ï¼Œæ–¹æ³•å°±ä¸è´´äº†ã€‚ 12345678910return { type: NodeTypes.INTERPOLATION, content: { type: NodeTypes.SIMPLE_EXPRESSION, isStatic: false, content, loc: getSelection(context, innerStart, innerEnd) }, loc: getSelection(context, start) } å†çœ‹ä¸‹è¿™ä¸¤ä¸ªå¤„ç† source å†…å®¹åç§»çš„æ–¹æ³•ï¼š advanceBy(context,number) : å°†éœ€è¦å¤„ç†çš„æ¨¡æ¿source ï¼Œåç§» number ä¸ªå­—ç¬¦ï¼Œé‡æ–°è®°å½• locadvanceSpaces() : åç§»å­˜åœ¨çš„è¿ç»­çš„ç©ºæ ¼ å›åˆ°ä¸Šé¢çš„åŒ¹é…æ¡ä»¶ï¼Œå¦‚æœæ˜¯ &lt; å¼€å¤´ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼š ç¬¬äºŒä¸ªå­—ç¬¦æ˜¯ â€œ/â€œ å¯¹åº”çš„å°±æ˜¯ &lt;/ å¦‚æœæ˜¯ &lt;/&gt; ï¼Œé‚£ä¹ˆè®¤ä¸ºæ˜¯ä¸€ä¸ªæ— æ•ˆæ ‡ç­¾ï¼Œç›´æ¥ advanceBy åç§» 3 ä¸ªå­—ç¬¦å³å¯ã€‚ å¦‚æœæ˜¯ &lt;\\/aï¼Œé‚£ä¹ˆè®¤ä¸ºæ˜¯ä¸€ä¸ªæˆªæ­¢æ ‡ç­¾ï¼Œæ‰§è¡Œ parseTag æ–¹æ³•å¤„ç†ã€‚ ç¬¬äºŒä¸ªå­—ç¬¦æ˜¯å­—æ¯ å¯¹åº”å°±æ˜¯æ ‡ç­¾çš„èµ·å§‹æ–‡å­—äº†ï¼Œå¦‚ &lt;\\divï¼Œæ‰§è¡Œ parseElement æ–¹æ³•å¤„ç†èµ·å§‹æ ‡ç­¾ã€‚ parseTag å¤„ç†æ ‡ç­¾å¦‚æœæ˜¯æˆªæ­¢æ ‡ç­¾ï¼šparseTagï¼Œåˆ™ç›´æ¥å¤„ç†å®Œæˆã€‚å¦‚æœæ˜¯èµ·å§‹æ ‡ç­¾ï¼šparseElement æ‰§è¡Œï¼Œè°ƒç”¨parseTag å¤„ç†æ ‡ç­¾ï¼Œç„¶åå†å»é€’å½’å¤„ç†å­èŠ‚ç‚¹ç­‰ã€‚ æ­£åˆ™ï¼š/^&lt;/?([a-z][^\\t\\r\\n\\f /&gt;]*)/i è¿™ä¸ªå°±ä¸å¤šè¯´äº†ï¼ŒåŒ¹é… &lt;\\div&gt; &lt;/div&gt;è¿™ç§æ ‡ç­¾ã€‚æµ‹è¯• match ï¼š 12/^&lt;\\/?([a-z][^\\t\\r\\n\\f /&gt;]*)/i.exec(\"&lt;div class='abc'&gt;\")(2) [\"&lt;div\", \"div\", index: 0, input: \"&lt;div class='abc'&gt;\", groups: undefined] æ˜¾ç„¶ï¼Œmathch[1] å³åŒ¹é…åˆ°çš„æ ‡ç­¾å…ƒç´ ã€‚æˆ‘ä»¬çœ‹ä¸»æ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849function parseTag( context: ParserContext, type: TagType, parent: ElementNode | undefined): ElementNode { // Tag open. const start = getCursor(context) const match = /^&lt;\\/?([a-z][^\\t\\r\\n\\f /&gt;]*)/i.exec(context.source)! const tag = match[1] const props = [] const ns = context.options.getNamespace(tag, parent) let tagType = ElementTypes.ELEMENT if (tag === 'slot') tagType = ElementTypes.SLOT else if (tag === 'template') tagType = ElementTypes.TEMPLATE else if (/[A-Z-]/.test(tag)) tagType = ElementTypes.COMPONENT advanceBy(context, match[0].length) advanceSpaces(context) // Attributes. const attributeNames = new Set&lt;string&gt;() while ( context.source.length &gt; 0 &amp;&amp; !startsWith(context.source, '&gt;') &amp;&amp; !startsWith(context.source, '/&gt;') ) { const attr = parseAttribute(context, attributeNames) if (type === TagType.Start) { props.push(attr) } advanceSpaces(context) } // Tag close. let isSelfClosing = false if (context.source.length === 0) { } else { isSelfClosing = startsWith(context.source, '/&gt;') advanceBy(context, isSelfClosing ? 2 : 1) } return { type: NodeTypes.ELEMENT, ns, tag, tagType, props, isSelfClosing, children: [], loc: getSelection(context, start), codegenNode: undefined // to be created during transform phase }} tagTypeæœ‰å››ç§ç±»å‹ï¼Œåœ¨è¿™é‡Œå®šä¹‰äº†ï¼Œåˆ†åˆ«æ˜¯: 0 element,1 component,2 slot,3 template æˆ‘ä»¬çœ‹while å¾ªç¯ï¼ŒadvanceBy å»æ‰èµ·å§‹ &lt; å’Œæ ‡ç­¾åä¹‹å:å¦‚æœè·Ÿç€æ˜¯ &gt; æˆ–è€… /&gt; ï¼Œé‚£ä¹ˆæ ‡ç­¾å¤„ç†ç»“æŸï¼Œé€€å‡ºå¾ªç¯ã€‚å¦åˆ™æ˜¯æ ‡ç­¾çš„å…ƒç´ ï¼Œæˆ‘ä»¬æ‰§è¡Œ parseAttribute æ¥å¤„ç†æ ‡ç­¾å±æ€§ï¼Œè¯¥èŠ‚ç‚¹ä¸Šå¢åŠ propsï¼Œä¿å­˜ è¯¥èµ·å§‹èŠ‚ç‚¹çš„ attributes; æ‰§è¡Œæ–¹æ³•åé¢çš„ï¼ï¼Œæ˜¯tsè¯­æ³•ï¼Œç›¸å½“äºå‘Šè¯‰tsï¼Œè¿™é‡Œä¸€å®šä¼šæœ‰å€¼ï¼Œæ— éœ€åšç©ºåˆ¤æ–­ï¼Œå¦‚ const match = /^&lt;/?([a-z][^\\t\\r\\n\\f /&gt;]*)/i.exec(context.source)! parseAttribute å¤„ç†æ ‡ç­¾ä¸Šçš„å±æ€§æ­£åˆ™è·å–å±æ€§ä¸Šçš„name 12/^[^\\t\\r\\n\\f /&gt;][^\\t\\r\\n\\f /&gt;=]*/.exec('class='abc'&gt;')[\"class\", index: 0, input: \"class='abc'&gt;\", groups: undefined] å¦‚æœä¸æ˜¯ä¸€ä¸ªå­¤ç«‹çš„å±æ€§ï¼Œæœ‰valueå€¼çš„è¯ï¼ˆ/^[\\t\\r\\n\\f ]*=/.test(context.source)ï¼‰ï¼Œé‚£ä¹ˆå†è·å–å±æ€§çš„valueã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990function parseAttribute( context: ParserContext, nameSet: Set&lt;string&gt;): AttributeNode | DirectiveNode { // Name. const start = getCursor(context) const match = /^[^\\t\\r\\n\\f /&gt;][^\\t\\r\\n\\f /&gt;=]*/.exec(context.source)! const name = match[0] nameSet.add(name) advanceBy(context, name.length) // Value let value: | { content: string isQuoted: boolean loc: SourceLocation } | undefined = undefined if (/^[\\t\\r\\n\\f ]*=/.test(context.source)) { advanceSpaces(context) advanceBy(context, 1) advanceSpaces(context) value = parseAttributeValue(context) } const loc = getSelection(context, start) if (/^(v-|:|@|#)/.test(name)) { const match = /(?:^v-([a-z0-9-]+))?(?:(?::|^@|^#)([^\\.]+))?(.+)?$/i.exec( name )! let arg: ExpressionNode | undefined if (match[2]) { const startOffset = name.split(match[2], 2)!.shift()!.length const loc = getSelection( context, getNewPosition(context, start, startOffset), getNewPosition(context, start, startOffset + match[2].length) ) let content = match[2] let isStatic = true if (content.startsWith('[')) { isStatic = false content = content.substr(1, content.length - 2) } arg = { type: NodeTypes.SIMPLE_EXPRESSION, content, isStatic, loc } } if (value &amp;&amp; value.isQuoted) { const valueLoc = value.loc valueLoc.start.offset++ valueLoc.start.column++ valueLoc.end = advancePositionWithClone(valueLoc.start, value.content) valueLoc.source = valueLoc.source.slice(1, -1) } return { type: NodeTypes.DIRECTIVE, name: match[1] || (startsWith(name, ':') ? 'bind' : startsWith(name, '@') ? 'on' : 'slot'), exp: value &amp;&amp; { type: NodeTypes.SIMPLE_EXPRESSION, content: value.content, isStatic: false, loc: value.loc }, arg, modifiers: match[3] ? match[3].substr(1).split('.') : [], loc } } return { type: NodeTypes.ATTRIBUTE, name, value: value &amp;&amp; { type: NodeTypes.TEXT, content: value.content, isEmpty: value.content.trim().length === 0, loc: value.loc }, loc }} parseAttributeValue è·å–å±æ€§å€¼çš„æ–¹æ³•æ¯”è¾ƒå®¹æ˜“ï¼š å¦‚æœvalueå€¼æœ‰å¼•å·å¼€å§‹ï¼Œé‚£ä¹ˆå°±æ‰¾åˆ°ä¸‹ä¸€ä¸ªå¼•å·æœªvalueå€¼ç»“æŸ ï¼ˆclass=â€aaaâ€ class=â€™aaaâ€™ï¼‰ å¦‚æœvalueæ²¡æœ‰å¼•å·ï¼Œé‚£ä¹ˆå°±æ‰¾åˆ°ä¸‹ä¸€ä¸ªç©ºæ ¼ä¸ºvalueå€¼ç»“æŸ ï¼ˆclass=aaaï¼‰ å…¶ä¸­æœ‰å¤„ç†vueçš„è¯­æ³•ç‰¹æ€§ï¼Œå¦‚æœå±æ€§åç§°æ˜¯v-,:,@,#å¼€å¤´çš„ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œçœ‹ä¸‹è¿™ä¸ªæ­£åˆ™ï¼š 12345/(?:^v-([a-z0-9-]+))?(?:(?::|^@|^#)([^\\.]+))?(.+)?$/i.exec(\"v-name\")(4) [\"v-name\", \"name\", undefined, undefined, index: 0, input: \"v-name\", groups: undefined]/(?:^v-([a-z0-9-]+))?(?:(?::|^@|^#)([^\\.]+))?(.+)?$/i.exec(\":name\")(4) [\":name\", undefined, \"name\", undefined, index: 0, input: \":name\", groups: undefined] mathch[2]å¦‚æœæœ‰å€¼ï¼Œå³åŒ¹é…åˆ°äº†ï¼Œè¯´æ˜æ˜¯é v-nameï¼Œå¦‚æœæ˜¯åç§°æ˜¯[]åŒ…è£¹çš„åˆ™æ˜¯ åŠ¨æ€æŒ‡ä»¤ï¼Œå°† isStatic ç½®ä¸º false parseElement å¤„ç†èµ·å§‹æ ‡ç­¾parseElement å¤„ç†èµ·å§‹æ ‡ç­¾ï¼Œæˆ‘ä»¬å…ˆæ‰§è¡Œ parseTag è§£ææ ‡ç­¾ï¼Œè·å–åˆ°èµ·å§‹èŠ‚ç‚¹çš„ æ ‡ç­¾å…ƒç´ å’Œå±æ€§ï¼Œå¦‚æœå½“å‰ä¹Ÿæ˜¯æˆªæ­¢æ ‡ç­¾(æ¯”å¦‚),åˆ™ç›´æ¥è¿”å›è¯¥æ ‡ç­¾ã€‚å¦åˆ™ï¼Œå°†èµ·å§‹æ ‡ç­¾ push åˆ°æœªåŒ¹é…çš„èµ·å§‹ ancestorsæ ˆé‡Œé¢ã€‚ç„¶åç»§ç»­å»å¤„ç†å­å…ƒç´  parseChildren ,æ³¨æ„ï¼Œå°†æœªåŒ¹é…çš„ ancestors ä¼ è¿›å»äº†ï¼ŒparseChildren çš„æˆªæ­¢æ¡ä»¶æœ‰ä¸¤ä¸ªï¼š context.sourceä¸ºç©ºï¼Œå³å¤„ç†å®Œæˆ ç¢°åˆ°æˆªæ­¢èŠ‚ç‚¹æ ‡ç­¾(&lt;/)ï¼Œä¸”èƒ½åœ¨æœªåŒ¹é…çš„èµ·å§‹æ ‡ç­¾ï¼ˆancestorsï¼‰é‡Œé¢æ‰¾åˆ°å¯¹å¯¹åº”çš„tagã€‚ å› æ­¤ï¼Œå¦‚æœæ˜¯å¾ªç¯ç¢°åˆ°åŒ¹é…çš„æˆªæ­¢æ ‡ç­¾äº†ï¼Œåˆ™éœ€è¦ ancestors.pop()ï¼Œå°†èŠ‚ç‚¹æ·»åŠ åˆ°å½“å‰çš„å­èŠ‚ç‚¹ã€‚ å½“ç„¶ï¼Œå¤„ç†å½“å‰èµ·å§‹èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹ä¹Ÿå¯èƒ½æ˜¯æˆªæ­¢èŠ‚ç‚¹ï¼Œæ¯”å¦‚ï¼š&lt;\\img src=â€xxxâ€/&gt;ï¼Œåˆ™ç»§ç»­å»æ‰§è¡Œå¤„ç†æˆªæ­¢èŠ‚ç‚¹å³å¯ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728function parseElement( context: ParserContext, ancestors: ElementNode[]): ElementNode | undefined { // Start tag. const parent = last(ancestors) const element = parseTag(context, TagType.Start, parent) if (element.isSelfClosing || context.options.isVoidTag(element.tag)) { return element } // Children. ancestors.push(element) const mode = (context.options.getTextMode( element.tag, element.ns ) as unknown) as TextModes const children = parseChildren(context, mode, ancestors) ancestors.pop() element.children = children // End tag. if (startsWithEndTagOpen(context.source, element.tag)) { parseTag(context, TagType.End, parent) } else { } element.loc = getSelection(context, element.loc.start) return element} è‡³æ­¤ï¼Œvue3.0çš„ å°† æ¨¡æ¿æ–‡ä»¶è½¬æ¢æˆ AST çš„ä¸»æµç¨‹å·²ç»åŸºæœ¬å®Œæˆã€‚é™å¾…ä¸‹ç¯‡ï¼ŒAST çš„ transform å¤„ç†ã€‚","link":"/2019/10/09/Vue-js-3-0ç¼–è¯‘å™¨compiler-coreæºç è§£æ/"},{"title":"æ¢ç§æ–¹å¼è¯»æºç ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªç®€æ˜“ç‰ˆçš„Mocha","text":"ä½œè€…ï¼šé»„æµ©ç¾¤ å‰è¨€Mocha æ˜¯ç›®å‰æœ€æµè¡Œçš„ JavaScript æµ‹è¯•æ¡†æ¶ï¼Œç†è§£ Mocha çš„å†…éƒ¨å®ç°åŸç†æœ‰åŠ©äºæˆ‘ä»¬æ›´æ·±å…¥åœ°äº†è§£å’Œå­¦ä¹ è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚ç„¶è€Œé˜…è¯»æºç ä¸€ç›´æ˜¯ä¸ªè®©äººæœ›è€Œç”Ÿç•çš„è¿‡ç¨‹ï¼Œå¤§é‡çš„é«˜çº§å†™æ³•ç»å¸¸æ˜¯æ™¦æ¶©éš¾æ‡‚ï¼Œå¤§é‡çš„è¾¹ç¼˜æƒ…å†µçš„å¤„ç†ä¹Ÿååˆ†å½±å“å¯¹æ ¸å¿ƒä»£ç çš„ç†è§£ï¼Œä»¥è‡³äºå†™ä¸€ç¯‡æºç è§£æè¿‡åå¾€å¾€æ˜¯è¿è‡ªå·±éƒ½çœ‹ä¸æ‡‚ã€‚æ‰€ä»¥ï¼Œè¿™æ¬¡æˆ‘ä»¬ä¸ç”Ÿå•ƒ Mocha æºç ï¼Œæ¢ä¸ªæ–¹å¼ï¼Œä»é›¶å¼€å§‹ä¸€æ­¥æ­¥å®ç°ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ Mochaã€‚ æˆ‘ä»¬å°†å®ç°ä»€ä¹ˆï¼Ÿ å®ç° Mocha æ¡†æ¶çš„ BDD é£æ ¼æµ‹è¯•ï¼Œèƒ½é€šè¿‡ describe/it å‡½æ•°å®šä¹‰ä¸€ç»„æˆ–å•ä¸ªçš„æµ‹è¯•ç”¨ä¾‹ï¼› å®ç° Mocha æ¡†æ¶çš„ Hook æœºåˆ¶ï¼ŒåŒ…æ‹¬ beforeã€afterã€beforeEachã€afterEachï¼› å®ç°ç®€å•æ ¼å¼çš„æµ‹è¯•æŠ¥å‘Šè¾“å‡ºã€‚ Mocha çš„ BDD æµ‹è¯• Mocha æ”¯æŒ BDD/TDD ç­‰å¤šç§æµ‹è¯•é£æ ¼ï¼Œé»˜è®¤ä½¿ç”¨ BDD æ¥å£ã€‚BDDï¼ˆè¡Œä¸ºé©±åŠ¨å¼€å‘ï¼‰æ˜¯ä¸€ç§ä»¥éœ€æ±‚ä¸ºå¯¼å‘çš„æ•æ·å¼€å‘æ–¹æ³•ï¼Œç›¸æ¯”ä¸»å¼ â€æµ‹è¯•å…ˆè¡Œâ€œçš„ TDDï¼ˆæµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰è€Œè¨€ï¼Œå®ƒå¼ºè°ƒâ€éœ€æ±‚å…ˆè¡Œâ€œï¼Œä»ä¸€ä¸ªæ›´åŠ å®è§‚çš„è§’åº¦å»å…³æ³¨åŒ…æ‹¬å¼€å‘ã€QAã€éœ€æ±‚æ–¹åœ¨å†…çš„å¤šæ–¹åˆ©ç›Šç›¸å…³è€…çš„åä½œå…³ç³»ï¼ŒåŠ›æ±‚è®©å¼€å‘è€…â€œåšæ­£ç¡®çš„äº‹â€œã€‚åœ¨ Mocha ä¸­ï¼Œä¸€ä¸ªç®€å•çš„ BDD å¼æµ‹è¯•ç”¨ä¾‹å¦‚ä¸‹ï¼š 12345678910111213141516describe('Array', function() { describe('#indexOf()', function() { before(function() { // ... }); it('should return -1 when not present', function() { // ... }); it('should return the index when present', function() { // ... }); after(function() { // ... }); });}); Mocha çš„ BDD æµ‹è¯•ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ª APIï¼š describe/contextï¼šè¡Œä¸ºæè¿°ï¼Œä»£è¡¨ä¸€ä¸ªæµ‹è¯•å—ï¼Œæ˜¯ä¸€ç»„æµ‹è¯•å•å…ƒçš„é›†åˆï¼› it/specifyï¼šæè¿°äº†ä¸€ä¸ªæµ‹è¯•å•å…ƒï¼Œæ˜¯æœ€å°çš„æµ‹è¯•å•ä½ï¼› beforeï¼šHook å‡½æ•°ï¼Œåœ¨æ‰§è¡Œè¯¥æµ‹è¯•å—ä¹‹å‰æ‰§è¡Œï¼› afterï¼šHook å‡½æ•°ï¼Œåœ¨æ‰§è¡Œè¯¥æµ‹è¯•å—ä¹‹åæ‰§è¡Œï¼› beforeEachï¼šHook å‡½æ•°ï¼Œåœ¨æ‰§è¡Œè¯¥æµ‹è¯•å—ä¸­æ¯ä¸ªæµ‹è¯•å•å…ƒä¹‹å‰æ‰§è¡Œï¼› afterEachï¼šHook å‡½æ•°ï¼Œåœ¨æ‰§è¡Œè¯¥æµ‹è¯•å—ä¸­æ¯ä¸ªæµ‹è¯•å•å…ƒä¹‹åæ‰§è¡Œã€‚ å¼€å§‹è¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ç›´æ¥å¼€å§‹ã€‚ ä¸€ã€ç›®å½•è®¾è®¡æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå‘½åä¸º simple-mochaã€‚ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š 1234567â”œâ”€ mocha/â”‚ â”œâ”€ index.jsâ”‚ â”œâ”€ src/â”‚ â”œâ”€ interfaces/â”‚ â””â”€ reporters/â”œâ”€ test/â””â”€ package.json å…ˆå¯¹è¿™ä¸ªç›®å½•ç»“æ„ä½œç®€å•è§£é‡Šï¼š mocha/ï¼šå­˜æ”¾æˆ‘ä»¬å³å°†å®ç°çš„ simple-mocha çš„æºä»£ç  mocha/index.jsï¼šsimple-mocha å…¥å£ mocha/src/ï¼šsimple-mocha æ ¸å¿ƒä»£ç  mocha/interfaces/ï¼šå­˜æ”¾å„ç±»é£æ ¼çš„æµ‹è¯•æ¥å£ï¼Œå¦‚ BDD mocha/reporters/ï¼šå­˜æ”¾ç”¨äºè¾“å‡ºæµ‹è¯•æŠ¥å‘Šçš„å„ç§ reporterï¼Œå¦‚ SPEC test/ï¼šå­˜æ”¾æˆ‘ä»¬ç¼–å†™çš„æµ‹è¯•ç”¨ä¾‹ package.json å…¶ä¸­ package.json å†…å®¹å¦‚ä¸‹ï¼š 1234567891011{ \"name\": \"simple-mocha\", \"version\": \"1.0.0\", \"description\": \"a simple mocha for understanding the mechanism of mocha\", \"main\": \"\", \"scripts\": { \"test\": \"node mocha/index.js\" }, \"author\": \"hankle\", \"license\": \"ISC\"} æ‰§è¡Œ npm test å°±å¯ä»¥å¯åŠ¨æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ã€‚ äºŒã€æ¨¡å—è®¾è®¡Mocha çš„ BDD æµ‹è¯•åº”è¯¥æ˜¯ä¸€ä¸ªâ€å…ˆå®šä¹‰åæ‰§è¡Œâ€œçš„è¿‡ç¨‹ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯å…¶ Hook æœºåˆ¶æ­£ç¡®æ‰§è¡Œï¼Œè€Œä¸ä»£ç ç¼–å†™é¡ºåºæ— å…³ï¼Œå› æ­¤æˆ‘ä»¬æŠŠæ•´ä¸ªæµ‹è¯•æµç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šæ”¶é›†æµ‹è¯•ç”¨ä¾‹ï¼ˆå®šä¹‰ï¼‰å’Œæ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼ˆæ‰§è¡Œï¼‰ã€‚æˆ‘ä»¬æ„é€ äº†ä¸€ä¸ª Mocha ç±»æ¥å®Œæˆè¿™ä¸¤ä¸ªè¿‡ç¨‹ï¼ŒåŒæ—¶è¿™ä¸ªç±»ä¹Ÿè´Ÿè´£ç»Ÿç­¹åè°ƒå…¶ä»–å„æ¨¡å—çš„æ‰§è¡Œï¼Œå› æ­¤å®ƒæ˜¯æ•´ä¸ªæµ‹è¯•æµç¨‹çš„æ ¸å¿ƒã€‚ 1234567// mocha/src/mocha.jsclass Mocha { constructor() {} run() {}}module.exports = Mocha; 12345// mocha/index.jsconst Mocha = require('./src/mocha');const mocha = new Mocha();mocha.run(); å¦ä¸€æ–¹é¢æˆ‘ä»¬çŸ¥é“ï¼Œdescribe å‡½æ•°æè¿°äº†ä¸€ä¸ªæµ‹è¯•é›†åˆï¼Œè¿™ä¸ªæµ‹è¯•é›†åˆé™¤åŒ…æ‹¬è‹¥å¹²æµ‹è¯•å•å…ƒå¤–ï¼Œè¿˜æ‹¥æœ‰ç€ä¸€äº›è‡ªèº«çš„ Hook å‡½æ•°ï¼Œç»´æŠ¤äº†ä¸€å¥—ä¸¥æ ¼çš„æ‰§è¡Œæµã€‚it å‡½æ•°æè¿°äº†ä¸€ä¸ªæµ‹è¯•å•å…ƒï¼Œå®ƒéœ€è¦æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶ä¸”æ¥æ”¶æ–­è¨€ç»“æœã€‚è¿™æ˜¯ä¸¤ä¸ªé€»è¾‘å¤æ‚çš„å•å…ƒï¼ŒåŒæ—¶éœ€è¦ç»´æŠ¤ä¸€å®šçš„å†…éƒ¨çŠ¶æ€ï¼Œæˆ‘ä»¬ç”¨ä¸¤ä¸ªç±»ï¼ˆSuite/Testï¼‰æ¥åˆ†åˆ«æ„é€ å®ƒä»¬ã€‚æ­¤å¤–æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒBDD é£æ ¼çš„æµ‹è¯•ç”¨ä¾‹æ˜¯ä¸€ä¸ªå…¸å‹çš„æ ‘å½¢ç»“æ„ï¼Œdescribe å®šä¹‰çš„æµ‹è¯•å—å¯ä»¥åŒ…å«æµ‹è¯•å—ï¼Œä¹Ÿå¯ä»¥åŒ…å« it å®šä¹‰çš„æµ‹è¯•å•å…ƒã€‚æ‰€ä»¥ Suite/Test å®ä¾‹è¿˜å°†ä½œä¸ºèŠ‚ç‚¹ï¼Œæ„é€ å‡ºä¸€æ£µ suite-test æ ‘ã€‚æ¯”å¦‚ä¸‹è¾¹è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼š 12345678910111213141516describe('Array', function () { describe('#indexOf()', function () { it('should return -1 when not present', function () { // ... }) it('should return the index when present', function () { // ... }) }) describe('#every()', function () { it('should return true when all items are satisfied', function () { // ... }) })}) ç”±å®ƒæ„é€ å‡ºæ¥çš„ suite-test æ ‘æ˜¯è¿™æ ·çš„ï¼š 1234567891011 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”¤ test:\"should return -1 when not present\" â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”Œâ”€â”¤ suite:\"#indexOf()\" â”œâ”€â”¤ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â””â”€â”¤ test:\"should return the index when present\" â”‚â”‚ suite:\"Array\" â”œâ”€â”¤ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â””â”€â”¤ suite:\"#every()\" â”œâ”€â”€â”€â”¤ test:\"should return true when all items are satisfied\" â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ å› æ­¤ï¼ŒSuite/Test é™¤äº†è¦èƒ½å¤Ÿè¡¨ç¤º describe/it ä¹‹å¤–ï¼Œè¿˜åº”è¯¥èƒ½å¤Ÿè¯ é‡Šè¿™ç§æ ‘çŠ¶ç»“æ„çš„çˆ¶å­çº§å…³ç³»ï¼š 12345678910111213141516171819// mocha/src/suite.jsclass Suite { constructor(props) { this.title = props.title; // Suiteåç§°ï¼Œå³describeä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•° this.suites = []; // å­çº§suite this.tests = []; // åŒ…å«çš„test this.parent = props.parent; // çˆ¶suite this._beforeAll = []; // before hook this._afterAll = []; // after hook this._beforeEach = []; // beforeEach hook this._afterEach = []; // afterEach hook if (props.parent instanceof Suite) { props.parent.suites.push(this); } }}module.exports = Suite; 123456789// mocha/src/test.jsclass Test { constructor(props) { this.title = props.title; // Teståç§°ï¼Œå³itä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•° this.fn = props.fn; // Testçš„æ‰§è¡Œå‡½æ•°ï¼Œå³itä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•° }}module.exports = Test; æˆ‘ä»¬å®Œå–„ä¸€ä¸‹ç›®å½•ç»“æ„ï¼š 12345678910111213141516â”œâ”€ mocha/â”‚ â”œâ”€ index.jsâ”‚ â”œâ”€ src/â”‚ â”‚ â”œâ”€ mocha.jsâ”‚ â”‚ â”œâ”€ runner.jsâ”‚ â”‚ â”œâ”€ suite.jsâ”‚ â”‚ â”œâ”€ test.jsâ”‚ â”‚ â””â”€ utils.jsâ”‚ â”œâ”€ interfaces/â”‚ â”‚ â”œâ”€ bdd.jsâ”‚ â”‚ â””â”€ index.jsâ”‚ â””â”€ reporters/â”‚ â”œâ”€ spec.jsâ”‚ â””â”€ index.jsâ”œâ”€ test/â””â”€ package.json è€ƒè™‘åˆ°æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹çš„è¿‡ç¨‹è¾ƒä¸ºå¤æ‚ï¼Œæˆ‘ä»¬æŠŠè¿™å—é€»è¾‘å•ç‹¬æŠ½ç¦»åˆ° runner.jsï¼Œå®ƒå°†åœ¨æ‰§è¡Œé˜¶æ®µè´Ÿè´£è°ƒåº¦ suite å’Œ test èŠ‚ç‚¹å¹¶è¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œåç»­ä¼šè¯¦ç»†è¯´åˆ°ã€‚ ä¸‰ã€æ”¶é›†æµ‹è¯•ç”¨ä¾‹æ”¶é›†æµ‹è¯•ç”¨ä¾‹ç¯èŠ‚é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ª suite æ ¹èŠ‚ç‚¹ï¼Œå¹¶æŠŠ API æŒ‚è½½åˆ°å…¨å±€ï¼Œç„¶åå†æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ *.spec.js è¿›è¡Œç”¨ä¾‹æ”¶é›†ï¼Œæœ€ç»ˆå°†ç”Ÿæˆä¸€æ£µä¸ä¹‹ç»“æ„å¯¹åº”çš„ suite-test æ ‘ã€‚ 1ã€suite æ ¹èŠ‚ç‚¹æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª suite å®ä¾‹ï¼Œä½œä¸ºæ•´æ£µ suite-test æ ‘çš„æ ¹èŠ‚ç‚¹ï¼ŒåŒæ—¶å®ƒä¹Ÿæ˜¯æˆ‘ä»¬æ”¶é›†å’Œæ‰§è¡Œæµ‹è¯•ç”¨ä¾‹çš„èµ·ç‚¹ã€‚ 12345678910111213// mocha/src/mocha.jsconst Suite = require('./suite');class Mocha { constructor() { // åˆ›å»ºä¸€ä¸ªsuiteæ ¹èŠ‚ç‚¹ this.rootSuite = new Suite({ title: '', parent: null }); } // ...} 2ã€BDD API çš„å…¨å±€æŒ‚è½½åœ¨æˆ‘ä»¬ä½¿ç”¨ Mocha ç¼–å†™æµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨å¼•å…¥ Mocha æä¾›çš„ä»»ä½•æ¨¡å—ï¼Œå°±èƒ½å¤Ÿç›´æ¥ä½¿ç”¨ describeã€it ç­‰ä¸€ç³»åˆ— APIã€‚é‚£æ€ä¹ˆæ ·æ‰èƒ½å®ç°è¿™ä¸€ç‚¹å‘¢ï¼Ÿå¾ˆç®€å•ï¼ŒæŠŠ API æŒ‚è½½åˆ° global å¯¹è±¡ä¸Šå°±è¡Œã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ä¹‹å‰ï¼Œå…ˆå°† BDD é£æ ¼çš„ API å…¨éƒ¨ä½œå…¨å±€æŒ‚è½½ã€‚ 1234567891011121314// mocha/src/mocha.js// ...const interfaces = require('../interfaces');class Mocha { constructor() { // åˆ›å»ºä¸€ä¸ªæ ¹suite // ... // ä½¿ç”¨bddæµ‹è¯•é£æ ¼ï¼Œå°†APIæŒ‚è½½åˆ°globalå¯¹è±¡ä¸Š const ui = 'bdd'; interfaces[ui](global, this.rootSuite); } // ...} 12// mocha/interfaces/index.jsmodule.exports.bdd = require('./bdd'); 123456789// mocha/interfaces/bdd.jsmodule.exports = function (context, root) { context.describe = context.context = function (title, fn) {} context.it = context.specify = function (title, fn) {} context.before = function (fn) {} context.after = function (fn) {} context.beforeEach = function (fn) {} context.afterEach = function (fn) {}} 3ã€BDD API çš„å…·ä½“å®ç°æˆ‘ä»¬å…ˆçœ‹çœ‹ describe å‡½æ•°æ€ä¹ˆå®ç°ã€‚ describe ä¼ å…¥çš„ fn å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæè¿°äº†ä¸€ä¸ªæµ‹è¯•å—ï¼Œæµ‹è¯•å—åŒ…å«äº†è‹¥å¹²å­æµ‹è¯•å—å’Œæµ‹è¯•å•å…ƒã€‚å› æ­¤æˆ‘ä»¬éœ€è¦æ‰§è¡Œ describe ä¼ å…¥çš„ fn å‡½æ•°ï¼Œæ‰èƒ½å¤Ÿè·çŸ¥åˆ°å®ƒçš„å­å±‚ç»“æ„ï¼Œä»è€Œæ„é€ å‡ºä¸€æ£µå®Œæ•´çš„ suite-test æ ‘ã€‚è€Œé€å±‚æ‰§è¡Œ describe çš„ fn å‡½æ•°ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ·±åº¦ä¼˜å…ˆéå†çš„è¿‡ç¨‹ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ©ç”¨ä¸€ä¸ªæ ˆï¼ˆstackï¼‰æ¥è®°å½• suite æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„ã€‚ 1234567891011121314151617181920// mocha/interfaces/bdd.jsconst Suite = require('../src/suite');const Test = require('../src/test');module.exports = function (context, root) { // è®°å½• suite æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„ const suites = [root]; context.describe = context.context = function (title, fn) { const parent = suites[0]; const suite = new Suite({ title, parent }); suites.unshift(suite); fn.call(suite); suites.shift(suite); }} æ¯æ¬¡å¤„ç†ä¸€ä¸ª describe æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šæ„å»ºä¸€ä¸ª Suite å®ä¾‹æ¥è¡¨ç¤ºå®ƒï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œ fn å‰å…¥æ ˆï¼Œæ‰§è¡Œ fn åå‡ºæ ˆï¼Œä¿è¯ suites[0] å§‹ç»ˆæ˜¯å½“å‰æ­£åœ¨å¤„ç†çš„ suite èŠ‚ç‚¹ã€‚åˆ©ç”¨è¿™ä¸ªæ ˆåˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨éå†è¿‡ç¨‹ä¸­æ„å»ºå‡º suite çš„æ ‘çº§å…³ç³»ã€‚ åŒæ ·çš„ï¼Œå…¶ä»– API ä¹Ÿéƒ½éœ€è¦ä¾èµ–è¿™ä¸ªæ ˆåˆ—è¡¨æ¥å®ç°ï¼š 123456789101112131415161718192021222324252627282930313233343536// mocha/interfaces/bdd.jsmodule.exports = function (context, root) { // è®°å½• suite æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„ const suites = [root]; // context.describe = ... context.it = context.specify = function (title, fn) { const parent = suites[0]; const test = new Test({ title, fn }); parent.tests.push(test); } context.before = function (fn) { const cur = suites[0]; cur._beforeAll.push(fn); } context.after = function (fn) { const cur = suites[0]; cur._afterAll.push(fn); } context.beforeEach = function (fn) { const cur = suites[0]; cur._beforeEach.push(fn); } context.afterEach = function (fn) { const cur = suites[0]; cur._afterEach.push(fn); }} 4ã€æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œæˆ‘ä»¬å¼€å§‹ require æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ã€‚è¦å®Œæˆè¿™ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‡½æ•°æ¥ååŠ©å®Œæˆï¼Œå®ƒè´Ÿè´£è§£æ test è·¯å¾„ä¸‹çš„èµ„æºï¼Œè¿”å›ä¸€ä¸ªæ–‡ä»¶åˆ—è¡¨ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ”¯æŒ test è·¯å¾„ä¸ºæ–‡ä»¶å’Œä¸ºç›®å½•çš„ä¸¤ç§æƒ…å†µã€‚ 1234567891011121314151617181920212223242526272829303132333435// mocha/src/utils.jsconst path = require('path');const fs = require('fs');module.exports.lookupFiles = function lookupFiles(filepath) { let stat; // å‡è®¾è·¯å¾„æ˜¯æ–‡ä»¶ try { stat = fs.statSync(`${filepath}.js`); if (stat.isFile()) { // ç¡®å®æ˜¯æ–‡ä»¶ï¼Œç›´æ¥ä»¥æ•°ç»„å½¢å¼è¿”å› return [filepath]; } } catch(e) {} // å‡è®¾è·¯å¾„æ˜¯ç›®å½• let files = []; // å­˜æ”¾ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ fs.readdirSync(filepath).forEach(function(dirent) { let pathname = path.join(filepath, dirent); try { stat = fs.statSync(pathname); if (stat.isDirectory()) { // æ˜¯ç›®å½•ï¼Œè¿›ä¸€æ­¥é€’å½’ files = files.concat(lookupFiles(pathname)); } else if (stat.isFile()) { // æ˜¯æ–‡ä»¶ï¼Œè¡¥å……åˆ°å¾…è¿”å›çš„æ–‡ä»¶åˆ—è¡¨ä¸­ files.push(pathname); } } catch(e) {} }); return files;} 1234567891011121314151617181920// mocha/src/mocha.js// ...const path = require('path');const utils = require('./utils');class Mocha { constructor() { // åˆ›å»ºä¸€ä¸ªæ ¹suite // ... // ä½¿ç”¨bddæµ‹è¯•é£æ ¼ï¼Œå°†APIæŒ‚è½½åˆ°globalå¯¹è±¡ä¸Š // ... // æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ï¼Œæ„å»ºsuite-testæ ‘ const spec = path.resolve(__dirname, '../../test'); const files = utils.lookupFiles(spec); files.forEach(file =&gt; { require(file); }); } // ...} å››ã€æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹åœ¨è¿™ä¸ªç¯èŠ‚ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡éå† suite-test æ ‘æ¥é€’å½’æ‰§è¡Œ suite èŠ‚ç‚¹å’Œ test èŠ‚ç‚¹ï¼Œå¹¶åŒæ­¥åœ°è¾“å‡ºæµ‹è¯•æŠ¥å‘Šã€‚ 1ã€å¼‚æ­¥æ‰§è¡ŒMocha çš„æµ‹è¯•ç”¨ä¾‹å’Œ Hook å‡½æ•°æ˜¯æ”¯æŒå¼‚æ­¥æ‰§è¡Œçš„ã€‚å¼‚æ­¥æ‰§è¡Œçš„å†™æ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å‡½æ•°è¿”å›å€¼ä¸ºä¸€ä¸ª promise å¯¹è±¡ï¼Œå¦ä¸€ç§æ˜¯å‡½æ•°æ¥æ”¶ä¸€ä¸ªå…¥å‚ doneï¼Œå¹¶ç”±å¼€å‘è€…åœ¨å¼‚æ­¥ä»£ç ä¸­æ‰‹åŠ¨è°ƒç”¨ done(error) æ¥å‘ Mocha ä¼ é€’æ–­è¨€ç»“æœã€‚æ‰€ä»¥ï¼Œåœ¨æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåŒ…è£…å‡½æ•°ï¼Œå°†å¼€å‘è€…ä¼ å…¥çš„å‡½æ•° promise åŒ–ï¼š 123456789101112131415161718192021222324// mocha/src/utils.js// ...module.exports.adaptPromise = function(fn) { return () =&gt; new Promise(resolve =&gt; { if (fn.length == 0) { // ä¸ä½¿ç”¨å‚æ•° done try { const ret = fn(); // åˆ¤æ–­æ˜¯å¦è¿”å›promise if (ret instanceof Promise) { return ret.then(resolve, resolve); } else { resolve(); } } catch (error) { resolve(error); } } else { // ä½¿ç”¨å‚æ•° done function done(error) { resolve(error); } fn(done); } })} è¿™ä¸ªå·¥å…·å‡½æ•°ä¼ å…¥ä¸€ä¸ªå‡½æ•° fn å¹¶è¿”å›å¦å¤–ä¸€ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œè¿”å›çš„å‡½æ•°èƒ½å¤Ÿä»¥ promise çš„å½¢å¼å»è¿è¡Œ fnã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬éœ€è¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ä¹‹å‰çš„ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435// mocha/interfaces/bdd.js// ...const { adaptPromise } = require('../src/utils');module.exports = function (context, root) { // ... context.it = context.specify = function (title, fn) { // ... const test = new Test({ title, fn: adaptPromise(fn) }); // ... } context.before = function (fn) { // ... cur._beforeAll.push(adaptPromise(fn)); } context.after = function (fn) { // ... cur._afterAll.push(adaptPromise(fn)); } context.beforeEach = function (fn) { // ... cur._beforeEach.push(adaptPromise(fn)); } context.afterEach = function (fn) { // ... cur._afterEach.push(adaptPromise(fn)); }} 2ã€æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå™¨æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹éœ€è¦è°ƒåº¦ suite å’Œ test èŠ‚ç‚¹ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ‰§è¡Œå™¨ï¼ˆrunnerï¼‰æ¥ç»Ÿä¸€è´Ÿè´£æ‰§è¡Œè¿‡ç¨‹ã€‚è¿™æ˜¯æ‰§è¡Œé˜¶æ®µçš„æ ¸å¿ƒï¼Œæˆ‘ä»¬å…ˆç›´æ¥è´´ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124// mocha/src/runner.jsconst EventEmitter = require('events').EventEmitter;// ç›‘å¬äº‹ä»¶çš„æ ‡è¯†const constants = { EVENT_RUN_BEGIN: 'EVENT_RUN_BEGIN', // æ‰§è¡Œæµç¨‹å¼€å§‹ EVENT_RUN_END: 'EVENT_RUN_END', // æ‰§è¡Œæµç¨‹ç»“æŸ EVENT_SUITE_BEGIN: 'EVENT_SUITE_BEGIN', // æ‰§è¡Œsuiteå¼€å§‹ EVENT_SUITE_END: 'EVENT_SUITE_END', // æ‰§è¡Œsuiteå¼€å§‹ EVENT_FAIL: 'EVENT_FAIL', // æ‰§è¡Œç”¨ä¾‹å¤±è´¥ EVENT_PASS: 'EVENT_PASS' // æ‰§è¡Œç”¨ä¾‹æˆåŠŸ}class Runner extends EventEmitter { constructor() { super(); // è®°å½• suite æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„ this.suites = []; } /* * ä¸»å…¥å£ */ async run(root) { this.emit(constants.EVENT_RUN_BEGIN); await this.runSuite(root); this.emit(constants.EVENT_RUN_END); } /* * æ‰§è¡Œsuite */ async runSuite(suite) { // suiteæ‰§è¡Œå¼€å§‹ this.emit(constants.EVENT_SUITE_BEGIN, suite); // 1ï¼‰æ‰§è¡Œbeforeé’©å­å‡½æ•° if (suite._beforeAll.length) { for (const fn of suite._beforeAll) { const result = await fn(); if (result instanceof Error) { this.emit(constants.EVENT_FAIL, `\"before all\" hook in ${suite.title}: ${result.message}`); // suiteæ‰§è¡Œç»“æŸ this.emit(constants.EVENT_SUITE_END); return; } } } // è·¯å¾„æ ˆæ¨å…¥å½“å‰èŠ‚ç‚¹ this.suites.unshift(suite); // 2ï¼‰æ‰§è¡Œtest if (suite.tests.length) { for (const test of suite.tests) { await this.runTest(test); } } // 3ï¼‰æ‰§è¡Œå­çº§suite if (suite.suites.length) { for (const child of suite.suites) { await this.runSuite(child); } } // è·¯å¾„æ ˆæ¨å‡ºå½“å‰èŠ‚ç‚¹ this.suites.shift(suite); // 4ï¼‰æ‰§è¡Œafteré’©å­å‡½æ•° if (suite._afterAll.length) { for (const fn of suite._afterAll) { const result = await fn(); if (result instanceof Error) { this.emit(constants.EVENT_FAIL, `\"after all\" hook in ${suite.title}: ${result.message}`); // suiteæ‰§è¡Œç»“æŸ this.emit(constants.EVENT_SUITE_END); return; } } } // suiteç»“æŸ this.emit(constants.EVENT_SUITE_END); } /* * æ‰§è¡Œsuite */ async runTest(test) { // 1ï¼‰ç”±suiteæ ¹èŠ‚ç‚¹å‘å½“å‰suiteèŠ‚ç‚¹ï¼Œä¾æ¬¡æ‰§è¡ŒbeforeEaché’©å­å‡½æ•° const _beforeEach = [].concat(this.suites).reverse().reduce((list, suite) =&gt; list.concat(suite._beforeEach), []); if (_beforeEach.length) { for (const fn of _beforeEach) { const result = await fn(); if (result instanceof Error) { return this.emit(constants.EVENT_FAIL, `\"before each\" hook for ${test.title}: ${result.message}`) } } } // 2ï¼‰æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ const result = await test.fn(); if (result instanceof Error) { return this.emit(constants.EVENT_FAIL, `${test.title}`); } else { this.emit(constants.EVENT_PASS, `${test.title}`); } // 3ï¼‰ç”±å½“å‰suiteèŠ‚ç‚¹å‘suiteæ ¹èŠ‚ç‚¹ï¼Œä¾æ¬¡æ‰§è¡ŒafterEaché’©å­å‡½æ•° const _afterEach = [].concat(this.suites).reduce((list, suite) =&gt; list.concat(suite._afterEach), []); if (_afterEach.length) { for (const fn of _afterEach) { const result = await fn(); if (result instanceof Error) { return this.emit(constants.EVENT_FAIL, `\"after each\" hook for ${test.title}: ${result.message}`) } } } }}Runner.constants = constants;module.exports = Runner ä»£ç å¾ˆé•¿ï¼Œæˆ‘ä»¬ç¨å¾®æ‹ä¸€ä¸‹ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬æ„é€ ä¸€ä¸ª Runner ç±»ï¼Œåˆ©ç”¨ä¸¤ä¸ª async æ–¹æ³•æ¥å®Œæˆå¯¹ suite-test æ ‘çš„éå†ï¼š runSuite ï¼šè´Ÿè´£æ‰§è¡Œ suite èŠ‚ç‚¹ã€‚å®ƒä¸ä»…éœ€è¦è°ƒç”¨ runTest æ‰§è¡Œè¯¥ suite èŠ‚ç‚¹ä¸Šçš„è‹¥å¹² test èŠ‚ç‚¹ï¼Œè¿˜éœ€è¦è°ƒç”¨ runSuite æ‰§è¡Œä¸‹ä¸€çº§çš„è‹¥å¹² suite èŠ‚ç‚¹æ¥å®ç°éå†ï¼ŒåŒæ—¶ï¼Œbefore/after ä¹Ÿå°†åœ¨è¿™é‡Œå¾—åˆ°è°ƒç”¨ã€‚æ‰§è¡Œé¡ºåºä¾æ¬¡æ˜¯ï¼šbefore -&gt; runTest -&gt; runSuite -&gt; afterã€‚ runTest ï¼šè´Ÿè´£æ‰§è¡Œ test èŠ‚ç‚¹ï¼Œä¸»è¦æ˜¯æ‰§è¡Œè¯¥ test å¯¹è±¡ä¸Šå®šä¹‰çš„æµ‹è¯•ç”¨ä¾‹ã€‚å¦å¤–ï¼ŒbeforeEach/afterEach çš„æ‰§è¡Œæœ‰ä¸€ä¸ªç±»ä¼¼æµè§ˆå™¨äº‹ä»¶æ•è·å’Œå†’æ³¡çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦æ²¿èŠ‚ç‚¹è·¯å¾„å‘å½“å‰ suite èŠ‚ç‚¹æ–¹å‘å’Œå‘ suite æ ¹èŠ‚ç‚¹æ–¹å‘åˆ†åˆ«æ‰§è¡Œå„ suite çš„ beforeEach/afterEach é’©å­å‡½æ•°ã€‚æ‰§è¡Œé¡ºåºä¾æ¬¡æ˜¯ï¼šbeforeEach -&gt; run test case -&gt; afterEachã€‚ åœ¨éå†è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¾ç„¶æ˜¯åˆ©ç”¨ä¸€ä¸ªæ ˆåˆ—è¡¨æ¥ç»´æŠ¤ suite æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„ã€‚åŒæ—¶ï¼Œè¿™ä¸¤ä¸ªæµç¨‹éƒ½ç”¨ async/await å†™æ³•æ¥ç»„ç»‡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡åœ¨å¼‚æ­¥åœºæ™¯ä¸‹ä¾ç„¶æ˜¯æŒ‰åºæ‰§è¡Œçš„ã€‚ å…¶æ¬¡ï¼Œæµ‹è¯•ç»“è®ºæ˜¯â€œè¾¹æ‰§è¡Œè¾¹è¾“å‡ºâ€çš„ã€‚ä¸ºäº†åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­èƒ½å‘ reporter å®æ—¶é€šçŸ¥æ‰§è¡Œç»“æœå’Œæ‰§è¡ŒçŠ¶æ€ï¼Œæˆ‘ä»¬è®© Runner ç±»ç»§æ‰¿è‡ª EventEmitter ç±»ï¼Œä½¿å…¶å…·å¤‡è®¢é˜…/å‘å¸ƒäº‹ä»¶çš„èƒ½åŠ›ï¼Œè¿™ä¸ªåç»­ä¼šç»†è®²ã€‚ æœ€åï¼Œæˆ‘ä»¬åœ¨ Mocha å®ä¾‹çš„ run æ–¹æ³•ä¸­å»å®ä¾‹åŒ– Runner å¹¶è°ƒç”¨å®ƒï¼š 1234567891011// mocha/src/mocha.js// ...const Runner = require('./runner');class Mocha { // ... run() { const runner = new Runner(); runner.run(this.rootSuite); }} 3ã€è¾“å‡ºæµ‹è¯•æŠ¥å‘Šreporter è´Ÿè´£æµ‹è¯•æŠ¥å‘Šè¾“å‡ºï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯åœ¨æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹çš„è¿‡ç¨‹ä¸­åŒæ­¥è¿›è¡Œçš„ï¼Œå› æ­¤æˆ‘ä»¬åˆ©ç”¨ EventEmitter è®© reporter å’Œ runner ä¿æŒé€šä¿¡ã€‚åœ¨ runner ä¸­æˆ‘ä»¬å·²ç»åœ¨å„ä¸ªå…³é”®èŠ‚ç‚¹éƒ½ä½œäº† event emitï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åœ¨ reporter ä¸­åŠ ä¸Šç›¸åº”çš„äº‹ä»¶ç›‘å¬å³å¯ï¼š 12// mocha/reporters/index.jsmodule.exports.spec = require('./spec'); 1234567891011121314151617181920212223// mocha/reporters/spec.jsconst constants = require('../src/runner').constants;module.exports = function (runner) { // æ‰§è¡Œå¼€å§‹ runner.on(constants.EVENT_RUN_BEGIN, function() {}); // suiteæ‰§è¡Œå¼€å§‹ runner.on(constants.EVENT_SUITE_BEGIN, function(suite) {}); // suiteæ‰§è¡Œç»“æŸ runner.on(constants.EVENT_SUITE_END, function() {}); // ç”¨ä¾‹é€šè¿‡ runner.on(constants.EVENT_PASS, function(title) {}); // ç”¨ä¾‹å¤±è´¥ runner.on(constants.EVENT_FAIL, function(title) {}); // æ‰§è¡Œç»“æŸ runner.once(constants.EVENT_RUN_END, function() {});} Mocha ç±»ä¸­å¼•å…¥ reporterï¼Œæ‰§è¡Œäº‹ä»¶è®¢é˜…ï¼Œå°±èƒ½è®© runner å°†æµ‹è¯•çš„çŠ¶æ€ç»“æœå®æ—¶æ¨é€ç»™ reporter äº†ï¼š 1234567891011// mocha/src/mocha.jsconst reporters = require('../reporters');// ...class Mocha { // ... run() { const runner = new Runner(); reporters['spec'](runner); runner.run(this.rootSuite); }} reporter ä¸­å¯ä»¥ä»»æ„æ„é€ ä½ æƒ³è¦çš„æŠ¥å‘Šæ ·å¼è¾“å‡ºï¼Œä¾‹å¦‚è¿™æ ·ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364// mocha/reporters/spec.jsconst constants = require('../src/runner').constants;const colors = { pass: 90, fail: 31, green: 32,}function color(type, str) { return '\\u001b[' + colors[type] + 'm' + str + '\\u001b[0m';}module.exports = function (runner) { let indents = 0; let passes = 0; let failures = 0; function indent(i = 0) { return Array(indents + i).join(' '); } // æ‰§è¡Œå¼€å§‹ runner.on(constants.EVENT_RUN_BEGIN, function() { console.log(); }); // suiteæ‰§è¡Œå¼€å§‹ runner.on(constants.EVENT_SUITE_BEGIN, function(suite) { console.log(); ++indents; console.log(indent(), suite.title); }); // suiteæ‰§è¡Œç»“æŸ runner.on(constants.EVENT_SUITE_END, function() { --indents; if (indents == 1) console.log(); }); // ç”¨ä¾‹é€šè¿‡ runner.on(constants.EVENT_PASS, function(title) { passes++; const fmt = indent(1) + color('green', ' âœ“') + color('pass', ' %s'); console.log(fmt, title); }); // ç”¨ä¾‹å¤±è´¥ runner.on(constants.EVENT_FAIL, function(title) { failures++; const fmt = indent(1) + color('fail', ' Ã— %s'); console.log(fmt, title); }); // æ‰§è¡Œç»“æŸ runner.once(constants.EVENT_RUN_END, function() { console.log(color('green', ' %d passing'), passes); console.log(color('fail', ' %d failing'), failures); });} äº”ã€éªŒè¯åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„ simple-mocha å°±åŸºæœ¬å®Œæˆäº†ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æ¥ç®€å•éªŒè¯ä¸€ä¸‹ï¼š 12345678910111213141516171819202122232425262728// test/test.spec.jsconst assert = require('assert');describe('Array', function () { describe('#indexOf()', function () { it('should return -1 when not present', function () { assert.equal(-1, [1, 2, 3].indexOf(4)) }) it('should return the index when present', function () { assert.equal(-1, [1, 2, 3].indexOf(3)) }) }) describe('#every()', function () { it('should return true when all items are satisfied', function () { assert.equal(true, [1, 2, 3].every(item =&gt; !isNaN(item))) }) })})describe('Srting', function () { describe('#replace', function () { it('should return a string that has been replaced', function () { assert.equal('hey Hankle', 'hey Densy'.replace('Densy', 'Hankle')) }) })}) è¿™é‡Œæˆ‘ä»¬ç”¨ node å†…ç½®çš„ assert æ¨¡å—æ¥æ‰§è¡Œæ–­è¨€æµ‹è¯•ã€‚ä¸‹è¾¹æ˜¯æ‰§è¡Œç»“æœï¼š 123456789101112131415161718npm test&gt; simple-mocha@1.0.0 test /Documents/simple-mocha&gt; node mocha Array #indexOf() âœ“ should return -1 when not present Ã— should return the index when present #every() âœ“ should return true when all items are satisfied String #replace âœ“ should return a string that has been replaced 3 passing 1 failing æµ‹è¯•ç”¨ä¾‹æ‰§è¡ŒæˆåŠŸã€‚é™„ä¸Šå®Œæ•´çš„æµç¨‹å›¾ï¼š ç»“å°¾å¦‚æœä½ çœ‹åˆ°äº†è¿™é‡Œï¼Œçœ‹å®Œå¹¶çœ‹æ‡‚äº†ä¸Šè¾¹å®ç° simple-mocha çš„æ•´ä¸ªæµç¨‹ï¼Œé‚£ä¹ˆå¾ˆé«˜å…´åœ°å‘Šè¯‰ä½ ï¼Œä½ å·²ç»æŒæ¡äº† Mocha æœ€æ ¸å¿ƒçš„è¿è¡Œæœºç†ã€‚simple-mocha çš„æ•´ä¸ªå®ç°è¿‡ç¨‹å…¶å®å°±æ˜¯ Mocha å®ç°çš„ä¸€ä¸ªç®€åŒ–ã€‚è€Œä¸ºäº†è®©å¤§å®¶åœ¨çœ‹å®Œè¿™ç¯‡æ–‡ç« åå†å»é˜…è¯» Mocha æºç æ—¶èƒ½å¤Ÿæ›´å¿«é€Ÿåœ°ç†è§£ï¼Œæˆ‘åœ¨ç®€åŒ–å’Œæµ…åŒ– Mocha å®ç°æµç¨‹çš„åŒæ—¶ï¼Œä¹Ÿå°½å¯èƒ½åœ°ä¿ç•™äº†å…¶ä¸­çš„ä¸€äº›å‘½åå’Œå®ç°ç»†èŠ‚ã€‚æœ‰å·®åˆ«çš„åœ°æ–¹ï¼Œå¦‚æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ç¯èŠ‚ï¼ŒMocha æºç åˆ©ç”¨äº†ä¸€ä¸ªå¤æ‚çš„ Hook æœºåˆ¶æ¥å®ç°å¼‚æ­¥æµ‹è¯•çš„ä¾åºæ‰§è¡Œï¼Œè€Œæˆ‘ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œç”¨ async/await æ¥æ›¿ä»£å®ç°ã€‚å½“ç„¶è¿™ä¸æ˜¯è¯´ Mocha å®ç°å¾—ç¹çï¼Œåœ¨æ›´åŠ å¤æ‚çš„æµ‹è¯•åœºæ™¯ä¸‹ï¼Œè¿™å¥— Hook æœºåˆ¶æ˜¯ååˆ†å¿…è¦çš„ã€‚æ‰€ä»¥ï¼Œè¿™ç¯‡æ–‡ç« ä»…ä»…å¸Œæœ›èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ”»å…‹ Mocha æºç é˜…è¯»çš„ç¬¬ä¸€é“é™¡å¡ï¼Œè€Œè¦ç†è§£ Mocha çš„ç²¾é«“ï¼Œå…‰çœ‹è¿™ç¯‡æ–‡ç« æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œè¿˜å¾—æ·±å…¥é˜…è¯» Mocha æºç ã€‚ å‚è€ƒæ–‡ç«  Mochaå®˜æ–¹æ–‡æ¡£BDDå’ŒMochaæ¡†æ¶","link":"/2019/10/09/æ¢ç§æ–¹å¼è¯»æºç ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªç®€æ˜“ç‰ˆçš„Mocha/"},{"title":"ã€è¯‘ã€‘Webå†…å®¹å¦‚ä½•å½±å“ç”µæ± çš„ä½¿ç”¨","text":"åŸæ–‡åœ°å€ï¼šhttps://webkit.org/blog/8970/how-web-content-can-affect-power-usage/åŸæ–‡ä½œè€…ï¼šBenjamin Poulain &amp; Simon Fraserè¯‘è€…ï¼šåˆ˜è¾‰ æ ¡éªŒï¼šæåˆšæ¾ ç°åœ¨ç”¨æˆ·ä¸Šç½‘å¤§å¤šä½¿ç”¨ç§»åŠ¨è®¾å¤‡æˆ–è€…ç¬”è®°æœ¬ç”µè„‘ã€‚å¯¹è¿™ä¸¤è€…æ¥è¯´ï¼Œç”µæ± å¯¿å‘½éƒ½å¾ˆé‡è¦ã€‚åœ¨è¿™ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘ä»¬å°†è®¨è®ºå½±å“ç”µæ± å¯¿å‘½çš„å› ç´ ï¼Œä»¥åŠä½œä¸ºä¸€ä¸ªwebå¼€å‘è€…ï¼Œæˆ‘ä»¬å¦‚ä½•è®©ç½‘é¡µè€—ç”µæ›´å°‘ï¼Œä»¥ä¾¿ç”¨æˆ·æœ‰æ›´å¤šæ—¶é—´æ¥å…³æ³¨æˆ‘ä»¬çš„å†…å®¹ã€‚ æ˜¯ä»€ä¹ˆåœ¨è€—ç”µï¼Ÿç§»åŠ¨è®¾å¤‡çš„ç”µåŠ›æ¶ˆè€—æœ‰ä»¥ä¸‹å‡ ä¸ªå› ç´ ï¼š CPU ï¼ˆæ ¸å¿ƒå¤„ç†å™¨ï¼‰ GPU ï¼ˆå›¾å½¢å¤„ç†ï¼‰ ç½‘ç»œ ï¼ˆwifiæˆ–è€…èœ‚çªç§»åŠ¨ç½‘ç»œï¼‰ å±å¹• å±å¹•åŠŸè€—ç›¸å¯¹ç¨³å®šï¼Œå¹¶ä¸”ä¸»è¦ç”±ç”¨æˆ·æ§åˆ¶ï¼ˆé€šè¿‡å±å¹•ä½¿ç”¨æ—¶é—´å’Œäº®åº¦ï¼‰ï¼Œä½†æ˜¯å¯¹äºå…¶ä»–ç»„ä»¶ï¼Œä¾‹å¦‚CPUï¼ŒGPUï¼Œç½‘ç»œæ¨¡å—ï¼ŒåŠŸè€—æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œè€Œä¸”å˜åŒ–èŒƒå›´å¾ˆå¤§ã€‚ ç³»ç»Ÿæ ¹æ®å½“å‰æ­£åœ¨å¤„ç†çš„ä»»åŠ¡è°ƒæ•´CPUå’ŒGPUæ€§èƒ½ï¼ŒåŒ…æ‹¬åœ¨Webæµè§ˆå™¨ä¸­ç”¨æˆ·æ­£åœ¨äº¤äº’çš„ç½‘é¡µä»¥åŠä½¿ç”¨Webå†…å®¹çš„å…¶ä»–åº”ç”¨ç¨‹åºã€‚è¿™æ˜¯é€šè¿‡æ‰“å¼€æˆ–å…³é—­æŸäº›ç»„ä»¶ä»¥åŠé€šè¿‡æ›´æ”¹å…¶æ—¶é’Ÿé¢‘ç‡æ¥å®Œæˆçš„ã€‚æ€»çš„æ¥è¯´ï¼ŒèŠ¯ç‰‡æ‰€éœ€çš„æ€§èƒ½è¶Šé«˜ï¼Œå…¶åŠŸç‡æ•ˆç‡å°±è¶Šä½ã€‚ç¡¬ä»¶å¯ä»¥éå¸¸å¿«é€Ÿåœ°æå‡åˆ°é«˜æ€§èƒ½ï¼ˆä½†æ˜¯éœ€è¦å¾ˆå¤§çš„åŠŸç‡ï¼‰ï¼Œç„¶åè¿…é€Ÿæ¢å¤åˆ°æ›´é«˜æ•ˆçš„ä½åŠŸè€—çŠ¶æ€ã€‚ è‰¯å¥½ç”¨ç”µçš„ä¸€èˆ¬åŸåˆ™ä¸ºäº†æœ€å¤§é™åº¦åœ°å»¶é•¿ç”µæ± å¯¿å‘½ï¼Œä½ å¿…é¡»å°½é‡å‡å°‘ç¡¬ä»¶å¤„äºé«˜åŠŸç‡çŠ¶æ€çš„æ—¶é—´ï¼Œè®©ç¡¬ä»¶å°½å¯èƒ½çš„å¤„äºç©ºé—²çŠ¶æ€ã€‚ å¯¹äºwebå¼€å‘è€…æ¥è¯´ï¼Œæœ‰ä¸‰ç§äº¤äº’åœºæ™¯éœ€è¦æ³¨æ„ï¼š ç”¨æˆ·ä¸»åŠ¨ä¸å†…å®¹äº¤äº’ é¡µé¢å¤„äºå‰å°ï¼Œä½†æ˜¯ç”¨æˆ·æ²¡æœ‰äº¤äº’ é¡µé¢å¤„äºåå° é«˜æ•ˆçš„ç”¨æˆ·äº¤äº’ç”¨æˆ·äº¤äº’çš„æ—¶å€™è‚¯å®šä¼šè€—ç”µã€‚é¡µé¢éœ€è¦å¿«é€Ÿçš„åŠ è½½ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¿«é€Ÿçš„å“åº”è§¦æ‘¸ã€‚åœ¨å¤§å¤šæ•°åœºæ™¯ä¸­ï¼Œå‡å°‘é¦–æ¬¡æ¸²æŸ“æ—¶é—´ä¹Ÿä¼šé™ä½åŠŸè€—ã€‚ä¸è¿‡ï¼Œåœ¨åˆå§‹é¡µé¢åŠ è½½åç»§ç»­åŠ è½½èµ„æºå’Œè¿è¡Œè„šæœ¬æ—¶è¦å°å¿ƒã€‚æˆ‘ä»¬è¦å°½å¿«è®©ç³»ç»Ÿè¿”å›ç©ºé—²çŠ¶æ€ã€‚æ€»çš„æ¥è¯´ï¼Œæµè§ˆå™¨å·²ç»å®Œæˆäº†å¸ƒå±€å’Œæ¸²æŸ“ï¼Œjsæ‰§è¡Œçš„è¶Šå°‘ï¼Œè€—ç”µè¶Šå°‘ã€‚ ä¸€æ—¦é¡µé¢åŠ è½½å®Œï¼Œç”¨æˆ·å¯èƒ½ä¼šæ»šå±æˆ–è€…ç‚¹å‡»é¡µé¢ï¼Œè¿™åŒæ ·ä¼šäº§ç”Ÿè€—ç”µï¼ˆä¸»è¦æ˜¯CPUå’ŒGPUï¼‰,è¿™æ˜¯å¿…è¦çš„æ¶ˆè€—ã€‚è¦ç¡®ä¿å°½å¿«è¿”å›ç©ºé—²çŠ¶æ€ã€‚å¹¶ä¸”ï¼Œæœ€å¥½ä½¿ç”¨æµè§ˆå™¨æœ¬èº«æä¾›çš„åŠŸèƒ½ã€‚- ä¸¾ä¾‹ï¼šæ™®é€šçš„é¡µé¢æ»šåŠ¨è‚¯å®šæ¯”ç”¨jsè‡ªå®šä¹‰çš„æ»šåŠ¨æ›´é«˜æ•ˆã€‚ è®©ç©ºé—²çŠ¶æ€è€—ç”µè¶‹å‘äºé›¶å½“ç”¨æˆ·æ²¡æœ‰å’Œé¡µé¢äº¤äº’æ—¶ï¼Œå°½å¯èƒ½çš„ä½¿é¡µé¢ä¸è€—ç”µï¼Œä¾‹å¦‚ï¼š å°½é‡å°‘ç”¨å®šæ—¶å™¨ä»¥é¿å…å”¤é†’CPU,å¯ä»¥æŠŠåŸºäºå®šæ—¶å™¨çš„ä»»åŠ¡åˆå¹¶ï¼Œä½¿ç”¨å°½å¯èƒ½å°‘çš„å®šæ—¶å™¨ã€‚å¤§é‡æ»¥ç”¨å®šæ—¶å™¨ä¼šå¯¼è‡´CPUè¢«é¢‘ç¹å”¤é†’ï¼Œè¿™æ¯”æŠŠè¿™äº›ä»»åŠ¡åˆå¹¶å¤„ç†è¦ç³Ÿç³•çš„å¤šã€‚ æœ€å¤§é™åº¦åœ°å‡å°‘åŠ¨ç”»å†…å®¹ï¼Œå¦‚åŠ¨ç”»å›¾åƒå’Œè‡ªåŠ¨æ’­æ”¾è§†é¢‘ã€‚è¦ç‰¹åˆ«æ³¨æ„â€loadingâ€ç”¨çš„gifå›¾ç‰‡æˆ–cssåŠ¨ç”»ï¼Œè¿™äº›åŠ¨ç”»ä¼šä¸æ–­è§¦å‘æ¸²æŸ“ï¼Œå³ä½¿çœ‹ä¸åˆ°ä¹Ÿä¼šè§¦å‘ã€‚IntersectionObserverå¯ä»¥ç”¨æ¥åœ¨å¯è§æ—¶æ‰è¿è¡ŒåŠ¨ç”»ã€‚ å°½é‡ç”¨cssåšåŠ¨ç”»å’Œè¿‡æ¸¡ï¼Œè¿™äº›åŠ¨ç”»ä¸å¯è§æ—¶ï¼Œæµè§ˆå™¨ä¼šè¿›è¡Œä¼˜åŒ–ï¼Œå¹¶ä¸”cssåŠ¨ç”»æ¯”jsåŠ¨ç”»è¦é«˜æ•ˆçš„å¤šã€‚ é¿å…é€šè¿‡è½®è¯¢æ¥è·å–æœåŠ¡å™¨æ›´æ–°ï¼Œå¯ä»¥ç”¨websocketæˆ–è€…æŒä¹…è¿æ¥æ¥ä»£æ›¿è½®è¯¢ã€‚ çœ‹èµ·æ¥å¤„äºç©ºé—²çŠ¶æ€çš„é¡µé¢ï¼Œå¦‚æœæ­£åœ¨åå°è¿›è¡Œå·¥ä½œï¼Œå…¶ç”¨æˆ·äº¤äº’çš„å“åº”æ•ˆç‡ä¹Ÿä¼šé™ä½ï¼Œå› æ­¤æœ€å°åŒ–åå°æ´»åŠ¨ä¹Ÿå¯ä»¥æé«˜å“åº”èƒ½åŠ›ä»¥åŠç”µæ± å¯¿å‘½ã€‚ é¡µé¢åœ¨åå°æ—¶CPUé›¶ä½¿ç”¨è¿™å‡ ç§åœºæ™¯æ—¶ï¼Œé¡µé¢å˜ä¸ºéæ´»åŠ¨çŠ¶æ€(ä¸æ˜¯ç”¨æˆ·çš„é¦–è¦ç„¦ç‚¹)ï¼Œä¾‹å¦‚ï¼š ç”¨æˆ·åˆ‡æ¢åˆ°å…¶ä»–tab ç”¨æˆ·åˆ‡æ¢åˆ°å…¶ä»–app æµè§ˆå™¨çª—å£æœ€å°åŒ– æµè§ˆå™¨çª—å£å¤±å»ç„¦ç‚¹ æµè§ˆå™¨çª—å£åœ¨å…¶ä»–çª—å£åé¢ çª—å£æ‰€åœ¨çš„ç©ºé—´ä¸æ˜¯å½“å‰ç©ºé—´ï¼ˆMacOSæ‰æœ‰ç©ºé—´çš„æ¦‚å¿µï¼‰ å½“é¡µé¢ä¸æ´»åŠ¨æ—¶ï¼Œwebkitä¼šè‡ªåŠ¨åšä»¥ä¸‹å¤„ç†æ¥å‡å°‘è€—ç”µï¼š åœæ­¢è°ƒç”¨requestAnimationFrame CSSå’ŒSVGåŠ¨ç”»ä¼šæš‚åœ å®šæ—¶å™¨ä¼šèŠ‚æµ æ­¤å¤–ï¼ŒWebKitåˆ©ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„èƒ½åŠ›æ¥æœ€å¤§é™åº¦åœ°æé«˜æ•ˆç‡ï¼š åœ¨iOSä¸Šï¼Œä¸ç”¨çš„é€‰é¡¹å¡(tabé¡µ)ä¼šå®Œå…¨æš‚åœã€‚ åœ¨macOSä¸Šï¼Œé€‰é¡¹å¡ä¼šå“åº”App NapåŠŸèƒ½ï¼Œè¿™æ„å‘³ç€ä¸å¯è§†æ›´æ–°çš„é€‰é¡¹å¡çš„Webè¿›ç¨‹ä¼˜å…ˆçº§è¾ƒä½ï¼Œå¹¶ä¸”å…¶è®¡æ—¶å™¨ä¼šåšèŠ‚æµå¤„ç†ã€‚ ä½†æ˜¯ï¼Œé¡µé¢å¯ä»¥é€šè¿‡è®¡æ—¶å™¨ï¼ˆsetTimeoutå’ŒsetIntervalï¼‰ï¼Œæ¶ˆæ¯ï¼Œç½‘ç»œäº‹ä»¶ç­‰è§¦å‘CPUå”¤é†’ã€‚é¡µé¢åœ¨åå°æ—¶åº”é¿å…è¿™äº›å”¤é†’ï¼Œæœ‰ä¸¤ä¸ªAPIå¯¹æ­¤æœ‰ç”¨ï¼š é¡µé¢å¯è§æ€§APIæä¾›äº†ä¸€ç§å“åº”é¡µé¢è½¬æ¢ä¸ºåå°æˆ–å‰å°çš„æ–¹æ³•ã€‚è¿™æ˜¯ä¸€ç§é¿å…é¡µé¢åœ¨åå°æ—¶æ›´æ–°UIçš„å¥½æ–¹æ³•ã€‚ç”¨visibilitychangeäº‹ä»¶ï¼Œåœ¨é¡µé¢å¯è§æ—¶æ›´æ–°é¡µé¢å†…å®¹ã€‚ é¡µé¢å¤±å»ç„¦ç‚¹æ—¶ä¼šå‘å‡ºbluräº‹ä»¶ã€‚è¿™æ—¶ï¼Œé¡µé¢ä¾ç„¶å¯è§ï¼Œä½†æ˜¯ä¸æ˜¯èšç„¦çª—å£ã€‚å¯ä»¥è€ƒè™‘æš‚åœåŠ¨ç”»ã€‚ æŸ¥æ‰¾é—®é¢˜æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ç”¨æµè§ˆå™¨æ§åˆ¶å°çš„æ—¶é—´çº¿åŠŸèƒ½ã€‚é¡µé¢åœ¨åå°æ—¶ï¼Œæ—¶é—´çº¿è®°å½•ä¸­ä¸åº”è¯¥æœ‰ä»»ä½•äº‹ä»¶å‘ç”Ÿã€‚ æ‰¾åˆ°é—®é¢˜æ‰€åœ¨ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†webé¡µé¢ä¸»è¦çš„è€—ç”µå› ç´ ï¼Œå¹¶ä¸”ç»™å‡ºäº†ä¸€äº›åˆ›å»ºé«˜æ•ˆé¡µé¢çš„ä¸€èˆ¬è§„åˆ™ã€‚ æ¥ä¸‹æ¥è®¨è®ºä¸€ä¸‹æ€æ ·æ‰¾å‡ºå¹¶è§£å†³å¯¼è‡´åŠŸè€—è¿‡å¤§çš„é—®é¢˜ã€‚ è„šæœ¬å¦‚ä¸Šæ‰€è¿°ï¼Œç°ä»£CPUèƒ½å¤ŸæŠŠåŠŸç‡ä»ç©ºé—²æ€çš„éå¸¸ä½æå‡åˆ°éå¸¸é«˜æ¥æ»¡è¶³ç”¨æˆ·äº¤äº’å’Œå…¶ä»–ä»»åŠ¡çš„è¦æ±‚ã€‚ ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼ŒCPUæ˜¯å¯¼è‡´ç”µæ± å¯¿å‘½å‡å°‘çš„ä¸»è¦åŸå› ã€‚é¡µé¢åŠ è½½æœŸé—´CPUè¦åšä¸€è¿ä¸²å·¥ä½œåŒ…æ‹¬åŠ è½½ã€è§£æã€æ¸²æŸ“èµ„æºï¼Œå¹¶ä¸”æ‰§è¡Œjsã€‚åœ¨å¤§å¤šæ•°ç°ä»£webé¡µé¢ä¸Šï¼Œæ‰§è¡ŒjsèŠ±è´¹çš„æ—¶é—´è¿œè¿œé«˜å‡ºæµè§ˆå™¨ç”¨åœ¨å…¶ä½™åŠ è½½è¿‡ç¨‹ä¸­èŠ±è´¹çš„æ—¶é—´ã€‚å› ä¸ºå°½é‡å‡å°‘jsæ‰§è¡Œæ—¶é—´å¯¹çœç”µæœ‰æœ€å¤§çš„æ•ˆç›Šã€‚ æµ‹é‡CPUä½¿ç”¨çš„æœ€ä½³æ–¹æ³•æ˜¯ä½¿ç”¨Web Inspectorï¼Œå°±åƒä¹‹å‰æ–‡ç« é‡Œæ‰€è¯´çš„ï¼Œæ—¶é—´çº¿é¢æ¿å¯ä»¥æ˜¾ç¤ºä»»æ„é€‰å®šæ—¶é—´èŒƒå›´å†…çš„CPUæ´»åŠ¨ã€‚ ä¸ºäº†é«˜æ•ˆåœ°ä½¿ç”¨CPUï¼ŒWebKitå°½å¯èƒ½åœ¨å¤šæ ¸ä¸Šåˆ†é…å·¥ä½œï¼ˆä½¿ç”¨Workersçš„é¡µé¢ä¹Ÿå¯ä»¥ä½¿ç”¨å¤šæ ¸ï¼‰ã€‚Web Inspectoræä¾›ä¸é¡µé¢ä¸»çº¿ç¨‹åŒæ—¶è¿è¡Œçš„çº¿ç¨‹çš„ç»†åˆ†å›¾è¡¨ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å±å¹•æˆªå›¾æ˜¾ç¤ºäº†æ»šåŠ¨å…·æœ‰å¤æ‚æ¸²æŸ“å’Œè§†é¢‘æ’­æ”¾çš„é¡µé¢æ—¶çš„çº¿ç¨‹ï¼š åœ¨å¯»æ‰¾ä¼˜åŒ–ç‚¹æ—¶ï¼Œåº”å…³æ³¨ä¸»çº¿ç¨‹ï¼Œå› ä¸ºjsè¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸Šï¼ˆé™¤éæ‚¨æ­£åœ¨ä½¿ç”¨Workersï¼‰ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ—¶é—´çº¿é¢æ¿çš„ â€œJavaScript and Eventsâ€ é¡¹æ¥äº†è§£è§¦å‘è„šæœ¬çš„å†…å®¹ã€‚ä¹Ÿè®¸ä½ åœ¨å“åº”ç”¨æˆ·æˆ–æ»šåŠ¨äº‹ä»¶æˆ–ä»requestAnimationFrameè§¦å‘éšè—å…ƒç´ çš„æ›´æ–°æ—¶åšäº†å¤ªå¤šå·¥ä½œã€‚ä½ éœ€è¦äº†è§£ä½ åœ¨é¡µé¢ä¸Šä½¿ç”¨çš„JavaScriptåº“å’Œç¬¬ä¸‰æ–¹è„šæœ¬æ‰€åšçš„å·¥ä½œã€‚å¦‚æœè¦æ·±å…¥æŒ–æ˜ï¼Œä½ å¯ä»¥ä½¿ç”¨Web Inspectorçš„JavaScript profileræ¥æŸ¥çœ‹æ—¶é—´éƒ½ç”¨åœ¨å“ªäº›åœ°æ–¹ã€‚ â€œWebKitçº¿ç¨‹â€ä¸­çš„æ´»åŠ¨ä¸»è¦ç”±ä¸JavaScriptç›¸å…³çš„å·¥ä½œè§¦å‘ï¼šJITç¼–è¯‘å’Œåƒåœ¾æ”¶é›†ã€‚å› æ­¤å‡å°‘è¿è¡Œçš„è„šæœ¬æ•°é‡å¹¶å‡å°‘çŸ­ç”Ÿå‘½å‘¨æœŸçš„JavaScriptå¯¹è±¡å¯ä»¥é™ä½webkitçº¿ç¨‹çš„æ´»åŠ¨ã€‚ WebKitè°ƒç”¨çš„å„ç§å…¶ä»–ç³»ç»Ÿæ¡†æ¶éƒ½ä½¿ç”¨çº¿ç¨‹ï¼Œâ€œOther threadâ€ åŒ…æ‹¬äº†è¿™äº›å·¥ä½œ; â€œOther threadâ€ æœ€ä¸»è¦çš„å·¥ä½œæ˜¯æ¸²æŸ“ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢è®¨è®ºã€‚ æ¸²æŸ“ä¸»çº¿ç¨‹CPUä½¿ç”¨ä¹Ÿå¯ä»¥é€šè¿‡å¤§é‡å¸ƒå±€å’Œç»˜åˆ¶æ¥è§¦å‘ï¼›è¿™äº›é€šå¸¸ç”±è„šæœ¬è§¦å‘ï¼Œä½†æ˜¯é™¤äº†transformï¼Œopacityå’Œfilterä¹‹å¤–çš„å±æ€§çš„CSSåŠ¨ç”»ä¹Ÿå¯ä»¥è§¦å‘å®ƒä»¬ã€‚æŸ¥çœ‹æ—¶é—´çº¿é¢æ¿çš„ â€œLayout and Renderingâ€ é¡¹å°†å¸®åŠ©ä½ äº†è§£å¯¼è‡´æ´»åŠ¨çš„åŸå› ã€‚ å¦‚æœ â€œLayout and Renderingâ€ æ˜¾ç¤ºçš„æ¸²æŸ“è¿‡ç¨‹ä¸èƒ½æ¸…æ¥šå±•ç¤ºé¡µé¢æ­£åœ¨å‘ç”Ÿä»€ä¹ˆå˜åŒ–ï¼Œå¯ä»¥å¯ç”¨ Paint Flashingï¼š è¿™éƒ¨åˆ†æ¸²æŸ“å°†ç”¨çº¢è‰²èƒŒæ™¯çš„é«˜äº®æ˜¾ç¤ºï¼Œä½ å¯ä»¥æ»šåŠ¨é¡µé¢æŸ¥çœ‹ã€‚æ³¨æ„ï¼ŒWebKitä¼šä¿ç•™ä¸€äº›â€œé€è§†â€å›¾å—ä»¥å…è®¸å¹³æ»‘æ»šåŠ¨ï¼Œå› æ­¤è§†å£ä¸­ä¸å¯è§çš„å›¾å½¢ä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œä»¥ä½¿å±å¹•å¤–å›¾å—ä¿æŒæœ€æ–°ã€‚å¦‚æœæ¸²æŸ“å±•ç¤ºåœ¨æ—¶é—´è½´ä¸­ï¼Œè¯´æ˜å®ƒæ­£åœ¨å·¥ä½œã€‚ é™¤äº†å¯¼è‡´CPUè€—ç”µå¤–ï¼Œæ¸²æŸ“é€šå¸¸è¿˜ä¼šè§¦å‘GPUå·¥ä½œã€‚macOSå’ŒiOSä¸Šçš„WebKitä½¿ç”¨GPUè¿›è¡Œæ¸²æŸ“ï¼Œå› æ­¤è§¦å‘æ¸²æŸ“å¯ä»¥æ˜¾ç€å¢åŠ è€—ç”µã€‚é¢å¤–çš„CPUä½¿ç”¨é€šå¸¸æ˜¾ç¤ºåœ¨æ—¶é—´çº¿é¢æ¿ â€œCPUâ€ é¡¹ä¸­çš„ â€œOther threadsâ€ ä¸‹ã€‚ GPUè¿˜ç”¨äºcanvasæ¸²æŸ“ï¼ŒåŒ…æ‹¬2Dç”»å¸ƒå’ŒWebGL / WebGPUã€‚ä¸ºäº†æœ€å°é™åº¦ä½¿ç”¨ç»˜å›¾ï¼Œcanvasä¸Šæ˜¾ç¤ºçš„å†…å®¹æ²¡æœ‰å˜åŒ–æ—¶ä¸è¦è°ƒç”¨canvas APIï¼Œå¹¶å°è¯•ä¼˜åŒ–canvasç»˜åˆ¶ä»£ç ã€‚ è®¸å¤šMacç¬”è®°æœ¬ç”µè„‘éƒ½æœ‰ä¸¤ä¸ªGPUï¼Œä¸€ä¸ªä¸CPUç›¸åŒå†…æ ¸çš„é›†æˆGPUï¼ŒåŠŸèƒ½ä¸å¼ºä½†åŠŸè€—ä½ï¼Œä¸€ä¸ªåŠŸèƒ½æ›´å¼ºå¤§ä½†æ˜¯åŠŸè€—ä¹Ÿæ›´é«˜çš„ç‹¬ç«‹GPUã€‚ WebKité»˜è®¤ä½¿ç”¨é›†æˆGPUï¼›ä½ å¯ä»¥ä½¿ç”¨powerPreferenceä¸Šä¸‹æ–‡åˆ›å»ºå‚æ•°è¯·æ±‚ç‹¬ç«‹GPUï¼Œä½†åªæœ‰åœ¨ä½ å¯ä»¥è¯æ˜ç”µæºæˆæœ¬åˆç†æ—¶æ‰æ‰§è¡Œæ­¤æ“ä½œã€‚ ç½‘ç»œæ— çº¿ç½‘ç»œä¼šä»¥æ„æƒ³ä¸åˆ°çš„æ–¹å¼å½±å“ç”µæ± å¯¿å‘½ã€‚æ‰‹æœºæœ‰åŠŸèƒ½æ›´å¼ºå¤§çš„æ— çº¿æ¨¡å—ï¼ˆWiFiå’Œèœ‚çªç½‘ç»œèŠ¯ç‰‡ï¼‰å’Œæ›´å°çš„ç”µæ± ï¼Œå› æ­¤å—åˆ°çš„å½±å“æœ€å¤§ã€‚ é—æ†¾çš„æ˜¯ï¼Œåœ¨å®éªŒå®¤å¤–æµ‹é‡ç½‘ç»œçš„åŠŸç‡å½±å“å¹¶ä¸å®¹æ˜“ï¼Œä½†å¯ä»¥é€šè¿‡éµå¾ªä¸€äº›ç®€å•çš„è§„åˆ™æ¥å‡å°‘ã€‚ é™ä½ç½‘ç»œåŠŸè€—çš„æœ€ç›´æ¥æ–¹æ³•æ˜¯æœ€å¤§é™åº¦åœ°åˆ©ç”¨æµè§ˆå™¨çš„ç¼“å­˜ã€‚ å‡å°‘é¡µé¢åŠ è½½æ—¶é—´çš„æ‰€æœ‰æœ€ä½³å®è·µä¹Ÿå¯ä»¥é€šè¿‡å‡å°‘æ— çº¿æ¨¡å—éœ€è¦æ‰“å¼€çš„æ—¶é—´æ¥ä½¿ç”µæ± å—ç›Šã€‚ å¦ä¸€ä¸ªé‡è¦æ–¹é¢æ˜¯åœ¨æ—¶é—´ä¸Šå°†ç½‘ç»œè¯·æ±‚ç»„åˆåœ¨ä¸€èµ·ã€‚æ¯å½“æœ‰æ–°è¯·æ±‚åˆ°æ¥æ—¶ï¼Œæ“ä½œç³»ç»Ÿéƒ½éœ€è¦æ‰“å¼€æ— çº¿æ¨¡å—ï¼Œè¿æ¥åˆ°åŸºç«™æˆ–èœ‚çªå¡”ï¼Œå¹¶ä¼ è¾“å­—èŠ‚ã€‚åœ¨å‘é€åˆ†ç»„ä¹‹åï¼Œåœ¨å‘é€æ›´å¤šåˆ†ç»„çš„æƒ…å†µä¸‹ï¼Œæ— çº¿ç”µä¿æŒä¾›ç”µå°‘é‡æ—¶é—´ã€‚ å¦‚æœé¡µé¢éç»å¸¸æ€§çš„å‘é€å°‘é‡æ•°æ®ï¼Œåˆ™å¼€é”€å¯èƒ½ä¼šå¤§äºä¼ è¾“æ•°æ®æ‰€éœ€çš„èƒ½é‡ã€‚ å¯ä»¥ä» Web Inspector çš„æ—¶é—´çº¿é¢æ¿çš„ â€œNetwork Requestsâ€ é¡¹ä¸­å‘ç°æ­¤ç±»é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å±å¹•æˆªå›¾æ˜¾ç¤ºäº†å‡ ç§’é’Ÿå†…å‘é€çš„å››ä¸ªå•ç‹¬è¯·æ±‚ï¼š åŒæ—¶å‘é€æ‰€æœ‰è¯·æ±‚å°†æé«˜ç½‘ç»œç”¨ç”µæ•ˆç‡ã€‚ æ€»ç»“æˆ‘ä»¬å¯ä»¥å¯¹ç½‘é¡µåšå¾ˆå¤šä¼˜åŒ–æ¥å»¶é•¿ç”µæ± å¯¿å‘½ã€‚ åœ¨Web Inspectorä¸­æµ‹é‡å¯¹ç”µæ± å½±å“å¹¶é™ä½æŸè€—éå¸¸é‡è¦ã€‚ è¿™æ ·åšå¯ä»¥æ”¹å–„ç”¨æˆ·ä½“éªŒå¹¶å»¶é•¿ç”µæ± å¯¿å‘½ã€‚ æé«˜ç”µæ± å¯¿å‘½çš„æœ€ç›´æ¥æ–¹æ³•æ˜¯æœ€å¤§é™åº¦åœ°é™ä½CPUä½¿ç”¨ç‡ã€‚ æ–°çš„Web Inspectoræä¾›äº†å¼ºå¤§çš„å·¥å…·å¯ä»¥å…¨ç¨‹ç›‘æ§ã€‚ ä¸ºäº†è®©ç”µæ± å¯¿å‘½æ›´é•¿ï¼Œæˆ‘ä»¬è¦ï¼š åœ¨ç©ºé—²æ—¶å°†CPUä½¿ç”¨ç‡é™è‡³é›¶ åœ¨ç”¨æˆ·äº¤äº’æœŸé—´æœ€å¤§åŒ–æ€§èƒ½ä»¥å¿«é€Ÿæ¢å¤ç©ºé—²","link":"/2019/09/17/ã€è¯‘ã€‘Webå†…å®¹å¦‚ä½•å½±å“ç”µæ± çš„ä½¿ç”¨/"},{"title":"ä½ è¿˜åœ¨ç”¨å›¾ç‰‡åšå¼•å¯¼è’™å±‚ï¼Ÿ","text":"ä½œè€…ï¼šæ·±å±±èš‚èš å¼•å¯¼è’™å±‚é€šå¸¸åœ¨æ–°ä¸šåŠ¡ä¸Šçº¿ã€æˆ–è€…ä¸šåŠ¡æœ‰å˜æ›´æ—¶çš„ç»™æ–°ç”¨æˆ·çš„ä¸€ä¸ªæ“ä½œæŒ‡å¼•ã€‚ä¸‹å›¾é¡µé¢å³æ˜¯ä¸€ä¸ªè’™å±‚ï¼Œä¼šåœ¨æŸä¸ªå±€éƒ¨ä½ç½®é«˜äº®æˆ‘ä»¬éœ€è¦é‡ç‚¹çªå‡ºçš„å†…å®¹ï¼š å½“å‰å‘ç°å¾ˆå¤šé¡µé¢åšè’™å±‚å¼•å¯¼ï¼Œè¿˜æ˜¯ä½¿ç”¨å›¾ç‰‡å½¢å¼æ¥åšã€‚ å›¾ç‰‡å¼•å¯¼è’™å±‚æœ‰å‡ å¤§ç¼ºç‚¹ï¼š å›¾ç‰‡å¤§ï¼Œå½±å“åŠ è½½ å›¾ç‰‡çš„å†…å®¹éƒ½æ˜¯å‡çš„ï¼Œå’ŒçœŸå®çš„åº•éƒ¨å†…å®¹æ²¡å¯¹ä¸Š å…¨å±è’™å±‚å›¾ç‰‡ï¼Œå›¾ç‰‡çš„å®½é«˜å’Œå±å¹•å®½é«˜ä¸ä¸€è‡´ï¼Œæ˜¾ç¤ºä¸¤è¾¹ç•™é»‘ï¼Œæˆ–è€…æœ‰å‹ç¼©çš„æ•ˆæœã€‚ å›¾ç‰‡çš„å¼•å¯¼ä½ç½®ä¸èƒ½ç‚¹å‡»ã€‚ low ï¼Ÿ not cool ï¼Ÿ æœ¬æ–‡è®²è¿°å…­ç§æ€è·¯æ¥å®ç°å¼•å¯¼è’™å±‚ z-indexå®ç°è’™å±‚ åŠ¨æ€opacityå®ç° borderå®ç° box-shadowå®ç° èŠ‚ç‚¹å¤åˆ¶å®ç° canvaså®ç° ä»¥ä¸Šå…­ç§å¼•å¯¼è’™å±‚å®ç°æ€è·¯ï¼Œåœ¨ä¸€å®šæƒ…å†µä¸‹éƒ½èƒ½æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ï¼Œä»ä¸åŒè§’åº¦æ¥å®ç°äº†å¼•å¯¼è’™å±‚ã€‚z-indexæœ€ç®€å•ï¼Œcanvasæœ€çµæ´»ï¼Œå°±ä¸ªäººè€Œè¨€ï¼Œæ›´åŠ å–œæ¬¢éª¨æ¶å±å¼çš„åŠ¨æ€opacityè’™å±‚å®ç°ï¼Œæ›´æœ‰è¶£æ›´é…·!!! æ€è·¯ä¸€ï¼šä½¿ç”¨z-index æ–°å¢ä¸€ä¸ªdivï¼Œè®¾ç½®ä¸ºåŠé€æ˜åŒºåŸŸï¼Œå¤§å°è¦†ç›–æ•´ä¸ªé¡µé¢ åŠé€æ˜è’™å±‚åŒºåŸŸz-indexå¤§äºé¡µé¢å…ƒç´  å¼•å¯¼å†…å®¹åŒºåŸŸå¤§äºåŠé€æ˜è’™å±‚åŒºåŸŸz-index è¿™ä¸ªå¥½ç†è§£ï¼Œé¡µé¢å…ƒç´ éƒ½æ˜¯æœ‰å±‚çº§çš„ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠå¼•å¯¼å†…å®¹åŒºåŸŸè®¾ç½®ä¸ºæœ€é¡¶å±‚çš„å±‚çº§ï¼Œåœ¨å¼•å¯¼å†…å®¹åŒºåŸŸä¹‹ä¸‹è®¾ç½®ä¸€ä¸ªé®ç½©å±‚ï¼Œå…¶ä»–å†…å®¹å…ƒç´ çš„z-indexéƒ½åœ°åŸŸè¿™ä¸ªé®ç½©å±‚å³å¯ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•ä¾‹å­ã€‚ 123456789101112131415161718192021222324252627.z1{ position:absolute; left:50px; top:50px; width:50px; height:50px; background:blue; z-index:1;}.z2{ position:absolute; left:60px; top:60px; width:50px; height:50px; background:red; z-index:2;}.z3{ position:absolute; left:70px; top:70px; width:50px; height:50px; background:yellow; z-index:3;} æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹z2çš„æ ·å¼ã€‚ 12345678910111213141516171819202122232425.z2{ position:absolute; left:50px; top:50px; width:50px; height:50px; background:black; opacity:0.5; z-index:2; animation:z_index 2s linear infinite alternate;}@keyframes z_index { from { left:50px; top:50px; width:50px; height:50px; } to { left:0px; top:0px; width:200px; height:200px; } } åªè¦åœ¨å¸ƒå±€é¡µé¢å…ƒç´ çš„æ—¶å€™ï¼ŒæŠŠéœ€è¦åšè’™å±‚çš„å…ƒç´ ç¡®å®šå¥½ï¼Œé…åˆjsï¼ŒåŠ¨æ€çš„è®¾ç½®å…ƒç´ çš„z-index + opacityï¼Œå°±å¯ä»¥å¾ˆå¥½çš„åšåˆ°é¡µé¢çš„å¼•å¯¼è’™å±‚æ•ˆæœã€‚ æ€è·¯äºŒï¼šä½¿ç”¨opacityå°†éè’™å±‚å…ƒç´ åŠé€æ˜ å¼•å¯¼å†…å®¹åŒºåŸŸæ— éœ€æ”¹åŠ¨ é¡µé¢å…¶ä»–èŠ‚ç‚¹å…ƒç´ åŠé€æ˜ æˆ‘ä»¬ä¸å†æ–°å¢è’™å±‚ï¼Œè€Œæ˜¯å®Œå…¨æ“ä½œé¡µé¢èŠ‚ç‚¹ï¼Œå°†éœ€è¦é®ç½©çš„èŠ‚ç‚¹éƒ½è®¾ç½®ä¸ºåŠé€æ˜ï¼Œå¼•å¯¼è’™å±‚æ˜¾ç°å†…å®¹åˆ™å®Œå…¨æ˜¾ç¤ºå‡ºæ¥ã€‚é¡µé¢çš„æ•ˆæœå’Œè’™å±‚ä¸å¤ªä¸€æ ·ï¼Œå¯¹äºç©ºç™½åœ°æ–¹ï¼Œæˆ‘ä»¬ä»ç„¶æ˜¯å®Œå…¨æ˜¾ç¤ºï¼Œåªæ˜¯å°†æœ‰å†…å®¹çš„å…ƒç´ ç»™åŠé€æ˜ï¼Œç±»ä¼¼éª¨æ¶å±çš„æ•ˆæœã€‚ä¸ºäº†æ¼”ç¤ºæ•ˆæœï¼Œæˆ‘ä»¬çœ‹å¦‚ä¸‹ä¾‹å­ï¼šé¡µé¢è®¾ç½®6ä¸ªå…ƒç´ ã€‚ 12345678&lt;div class=\"wrap\"&gt; &lt;div class=\"z z1\"&gt;&lt;/div&gt; &lt;div class=\"z z2\"&gt;&lt;/div&gt; &lt;div class=\"z z3\"&gt;&lt;/div&gt; &lt;div class=\"z z4\"&gt;&lt;/div&gt; &lt;div class=\"z z5\"&gt;&lt;/div&gt; &lt;div class=\"z z6\"&gt;&lt;/div&gt; &lt;/div&gt; å°†å…ƒç´ å†…å®¹ç”¨flexå¹¶æ’å¸ƒå±€ã€‚ 12345678910111213141516171819202122232425262728.wrap{ display:flex; flex-wrap:wrap; width:150px;}.z{ width:50px; height:50px; transition:all 1s;}.z1{ background:blue;}.z2{ background:black;}.z3{ background:yellow;}.z4{ background:red;}.z5{ background:green;}.z6{ background:orange;} ä½¿ç”¨jsæ“ä½œï¼Œä¾æ¬¡åŠé€æ˜å…¶ä»–å…ƒç´ ï¼Œæ˜¾ç¤ºå½“å‰å…ƒç´ æ¥æ¨¡æ‹Ÿè’™å±‚ã€‚ 1234567891011121314151617let arry = Array.from(document.querySelectorAll(\".z\"));let index = -1;let direct = 1;setInterval(()=&gt;{ if(index&gt;=5) direct = -1; else if(index&lt;=0) direct = 1; index = index+direct; arry.forEach((d,i)=&gt;{ d.style.opacity = 1; }); setTimeout(()=&gt;{ arry.forEach((d,i)=&gt;{ if(i==index) return; d.style.opacity = 0.1; }); },1000);},2000) çœ‹äº†è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æ¸…æ™°çš„çœ‹åˆ°è¿™ä¸ªå¼•å¯¼è’™å±‚çš„å®ç°è¿‡ç¨‹ã€‚è¿™ç§å¼•å¯¼è’™å±‚å…¶å®æ›´å¥½ç©æœ‰è¶£ï¼Œæœ‰ç‚¹ç±»ä¼¼å½“å‰æµè¡Œçš„éª¨æ¶å±ï¼Œå…¶ä»–å·²æœ‰å…ƒç´ éœ€è¦é®ç½©çš„å†…å®¹å°±æ˜¯éª¨æ¶å±çš„ç°è‰²éƒ¨åˆ†ï¼Œéœ€è¦æ˜¾ç°çš„å°±æ˜¯é‡ç‚¹çš„è’™å±‚å†…å®¹ã€‚æœ‰è¶£ï¼ï¼ï¼ æ€è·¯ä¸‰ï¼šä½¿ç”¨borderçš„æ–¹å¼æ¥å®ç°æ²¡é”™ï¼Œå°±æ˜¯æ™®éä¸èƒ½åœ¨æ™®éçš„borderäº†ï¼Œä¸”çœ‹å¦‚ä¸‹ï¼š 123div { border:1px solid #red;} é‚£ç”¨borderæ€ä¹ˆå®ç°å¼•å¯¼è’™å±‚å‘¢ï¼Ÿ 1ã€å…ˆäº†è§£ä¸‹ä¸‰è§’å½¢å…ˆçœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š 1&lt;div class=\"border_1\"&gt;&lt;/div&gt; 123456789.border_1{ width: 100px; height: 100px; border-top:50px solid red; border-right: 50px solid transparent; border-bottom: 50px solid transparent; border-left: 50px solid transparent; box-sizing:border-box;} å®ç°äº†ä¸€ä¸ªå€’ä¸‰è§’,è¿™ä¸ªåº”ç”¨åœºæ™¯æ˜¯ä¸æ˜¯å°±æ¯”è¾ƒå¤šäº†ï¼Œå¾ˆå¤štipsçš„æŒ‡å¼•ï¼Œæ ‡æ³¨ç­‰éƒ½ä¼šç”¨åˆ°ã€‚æˆ‘å°±çœ‹åˆ°è¿‡è¿™ç§å€’ä¸‰è§’ä½¿ç”¨ä¸€å¼ å›¾ç‰‡ä»£æ›¿çš„åšæ³•ã€‚ä»”ç»†çœ‹è¿™æ®µä»£ç ï¼Œä¸»è¦æœ‰å®ç°äº†ä¸‰ç‚¹ï¼š å››è¾¹éƒ½è®¾ç½®äº†è¾¹æ¡† å®½é«˜éƒ½ä¸º100px,å³ä¸Šä¸‹ã€å·¦å³è¡¨æ¡†ä¹‹å’Œï¼Œå…¶å®å°äºç­‰äºè¿™ä¸ªå€¼éƒ½è¡Œã€‚ åªæœ‰é¡¶éƒ¨è¾¹æ¡†æ˜¯çº¢è‰²ï¼Œå…¶ä»–è¾¹æ¡†æ˜¯é€æ˜çš„ã€‚ ä¸ºäº†ç†è§£ä¸Šé¢çš„å®ç°ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å¦‚ä¸‹ä»£ç ï¼š 123456789101112131415161718.border_2{ width: 100px; height: 100px; background-color:green; border-style:solid; border-color:red yellow blue black; border-width:50px; animation:border_ani 2s linear infinite alternate; box-sizing:border-box;}@keyframes border_ani { from { border-width:50px; } to { border-width:0; } } ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°ï¼Œéšç€border-widthçš„å˜åŒ–ï¼Œæ•´ä¸ªdivçš„ç»¿è‰²èƒŒæ™¯åœ¨è·Ÿéšå˜åŒ–ã€‚ å½“border-width=0çš„æ—¶å€™ï¼Œæ•´ä¸ªé¡µé¢åªæœ‰ç»¿è‰²èƒŒæ™¯ï¼Œå³éƒ½æ˜¯å†…å®¹çš„å¤§å° å½“border-width=50çš„æ—¶å€™ï¼Œæ•´ä¸ªdivçš„å¤§å°éƒ½è¢«borderç»™å……æ»¡äº†ï¼Œä¸Šä¸‹å·¦å³å‡åˆ†1/4ï¼Œå°±æ˜¯å››ä¸ªå€’ä¸‰è§’ã€‚ è¿™æ ·æˆ‘ä»¬å°±æ¸…æ™°çš„èƒ½å¾—åˆ°: å½“border-right,border-left,border-bottoméƒ½transparenté€æ˜ï¼Œborder-topæ˜¯çº¢è‰²çš„æ—¶å€™ï¼Œæ‰€çœ‹åˆ°çš„å°±æ˜¯ä¸€ä¸ªå€’ä¸‰è§’ã€‚ åŒç†æˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½®è¾¹æ¡†çš„å¤§å°ä¸ä¸€è‡´ï¼Œå¯ä»¥å®ç°æ–œä¸‰è§’ï¼š 123456789.border_3{ width: 0; height: 0; border-top:30px solid red; border-right: 10px solid transparent; border-bottom: 20px solid transparent; border-left: 100px solid transparent; box-sizing:border-box;} è¿˜å¯ä»¥å®ç°å·¥ä½œä¸­ç»å¸¸ç¢°åˆ°çš„æ¢¯å½¢ï¼š 123456789.border_4{ width: 150px; height: 150px; border-top:50px solid red; border-right: 50px solid transparent; border-bottom: 50px solid transparent; border-left: 50px solid transparent; box-sizing:border-box;} å¥½äº†ï¼Œè¿™é‡Œä¸ç´¯èµ˜äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å„ç§å°è¯•ã€‚é‡åˆ°è¿™ç§ç®€å•è¾¹çº¿å›¾ï¼Œå°±ä¸è¦åŠ¨ä¸åŠ¨ä½¿ç”¨å›¾ç‰‡äº†ã€‚ 2ã€å†çœ‹å®ç°å¼•å¯¼è’™å±‚ æ–°å¢ä¸€ä¸ªdivï¼Œä½œä¸ºè’™å±‚å…ƒç´  divä¸­é—´å¤§å°å’Œå¼•å¯¼å†…å®¹å…ƒç´ å¤§å°å®Œå…¨ä¸€è‡´ï¼Œä¸”ä½ç½®æ°å¥½é‡å  divçš„borderè®¾ç½®ä¸ºåŠé€æ˜ä¸”æ— é™æ”¾å¤§ äº†è§£äº†ä¸Šé¢çš„ä¸‰è§’å½¢çš„å®ç°ä¹‹åï¼Œä¼°è®¡ä½ ä¹Ÿèƒ½æƒ³å‡ºæ€ä¹ˆåšå¼•å¯¼è’™å±‚äº†ã€‚ä¸€ä¸ªdivæœ‰å››ä¸ªè¾¹æ¡†ï¼Œå¦‚æœæˆ‘ä»¬æŠŠè¾¹æ¡†éƒ½è®¾ç½®æˆåŠé€æ˜ï¼Œç„¶åä¸­é—´çš„åŒºåŸŸï¼ˆä¸Šé¢border_2çš„greenï¼‰è®¾ç½®æˆå…¨é€æ˜ä¼šä¸å°±å¯ä»¥å®ç°åŒºåŸŸå¼•å¯¼è’™å±‚äº†å—ï¼Ÿç„¶åå†æŠŠè¾¹æ¡†è®¾ç½®æˆè¶…è¿‡å±å¹•çš„å¤§å°å‘¢ï¼Œå°±æ˜¯å…¨æ™¯å¼•å¯¼è’™å±‚äº†ï¼ 123456789.border_5{ width: 150px; height: 150px; border-top:50px solid rgba(0,0,0,.5); border-right: 50px solid rgba(0,0,0,.5); border-bottom: 50px solid rgba(0,0,0,.5); border-left: 50px solid rgba(0,0,0,.5); box-sizing:border-box;} è¿™æ˜¯ä¸€ä¸ª150pxçš„åŒºåŸŸè’™å±‚ï¼Œæˆ‘ä»¬çœ‹ä¸‹å¦‚ä¸‹ç¤ºä¾‹å°±èƒ½å¾ˆæ˜ç™½äº†ï¼š 1234567891011121314151617.border_6{ width: 20px; height: 20px; border-style:solid; border-color:rgba(0,0,0,.5); border-width:20px; animation:border_ani 2s linear infinite alternate; box-sizing:content-box;}@keyframes border_ani { from { border-width:20px; } to { border-width:100px; } } å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½®border-radiusæ¥å®ç°åœ†å½¢çš„è’™å±‚åŒºåŸŸï¼Œå¦‚ä¸‹ï¼š å½“ç„¶ï¼Œè¿™é‡Œçš„è¾¹æ¡†å¤§å°å€¼éƒ½æ˜¯å†™æ­»çš„ï¼Œå…·ä½“å®ç°éœ€è¦æ ¹æ®é¡µé¢å†…å®¹ä¿®æ”¹æˆ–è€…åŠ¨æ€ä¿®æ”¹å³å¯ã€‚ å¦‚æœæ˜¯æ¤­åœ†å‘¢ï¼Ÿ æ€»ç»“ï¼š borderå¯ä»¥å®ç°å„ç§è¾¹çº¿çš„å½¢çŠ¶ï¼Œå¯ä»¥å®ç°å¼•å¯¼è’™å±‚ï¼Œé¡µé¢æŒ‡å®šåŒºåŸŸé€æ˜ï¼Œä¹‹å¤–çš„éƒ½åŠé€æ˜æ¥å®ç°å³å¯ã€‚ æ€è·¯å››ã€ä½¿ç”¨box-shadowæ¥å®ç° æ–°å¢ä¸€ä¸ªdivï¼Œä½œä¸ºè’™å±‚å…ƒç´  divå¤§å°å’Œå†…å®¹å…ƒç´ å¤§å°å®Œå…¨ä¸€è‡´ï¼Œä¸”ä½ç½®æ°å¥½é‡å  divçš„box-shadowçš„é˜´å½±å°ºå¯¸è®¾ç½®ä¸ºåŠé€æ˜ä¸”è®¾ç½®ä¸ºæ¯”è¾ƒå¤§çš„çº¦2000pxå¤§å° box-shadowï¼Œå¤§ä¼™éƒ½ä¸é™Œç”Ÿï¼Œå°±æ˜¯ç›’å­çš„é˜´å½±ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹å®ƒçš„åŸºæœ¬ç”¨æ³•ï¼š 123456.boxshadow_1{ width:50px; height:50px; background:blue; box-shadow: 10px 10px 5px 4px #000;} åœ¨å®½é«˜ä¸º50pxçš„div,å®ƒçš„é˜´å½±æ°´å¹³å’Œå‚ç›´éƒ½æ˜¯10pxï¼Œé˜´å½±æ¨¡ç³Šè·ç¦»æ˜¯5px,é˜´å½±çš„å°ºå¯¸æ˜¯4px,é˜´å½±æ˜¯#000çš„é¢œè‰²(è¿™é‡Œç»™bodyå¢åŠ äº†ä¸€ä¸ªyellowçš„èƒŒæ™¯è‰²ä»¥ä¾¿äºåŒºåˆ†)ã€‚ é¦–å…ˆæˆ‘ä»¬æŠŠé˜´å½±é€æ˜ï¼š 123456.boxshadow_2{ width:50px; height:50px; background:blue; box-shadow: 10px 10px 5px 4px rgba(0,0,0,.5);} é‚£æ€ä¹ˆè®©é˜´å½±é®ç›–æ•´ä¸ªé¡µé¢å‘¢ï¼Ÿ é˜´å½±çš„æ°´å¹³å’Œå‚ç›´è·ç¦»æ˜¯æŒ‡è·ç¦»åŸdevçš„è·ç¦»ï¼Œè¿™ä¸ªè°ƒæ•´è¾¾ä¸åˆ°æ•ˆæœï¼Œåªä¼šè®©é˜´å½±æ›´å¤šçš„åç¦»å…ƒç´ ã€‚ é˜´å½±çš„æ¨¡ç³Šè·ç¦»æŒ‡é˜´å½±çš„è¾¹ç¼˜æ¸å˜æ¨¡ç³Šçš„è·ç¦»ï¼Œè·ç¦»è¶Šé•¿ï¼Œåªä¼šè®©æ¸å˜æ¨¡ç³ŠåŠ é•¿ï¼Œè’™å±‚å¤§å°ä¸ä¼šå˜ã€‚ é˜´å½±çš„å°ºå¯¸ï¼Œè¿™ä¸ªæ˜¯æŒ‡å¤šå¤§çš„é˜´å½±ï¼Œé‚£æˆ‘ä»¬å°†é˜´å½±å°ºå¯¸è®¾ç½®å¾ˆå¤§å‘¢ï¼Ÿæ˜¯çš„ï¼Œå°±æ˜¯è¿™ä¸ªäº† çœ‹å¦‚ä¸‹çš„ä¾‹å­ï¼Œæˆ‘ä»¬è°ƒæ•´é˜´å½±çš„å°ºå¯¸ï¼š 123456789101112131415.boxshadow_3 { width:50px; height:50px; background:blue; box-shadow: 0px 0px 5px 0px rgba(0,0,0,.5); animation:box_ani 2s linear infinite alternate;}@keyframes box_ani { from { box-shadow: 10px 10px 5px 0px rgba(0,0,0,.5); } to { box-shadow: 10px 10px 5px 100px rgba(0,0,0,.5); } } å¦‚ä¸Šï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠé˜´å½±å°ºå¯¸åŠ å¤§å°±å¯ä»¥å®ç°å¼•å¯¼è’™å±‚äº†ã€‚å¦‚æœéœ€è¦å¼•å¯¼è’™å±‚çŠ¶æ€ä¸‹è¿˜èƒ½å“åº”äº‹ä»¶å‘¢ï¼Ÿåªéœ€è¦åŠ ä¸€ä¸ªpointer-eventså±æ€§å³å¯ã€‚ box-shadowçš„é˜´å½±è·ç¦»åˆ‡å‹¿ç›²ç›®è®¾ç½®è¿‡å¤§ï¼Œç»è¿‡æµ‹è¯•è¿™ä¸ªå€¼å¦‚æœè¿‡å¤§ï¼Œæ¯”å¦‚4000pxï¼Œåœ¨éƒ¨åˆ†æ‰‹æœºä¸Šé˜´å½±æ— æ³•æ˜¾ç¤ºå‡ºæ¥ã€‚ç»è¿‡å®è·µï¼Œè®¾ç½®ä¸º2000pxä¸ºä½³ã€‚ æ€è·¯äº”ï¼šä½¿ç”¨é¡µé¢èŠ‚ç‚¹å¤åˆ¶ æ–°å¢ä¸¤ä¸ªdivï¼Œä¸€ä¸ªåŠé€æ˜è’™å±‚å…ƒç´ å’Œä¸€ä¸ªè’™å±‚å†…å®¹åŒºåŸŸ å°†é¡µé¢èŠ‚ç‚¹å¼•å¯¼å†…å®¹æ‹·è´åˆ°è’™å±‚å†…å®¹åŒºåŸŸ å°†è’™å±‚å†…å®¹åŒºåŸŸçš„å¤§å°å’Œä½ç½®ä¸åŸèŠ‚ç‚¹å¼•å¯¼å†…å®¹å®Œå…¨é‡åˆ é¡µé¢å†…å®¹å·²ç»åšå¥½äº†ï¼Œæˆ‘ä»¬éœ€è¦å¼•å¯¼è’™å±‚æ¥æ˜¾ç¤ºæŸä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆå°†å…ƒç´ å¤åˆ¶åˆ°æœ€å¤–å±‚ï¼Œé¡¶å±‚å¢åŠ ä¸€å±‚è’™å±‚æ¥å®ç°,éœ€è¦çªå‡ºçš„å¼•å¯¼å†…å®¹åœ¨è’™å±‚ä¹‹ä¸Šå³å¯å®ç°ã€‚ 123456&lt;div class=\"content one\"&gt;æˆ‘æ˜¯ç¬¬ä¸€ä¸ªdivï¼Œæˆ‘æ˜¯ç¬¬ä¸€ä¸ªdiv&lt;/div&gt;&lt;div class=\"content two\"&gt;æˆ‘æ˜¯ç¬¬äºŒä¸ªdivï¼Œæˆ‘æ˜¯ç¬¬äºŒä¸ªdiv&lt;/div&gt;&lt;div class=\"content three\"&gt;æˆ‘æ˜¯ç¬¬ä¸‰ä¸ªdivï¼Œæˆ‘æ˜¯ç¬¬ä¸‰ä¸ªdiv&lt;/div&gt;&lt;div class=\"content four\"&gt;æˆ‘æ˜¯ç¬¬å››ä¸ªdivï¼Œæˆ‘æ˜¯ç¬¬å››ä¸ªdiv&lt;/div&gt;&lt;div class=\"mask\"&gt;&lt;/div&gt;&lt;div id=\"maskContent\"&gt;&lt;/div&gt; è¿™é‡Œè®¾ç½®äº†ä¸€ä¸ªå›ºå®šè’™å±‚ï¼Œå’Œä¸€ä¸ªå›ºå®šçš„è’™å±‚å†…å®¹å…ƒç´ ï¼Œæˆ‘ä»¬åªéœ€è¦å¡«å……å³å¯ã€‚ 12345678910111213141516171819.content{ padding:10px; z-index:0;}.mask{ position:fixed; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,.8); z-index:900 } #maskContent{ position:fixed; z-index:999; display:inline-block; background-color: #fff; } è¿™é‡Œå†…å®¹åŒºåŸŸéƒ½æ˜¯0ï¼Œç„¶åmaskæ˜¯900ï¼Œæˆ‘ä»¬çš„è’™å±‚å…ƒç´ æ˜¯999ï¼Œå°±æ˜¯æœ€ä¸Šå±‚äº†ã€‚ 123456789101112131415function renderContent(cls){ let targetNode = document.querySelector(`.${cls}`); let maskContent = document.getElementById(\"maskContent\"); maskContent.innerHTML = targetNode.outerHTML; let pos = targetNode.getBoundingClientRect(); maskContent.style.top=pos.top+\"px\"; maskContent.style.left=pos.left+\"px\"; maskContent.style.width=pos.width+\"px\"; maskContent.style.height=pos.height+\"px\"; }let i = 0;setInterval(()=&gt;{ renderContent(['one','two','three','four'][i]); if(++i&gt;=4) i = 0;},1000) è¿™é‡Œä¸ºäº†æ¼”ç¤ºæ•ˆæœï¼Œå¢åŠ äº†ä¸€ä¸ªå®šæ—¶å™¨æ”¹å˜ä¸åŒçš„é®ç½©å±‚ã€‚æ˜“äºç†è§£ï¼Œçœ‹ä¸‹æ•ˆæœï¼š æ€è·¯å…­ï¼šä½¿ç”¨canvaså®ç° æ–°å¢ä¸€ä¸ªcanvasï¼Œç»˜åˆ¶ä¸¤æ¬¡å›¾å½¢ ç¬¬ä¸€æ¬¡ï¼šç»˜åˆ¶ä¸€ä¸ªå…¨å±çš„åŠé€æ˜é˜´å½± ç¬¬äºŒæ¬¡ï¼šä½¿ç”¨xorç»˜åˆ¶ä¸€ä¸ªå’Œå¼•å¯¼å†…å®¹åŒºåŸŸçš„å¤§å°ä½ç½®å®Œå…¨é‡åˆçš„åŒºåŸŸ ç¬¬äºŒæ¬¡ç»˜åˆ¶çš„å†…å®¹åŒºåŸŸå’Œç¬¬ä¸€æ¬¡é‡å ï¼Œä½¿ç”¨xorï¼Œæ‰€ä»¥ä¼šé€æ˜ï¼Œè¯¥å¼•å¯¼å†…å®¹åŒºåŸŸå°±ä¼šå®Œå…¨æ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœäº†ã€‚ ä½¿ç”¨canvasçš„globalCompositeOperationå±æ€§æ¥å®ç°,å†…å®¹å‚è€ƒhttp://www.tutorialspoint.com/html5/canvas_composition.htm é‡ç‚¹çœ‹xorï¼šShapes are made transparent where both overlap and drawn normal everywhere else.ç¿»è¯‘ï¼š canvasç»˜åˆ¶çš„å½¢çŠ¶åœ¨é‡å å¤„éƒ½ä¼šå˜æˆé€æ˜çš„ï¼Œéé‡å å¤„çš„å…¶ä»–ä»»ä½•åœ°æ–¹éƒ½æ­£å¸¸ç»˜åˆ¶å†…å®¹ã€‚ æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥åœ¨canvasé‡Œé¢ç»˜åˆ¶ä¸€ä¸ªcanvasè’™å±‚ï¼Œç„¶ååœ¨è’™å±‚ä¸­éœ€è¦æ˜¾ç¤ºçš„å†…å®¹ç”¨xoræ¥ç»˜åˆ¶é‡å ï¼Œç„¶åé‡å å†…å®¹å°±ä¼šè¢«é€æ˜ï¼Œé‚£ä¹ˆè¿™ä¸ªé€æ˜åŒºåŸŸçš„å†…å®¹å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„å¼•å¯¼è’™å±‚çªå‡ºå†…å®¹åŒºåŸŸã€‚å…·ä½“çœ‹å®ä¾‹ï¼š 12345 &lt;div class=\"content one\"&gt;æˆ‘æ˜¯ç¬¬ä¸€ä¸ªdivï¼Œæˆ‘æ˜¯ç¬¬ä¸€ä¸ªdiv&lt;/div&gt;&lt;div class=\"content two\"&gt;æˆ‘æ˜¯ç¬¬äºŒä¸ªdivï¼Œæˆ‘æ˜¯ç¬¬äºŒä¸ªdiv&lt;/div&gt;&lt;div class=\"content three\"&gt;æˆ‘æ˜¯ç¬¬ä¸‰ä¸ªdivï¼Œæˆ‘æ˜¯ç¬¬ä¸‰ä¸ªdiv&lt;/div&gt;&lt;div class=\"conteent four\"&gt;æˆ‘æ˜¯ç¬¬å››ä¸ªdivï¼Œæˆ‘æ˜¯ç¬¬å››ä¸ªdiv&lt;/div&gt;&lt;canvas id=\"mask\"&gt;&lt;/canvas&gt; é¡µé¢å¢åŠ ä¸€ä¸ªcanvasèŠ‚ç‚¹ã€‚å°†canvasæ•´ä½“è®¾ç½®æˆåŠé€æ˜ï¼Œç„¶åå†ç”¨xoræ¥å®ç°å†…å®¹çš„ç»˜åˆ¶ã€‚ 12345678910111213141516171819202122232425 function mask(cls){ let targetNode = document.querySelector(`.${cls}`); let pos = targetNode.getBoundingClientRect(); let canvas = document.getElementById(\"mask\"); let width = window.innerWidth; let height = window.innerHeight;; canvas.setAttribute(\"width\", width); canvas.setAttribute(\"height\",height); var ctx = canvas.getContext(\"2d\"); ctx.globalCompositeOperation = 'source-over'; ctx.fillStyle ='rgba(255, 255, 255, 0.9)'; ctx.fillRect(0, 0, width, height); ctx.fill(); ctx.fillStyle ='white'; ctx.globalCompositeOperation=\"xor\"; ctx.fillRect(pos.left,pos.top,pos.width,pos.height); ctx.fill(); }let array = ['one','two','three','four'];let i = 0;setInterval(()=&gt;{ mask(array[i]); i++; if(i&gt;=4) i = 0;},1000) çœ‹å®Œä»¥ä¸Šå®ç°ï¼Œä½ æœ€å–œæ¬¢å“ªç§å®ç°æ–¹å¼å‘¢ï¼Ÿ","link":"/2019/09/20/guid-mask/"},{"title":"ã€è¯‘ã€‘åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨åŸç”ŸJavaScriptæ¨¡å—","text":"åŸæ–‡åœ°å€ï¼šhttps://philipwalton.com/articles/using-native-javascript-modules-in-production-today/åŸæ–‡ä½œè€…ï¼šPHILIP WALTONè¯‘è€…ï¼šé¾šäº® ï¼Œæ ¡å¯¹ï¼šåˆ˜è¾‰å£°æ˜ï¼šæœ¬ç¿»è¯‘ä»…åšå­¦ä¹ äº¤æµä½¿ç”¨ï¼Œè½¬è½½è¯·æ³¨æ˜æ¥æº ä¸¤å¹´å‰ï¼Œæˆ‘å†™äº†ä¸€ç¯‡æœ‰å…³module/nomoduleæŠ€æœ¯çš„æ–‡ç« ï¼Œè¿™é¡¹æŠ€æœ¯å…è®¸ä½ åœ¨ç¼–å†™ES2015+ä»£ç æ—¶ï¼Œä½¿ç”¨æ‰“åŒ…å™¨å’Œè½¬æ¢å™¨ç”Ÿæˆä¸¤ä¸ªç‰ˆæœ¬çš„ä»£ç åº“ï¼Œä¸€ä¸ªå…·æœ‰ç°ä»£è¯­æ³•çš„ç‰ˆæœ¬ï¼ˆé€šè¿‡&lt;script type=&quot;module&quot;&gt;åŠ è½½ï¼‰å’Œä¸€ä¸ªä½¿ç”¨ES5è¯­æ³•çš„ç‰ˆæœ¬ï¼ˆé€šè¿‡&lt;script nomodule&gt;åŠ è½½ï¼‰ã€‚è¯¥æŠ€æœ¯å…è®¸ä½ å‘æ”¯æŒæ¨¡å—ï¼ˆè¯‘è€…æ³¨ï¼šæŒ‡ECMAåˆ¶å®šçš„æ ‡å‡†çš„export/importæ¨¡å—è¯­æ³•åŠå…¶åŠ è½½æœºåˆ¶ï¼Œåˆç§°ä¸ºES Moduleã€ESMã€ES6 Moduleã€ES2015 Moduleï¼Œä¸‹æ–‡ä¸­å°†å‡ºç°å¾ˆå¤šâ€æ¨¡å—â€ä¸€è¯ï¼Œéƒ½æ˜¯è¿™ä¸ªå«ä¹‰ï¼‰çš„æµè§ˆå™¨å‘é€æ›´å°‘çš„ä»£ç ï¼Œç°åœ¨å¤§å¤šæ•°Webæ¡†æ¶å’ŒCLIéƒ½æ”¯æŒå®ƒã€‚ ä½†æ˜¯é‚£æ—¶å€™ï¼Œå°½ç®¡èƒ½å¤Ÿåœ¨ç”Ÿäº§ä¸­éƒ¨ç½²ç°ä»£JavaScriptï¼Œå¤§å¤šæ•°æµè§ˆå™¨ä¹Ÿéƒ½æ”¯æŒæ¨¡å—ï¼Œæˆ‘ä»ç„¶å»ºè®®æ‰“åŒ…ä½ çš„ä»£ç ã€‚ ä¸ºä»€ä¹ˆï¼Ÿä¸»è¦æ˜¯å› ä¸ºæˆ‘è§‰å¾—åœ¨æµè§ˆå™¨ä¸­åŠ è½½æ¨¡å—å¾ˆæ…¢ã€‚å°½ç®¡åƒHTTP/2è¿™æ ·çš„æ–°åè®®ç†è®ºä¸Šæœ‰æ•ˆåœ°æ”¯æŒåŠ è½½å¤§é‡å°æ–‡ä»¶ï¼Œä½†å½“æ—¶çš„æ‰€æœ‰æ€§èƒ½ç ”ç©¶éƒ½è®¤ä¸ºä½¿ç”¨æ‰“åŒ…å™¨æ›´æœ‰æ•ˆã€‚ å…¶å®å½“æ—¶çš„ç ”ç©¶æ˜¯ä¸å®Œæ•´çš„ã€‚è¯¥ç ”ç©¶æ‰€ä½¿ç”¨çš„æ¨¡å—æµ‹è¯•ç¤ºä¾‹ç”±éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­æœªä¼˜åŒ–å’Œæœªç¼©å°çš„æºæ–‡ä»¶ç»„æˆã€‚å®ƒå¹¶æ²¡æœ‰å°†ä¼˜åŒ–åçš„æ¨¡å—åŒ…ä¸ä¼˜åŒ–åçš„åŸå§‹è„šæœ¬è¿›è¡Œæ¯”è¾ƒã€‚ ä¸è¿‡ï¼Œå½“æ—¶å¹¶æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•æ¥éƒ¨ç½²æ¨¡å—(è¯‘è€…æ³¨ï¼šæŒ‡éµå¾ªES2015æ¨¡å—è§„èŒƒçš„æ–‡ä»¶)ã€‚ä½†æ˜¯ç°åœ¨ï¼Œæ‰“åŒ…æŠ€æœ¯å–å¾—äº†ä¸€äº›æœ€æ–°è¿›å±•ï¼Œå¯ä»¥å°†ç”Ÿäº§ä»£ç éƒ¨ç½²ä¸ºES2015æ¨¡å—(åŒ…å«é™æ€å¯¼å…¥å’ŒåŠ¨æ€å¯¼å…¥)ï¼Œä»è€Œè·å¾—æ¯”éæ¨¡å—(è¯‘è€…æ³¨ï¼šæŒ‡é™¤ES2015æ¨¡å—å¤–çš„ä¼ ç»Ÿéƒ¨ç½²æ–¹å¼)æ›´å¥½çš„æ€§èƒ½ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªç«™ç‚¹(è¯‘è€…æ³¨ï¼šæŒ‡åŸæ–‡ç« æ‰€åœ¨çš„ç½‘ç«™)å·²ç»åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨åŸç”Ÿæ¨¡å—å¥½å‡ ä¸ªæœˆäº†ã€‚ å¯¹æ¨¡å—çš„è¯¯è§£ä¸æˆ‘äº¤æµè¿‡çš„å¾ˆå¤šäººéƒ½è®¤ä¸ºæ¨¡å—ï¼ˆè¯‘è€…æ³¨ï¼šæŒ‡éµå¾ªES2015æ¨¡å—è§„èŒƒçš„éƒ¨ç½²æ–¹å¼ï¼‰æ˜¯å¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒä¸‹åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªé€‰æ‹©ç½¢äº†ã€‚ä»–ä»¬ä¸­çš„è®¸å¤šäººå¼•ç”¨äº†æˆ‘åˆšåˆšæåˆ°çš„ç ”ç©¶ï¼Œå¹¶å»ºè®®ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æ¨¡å—ï¼Œé™¤é: â€¦å°å‹webåº”ç”¨ç¨‹åºï¼Œæ€»å…±åªæœ‰ä¸åˆ°100ä¸ªæ¨¡å—ï¼Œä¾èµ–æ ‘ç›¸å¯¹è¾ƒæµ…(å³æœ€å¤§æ·±åº¦å°äº5)ã€‚ å¦‚æœä½ æ›¾ç»æŸ¥çœ‹è¿‡node_modulesç›®å½•ï¼Œå¯èƒ½çŸ¥é“å³ä½¿æ˜¯å°å‹åº”ç”¨ç¨‹åºä¹Ÿå¾ˆå®¹æ˜“æœ‰è¶…è¿‡100ä¸ªæ¨¡å—ä¾èµ–é¡¹ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹npmä¸Šä¸€äº›æµè¡Œçš„å·¥å…·åŒ…æœ‰å¤šå°‘ä¸ªæ¨¡å—ä¾èµ–é¡¹å§ï¼š åŒ… æ¨¡å—æ•°é‡ date-fns 729 lodash-es 643 rxjs 226 äººä»¬å¯¹æ¨¡å—çš„ä¸»è¦è¯¯è§£æ˜¯ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æ¨¡å—æ—¶åªæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š(1)æŒ‰åŸæ ·éƒ¨ç½²æ‰€æœ‰æºä»£ç (åŒ…æ‹¬node_modulesç›®å½•)ï¼Œ(2)å®Œå…¨ä¸ä½¿ç”¨æ¨¡å—ã€‚ å¦‚æœä½ ä»”ç»†è€ƒè™‘æˆ‘æ‰€å¼•ç”¨ç ”ç©¶ç»™å‡ºçš„å»ºè®®ï¼Œå®ƒæ²¡æœ‰è¯´åŠ è½½æ¨¡å—æ¯”æ™®é€šåŠ è½½è„šæœ¬æ…¢ï¼Œä¹Ÿæ²¡æœ‰è¯´ä½ ä¸åº”è¯¥ä½¿ç”¨æ¨¡å—ã€‚å®ƒåªæ˜¯è¯´ï¼Œå¦‚æœä½ å°†æ•°ç™¾ä¸ªæœªç»è¿‡å‹ç¼©çš„æ¨¡å—æ–‡ä»¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒChromeå°†æ— æ³•åƒåŠ è½½å•ä¸ªç»è¿‡å‹ç¼©çš„æ¨¡å—ä¸€æ ·å¿«é€Ÿçš„åŠ è½½å®ƒä»¬ã€‚æ‰€ä»¥å»ºè®®ç»§ç»­ä½¿ç”¨æ‰“åŒ…å™¨ã€ç¼–è¯‘å™¨å’Œå‹ç¼©å™¨ï¼ˆè¯‘è€…æ³¨ï¼šåŸæ–‡æ˜¯minifierï¼ŒæŒ‡å»é™¤ç©ºæ ¼æ³¨é‡Šç­‰ï¼‰ã€‚ å®é™…æƒ…å†µæ˜¯ï¼Œä½ å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ä¸Šé¢æ‰€æœ‰æŠ€æœ¯çš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ES2015æ¨¡å—ï¼ äº‹å®ä¸Šï¼Œå› ä¸ºæµè§ˆå™¨å·²ç»çŸ¥é“å¦‚ä½•åŠ è½½æ¨¡å—ï¼ˆå¯¹ä¸æ”¯æŒæ¨¡å—çš„æµè§ˆå™¨å¯ä»¥åšé™çº§å¤„ç†ï¼‰ï¼Œæ‰€ä»¥æ¨¡å—æ‰æ˜¯æˆ‘ä»¬åº”è¯¥æ‰“åŒ…å‡ºçš„æ ¼å¼ã€‚å¦‚æœä½ æ£€æŸ¥å¤§å¤šæ•°æµè¡Œçš„æ‰“åŒ…å™¨ç”Ÿæˆçš„è¾“å‡ºä»£ç ï¼Œä½ ä¼šå‘ç°å¾ˆå¤šæ ·æ¿ä»£ç ï¼ˆè¯‘è€…æ³¨ï¼šæŒ‡rollupå’Œwebpackä¸­çš„runtimeçš„ä»£ç ï¼‰ï¼Œå…¶å”¯ä¸€çš„ç›®çš„æ˜¯åŠ¨æ€åŠ è½½å…¶å®ƒä»£ç å¹¶ç®¡ç†ä¾èµ–ï¼Œä½†å¦‚æœæˆ‘ä»¬åªä½¿ç”¨å¸¦æœ‰importå’Œexportè¯­å¥çš„æ¨¡å—ï¼Œåˆ™ä¸éœ€è¦è¿™äº›ä»£ç ï¼ å¹¸è¿çš„æ˜¯ï¼Œä»Šå¤©è‡³å°‘æœ‰ä¸€ä¸ªæµè¡Œçš„æ‰“åŒ…å™¨ï¼ˆRollupï¼‰æ”¯æŒæ¨¡å—ä½œä¸ºè¾“å‡ºæ ¼å¼ï¼Œè¿™æ„å‘³ç€å¯ä»¥æ‰“åŒ…ä»£ç å¹¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²æ¨¡å—ï¼ˆæ²¡æœ‰åŠ è½½å™¨æ ·æ¿ä»£ç ï¼‰ã€‚ç”±äºRollupï¼ˆæ ¹æ®æˆ‘çš„ç»éªŒï¼Œè¿™æ˜¯æœ€å¥½çš„æ‰“åŒ…å™¨ï¼‰å…·æœ‰å‡ºè‰²çš„tree-shakingï¼Œä½¿å¾—Rollupæ‰“åŒ…å‡ºçš„æ¨¡å—æ˜¯ç›®å‰æ‰€æœ‰æ‰“åŒ…å™¨è¾“å‡ºæ¨¡å—ä¸­ä»£ç æœ€å°‘çš„ã€‚ æ›´æ–°ï¼š Parcelè®¡åˆ’åœ¨ä¸‹ä¸€ç‰ˆæœ¬ä¸­æ·»åŠ æ¨¡å—æ”¯æŒã€‚Webpackç›®å‰ä¸æ”¯æŒæ¨¡å—è¾“å‡ºæ ¼å¼ï¼Œä½†è¿™é‡Œæœ‰ä¸€äº›ç›¸å…³è®¨è®ºï¼ƒ2933ï¼Œï¼ƒ8895ï¼Œï¼ƒ8896ã€‚ å¦ä¸€ä¸ªè¯¯è§£æ˜¯ï¼Œé™¤éä½ çš„æ‰€æœ‰ä¾èµ–é¡¹éƒ½ä½¿ç”¨æ¨¡å—ï¼Œå¦åˆ™ä½ ä¸èƒ½ä½¿ç”¨æ¨¡å—ã€‚ä¸å¹¸çš„æ˜¯å¤§å¤šæ•°npmåŒ…ä»ç„¶ä»¥CommonJSçš„å½¢å¼å‘å¸ƒ(ç”šè‡³æœ‰äº›åŒ…ä»¥ES2015ç¼–å†™ï¼Œä½†åœ¨å‘å¸ƒåˆ°npmä¹‹å‰è½¬æ¢ä¸ºCommonJS)ï¼ å°½ç®¡å¦‚æ­¤ï¼ŒRollupæœ‰ä¸€ä¸ªæ’ä»¶ï¼ˆrollup-plugin-commonjsï¼‰ï¼Œå®ƒå¯ä»¥å°†CommonJSæºä»£ç è½¬æ¢ä¸ºES2015ã€‚å¦‚æœä¸€å¼€å§‹ä½ çš„ä¾èµ–é¡¹é‡‡ç”¨ES2015æ¨¡å—ç®¡ç†è‚¯å®šä¼šæ›´å¥½ï¼Œä½†æ˜¯æœ‰ä¸€äº›ä¾èµ–å…³ç³»ä¸æ˜¯è¿™æ ·ç®¡ç†çš„å¹¶ä¸ä¼šé˜»æ­¢ä½ éƒ¨ç½²æ¨¡å—ã€‚ åœ¨æœ¬æ–‡çš„å‰©ä½™éƒ¨åˆ†ï¼Œæˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•æ‰“åŒ…åˆ°æ¨¡å—ï¼ˆåŒ…æ‹¬ä½¿ç”¨åŠ¨æ€å¯¼å…¥å’Œä»£ç æ‹†åˆ†çš„ç²’åº¦ï¼‰ï¼Œè§£é‡Šä¸ºä»€ä¹ˆå®ƒé€šå¸¸æ¯”åŸå§‹è„šæœ¬æ›´é«˜æ•ˆï¼Œå¹¶å±•ç¤ºå¦‚ä½•å¤„ç†ä¸æ”¯æŒæ¨¡å—çš„æµè§ˆå™¨ã€‚ æœ€ä¼˜æ‰“åŒ…ç­–ç•¥æ‰“åŒ…ç”Ÿäº§ä»£ç ä¸€ç›´æ˜¯éœ€è¦æƒè¡¡åˆ©å¼Šã€‚ä¸€æ–¹é¢ï¼Œå¸Œæœ›ä»£ç å°½å¿«åŠ è½½å’Œæ‰§è¡Œã€‚å¦ä¸€æ–¹é¢ï¼Œåˆä¸å¸Œæœ›åŠ è½½ç”¨æˆ·å®é™…ç”¨ä¸åˆ°çš„ä»£ç ã€‚ åŒæ—¶ï¼Œè¿˜å¸Œæœ›ä»£ç å°½å¯èƒ½åœ°è¢«ç¼“å­˜ã€‚æ‰“åŒ…çš„ä¸€ä¸ªå¤§é—®é¢˜æ˜¯ï¼Œå³ä½¿åªæ˜¯ä¸€è¡Œä»£ç æœ‰ä¿®æ”¹ä¹Ÿä¼šä½¿æ•´ä¸ªæ‰“åŒ…åçš„åŒ…ç¼“å­˜å¤±æ•ˆã€‚å¦‚æœç›´æ¥ä½¿ç”¨ES2015æ¨¡å—éƒ¨ç½²åº”ç”¨ç¨‹åºï¼ˆå°±åƒå®ƒä»¬åœ¨æºä»£ç ä¸­ä¸€æ ·ï¼‰ï¼Œé‚£ä¹ˆä½ å¯ä»¥è‡ªç”±åœ°è¿›è¡Œå°çš„æ›´æ”¹ï¼ŒåŒæ—¶è®©åº”ç”¨ç¨‹åºçš„å¤§éƒ¨åˆ†ä»£ç ä»ç„¶ä¿ç•™åœ¨ç¼“å­˜ä¸­ã€‚ä½†å°±åƒæˆ‘å·²ç»æŒ‡å‡ºçš„é‚£æ ·ï¼Œè¿™ä¹Ÿæ„å‘³ç€ä½ çš„ä»£ç éœ€è¦æ›´é•¿æ—¶é—´æ‰èƒ½è¢«æ–°ç”¨æˆ·çš„æµè§ˆå™¨åŠ è½½å®Œæˆã€‚ å› æ­¤ï¼Œæ‰¾åˆ°æœ€ä¼˜æ‰“åŒ…ç²’åº¦çš„æŒ‘æˆ˜æ˜¯åœ¨åŠ è½½æ€§èƒ½å’Œé•¿æœŸç¼“å­˜ä¹‹é—´å–å¾—é€‚å½“çš„å¹³è¡¡ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¤§å¤šæ•°æ‰“åŒ…å™¨åœ¨åŠ¨æ€å¯¼å…¥æ—¶è¿›è¡Œä»£ç æ‹†åˆ†ï¼Œä½†æˆ‘è®¤ä¸ºä»…åŠ¨æ€å¯¼å…¥çš„ä»£ç æ‹†åˆ†ç²’åº¦ä¸å¤Ÿç»†ï¼Œç‰¹åˆ«æ˜¯å¯¹äºæ‹¥æœ‰å¤§é‡ç•™å­˜ç”¨æˆ·çš„ç«™ç‚¹ï¼ˆç¼“å­˜å¾ˆé‡è¦ï¼‰ã€‚ åœ¨æˆ‘çœ‹æ¥ï¼Œä½ åº”è¯¥å°½å¯èƒ½ç»†ç²’åº¦åœ°æ‹†åˆ†ä»£ç ï¼Œç›´åˆ°å¼€å§‹æ˜¾è‘—åœ°å½±å“åŠ è½½æ€§èƒ½ä¸ºæ­¢ã€‚è™½ç„¶æˆ‘å¼ºçƒˆå»ºè®®ä½ è‡ªå·±åŠ¨æ‰‹è¿›è¡Œåˆ†æï¼Œä½†æ˜¯æŸ¥é˜…ä¸Šæ–‡å¼•ç”¨çš„ç ”ç©¶å¯ä»¥å¾—å‡ºä¸€ä¸ªå¤§è‡´çš„ç»“è®ºã€‚å½“åŠ è½½å°‘äº100ä¸ªæ¨¡å—æ—¶ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½å·®å¼‚ã€‚é’ˆå¯¹HTTP/2æ€§èƒ½çš„ç ”ç©¶å‘ç°ï¼ŒåŠ è½½å°‘äº50ä¸ªæ–‡ä»¶æ—¶æ²¡æœ‰æ˜æ˜¾çš„å·®å¼‚(å°½ç®¡ä»–ä»¬åªæµ‹è¯•äº†1ã€6ã€50å’Œ1000ï¼Œæ‰€ä»¥100ä¸ªæ–‡ä»¶å¯èƒ½å°±å¯ä»¥äº†)ã€‚ é‚£ä¹ˆï¼Œæœ€å¥½çš„ä»£ç æ‹†åˆ†æ–¹æ³•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé™¤äº†é€šè¿‡åŠ¨æ€å¯¼å…¥åšä»£ç æ‹†åˆ†å¤–ï¼Œæˆ‘è¿˜å»ºè®®ä»¥npmåŒ…ä¸ºç²’åº¦åšä»£ç æ‹†åˆ†ï¼Œnode_modulesä¸­çš„æ¨¡å—éƒ½åˆå¹¶åˆ°ä»¥å…¶åŒ…åå‘½åçš„æ–‡ä»¶ä¸­ã€‚ åŒ…çº§åˆ«çš„ä»£ç æ‹†åˆ†å¦‚ä¸Šæ‰€è¿°ï¼Œæ‰“åŒ…æŠ€æœ¯çš„ä¸€äº›æœ€æ–°è¿›å±•ä½¿å¾—é«˜æ€§èƒ½æ¨¡å—éƒ¨ç½²æˆä¸ºå¯èƒ½ã€‚æˆ‘æåˆ°çš„å¢å¼ºæ˜¯æŒ‡Rollupçš„ä¸¤ä¸ªæ–°åŠŸèƒ½ï¼šé€šè¿‡åŠ¨æ€import()æ—¶è‡ªåŠ¨ä»£ç æ‹†åˆ†ï¼ˆåœ¨v1.0.0ä¸­æ·»åŠ ï¼‰å’Œé€šè¿‡manualChunksé€‰é¡¹è¿›è¡Œå¯ç¼–ç¨‹çš„æ‰‹åŠ¨ä»£ç æ‹†åˆ†ï¼ˆåœ¨v1.11.0ä¸­æ·»åŠ ï¼‰ã€‚ æœ‰äº†è¿™ä¸¤ä¸ªåŠŸèƒ½ï¼Œç°åœ¨å¾ˆå®¹æ˜“åœ¨åŒ…çº§åˆ«è¿›è¡Œä»£ç æ‹†åˆ†çš„æ„å»ºé…ç½®ã€‚ è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨manualChunksé€‰é¡¹é…ç½®çš„ä¾‹å­ï¼Œæ¯ä¸ªä½äºnode_moduleé‡Œçš„æ¨¡å—å°†è¢«åˆå¹¶åˆ°ä»¥åŒ…åå‘½åçš„æ–‡ä»¶é‡Œ(å½“ç„¶ï¼Œè¿™ç§æ¨¡å—è·¯å¾„é‡Œè‚¯å®šåŒ…å«node_modules) 1234567891011121314151617181920export default { input: { main: &apos;src/main.mjs&apos;, }, output: { dir: &apos;build&apos;, format: &apos;esm&apos;, entryFileNames: &apos;[name].[hash].mjs&apos;, }, manualChunks(id) { if (id.includes(&apos;node_modules&apos;)) { // Return the directory name following the last `node_modules`. // è¿”å›æœ€åä¸€ä¸ªnode_modulesåé¢è·Ÿç€çš„ç›®å½•å // Usually this is the package, but it could also be the scope. // é€šå¸¸éƒ½ä¼šæ˜¯ä¸€ä¸ªåŒ…åï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªç§æœ‰åŸŸ const dirs = id.split(path.sep); return dirs[dirs.lastIndexOf(&apos;node_modules&apos;) + 1]; } },} manualChunksé€‰é¡¹æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†æ¨¡å—æ–‡ä»¶è·¯å¾„ä½œä¸ºæƒŸä¸€çš„å‚æ•°ï¼Œä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªæ–‡ä»¶åï¼Œå‚æ•°ä¸­çš„æ¨¡å—å°†è¢«åŠ å…¥åˆ°è¿™ä¸ªæ–‡ä»¶é‡Œã€‚å¦‚æœæ²¡æœ‰è¿”å›ä»»ä½•å†…å®¹ï¼Œå‚æ•°ä¸­çš„æ¨¡å—å°†è¢«æ·»åŠ åˆ°é»˜è®¤æ–‡ä»¶ä¸­ã€‚ è€ƒè™‘ä»lodash-esåŒ…ä¸­å¯¼å…¥cloneDeep()ã€debounce()å’Œfind()æ¨¡å—çš„ä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚ä¸Šé¢çš„é…ç½®å°†æŠŠå„ä¸ªæ¨¡å—(ä»¥åŠå®ƒä»¬å¯¼å…¥çš„ä»»ä½•å…¶å®ƒlodashæ¨¡å—)ä¸€èµ·æ”¾å…¥ä¸€ä¸ªåä¸ºnpm.lodash-es.XXXX.mjsçš„è¾“å‡ºæ–‡ä»¶ä¸­ï¼Œ(å…¶ä¸­XXXXæ˜¯lodash-esæ¨¡å—æ–‡ä»¶çš„å“ˆå¸Œå€¼)ã€‚ åœ¨è¯¥æ–‡ä»¶çš„æœ«å°¾ï¼Œä½ ä¼šçœ‹åˆ°è¿™æ ·çš„å¯¼å‡ºè¯­å¥(æ³¨æ„ï¼Œå®ƒåªåŒ…å«æ·»åŠ åˆ°å—ä¸­æ¨¡å—çš„å¯¼å‡ºè¯­å¥ï¼Œè€Œä¸æ˜¯æ‰€æœ‰lodashæ¨¡å—): 1export {cloneDeep, debounce, find}; å¸Œæœ›è¿™ä¸ªä¾‹å­èƒ½æ¸…æ¥šåœ°è¯´æ˜ä½¿ç”¨Rollupæ‰‹åŠ¨æ‹†åˆ†ä»£ç çš„å·¥ä½œåŸç†ã€‚å°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘è®¤ä¸ºä½¿ç”¨importå’Œexportè¯­å¥çš„ä»£ç æ‹†åˆ†æ¯”ä½¿ç”¨éæ ‡å‡†çš„ã€ç‰¹å®šäºæ‰“åŒ…å™¨å®ç°çš„ä»£ç æ‹†åˆ†æ›´å®¹æ˜“é˜…è¯»å’Œç†è§£ã€‚ ä¾‹å¦‚ï¼Œè·Ÿè¸ªè¿™ä¸ªæ–‡ä»¶ä¸­å‘ç”Ÿäº†ä»€ä¹ˆå¾ˆéš¾(æˆ‘ä»¥å‰ä½¿ç”¨webpackå¯¹ä¸€ä¸ªé¡¹ç›®åšä»£ç æ‹†åˆ†åçš„å®é™…è¾“å‡º)ï¼Œè€Œä¸”åœ¨æ”¯æŒæ¨¡å—çš„æµè§ˆå™¨ä¸­å…¶å®ä¸éœ€è¦è¿™äº›ä»£ç : 12345678910111213141516171819(window[&quot;webpackJsonp&quot;] = window[&quot;webpackJsonp&quot;] || []).push([[&quot;import1&quot;],{/***/ &quot;tLzr&quot;:/*!*********************************!*\\ !*** ./app/scripts/import-1.js ***! \\*********************************//*! exports provided: import1 *//***/ (function(module, __webpack_exports__, __webpack_require__) {&quot;use strict&quot;;__webpack_require__.r(__webpack_exports__);/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, &quot;import1&quot;, function() { return import1; });/* harmony import */ var _dep_1__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./dep-1 */ &quot;6xPP&quot;);const import1 = &quot;imported: &quot; + _dep_1__WEBPACK_IMPORTED_MODULE_0__[&quot;dep1&quot;];/***/ })}]); å¦‚æœä½ æœ‰æ•°ç™¾ä¸ªnpmä¾èµ–é¡¹æ€ä¹ˆåŠï¼Ÿæˆ‘åœ¨ä¸Šé¢è¯´è¿‡ï¼Œæˆ‘è®¤ä¸ºåŒ…çº§åˆ«ä¸Šçš„ä»£ç æ‹†åˆ†æ˜¯ç«™ç‚¹ä»£ç æ‹†åˆ†çš„æœ€ä½³çŠ¶æ€ï¼Œè€Œåˆä¸ä¼šå¤ªæ¿€è¿›ã€‚ å½“ç„¶ï¼Œå¦‚æœä½ çš„åº”ç”¨ç¨‹åºä»æ•°ç™¾ä¸ªä¸åŒçš„npmåŒ…ä¸­å¯¼å…¥æ¨¡å—ï¼Œé‚£ä¹ˆæµè§ˆå™¨å¯èƒ½æ— æ³•æœ‰æ•ˆåœ°åŠ è½½æ‰€æœ‰æ¨¡å—ã€‚ ä½†æ˜¯ï¼Œå¦‚æœä½ ç¡®å®æœ‰å¾ˆå¤šnpmä¾èµ–é¡¹ï¼Œé‚£ä¹ˆå…ˆä¸è¦å®Œå…¨æ”¾å¼ƒè¿™ä¸ªç­–ç•¥ã€‚è¯·è®°ä½ï¼Œä½ å¯èƒ½ä¸ä¼šåœ¨æ¯ä¸ªé¡µé¢ä¸ŠåŠ è½½æ‰€æœ‰çš„npmä¾èµ–é¡¹ï¼Œå› æ­¤æ£€æŸ¥å®é™…åŠ è½½äº†å¤šå°‘ä¾èµ–é¡¹éå¸¸é‡è¦ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œç¡®å®æœ‰ä¸€äº›éå¸¸å¤§çš„åº”ç”¨ç¨‹åºå…·æœ‰å¦‚æ­¤å¤šçš„npmä¾èµ–å…³ç³»ï¼Œä»¥è‡³äºå®ƒä»¬ä¸èƒ½å®é™…åœ°å¯¹å…¶ä¸­çš„æ¯ä¸€ä¸ªåº”ç”¨ç¨‹åºè¿›è¡Œä»£ç æ‹†åˆ†ã€‚å¦‚æœä½ æ˜¯è¿™ç§æƒ…å†µï¼Œæˆ‘å»ºè®®ä½ æ‰¾å‡ºä¸€ç§æ–¹æ³•æ¥å°†ä¸€äº›ä¾èµ–é¡¹åˆ†ç»„åˆ°å…¬å…±æ–‡ä»¶ä¸­ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä½ å¯ä»¥å°†å¯èƒ½åœ¨åŒä¸€æ—¶é—´å‘ç”Ÿå˜åŒ–çš„åŒ…(ä¾‹å¦‚ï¼ŒReactå’Œreact-dom)åˆ†ç»„ï¼Œå› ä¸ºå®ƒä»¬å¿…é¡»ä¸€èµ·å¤±æ•ˆ(ä¾‹å¦‚ï¼Œæˆ‘ç¨åå±•ç¤ºçš„ç¤ºä¾‹åº”ç”¨ç¨‹åºå°†æ‰€æœ‰Reactä¾èµ–é¡¹åˆ†ç»„ä¸ºåŒä¸€ä¸ªæ–‡ä»¶)ã€‚ åŠ¨æ€å¯¼å…¥ä½¿ç”¨åŸç”Ÿimportè¯­å¥è¿›è¡Œä»£ç æ‹†åˆ†å’Œæ¨¡å—åŠ è½½çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œéœ€è¦å¼€å‘äººå‘˜å¯¹ä¸æ”¯æŒæ¨¡å—çš„æµè§ˆå™¨åšå…¼å®¹å¤„ç†ã€‚ å¦‚æœä½ æƒ³ä½¿ç”¨åŠ¨æ€import()æ‡’åŠ è½½ä»£ç ï¼Œé‚£ä¹ˆä½ è¿˜å¿…é¡»å¤„ç†è¿™æ ·ä¸€ä¸ªäº‹å®ï¼šæœ‰äº›æµè§ˆå™¨æ”¯æŒæ¨¡å—ï¼Œä½†ä¸æ”¯æŒåŠ¨æ€import()ï¼ˆEdge 16â€“18, Firefox 60â€“66, Safari 11, Chrome 61â€“63ï¼‰ã€‚ å¹¸è¿çš„æ˜¯ï¼Œä¸€ä¸ªå¾ˆå°çš„(~400å­—èŠ‚)ã€éå¸¸é«˜æ€§èƒ½çš„polyfillå¯ç”¨äºåŠ¨æ€import()ã€‚ å‘ç«™ç‚¹æ·»åŠ polyfillå¾ˆå®¹æ˜“ã€‚ä½ æ‰€è¦åšçš„æ˜¯å¯¼å…¥å®ƒå¹¶åœ¨åº”ç”¨ç¨‹åºçš„ä¸»å…¥å£ç‚¹åˆå§‹åŒ–å®ƒ(åœ¨è°ƒç”¨import()ä¹‹å‰): 12345import dynamicImportPolyfill from &apos;dynamic-import-polyfill&apos;;// This needs to be done before any dynamic imports are used. And if your// modules are hosted in a sub-directory, the path must be specified here.dynamicImportPolyfill.initialize({modulePath: &apos;/modules/&apos;}); æœ€åè¦åšçš„æ˜¯å‘Šè¯‰Rollupå°†è¾“å‡ºä»£ç ä¸­çš„åŠ¨æ€import()é‡å‘½åä¸ºä½ æŒ‡å®šçš„å¦ä¸€ä¸ªåç§°(é€šè¿‡output.dynamicImportFunctioné€‰é¡¹é…ç½®)ã€‚åŠ¨æ€å¯¼å…¥polyfillé»˜è®¤ä½¿ç”¨åç§°ä¸ºimportï¼Œä½†æ˜¯å¯ä»¥é…ç½®å®ƒã€‚ éœ€è¦é‡å‘½åimport()è¯­å¥çš„åŸå› æ˜¯importæ˜¯JavaScriptä¸­çš„ä¸€ä¸ªå…³é”®å­—ã€‚è¿™æ„å‘³ç€ä¸å¯èƒ½ä½¿ç”¨ç›¸åŒçš„åç§°æ¥å¡«å……åŸç”Ÿimport()ï¼Œå› ä¸ºè¿™æ ·åšä¼šå¯¼è‡´è¯­æ³•é”™è¯¯ã€‚ è®©Rollupåœ¨æ„å»ºæ—¶é‡å‘½åå®ƒæ˜¯å¾ˆå¥½çš„ï¼Œè¿™æ„å‘³ç€ä½ çš„æºä»£ç å¯ä»¥ä½¿ç”¨æ ‡å‡†ç‰ˆæœ¬ï¼Œå¹¶ä¸”åœ¨å°†æ¥ä¸å†éœ€è¦polyfillæ—¶ï¼Œä½ å°†ä¸å¿…é‡æ–°æ›´æ”¹å®ƒã€‚ é«˜æ•ˆåŠ è½½JavaScriptæ¨¡å—å½“ä½ ä½¿ç”¨ä»£ç æ‹†åˆ†çš„æ—¶å€™ï¼Œæœ€å¥½é¢„åŠ è½½æ‰€æœ‰é©¬ä¸Šè¦ä½¿ç”¨çš„æ¨¡å—(å³ä¸»å…¥å£æ¨¡å—å¯¼å…¥å›¾ä¸­çš„æ‰€æœ‰æ¨¡å—)ã€‚ ä½†æ˜¯ï¼Œå½“ä½ åŠ è½½å®é™…çš„JavaScriptæ¨¡å—ï¼ˆé€šè¿‡&lt;script type=&quot;module&quot;&gt;ä»¥åŠéšåimportè¯­å¥å¼•ç”¨çš„æ¨¡å—æ—¶ï¼‰ï¼Œä½ å°†å¸Œæœ›ä½¿ç”¨modulepreloadè€Œä¸æ˜¯ä¼ ç»Ÿçš„preload(ä»…é€‚ç”¨äºåŸå§‹è„šæœ¬)ã€‚ 123456&lt;link rel=&quot;modulepreload&quot; href=&quot;/modules/main.XXXX.mjs&quot;&gt;&lt;link rel=&quot;modulepreload&quot; href=&quot;/modules/npm.pkg-one.XXXX.mjs&quot;&gt;&lt;link rel=&quot;modulepreload&quot; href=&quot;/modules/npm.pkg-two.XXXX.mjs&quot;&gt;&lt;link rel=&quot;modulepreload&quot; href=&quot;/modules/npm.pkg-three.XXXX.mjs&quot;&gt;&lt;!-- ... --&gt;&lt;script type=&quot;module&quot; src=&quot;/modules/main.XXXX.mjs&quot;&gt;&lt;/script&gt; å®é™…ä¸Šï¼Œå¯¹äºé¢„åŠ è½½åŸç”Ÿçš„æ¨¡å—ï¼Œmodulepreloadå®é™…ä¸Šæ¯”ä¼ ç»Ÿçš„preloadè¦ä¸¥æ ¼å¾—å¤šï¼Œå®ƒä¸ä»…ä¸‹è½½æ–‡ä»¶ï¼Œè€Œä¸”åœ¨ä¸»çº¿ç¨‹ä¹‹å¤–ç«‹å³å¼€å§‹è§£æå’Œç¼–è¯‘æ–‡ä»¶ã€‚ä¼ ç»Ÿçš„é¢„åŠ è½½æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ï¼Œå› ä¸ºå®ƒä¸çŸ¥é“åœ¨é¢„åŠ è½½æ—¶è¯¥æ–‡ä»¶å°†ç”¨ä½œæ¨¡å—è„šæœ¬è¿˜æ˜¯åŸå§‹è„šæœ¬ã€‚ è¿™æ„å‘³ç€é€šè¿‡modulepreloadåŠ è½½æ¨¡å—é€šå¸¸ä¼šæ›´å¿«ï¼Œè€Œä¸”åœ¨å®ä¾‹åŒ–æ—¶ä¸å¤ªå¯èƒ½å¯¼è‡´ä¸»çº¿ç¨‹å¡é¡¿ã€‚ ç”Ÿæˆmodulepreloadåˆ—è¡¨Rollupçš„bundleå¯¹è±¡ä¸­çš„æ¯ä¸ªå…¥å£æ–‡ä»¶åœ¨å…¶é™æ€ä¾èµ–å…³ç³»å›¾ä¸­åŒ…å«å®Œæ•´çš„å¯¼å…¥åˆ—è¡¨ï¼Œå› æ­¤åœ¨Rollupçš„generateBundleé’©å­ä¸­å¾ˆå®¹æ˜“è·å¾—éœ€è¦é¢„åŠ è½½å“ªäº›æ–‡ä»¶çš„åˆ—è¡¨ã€‚ è™½ç„¶åœ¨npmä¸Šç¡®å®å­˜åœ¨ä¸€äº›modulepreloadæ’ä»¶ï¼Œä½†æ˜¯ä¸ºå›¾ä¸­çš„æ¯ä¸ªå…¥å£ç‚¹ç”Ÿæˆä¸€ä¸ªmodulepreloadåˆ—è¡¨åªéœ€è¦å‡ è¡Œä»£ç ï¼Œæ‰€ä»¥æˆ‘æ›´æ„¿æ„åƒè¿™æ ·æ‰‹åŠ¨åˆ›å»ºå®ƒ: 123456789101112131415{ generateBundle(options, bundle) { // A mapping of entry chunk names to their full dependency list. const modulepreloadMap = {}; for (const [fileName, chunkInfo] of Object.entries(bundle)) { if (chunkInfo.isEntry || chunkInfo.isDynamicEntry) { modulepreloadMap[chunkInfo.name] = [fileName, ...chunkInfo.imports]; } } // Do something with the mapping... console.log(modulepreloadMap); }} ä¾‹å¦‚ï¼Œè¿™é‡Œæ˜¯æˆ‘å¦‚ä½•ä¸ºè¿™ä¸ªç«™ç‚¹ä»¥åŠæˆ‘çš„demoåº”ç”¨ç”Ÿæˆmodulepreloadåˆ—è¡¨çš„ã€‚ æ³¨æ„ï¼šè™½ç„¶å¯¹äºæ¨¡å—è„šæœ¬æ¥è¯´ï¼Œmodulepreloadç»å¯¹æ¯”åŸå§‹çš„preloadæ›´å¥½ï¼Œä½†å®ƒå¯¹æµè§ˆå™¨çš„æ”¯æŒæ›´å·®(ç›®å‰åªæ”¯æŒchrome)ã€‚å¦‚æœä½ çš„æµé‡ä¸­æœ‰ç›¸å½“ä¸€éƒ¨åˆ†æ˜¯échromeæµé‡ï¼Œé‚£ä¹ˆä½¿ç”¨classic preloadæ˜¯æœ‰æ„ä¹‰çš„ã€‚ ä¸ä½¿ç”¨modulepreloadä¸åŒï¼Œä½¿ç”¨preloadæ—¶éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œé¢„åŠ è½½è„šæœ¬ä¸ä¼šæ”¾åœ¨æµè§ˆå™¨çš„æ¨¡å—æ˜ å°„ä¸­ï¼Œè¿™æ„å‘³ç€å¯èƒ½ä¼šä¸æ­¢ä¸€æ¬¡åœ°å¤„ç†é¢„åŠ è½½çš„è¯·æ±‚(ä¾‹å¦‚ï¼Œå¦‚æœæ¨¡å—åœ¨æµè§ˆå™¨å®Œæˆé¢„åŠ è½½ä¹‹å‰å¯¼å…¥æ–‡ä»¶)ã€‚ ä¸ºä»€ä¹ˆè¦éƒ¨ç½²åŸç”Ÿæ¨¡å—ï¼Ÿå¦‚æœä½ å·²ç»åœ¨ä½¿ç”¨åƒwebpackè¿™æ ·çš„æ‰“åŒ…å™¨ï¼Œå¹¶ä¸”å·²ç»åœ¨ä½¿ç”¨ç»†ç²’åº¦ä»£ç æ‹†åˆ†å’Œé¢„åŠ è½½è¿™äº›æ–‡ä»¶(ä¸æˆ‘åœ¨è¿™é‡Œæè¿°çš„ç±»ä¼¼)ï¼Œé‚£ä¹ˆä½ å¯èƒ½æƒ³çŸ¥é“æ˜¯å¦å€¼å¾—æ”¹å˜ç­–ç•¥ï¼Œä½¿ç”¨åŸç”Ÿæ¨¡å—ã€‚ä¸‹é¢æ˜¯æˆ‘è®¤ä¸ºä½ åº”è¯¥è€ƒè™‘å®ƒçš„å‡ ä¸ªåŸå› ï¼Œä»¥åŠä¸ºä»€ä¹ˆæ‰“åŒ…åˆ°åŸç”Ÿæ¨¡å—æ¯”ä½¿ç”¨å¸¦æœ‰æ¨¡å—åŠ è½½ä»£ç çš„åŸå§‹è„šæœ¬è¦å¥½ã€‚ æ›´å°çš„ä»£ç æ€»é‡å½“ä½¿ç”¨åŸç”Ÿæ¨¡å—æ—¶ï¼Œç°ä»£æµè§ˆå™¨ä¸å¿…ä¸ºç”¨æˆ·åŠ è½½ä»»ä½•ä¸å¿…è¦çš„æ¨¡å—åŠ è½½æˆ–ä¾èµ–å…³ç³»ç®¡ç†ä»£ç ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨åŸç”Ÿæ¨¡å—ï¼Œåˆ™æ ¹æœ¬ä¸éœ€è¦webpackè¿è¡Œæ—¶å’Œæ¸…å•ã€‚ æ›´å¥½çš„é¢„åŠ è½½æ­£å¦‚æˆ‘åœ¨å‰ä¸€èŠ‚ä¸­æåˆ°çš„ï¼Œä½¿ç”¨modulepreloadå…è®¸ä½ åŠ è½½ä»£ç å¹¶åœ¨ä¸»çº¿ç¨‹ä¹‹å¤–è§£æ/ç¼–è¯‘ä»£ç ã€‚åœ¨å…¶ä»–æ¡ä»¶ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œè¿™æ„å‘³ç€é¡µé¢çš„äº¤äº’é€Ÿåº¦æ›´å¿«ï¼Œå¹¶ä¸”ä¸»çº¿ç¨‹åœ¨ç”¨æˆ·äº¤äº’æœŸé—´ä¸å¤ªå¯èƒ½è¢«é˜»å¡ã€‚ å› æ­¤ï¼Œæ— è®ºä½ å¦‚ä½•ç»†ç²’åº¦åœ°å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œä»£ç æ‹†åˆ†ï¼Œä½¿ç”¨importè¯­å¥å’ŒmodulepreloadåŠ è½½æ¨¡å—è¦æ¯”é€šè¿‡åŸå§‹scriptæ ‡ç­¾å’Œå¸¸è§„preloadåŠ è½½æ›´æœ‰æ•ˆ(ç‰¹åˆ«æ˜¯å¦‚æœè¿™äº›æ ‡ç­¾æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œå¹¶åœ¨è¿è¡Œæ—¶æ·»åŠ åˆ°DOMä¸­)ã€‚ æ¢å¥è¯è¯´ï¼Œç”±Rollupæ‰“åŒ…å‡ºçš„20ä¸ªæ¨¡å—æ–‡ä»¶å°†æ¯”ç”±webpackæ‰“åŒ…å‡ºçš„20ä¸ªåŸå§‹è„šæœ¬æ–‡ä»¶åŠ è½½å¾—æ›´å¿«(ä¸æ˜¯å› ä¸ºwebpackï¼Œè€Œæ˜¯å› ä¸ºå®ƒä¸æ˜¯åŸç”Ÿæ¨¡å—)ã€‚ æ›´é¢å‘æœªæ¥è®¸å¤šæœ€ä»¤äººå…´å¥‹çš„æ–°æµè§ˆå™¨ç‰¹æ€§éƒ½æ˜¯æ„å»ºåœ¨æ¨¡å—ä¹‹ä¸Šçš„ï¼Œè€Œä¸æ˜¯åŸå§‹çš„è„šæœ¬ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨è¿™äº›ç‰¹æ€§ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œä½ çš„ä»£ç éœ€è¦ä½œä¸ºåŸç”Ÿæ¨¡å—éƒ¨ç½²ï¼Œè€Œä¸æ˜¯è½¬æ¢ä¸ºES5å¹¶é€šè¿‡åŸå§‹çš„scriptæ ‡ç­¾åŠ è½½(æˆ‘åœ¨å°è¯•ä½¿ç”¨å®éªŒæ€§KVå­˜å‚¨APIæ—¶æ›¾æåˆ°è¿‡è¿™ä¸ªé—®é¢˜)ã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›ä»…é™æ¨¡å—æ‰æœ‰çš„æœ€ä»¤äººå…´å¥‹çš„æ–°åŠŸèƒ½ï¼š å†…ç½®æ¨¡å— HTMLæ¨¡å— CSSæ¨¡å— JSONæ¨¡å— å¯¼å…¥åœ°å›¾ workersã€service workerså’Œwindowä¹‹é—´å…±äº«æ¨¡å— æ”¯æŒæ—§ç‰ˆæµè§ˆå™¨åœ¨å…¨çƒèŒƒå›´å†…ï¼Œè¶…è¿‡83%çš„æµè§ˆå™¨åŸç”Ÿæ”¯æŒJavaScriptæ¨¡å—(åŒ…æ‹¬åŠ¨æ€å¯¼å…¥)ï¼Œå› æ­¤å¯¹äºä½ çš„å¤§å¤šæ•°ç”¨æˆ·æ¥è¯´ï¼Œä¸éœ€è¦åšä»»ä½•å¤„ç†å°±å¯ä»¥ä½¿ç”¨è¿™é¡¹æŠ€æœ¯ã€‚ å¯¹äºæ”¯æŒæ¨¡å—ä½†ä¸æ”¯æŒåŠ¨æ€å¯¼å…¥çš„æµè§ˆå™¨ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šé¢æåˆ°çš„dynamic-import-polyfillã€‚ç”±äºpolyfilléå¸¸å°ï¼Œå¹¶ä¸”åœ¨å¯ç”¨æ—¶å°†ä½¿ç”¨æµè§ˆå™¨çš„åŸç”ŸåŠ¨æ€import()ï¼Œå› æ­¤æ·»åŠ è¿™ä¸ªpolyfillå‡ ä¹æ²¡æœ‰å¤§å°æˆ–æ€§èƒ½æˆæœ¬ã€‚ å¯¹äºæ ¹æœ¬ä¸æ”¯æŒæ¨¡å—çš„æµè§ˆå™¨ï¼Œå¯ä»¥ä½¿ç”¨æˆ‘å‰é¢æåˆ°çš„module/nomoduleæŠ€æœ¯ã€‚ ä¸€ä¸ªå®é™…çš„ä¾‹å­ç”±äºè°ˆè®ºè·¨æµè§ˆå™¨å…¼å®¹æ€§æ€»æ˜¯æ¯”å®é™…å®ç°å®ƒè¦å®¹æ˜“ï¼Œæ‰€ä»¥æˆ‘æ„å»ºäº†ä¸€ä¸ªæ¼”ç¤ºåº”ç”¨ç¨‹åºï¼Œå®ƒä½¿ç”¨äº†æˆ‘åœ¨è¿™é‡Œé˜è¿°çš„æ‰€æœ‰æŠ€æœ¯ã€‚ è¿™ä¸ªæ¼”ç¤ºç¨‹åºå¯ä»¥åœ¨ä¸æ”¯æŒåŠ¨æ€import()çš„æµè§ˆå™¨ä¸­è¿è¡Œ(å¦‚Edge 18å’ŒFirefox ESR)ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸æ”¯æŒæ¨¡å—çš„æµè§ˆå™¨ä¸­è¿è¡Œ(å¦‚Internet Explorer 11)ã€‚ ä¸ºäº†è¯´æ˜è¿™ä¸ªç­–ç•¥ä¸ä»…é€‚ç”¨äºç®€å•çš„ç”¨ä¾‹ï¼Œæˆ‘è¿˜åŒ…å«äº†å½“ä»Šå¤æ‚çš„JavaScriptåº”ç”¨ç¨‹åºéœ€è¦çš„è®¸å¤šç‰¹æ€§: Babelè½¬æ¢ï¼ˆåŒ…æ‹¬JSXï¼‰ CommonJSçš„ä¾èµ–å…³ç³»ï¼ˆä¾‹å¦‚reactï¼Œreact-domï¼‰ CSSä¾èµ–é¡¹ Asset hashing ä»£ç æ‹†åˆ† åŠ¨æ€å¯¼å…¥ï¼ˆå¸¦æœ‰polyfillé™çº§æœºåˆ¶ï¼‰ module/nomoduleé™çº§æœºåˆ¶ ä»£ç æ‰˜ç®¡åœ¨GitHubä¸Š(å› æ­¤ä½ å¯ä»¥æ´¾ç”Ÿrepoå¹¶è‡ªå·±æ„å»ºå®ƒ)ï¼Œè€Œæ¼”ç¤ºåˆ™æ‰˜ç®¡åœ¨Glitchä¸Šï¼Œå› æ­¤ä½ å¯ä»¥é‡æ–°ç»„åˆä»£ç å¹¶ä½¿ç”¨è¿™äº›ç‰¹æ€§ã€‚ æœ€é‡è¦çš„æ˜¯æŸ¥çœ‹ç¤ºä¾‹ä¸­ä½¿ç”¨çš„Rollupé…ç½®ï¼Œå› ä¸ºå®ƒå®šä¹‰äº†å¦‚ä½•ç”Ÿæˆæœ€ç»ˆæ¨¡å—ã€‚ æ€»ç»“å¸Œæœ›è¿™ç¯‡æ–‡ç« è®©ä½ ç›¸ä¿¡ï¼Œç°åœ¨ä¸ä»…å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²åŸç”ŸJavaScriptæ¨¡å—ï¼Œè€Œä¸”è¿™æ ·åšå¯ä»¥æé«˜ç«™ç‚¹çš„åŠ è½½å’Œè¿è¡Œæ—¶æ€§èƒ½ã€‚ ä»¥ä¸‹æ˜¯å¿«é€Ÿå®Œæˆæ­¤å·¥ä½œæ‰€éœ€æ­¥éª¤çš„æ‘˜è¦ï¼š ä½¿ç”¨æ‰“åŒ…å™¨ï¼Œä½†è¦ç¡®ä¿è¾“å‡ºæ ¼å¼ä¸ºES2015æ¨¡å— ç§¯æåœ°è¿›è¡Œä»£ç æ‹†åˆ†(å¦‚æœå¯èƒ½çš„è¯ï¼Œä¸€ç›´åˆ°nodeåŒ…) é¢„åŠ è½½é™æ€ä¾èµ–å…³ç³»å›¾ä¸­çš„æ‰€æœ‰æ¨¡å—(é€šè¿‡modulepreload) ä½¿ç”¨polyfillæ¥æ”¯æŒä¸æ”¯æŒåŠ¨æ€import()çš„æµè§ˆå™¨ ä½¿ç”¨&lt;script nomodule&gt;æ”¯æŒæ ¹æœ¬ä¸æ”¯æŒæ¨¡å—çš„æµè§ˆå™¨ å¦‚æœä½ å·²ç»åœ¨æ„å»ºè®¾ç½®ä¸­ä½¿ç”¨äº†Rollupï¼Œæˆ‘å¸Œæœ›ä½ å°è¯•è¿™é‡Œä»‹ç»çš„æŠ€æœ¯ï¼Œå¹¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²åŸç”Ÿæ¨¡å—(å¸¦æœ‰ä»£ç æ‹†åˆ†å’ŒåŠ¨æ€å¯¼å…¥)ã€‚å¦‚æœä½ è¿™æ ·åšäº†ï¼Œè¯·å‘Šè¯‰æˆ‘è¿›å±•å¦‚ä½•ï¼Œå› ä¸ºæˆ‘æ—¢æƒ³å¬ä½ çš„é—®é¢˜ï¼Œä¹Ÿæƒ³å¬ä½ çš„æˆåŠŸæ•…äº‹ï¼ æ¨¡å—æ˜¯JavaScriptçš„æ˜ç¡®æœªæ¥ï¼Œæˆ‘å¸Œæœ›æˆ‘ä»¬æ‰€æœ‰çš„å·¥å…·å’Œä¾èµ–éƒ½èƒ½å°½å¿«åŒ…å«æ¨¡å—ã€‚å¸Œæœ›æœ¬æ–‡èƒ½åœ¨è¿™ä¸ªæ–¹å‘ä¸Šèµ·åˆ°ä¸€ç‚¹æ¨åŠ¨ä½œç”¨ã€‚ è¯‘è€…è¯„ï¼š1.ä½œè€…ä¸Šä¸€ç¯‡æ–‡ç« çš„è¯‘æ–‡ï¼šhttps://jdc.jd.com/archives/49112.å¦å¤–ä¸€ç¯‡è®²JavaScriptåŸç”Ÿæ¨¡å—çš„æ–‡ç« ï¼šhttps://www.jianshu.com/p/9aae3884b05b","link":"/2019/09/10/ã€è¯‘ã€‘åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨åŸç”ŸJavaScriptæ¨¡å—/"},{"title":"æ‰‹æŠŠæ‰‹æ•™ä½ å†™webpack loader","text":"ä½œè€…ï¼šé»„æµ©ç¾¤ ä¸€ã€ä»€ä¹ˆæ˜¯ loaderloader å’Œ plugins æ˜¯ webpack ç³»ç»Ÿçš„ä¸¤å¤§é‡è¦ç»„æˆå…ƒç´ ã€‚ä¾é å¯¹ loaderã€plugins çš„ä¸åŒç»„åˆæ­é…ï¼Œæˆ‘ä»¬å¯ä»¥çµæ´»å®šåˆ¶å‡ºé«˜åº¦é€‚é…è‡ªèº«ä¸šåŠ¡çš„æ‰“åŒ…æ„å»ºæµç¨‹ã€‚ loader æ˜¯ webpack å®¹çº³å„ç±»èµ„æºçš„ä¸€ä¸ªé‡è¦æ‰‹æ®µï¼Œå®ƒç”¨äºå¯¹æ¨¡å—çš„æºä»£ç è¿›è¡Œè½¬æ¢ï¼Œå…è®¸ä½ åœ¨ import æˆ–åŠ è½½æ¨¡å—æ—¶é¢„å¤„ç†æ–‡ä»¶ï¼Œåˆ©ç”¨ loaderï¼Œæˆ‘ä»¬å¯ä»¥å°†å„ç§ç±»å‹çš„èµ„æºè½¬æ¢æˆ webpack æœ¬è´¨æ¥å—çš„èµ„æºç±»å‹ï¼Œå¦‚ javascriptã€‚ äºŒã€å¦‚ä½•ç¼–å†™ä¸€ä¸ª yaml-loader1ã€YAMLyaml è¯­è¨€å¤šç”¨äºç¼–å†™é…ç½®æ–‡ä»¶ï¼Œç»“æ„ä¸ JSON ç±»ä¼¼ï¼Œä½†è¯­æ³•æ ¼å¼æ¯” JSON æ›´åŠ æ–¹ä¾¿ç®€æ´ã€‚yaml æ”¯æŒæ³¨é‡Šï¼Œå¤§å°å†™æ•æ„Ÿï¼Œä½¿ç”¨ç¼©è¿›æ¥è¡¨ç¤ºå±‚çº§å…³ç³»ï¼š 123456789101112131415161718192021#å¯¹è±¡ version: 1.2.4#æ•°ç»„author: - Mike - Hankle#å¸¸é‡name: \"my project\" #å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²limit: 30 #å®šä¹‰ä¸€ä¸ªæ•°å€¼es6: true #å®šä¹‰ä¸€ä¸ªå¸ƒå°”å€¼openkey: Null #å®šä¹‰ä¸€ä¸ªnull#é”šç‚¹å¼•ç”¨server: base: &amp;base port: 8005 dev: ip: 120.168.117.21 &lt;&lt;: *base gamma: ip: 120.168.117.22 &lt;&lt;: *base ç­‰åŒäºï¼š 123456789101112131415161718192021{ \"version\": \"1.2.4\", \"author\": [\"Mike\", \"Hankle\"], \"name\": \"my project\", \"limit\": 30, \"es6\": true, \"openkey\": null, \"server\": { \"base\": { \"port\": 8005 }, \"dev\": { \"ip\": \"120.168.117.21\", \"port\": 8005 }, \"gamma\": { \"ip\": \"120.168.117.22\", \"port\": 8005 } }} åœ¨åŸºäº webpack æ„å»ºçš„åº”ç”¨ä¸­ï¼Œå¦‚æœå¸Œæœ›èƒ½å¤Ÿå¼•ç”¨ yaml æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œå°±éœ€è¦ä¸€ä¸ª yaml-loader æ¥æ”¯æŒç¼–è¯‘ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½ éƒ½èƒ½åœ¨ npm ä¸Šæ‰¾åˆ°å¯ç”¨çš„ loaderï¼Œä½†å¦‚æœä¸‡ä¸€æ²¡æœ‰å¯¹åº”çš„æ”¯æŒï¼Œæˆ–è€…ä½ å¸Œæœ›æœ‰ä¸€äº›è‡ªå®šä¹‰çš„è½¬æ¢ï¼Œé‚£ä¹ˆå°±éœ€è¦è‡ªå·±ç¼–å†™ä¸€ä¸ª webpack loader äº†ã€‚ 2ã€loader çš„åŸç†loader æ˜¯ä¸€ä¸ª node æ¨¡å—ï¼Œå®ƒå¯¼å‡ºä¸ºä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºåœ¨è½¬æ¢èµ„æºæ—¶è°ƒç”¨ã€‚è¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ª String/Buffer ç±»å‹çš„å…¥å‚ï¼Œå¹¶è¿”å›ä¸€ä¸ª String/Buffer ç±»å‹çš„è¿”å›å€¼ã€‚ä¸€ä¸ªæœ€ç®€å•çš„ loader æ˜¯è¿™æ ·çš„ï¼š 1234// loaders/yaml-loader.jsmodule.exports = function(source) { return source;}; loader æ”¯æŒç®¡é“å¼ä¼ é€’ï¼Œå¯¹åŒä¸€ç±»å‹çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ª loader è¿›è¡Œå¤„ç†ï¼Œè¿™æ‰¹ loader å°†æŒ‰ç…§â€œä»ä¸‹åˆ°ä¸Šã€ä»å³åˆ°å·¦â€çš„é¡ºåºæ‰§è¡Œï¼Œå¹¶ä»¥å‰ä¸€ä¸ª loader çš„è¿”å›å€¼ä½œä¸ºåä¸€ä¸ª loader çš„å…¥å‚ã€‚è¿™ä¸ªæœºåˆ¶æ— éæ˜¯å¸Œæœ›æˆ‘ä»¬åœ¨ç¼–å†™ loader çš„æ—¶å€™èƒ½å¤Ÿå°½é‡é¿å…é‡å¤é€ è½®å­ï¼Œåªå…³æ³¨éœ€è¦å®ç°çš„æ ¸å¿ƒåŠŸèƒ½ã€‚å› æ­¤é…ç½®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥ json-loaderï¼š 123456789101112131415161718192021// webpack.config.jsconst path = require(\"path\");module.exports = { // ... module: { rules: [ { test: /\\.yml$/, use: [ { loader: \"json-loader\" }, { loader: path.resolve(__dirname, \"./loaders/yaml-loader.js\") } ] } ] }}; 3ã€å¼€å§‹è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬éœ€è¦çš„ yaml-loaderï¼Œå°±åªåšä¸€ä»¶äº‹æƒ…ï¼šå°† yaml çš„æ•°æ®è½¬åŒ–æˆä¸ºä¸€ä¸ª JSON å­—ç¬¦ä¸²ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆç®€å•åœ°å®ç°è¿™æ ·ä¸€ä¸ª yaml-loaderï¼š 123456789101112var yaml = require(\"js-yaml\");module.exports = function(source) { this.cacheable &amp;&amp; this.cacheable(); try { var res = yaml.safeLoad(source); return JSON.stringify(res, undefined, \"\\t\"); } catch (err) { this.emitError(err); return null; }}; å°±æ˜¯è¿™ä¹ˆç®€å•ã€‚ä½†æ˜¯å¯èƒ½æœ‰æœ‹å‹ä¼šé—®ï¼Œè¿™é‡Œæ˜¯å› ä¸ºæœ‰ä¸ªç°æˆçš„æ¨¡å— js-yamlï¼Œå¯ä»¥ç›´æ¥å°† yaml è½¬æ¢æˆ JavaScript å¯¹è±¡ï¼Œä¸‡ä¸€æ²¡æœ‰è¿™ä¸ªæ¨¡å—ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿæ˜¯çš„ï¼Œloader çš„æ ¸å¿ƒå·¥ä½œå…¶å®å°±æ˜¯å­—ç¬¦ä¸²çš„å¤„ç†ï¼Œè¿™æ˜¯ä¸ªç›¸å½“æ¶å¿ƒçš„æ´»å„¿ï¼Œå°¤å…¶æ˜¯åœ¨è¿™ç±»è¯­æ³•è½¬æ¢çš„åœºæ™¯ä¸Šï¼Œå¯¹æºä»£ç çš„å­—ç¬¦ä¸²å¤„ç†å°†å˜å¾—æå…¶å¤æ‚ã€‚è¿™ä¸ªæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å¦å¤–ä¸€ç§è§£æ³•ï¼Œå€ŸåŠ© AST è¯­æ³•æ ‘ï¼Œæ¥ååŠ©æˆ‘ä»¬æ›´åŠ ä¾¿æ·åœ°æ“ä½œè½¬æ¢ã€‚ 4ã€åˆ©ç”¨ AST ä½œæºç è½¬æ¢yaml-ast-parser æ˜¯ä¸€ä¸ªå°† yaml è½¬æ¢æˆ AST è¯­æ³•æ ‘çš„ node æ¨¡å—ï¼Œæˆ‘ä»¬æŠŠå­—ç¬¦ä¸²è§£æçš„å·¥ä½œäº¤ç»™äº† AST parserï¼Œè€Œæ“ä½œ AST è¯­æ³•æ ‘è¿œæ¯”æ“ä½œå­—ç¬¦ä¸²è¦ç®€å•ã€æ–¹ä¾¿å¾—å¤šï¼š 1234567891011121314151617181920212223const yaml = require(\"yaml-ast-parser\");class YamlParser { constructor(source) { this.data = yaml.load(source); this.parse(); } parse() { // parse ast into javascript object }}module.exports = function(source) { this.cacheable &amp;&amp; this.cacheable(); try { const parser = new YamlParser(source); return JSON.stringify(parser.data, undefined, \"\\t\"); } catch (err) { this.emitError(err); return null; }}; è¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ AST parser æä¾›çš„æ–¹æ³•ç›´æ¥è½¬åŒ–å‡º jsonï¼Œå¦‚æœæ²¡æœ‰æˆ–è€…æœ‰æ‰€å®šåˆ¶ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨å®ç°ä¸€ä¸‹ parse çš„è¿‡ç¨‹ï¼Œä»…ä»…åªæ˜¯ä¸€ä¸ªæ ‘ç»“æ„çš„è¿­ä»£éå†è€Œå·²ï¼Œå…³é”®æ­¥éª¤æ˜¯å¯¹ AST è¯­æ³•æ ‘çš„å„ç±»å‹èŠ‚ç‚¹åˆ†åˆ«è¿›è¡Œå¤„ç†ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061const yaml = require(\"yaml-ast-parser\");const types = yaml.Kind;class YamlParser { // ... parse() { this.data = this.traverse(this.data); } traverse(node) { const type = types[node.kind]; switch (type) { // å¯¹è±¡ case \"MAP\": { const ret = {}; node.mappings.forEach(mapping =&gt; { Object.assign(ret, this.traverse(mapping)); }); return ret; } // é”®å€¼å¯¹ case \"MAPPING\": { let ret = {}; // éªŒè¯ const keyValid = yaml.determineScalarType(node.key) == yaml.ScalarType.string; if (!keyValid) { throw Error(\"é”®å€¼éæ³•\"); } if (node.key.value == \"&lt;&lt;\" &amp;&amp; types[node.value.kind] === \"ANCHOR_REF\") { // å¼•ç”¨åˆå¹¶ ret = this.traverse(node.value); } else { ret[node.key.value] = this.traverse(node.value); } return ret; } // å¸¸é‡ case \"SCALAR\": { return node.valueObject !== undefined ? node.valueObject : node.value; } // æ•°ç»„ case \"SEQ\": { const ret = []; node.items.forEach(item =&gt; { ret.push(this.traverse(item)); }); return ret; } // é”šç‚¹å¼•ç”¨ case \"ANCHOR_REF\": { return this.traverse(node.value); } default: throw Error(\"unvalid node\"); } }}// ... å½“ç„¶è¿™æ ·çš„å®ç°ç•¥ä¸ºç²—ç³™ï¼Œæ­£å¸¸æ¥è¯´ï¼Œä¸€äº›å®Œå¤‡çš„ AST parser ä¸€èˆ¬éƒ½ä¼šè‡ªå¸¦éå†æ–¹æ³•ï¼ˆtraverseï¼‰ï¼Œè¿™æ ·çš„æ–¹æ³•éƒ½æ˜¯æœ‰åšè¿‡ä¼˜åŒ–çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œå°½é‡é¿å…è‡ªå·±æ‰‹åŠ¨å®ç°ã€‚ æŒ‰ç…§ç›¸åŒçš„åšæ³•ï¼Œä½ è¿˜å¯ä»¥å®ç°ä¸€ä¸ª markdown-loaderï¼Œç”šè‡³æ›´ä¸ºå¤æ‚çš„ vue-loaderã€‚ ä¸‰ã€loader çš„ä¸€äº›å¼€å‘æŠ€å·§1ã€å•ä¸€ä»»åŠ¡åªåšä¸€ä»¶äº‹æƒ…ï¼Œåšå¥½ä¸€ä»¶äº‹æƒ…ã€‚loader çš„ç®¡é“ï¼ˆpipelineï¼‰è®¾è®¡æ­£æ˜¯å¸Œæœ›èƒ½å¤Ÿå°†ä»»åŠ¡æ‹†è§£å¹¶ç‹¬ç«‹æˆä¸€ä¸ªä¸ªå­ä»»åŠ¡ï¼Œç”±å¤šä¸ª loader åˆ†åˆ«å¤„ç†ï¼Œä»¥æ­¤æ¥ä¿è¯æ¯ä¸ª loader çš„å¯å¤ç”¨æ€§ã€‚å› æ­¤æˆ‘ä»¬åœ¨å¼€å‘ loader å‰ä¸€å®šè¦å…ˆç»™ loader ä¸€ä¸ªå‡†ç¡®çš„åŠŸèƒ½å®šä½ï¼Œä»é€šç”¨çš„è§’åº¦å‡ºå‘å»è®¾è®¡ï¼Œé¿å…åšå¤šä½™çš„äº‹ã€‚ 2ã€æ— çŠ¶æ€loader åº”è¯¥æ˜¯ä¸ä¿å­˜çŠ¶æ€çš„ã€‚è¿™æ ·çš„å¥½å¤„ä¸€æ–¹é¢æ˜¯ä½¿æˆ‘ä»¬ loader ä¸­çš„æ•°æ®æµç®€å•æ¸…æ™°ï¼Œå¦ä¸€æ–¹é¢æ˜¯ä¿è¯ loader å…·æœ‰è‰¯å¥½å¯æµ‹æ€§ã€‚å› æ­¤æˆ‘ä»¬çš„ loader æ¯æ¬¡è¿è¡Œéƒ½ä¸åº”è¯¥ä¾èµ–äºè‡ªèº«ä¹‹å‰çš„ç¼–è¯‘ç»“æœï¼Œä¹Ÿä¸åº”è¯¥é€šè¿‡é™¤å‡ºå…¥å‚å¤–çš„å…¶ä»–æ–¹å¼ä¸å…¶ä»–ç¼–è¯‘æ¨¡å—è¿›è¡Œæ•°æ®äº¤æµã€‚å½“ç„¶ï¼Œè¿™å¹¶ä¸ä»£è¡¨ loader å¿…é¡»æ˜¯ä¸€ä¸ªæ— ä»»ä½•å‰¯ä½œç”¨çš„çº¯å‡½æ•°ï¼Œloader æ”¯æŒå¼‚æ­¥ï¼Œå› æ­¤æ˜¯å¯ä»¥åœ¨ loader ä¸­æœ‰ I/O æ“ä½œçš„ã€‚ 3ã€å°½å¯èƒ½ä½¿ç”¨ç¼“å­˜åœ¨å¼€å‘æ—¶ï¼Œloader å¯èƒ½ä¼šè¢«ä¸æ–­åœ°æ‰§è¡Œï¼Œåˆç†çš„ç¼“å­˜èƒ½å¤Ÿé™ä½é‡å¤ç¼–è¯‘å¸¦æ¥çš„æˆæœ¬ã€‚loader æ‰§è¡Œæ—¶é»˜è®¤æ˜¯å¼€å¯ç¼“å­˜çš„ï¼Œè¿™æ ·ä¸€æ¥ï¼Œ webpack åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­æ‰§è¡Œåˆ°åˆ¤æ–­æ˜¯å¦éœ€è¦é‡ç¼–è¯‘ loader å®ä¾‹çš„æ—¶å€™ï¼Œä¼šç›´æ¥è·³è¿‡ rebuild ç¯èŠ‚ï¼ŒèŠ‚çœä¸å¿…è¦é‡å»ºå¸¦æ¥çš„å¼€é”€ã€‚ å½“ä¸”ä»…å½“æœ‰ä½ çš„ loader æœ‰å…¶ä»–ä¸ç¨³å®šçš„å¤–éƒ¨ä¾èµ–ï¼ˆå¦‚ I/O æ¥å£ä¾èµ–ï¼‰æ—¶ï¼Œå¯ä»¥å…³é—­ç¼“å­˜ï¼š 1this.cacheable &amp;&amp; this.cacheable(false);","link":"/2019/09/17/æ‰‹æŠŠæ‰‹æ•™ä½ å†™webpack-loader/"},{"title":"å‰ç«¯èµ„æºæ²»ç†ï¼ˆä¸€ï¼‰","text":"ä½œè€…ï¼šæåˆšæ¾ 0.ä¹Ÿè°ˆå‰ç«¯å·¥ç¨‹åŒ–éšç€å‰ç«¯æŠ€æœ¯çš„é£é€Ÿå‘å±•ï¼Œå‰ç«¯éœ€è¦ä¸€ç§æ›´åŠ å·¥ç¨‹åŒ–çš„æ–¹å¼è§£å†³å‰ç«¯å¼€å‘æ—¥ç›Šå¤æ‚çš„é—®é¢˜ã€‚å‰ç«¯å·¥ç¨‹åŒ–æœ¬è´¨ä¹Ÿæ˜¯è½¯ä»¶å·¥ç¨‹çš„ä¸€ç§ï¼Œç”±äºè½¯ä»¶å·¥ç¨‹å¹¶æ— ä¸¥æ ¼çš„å®šä¹‰(æˆ–è€…è¯´ç¼ºä¹ç»Ÿä¸€çš„å®šä¹‰)ï¼Œå› æ­¤å‰ç«¯å·¥ç¨‹åŒ–çš„å†…æ¶µå…¶å®ç›¸å½“å®½æ³›ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå‰ç«¯å·¥ç¨‹åŒ–é‡ç‚¹å…³æ³¨çš„æ˜¯ç ”å‘å’Œç»´æŠ¤æ•ˆç‡ï¼Œæ‰€æœ‰æœ€ç»ˆç›®çš„æ˜¯è¿™ä¸ªçš„ï¼Œéƒ½å¯ä»¥ç®—ä½œå‰ç«¯å·¥ç¨‹åŒ–çš„èŒƒç•´ã€‚å‰ç«¯å·¥ç¨‹åŒ–è¿‘å‡ å¹´ä¹Ÿæ˜¯æŠ€æœ¯çƒ­ç‚¹ï¼ŒåŸºæœ¬ä¸Šå¤§å‹å‰ç«¯æŠ€æœ¯äº¤æµä¼šè®®éƒ½æœ‰æ­¤ä¸“é¢˜ï¼Œä»è§„èŒƒã€ç»„ä»¶ã€ç¼–è¯‘åŠæ„å»ºã€å·¥ä½œæµã€æŒç»­é›†æˆã€ç›‘æ§ç­‰å¤šä¸ªç»´åº¦éƒ½æœ‰æ¶‰åŠï¼Œç¬”è€…å°è¯•ä»å‰ç«¯èµ„æºæ²»ç†çš„è§’åº¦è°ˆä¸€ä¸‹å‰ç«¯å·¥ç¨‹åŒ–,æœ¬æ–‡æ˜¯ç³»åˆ—æ–‡ç« çš„ç¬¬ä¸€ç¯‡ï¼Œä¸»è¦è®²é—®é¢˜åŠè§£å†³çš„æ€è·¯ï¼Œä¸æ¶‰åŠå…·ä½“çš„å®ç°ç»†èŠ‚ã€‚ 1.å‰ç«¯èµ„æºæ²»ç†çš„å«ä¹‰é¦–å…ˆï¼Œè¿™é‡Œæ‰€è¯´çš„å‰ç«¯èµ„æºï¼Œå¹¶éæ˜¯ä»…æŒ‡jsã€cssã€å›¾ç‰‡ç­‰é™æ€èµ„æºï¼Œé¡µé¢ã€åç«¯æ¥å£ã€é…ç½®æ•°æ®ã€ç›‘æ§ç‚¹ç­‰ï¼Œéƒ½å¯ä»¥çº³å…¥å‰ç«¯èµ„æºçš„å®šä¹‰çš„èŒƒç•´ã€‚ åœ¨å·¥ä½œä¸­ï¼Œä½ æ˜¯å¦ä¼šç¢°åˆ°ä»¥ä¸‹é—®é¢˜ï¼š åŒäº‹æˆ–è€…é¢†å¯¼å‘ç°æŸä¸ªé¡µé¢æœ‰bugï¼Œéœ€è¦åœ¨å¾®ä¿¡ç¾¤æˆ–è€…å†…éƒ¨æ²Ÿé€šå·¥å…·å¤§ç¾¤é‡Œé—®æ˜¯è°è´Ÿè´£ï¼Ÿå¯èƒ½è¿˜è¦æŒ¨ä¸ªè‰¾ç‰¹å„ä¸ªTLï¼Œéœ€è¦å„ä¸ªTLç¡®è®¤ã€‚ æŸä¸ªç»„ä»¶è¦å‡çº§ï¼Œä½†æ˜¯ä¸çŸ¥é“é‚£äº›é¡µé¢ä½¿ç”¨äº†ï¼Œéœ€è¦åœ¨æ²Ÿé€šç¾¤é‡Œé—®æˆ–è€…æœé¡¹ç›®æºä»£ç ï¼Œé€ä¸ªæ‰¾åˆ°è´Ÿè´£äººã€‚ æŸä¸ªå¤§å‹è¥é”€æ´»åŠ¨çªç„¶è¦æ¢ä¸€ä¸ªæ–°çš„æ°›å›´logoï¼Œä½†æ˜¯ä¸çŸ¥é“å“ªäº›é¡µé¢ä½¿ç”¨äº†æ—§logoï¼Œéœ€è¦å®‰æ’å·¡æ£€ï¼Œäººè‚‰å»æ‰¾å‡ºæ¥ã€‚ å‘Šè­¦å‘ç°æŸä¸ªé‡è¦é¡µé¢çš„å‡ºç°äº†å†…å®¹ç©ºçª—ï¼ŒåŸå› æ˜¯è¿è¥åŒå­¦æ²¡æœ‰åŠæ—¶è¡¥å……è¿è¥æ•°æ®ï¼Œä½†æ˜¯ä¸çŸ¥é“æ˜¯å“ªä¸ªè¿è¥è´Ÿè´£ï¼Œéœ€è¦åœ¨å¾®ä¿¡å¤§ç¾¤æˆ–è€…å†…éƒ¨æ²Ÿé€šå·¥å…·å¤§ç¾¤é‡Œé—®ã€‚ å¤§ä¿ƒæ¥ä¸´ï¼ŒæŸä¸ªé‡è¦é¡µé¢çš„æµé‡é¢„è®¡æœ‰10å€æˆ–è€…20å€çš„å¢é•¿ï¼Œè¦é€šçŸ¥å„ä¸ªæ¥å£çš„åŒå­¦åšæ‰©å®¹å’Œå®¹ç¾å‡†å¤‡ï¼Œéœ€è¦æ‰‹å·¥æ¢³ç†é¡µé¢çš„ä¾èµ–çš„æ¥å£åˆ—è¡¨ã€‚ æŸä¸ªé™æ—¶çš„é¡µé¢å·²ç»åˆ°ç‚¹ä¸‹çº¿ï¼Œä½†æ˜¯ä»ç„¶æœ‰æµé‡ï¼Œä¸çŸ¥é“æµé‡å…¥å£åœ¨å“ªé‡Œã€‚ æˆ‘è¦åœ¨ç»Ÿè®¡ç³»ç»Ÿä¸ŠæŸ¥çœ‹æŸä¸ªé¡µé¢çš„æ€§èƒ½æ•°æ®ï¼Œä½†æ˜¯è¯¥ç³»ç»Ÿæ˜¯ä»¥é¡µé¢åå­—è€Œä¸æ˜¯åœ°å€æ¥æŸ¥æ‰¾çš„ï¼ŒæŸ¥æ‰¾è¿‡ç¨‹æ‰¾çš„äººè€çœ¼æ˜èŠ±ã€‚ æŸä¸ªåç«¯æ¥å£è¦å‡çº§æˆ–è€…è¦ä¸‹çº¿ï¼Œéœ€è¦åˆ†ænginxçš„è®¿é—®æ—¥å¿—æ‰¾åˆ°é¡µé¢åœ°å€ï¼Œç„¶åå†æ‹‰å„ä¸ªTLï¼Œé€ä¸ªç¡®è®¤éƒ½æ˜¯å“ªäº›åŒäº‹è´Ÿè´£ã€‚ ç­‰ç­‰ç­‰ ä¸Šé¢çš„é—®é¢˜ä¸€èˆ¬æ˜¯å¤§å‹å¤æ‚ä¸šåŠ¡åœºæ™¯ï¼ˆé€šå¸¸æ˜¯å¤šä¸ªå›¢é˜Ÿåˆä½œå¼€å‘ï¼Œä¸šåŠ¡å¤æ‚ï¼Œé¡µé¢æˆç™¾ä¸Šåƒç”šè‡³ä¸Šä¸‡ï¼‰ä¸‹æ‰æœ‰çš„ï¼Œå¦‚æœä½ æ‰€åœ¨çš„å›¢é˜Ÿä¹Ÿæœ‰ä¸Šé¢çš„é—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘è®¤ä¸ºä½ ä¹Ÿéœ€è¦å¯¹å‰ç«¯çš„èµ„æºè¿›è¡Œæ²»ç†ã€‚ é‚£ä¹ˆä»€ä¹ˆæ˜¯å‰ç«¯èµ„æºæ²»ç†å‘¢ï¼Ÿç¬”è€…å¯¹å…¶çš„å®šä¹‰æ˜¯ï¼š å°†å‰ç«¯ç›¸å…³çš„é¡µé¢ã€js/css/å›¾ç‰‡/å­—ä½“ã€æ¥å£ã€é…ç½®ã€ç›‘æ§ç‚¹ç­‰çš„ä¾èµ–å…³ç³»è¿›è¡Œæ”¶é›†ã€å­˜å‚¨å’Œç®¡ç†ï¼Œå¹¶å°†å‰²è£‚çš„ç»„ä»¶ç³»ç»Ÿã€é…ç½®ç³»ç»Ÿã€ç›‘æ§ç³»ç»Ÿã€ä¸šåŠ¡ç³»ç»Ÿç­‰è¿›è¡Œé‡æ„å’Œæ•´åˆï¼Œæœ€ç»ˆå½¢æˆä»¥é¡µé¢ç®¡ç†ä¸ºåŸºç¡€çš„ç»Ÿä¸€çš„æœ‰åºçš„å¹³å°ï¼Œæ‰€æœ‰å…³è”ä¿¡æ¯éƒ½èƒ½å¤Ÿè¢«æŸ¥è¯¢å’Œæ£€ç´¢ï¼Œæœ€ç»ˆå®ç°æ•´ä½“åä½œæ•ˆç‡çš„æå‡ã€‚ æ­¤å¤„ä½¿ç”¨â€œæ²»ç†â€è€Œä¸æ˜¯â€œç®¡ç†â€çš„åŸå› ï¼Œâ€œæ²»ç†â€ä¸€è¯æ›´å¼ºè°ƒåˆä½œæ•´æ”¹çš„è¿‡ç¨‹ã€‚åœ¨å¾ˆå¤šäº’è”ç½‘ä¼ä¸šï¼Œé€šå¸¸å·²ç»æœ‰ä¸€äº›ç‹¬ç«‹çš„ç»„ä»¶ç³»ç»Ÿã€é…ç½®ç³»ç»Ÿã€ç›‘æ§ç³»ç»Ÿç­‰ï¼Œä½†æ˜¯è¿™äº›ç³»ç»Ÿå¾ˆå¤šéƒ½æ˜¯ç‹¬ç«‹çš„ç¢ç‰‡åŒ–çš„ç³»ç»Ÿï¼Œå½¼æ­¤éƒ½æ˜¯å‰²è£‚çš„ï¼Œå‰²è£‚æ„å‘³ç€ç¼ºä¹ååŒï¼Œè¿›è€Œå½±å“ç ”å‘æ•ˆç‡ã€‚å› æ­¤ï¼Œå‰ç«¯èµ„æºæ²»ç†çš„ä¸€ä¸ªå…³é”®è¯æ˜¯â€œæ•´åˆâ€ï¼Œæ•´åˆå·²æœ‰çš„ç³»ç»Ÿã€‚ ç¬¬äºŒä¸ªå…³é”®è¯æ˜¯â€œå…³è”å…³ç³»ç®¡ç†â€ï¼Œå‰ç«¯ç›¸å…³çš„é¡µé¢ã€ç»„ä»¶ã€js/css/å›¾ç‰‡/å­—ä½“ã€æ¥å£ã€é…ç½®ã€ç›‘æ§ç‚¹åŠè´Ÿè´£äººç­‰ï¼Œä»–ä»¬æ˜¯å­˜åœ¨å…³è”å…³ç³»çš„ï¼Œæ¯”å¦‚é¡µé¢æ˜¯è°è´Ÿè´£çš„ã€è°ä¿®æ”¹çš„ã€å¼•ç”¨äº†å“ªäº›ç»„ä»¶ã€å›¾ç‰‡ã€å­—ä½“ã€æ¥å£ã€åœ¨ä»€ä¹ˆåœ°æ–¹é…ç½®æ•°æ®ã€ç›‘æ§ç‚¹éƒ½æœ‰å“ªäº›ç­‰ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™äº›å…³è”å…³ç³»åœ¨ç®¡ç†ç«¯è®°å½•ä¸‹æ¥ï¼Œå¹¶æä¾›æ£€ç´¢å’ŒæŸ¥è¯¢ã€‚ 2.å‰ç«¯èµ„æºæ²»ç†çš„å®ç°å‰ç«¯èµ„æºä¿¡æ¯çœ‹ä¼¼ç¹æ‚ï¼Œjsã€cssã€å›¾ç‰‡ã€é¡µé¢ã€åç«¯æ¥å£ã€é…ç½®æ•°æ®ã€ç›‘æ§ç‚¹ç­‰ï¼Œä½†æ˜¯ä»–ä»¬æœ‰ä¸€ä¸ªä¸²è”çš„é”šç‚¹ï¼Œè¿™ä¸ªé”šç‚¹å°±æ˜¯é¡µé¢ï¼Œä¸ç®¡æ˜¯H5ã€å°ç¨‹åºï¼Œè¿˜æ˜¯åŸç”ŸAPPï¼Œä¸ç®¡æ˜¯ä»ç ”å‘çš„è§’åº¦ï¼Œè¿˜æ˜¯ä»åé¦ˆé—®é¢˜çš„è§’åº¦ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ä»¥é¡µé¢ä¸ºå•ä½è¿›è¡Œçš„ï¼Œå…¶ä»–çš„å¦‚ç»„ä»¶ã€CSSã€å›¾ç‰‡ã€æ¥å£ã€é…ç½®ç­‰ï¼Œéƒ½æ˜¯è¢«é¡µé¢å¼•ç”¨çš„ï¼Œéƒ½å¯ä»¥é€šè¿‡é¡µé¢ä¸²è”èµ·æ¥çš„ï¼Œä¸‹å›¾å¯ä»¥æ¸…æ™°çš„è¡¨è¾¾å‡ºè¿™äº›ä¾èµ–å…³ç³»ã€‚ å› æ­¤ï¼Œå®ç°å‰ç«¯èµ„æºæ²»ç†çš„ç¬¬ä¸€ä¸ªè¦ç‚¹æ˜¯åšå¥½é¡µé¢ç®¡ç†ï¼ŒæŠŠé¡µé¢è‡ªèº«çš„ä¿¡æ¯ï¼Œå¦‚é¡µé¢åç§°ã€é¡µé¢åœ°å€ã€è´Ÿè´£äººã€ä¿®æ”¹æ—¶é—´ç­‰ä¿¡æ¯è¿›è¡Œæå–ã€å­˜å‚¨,ä½¿ä¹‹èƒ½å¤Ÿè¢«æŸ¥è¯¢å’Œæ£€ç´¢ã€‚åœ¨é¡µé¢ç®¡ç†åŸºç¡€ä¹‹ä¸Šï¼Œæˆ‘ä»¬è¿˜è¦æŠŠjsã€cssã€å›¾ç‰‡ã€é¡µé¢ã€åç«¯æ¥å£ã€é…ç½®æ•°æ®ã€ç›‘æ§ç‚¹ç­‰å„ä¸ªå‰ç«¯èµ„æºä¹‹é—´çš„å…³è”å…³ç³»ä¹Ÿè¦å­˜å‚¨å’Œç®¡ç†èµ·æ¥ï¼Œä½¿ä¹‹èƒ½å¤Ÿè¢«æŸ¥è¯¢å’Œæ£€ç´¢ã€‚ å…³è”å…³ç³»ä»æ¥æºä¸Šè®²ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ¥æºï¼š ä»£ç é™æ€åˆ†æäº§ç”Ÿã€‚é€šå¸¸åŒ…æ‹¬é¡µé¢ä¿¡æ¯è‡ªèº«ã€é¡µé¢è·Ÿjs/css/å›¾ç‰‡ç­‰çš„ä¾èµ–å…³ç³»ã€é¡µé¢è·Ÿæ¥å£çš„ä¾èµ–å…³ç³»ç­‰ã€‚ ç®¡ç†ç«¯é…ç½®äº§ç”Ÿã€‚é€šå¸¸åŒ…æ‹¬é¡µé¢è·Ÿç›‘æ§ç³»ç»Ÿçš„é…ç½®ã€é¡µé¢çš„è¿è¥é…ç½®æ•°æ®ç­‰ ç»Ÿè®¡æ•°æ®äº§ç”Ÿã€‚é€šå¸¸åŒ…æ‹¬é¡µé¢æ¥æºæ•°æ®ç­‰ã€‚ 2.1 é¡µé¢ä¿¡æ¯çš„æå–å‰ç«¯èµ„æºæ²»ç†çš„ç¬¬ä¸€è¦ç‚¹æ˜¯é¡µé¢ä¿¡æ¯ç®¡ç†ï¼Œå› æ­¤å¿…é¡»èƒ½å¤Ÿæ‹¿åˆ°é¡µé¢åŸºæœ¬ä¿¡æ¯ã€‚é¡µé¢åŸºæœ¬ä¿¡æ¯åº”è¯¥åŒ…æ‹¬å“ªäº›å‘¢ï¼Ÿé€šå¸¸æ¥è¯´ï¼Œè‡³å°‘åº”è¯¥åŒ…æ‹¬é¡µé¢URLã€é¡µé¢åç§°ã€é¡µé¢åˆ›å»ºäººã€åˆ›å»ºæ—¶é—´ç­‰å‡ ä¸ªå­—æ®µã€‚ å½“å‰çš„å‰ç«¯é¡µé¢å¼€å‘ï¼Œä¸ç®¡æ˜¯H5ã€å°ç¨‹åºï¼Œè¿˜æ˜¯åŸç”ŸAPPï¼Œé€šå¸¸ä¼šç»è¿‡ç¼–è¯‘æ„å»ºçš„è¿‡ç¨‹ï¼ˆé€šå¸¸æ˜¯å‘½ä»¤è¡Œå·¥å…·æˆ–è€…IDEï¼Œæ¯”å¦‚åŸºäºgulpå’Œwebpackçš„å·¥ä½œæµå·¥å…·ï¼‰ï¼Œåœ¨æ„å»ºå®Œæˆé˜¶æ®µå¯ä»¥æå–å‡ºé¡µé¢çš„åŸºæœ¬ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ç¼–è¯‘æ„å»ºæå–é¡µé¢ä¿¡æ¯çš„æµç¨‹ï¼š é¡µé¢çš„ç¼–è¯‘æ„å»ºæµç¨‹ï¼Œä¸€èˆ¬åˆ†ä¸ºä¸¤ç§ï¼š ç‹¬ç«‹æ„å»ºã€‚å¸¸è§äºH5ï¼Œæ­¤ç§åœºæ™¯ä¸€èˆ¬æ˜¯ä¸€ä¸ªäººè´Ÿè´£ä¸€ä¸ªé¡µé¢ï¼Œä¸å­˜åœ¨å¤šäººåä½œçš„æƒ…å†µï¼Œä¹Ÿä¸éœ€è¦gitåˆ†æ”¯ç®¡ç†å•¥çš„ï¼Œå¼€å‘å®Œæˆå³å¯èµ°æ„å»ºæµç¨‹ï¼Œåªéœ€è¦åœ¨æ„å»ºå®Œæˆçš„æ—¶å€™åˆ†æå³å¯ï¼Œé¡µé¢çš„URLã€é¡µé¢æ ‡é¢˜ã€åˆ›å»ºäººã€åˆ›å»ºæ—¶é—´ç­‰ä¿¡æ¯æ¯”è¾ƒå®¹æ˜“æå–ï¼Œæ¯”å¦‚é¡µé¢ä¿®æ”¹äººå¯ä»¥å–è‡ªå‘½ä»¤è¡Œå·¥å…·çš„ç”¨æˆ·ç™»å½•èº«ä»½ï¼ˆå‘½ä»¤è¡Œå·¥å…·å¯ä»¥åšç±»ä¼¼äºNPMçš„loginåŠŸèƒ½ï¼Œç™»å½•åè®°å½•ç”¨æˆ·èº«ä»½IDï¼‰ã€é¡µé¢æ ‡é¢˜å¯ä»¥è§£æé¡µé¢htmlçš„titleçš„å†…å®¹ï¼ˆå°ç¨‹åºä¸‹åˆ™è§£æè‡ªé¡µé¢jsonæ–‡ä»¶çš„navigationBarTitleTextå­—æ®µï¼‰ç­‰ã€‚ æŒç»­é›†æˆæ„å»ºã€‚è¿™ç§ä¸€èˆ¬æ˜¯éœ€è¦å¤šäººåä½œçš„H5ã€å°ç¨‹åºã€åŸç”ŸAPPç­‰ï¼Œä¸€èˆ¬æ¶‰åŠåˆ°åˆ†æ”¯ç®¡ç†å’Œåˆå¹¶çš„é—®é¢˜ï¼ŒåŒä¸€ä¸ªé¡µé¢å¯èƒ½è¢«å¤šäººä¿®æ”¹ï¼Œå› æ­¤é¡µé¢ä¿¡æ¯ä¸­çš„ç”¨æˆ·ä¿¡æ¯éƒ¨åˆ†æå–ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦åˆ†ægit logä¿¡æ¯æ‰èƒ½æ‹¿åˆ°ï¼Œå…¶ä»–çš„ä¿¡æ¯å­—æ®µæå–é€»è¾‘ä¸ç‹¬ç«‹æ„å»ºæƒ…å†µç›¸åŒã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…¸å‹çš„å¤šäººåä½œçš„é¡µé¢çš„git logä¿¡æ¯ã€‚ å¯¹äºä¸Šé¢çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å®šä¸€ä¸ªè§„åˆ™ï¼Œæ¯”å¦‚å–æœ€è¿‘çš„5æ¡logï¼Œå¹¶ç§»é™¤æŒç»­é›†æˆç³»ç»Ÿç”Ÿæˆçš„logï¼Œç®¡ç†ç«¯å­˜å‚¨çš„æ—¶å€™å›ï¼Œä»¥ç”¨æˆ·å+æ—¶é—´ä¸ºkeyï¼Œå»æ‰é‡å¤çš„éƒ¨åˆ†ã€‚ æ„å»ºæµç¨‹åˆ†æå‡ºé¡µé¢åŸºæœ¬ä¿¡æ¯åï¼Œéœ€æäº¤åˆ°ç®¡ç†ç«¯ä¿å­˜ï¼Œæ‰€ä»¥ç®¡ç†ç«¯éœ€è¦æä¾›postæ¥å£ã€‚ç®¡ç†ç«¯ä»¥æ­¤ä¸ºåŸºç¡€ï¼Œå½¢æˆâ€é¡µé¢ç®¡ç†ç³»ç»Ÿâ€œã€‚ 2.2 ä»£ç é™æ€åˆ†æå‡ºçš„å…³è”å…³ç³»æ„å»ºæµç¨‹é™¤å¯ä»¥åˆ†æåŸºæœ¬ä¿¡æ¯å¤–ï¼Œè¿˜å¯ä»¥åˆ†æå‡ºé¡µé¢çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œæ¯”å¦‚é¡µé¢ä¾èµ–çš„ç»„ä»¶ä¾èµ–è¡¨ã€é™æ€èµ„æºä¾èµ–è¡¨(js/css/å›¾ç‰‡)ã€æ¥å£ä¾èµ–è¡¨ã€ä¿®æ”¹äººã€ä¿®æ”¹æ—¶é—´ç­‰ã€‚é™æ€ä¾èµ–åˆ†æé€šå¸¸æœ‰3ç§æ–¹å¼ï¼š åŸºäºASTçš„ä¾èµ–åˆ†æã€‚ASTå°±æ˜¯æŠ½è±¡è¯­æ³•æ ‘ï¼Œç›®å‰å‰ç«¯å¯¹ä»–çš„ç ”ç©¶å’Œä½¿ç”¨è¶Šæ¥è¶Šå¹¿æ³›ï¼Œwebpackå†…éƒ¨å°±ä½¿ç”¨äº†acornè¿™ä¸ªASTåˆ†æåº“ã€‚å€ŸåŠ©äºwebpackå¼ºå¤§çš„æ¨¡å—è§£æå’Œä¾èµ–åˆ†æèƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¿åˆ°jsä¸npmç»„ä»¶ã€cssä¸èƒŒæ™¯å›¾ç­‰ä¹‹é—´çš„å…³è”å…³ç³»ï¼ˆå¯ä»¥åœ¨webpackçš„after-resolveé’©å­ä¸­è¿›è¡Œåˆ†æï¼‰ã€‚å¦å¤–ï¼Œé™¤äº†æ„å»ºå‰çš„ä¾èµ–å…³ç³»ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ‹¿åˆ°æ„å»ºå¤„ç†åçš„èµ„æºä¾èµ–å…³ç³»ï¼ˆå¯ä»¥åœ¨webpacçš„emité’©å­ä¸­è¿›è¡Œåˆ†æï¼‰ï¼Œå‰è€…æˆ‘ä»¬ç§°ä¸ºå¼•ç”¨ä¾èµ–å…³ç³»ï¼ˆåŒ…æ‹¬é™æ€èµ„æºä¾èµ–è¡¨ã€ç»„ä»¶ä¾èµ–è¡¨ï¼‰ï¼Œåè€…æˆ‘ä»¬ç§°ä¸ºå‘å¸ƒä¾èµ–å…³ç³»ã€‚ åŸºäºDOMæ“ä½œçš„ä¾èµ–åˆ†æã€‚webpackå¹¶ä¸æ˜¯ä»¥htmlä¸ºå…¥å£çš„ï¼Œä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬çš„å¼€å‘çš„å…¥å£å¯ä»¥è®¤ä¸ºå°±æ˜¯é¡µé¢ï¼Œå€ŸåŠ©äºJsDomç­‰å¼ºå¤§çš„ç±»åº“ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æˆ‘ä»¬ç†Ÿæ‚‰çš„å‰ç«¯çš„DOMæ“ä½œæ¥åˆ†æhtmlé¡µé¢å¯¹jsã€cssã€å›¾ç‰‡ç­‰çš„ä¾èµ–å…³ç³»ã€‚ åŸºäºæ­£åˆ™åŒ¹é…çš„ä¾èµ–åˆ†æã€‚é¡µé¢å¯¹äºæ¥å£çš„ä¾èµ–åˆ†æï¼Œç”±äºè¿™ç§æ˜¯éæ˜ç¡®çš„ä»£ç ä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥ä¸€èˆ¬é€šè¿‡æ­£åˆ™åŒ¹é…æ¥è§£æã€‚ä¸€èˆ¬å¯¹ä»£ç æœ‰ä¸€å®šçš„çº¦æŸè§„åˆ™ï¼Œæ¯”å¦‚ä¸ç”¨ç”¨å˜é‡æ‹¼æ¥æ¥å£åœ°å€ã€‚è¿™ä¸ªè§£æä¸ä¼šå¦‚ASTé‚£ä¹ˆç²¾ç¡®ï¼Œä½†æ˜¯åªè¦çº¦å®šè§„åˆ™ï¼ŒåŸºæœ¬ä¸Šéƒ½èƒ½æ»¡è¶³éœ€æ±‚ã€‚å¯ä»¥è€ƒè™‘æŠŠæ­¤ç±»å®ç°å°è£…ä¸ºwebpackçš„loaderã€‚ä¸Šé¢çš„ç¬¬ä¸€ç§å’Œç¬¬ä¸‰ç§çš„åˆ†æï¼Œéƒ½åº”è¯¥æ˜¯ä¸€ä¸ªé€’å½’åˆ†æè¿‡ç¨‹ï¼Œæœ€ç»ˆç”Ÿæˆé¡µé¢çš„é™æ€èµ„æºä¾èµ–è¡¨ã€ç»„ä»¶ä¾èµ–è¡¨ã€æ¥å£ä¾èµ–è¡¨ç­‰ã€‚è¿™äº›ä¿¡æ¯æäº¤åˆ°ç®¡ç†ç«¯è¿›è¡Œä¿å­˜ã€‚ 2.3 ç®¡ç†ç³»ç»Ÿä¹‹é—´çš„å…³è”å…³ç³»åœ¨å¾ˆå¤šäº’è”ç½‘ä¼ä¸šï¼Œé€šå¸¸å·²ç»æœ‰ä¸€äº›ç‹¬ç«‹çš„æˆç†Ÿçš„CMSç³»ç»Ÿï¼ˆå¦‚ç»™è¿è¥ç”¨çš„å†…å®¹é…ç½®ç³»ç»Ÿï¼Œé…ç½®æ´»åŠ¨æ—¶é—´ã€å•†å“IDç­‰ï¼‰ã€ç›‘æ§ç³»ç»Ÿï¼ˆå¦‚æµ‹é€Ÿç³»ç»Ÿã€ä¸šåŠ¡ç›‘æ§ç³»ç»Ÿã€å¼‚å¸¸ç›‘æ§ç³»ç»Ÿï¼‰ç­‰ï¼Œé€šå¸¸è¿™äº›ç³»ç»Ÿç”±ä¸åŒçš„å›¢é˜Ÿå¼€å‘ï¼Œè€Œä¸”ç»å¸¸éƒ½æœ‰ä¸€ä¸ªå«åšâ€é¡µé¢ç®¡ç†â€çš„ä¸œè¥¿ï¼Œä¸”è¦æ‰‹å·¥é…ç½®é¡µé¢åœ°å€ã€‚è¿™äº›ç³»ç»Ÿä¸­çš„ç›‘æ§ç‚¹é…ç½®ã€è¿è¥é…ç½®ç­‰ä¿¡æ¯ï¼Œéƒ½æ˜¯ä»¥é¡µé¢ç»´åº¦è¿›è¡Œåˆ›å»ºå’Œä½¿ç”¨çš„ï¼Œä½†æ˜¯è¿™äº›ä¿¡æ¯å¾ˆéš¾é€šè¿‡å¯¹å‰ç«¯ä»£ç é™æ€åˆ†æçš„æ–¹æ³•è¿›è¡Œæå–ï¼ˆæ¯”å¦‚è¿è¥é…ç½®ä¿¡æ¯ï¼Œè¿™ä¸ªå¯ä»¥æ˜¯å‰ç«¯ç›´æ¥ä½¿ç”¨ï¼Œä¹Ÿå¯èƒ½æ˜¯åç«¯ä½¿ç”¨ï¼Œè¦åˆ†æçš„è¯ä¸¤ç«¯ä»£ç éƒ½è¦åˆ†æï¼Œæ¯”è¾ƒéº»çƒ¦ï¼‰ã€‚æˆ‘ä»¬çš„æ€è·¯åº”è¯¥æ˜¯åœ¨ç®¡ç†ç«¯é€šè¿‡é¡µé¢ç®¡ç†æ¥è¿›è¡Œå…³è”ï¼Œå®è´¨ä¸Šæ˜¯è¦åšç³»ç»Ÿæ•´åˆã€‚ æ•´åˆçš„æ€è·¯ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åŸæ¥å„ä¸ªç³»ç»ŸåºŸå¼ƒæ‰åŸæ¥è‡ªèº«çš„â€é¡µé¢ç®¡ç†â€œï¼Œè€Œæ˜¯ä½¿ç”¨å‰é¢é™æ€åˆ†ææå–åˆ°çš„ç»Ÿä¸€çš„é¡µé¢ç®¡ç†ï¼Œç›‘æ§ç³»ç»Ÿã€è¿è¥é…ç½®ç³»ç»Ÿç­‰ç³»ç»Ÿéƒ½å¯ä»¥ä»¥æ­¤ä¸ºå…¥å£è¿›å…¥ï¼Œä»è€ŒæŠŠé¡µé¢ç›¸å…³çš„å„ä¸ªç®¡ç†ç³»ç»Ÿå…³è”èµ·æ¥ï¼Œè¿›è€ŒæŠŠå„ç§èƒ½åŠ›ä¸²è”ã€‚ 2.4 ç»Ÿè®¡æ•°æ®äº§ç”Ÿçš„å…³è”å…³ç³»å¯¹äºå¤§å‹åº”ç”¨æ¥è¯´ï¼Œä¸€èˆ¬éƒ½æœ‰ä¸€äº›ä¸šåŠ¡ç»Ÿè®¡æ•°æ®ï¼Œæœ€å…¸å‹çš„å°±æ˜¯ç‚¹å‡»æµæ•°æ®äº†ã€‚è¿™ç§æ•°æ®æ—¢ä¸åœ¨ä»£ç ä¸­ï¼Œä¹Ÿä¸åœ¨ç®¡ç†ç«¯é…ç½®ï¼Œè€Œä¸”é€šè¿‡ç»Ÿè®¡å’Œåˆ†ææ‰èƒ½æ‹¿åˆ°ã€‚å‰é¢æåˆ°çš„â€œæŸä¸ªé™æ—¶çš„é¡µé¢å·²ç»åˆ°ç‚¹ä¸‹çº¿ï¼Œä½†æ˜¯ä»ç„¶æœ‰æµé‡ï¼Œä¸çŸ¥é“æµé‡å…¥å£åœ¨å“ªé‡Œâ€è¿™ç§é—®é¢˜çš„è§£å†³ï¼Œå…¶å®ä¾èµ–äºç‚¹å‡»æµçš„ç»Ÿè®¡åˆ†ææ•°æ®äº†ï¼Œç‚¹å‡»æµç³»ç»Ÿä¸€èˆ¬éƒ½æœ‰â€œæ¥æºåˆ†æâ€ï¼Œè¿™ç§æ•°æ®ä¹Ÿä¸æ˜¯æ•æ„Ÿæ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥è€ƒè™‘è·Ÿé¡µé¢ç®¡ç†åšå…³è”å’Œæ•´åˆï¼Œæˆ–è€…æä¾›APIç»™é¡µé¢ç®¡ç†ç³»ç»Ÿã€‚å¦å¤–è¿˜æœ‰ä¸€ä¸ªä¾‹å­å°±æ˜¯ï¼Œæ¥å£å’Œé¡µé¢çš„å…³è”å…³ç³»ï¼Œå‰é¢æåˆ°é€šè¿‡é™æ€åˆ†æå¾—åˆ°çš„é¡µé¢å’Œæ¥å£çš„ä¾èµ–è¡¨æœ‰å¯èƒ½ä¸å¤Ÿå‡†ç¡®ï¼Œä½†æ˜¯æ¥å£è®¿é—®Web Serverçš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½æœ‰access.logï¼Œå¯ä»¥é€šè¿‡access.logæ¥åšåˆ†æï¼Œæ‹¿åˆ°æ¯”è¾ƒå®Œæ•´çš„é¡µé¢ä¾èµ–çš„æ¥å£ä¿¡æ¯ï¼Œä»¥åŠæ¥å£ä¾èµ–çš„é¡µé¢ä¿¡æ¯ï¼Œæœ‰äº›æ¥å£çš„è°ƒç”¨éœ€è¦æœ‰open apiçš„é‚£ç§æ³¨å†Œè°ƒç”¨æœºåˆ¶ï¼Œå°±å¦å½“åˆ«è®ºäº†ã€‚ 2.5 å…³è”å…³ç³»çš„æŸ¥è¯¢å’Œå­˜å‚¨ç®¡ç†ç«¯åº”è¯¥æä¾›æ­£åä¸¤ä¸ªæ–¹å‘çš„æŸ¥è¯¢å’Œæ£€ç´¢èƒ½åŠ›ï¼š æ­£å‘æŸ¥è¯¢ã€‚é€šè¿‡é¡µé¢æ¥æŸ¥è¯¢ä¾èµ–çš„ç»„ä»¶ã€é™æ€èµ„æº(js/css/å›¾ç‰‡)ã€åç«¯æ¥å£ç­‰ã€‚æ­¤ç§æ¯”è¾ƒç®€å•ï¼Œå› ä¸ºæäº¤çš„æ—¶å€™å·²ç»æœ‰å®Œæ•´çš„ä¾èµ–ä¿¡æ¯ï¼Œåªéœ€è¦æä¾›ç®€å•çš„æŸ¥è¯¢ã€‚ åå‘æŸ¥è¯¢ã€‚é€šè¿‡ç»„ä»¶ã€é™æ€èµ„æºã€æ¥å£ã€è¿è¥é…ç½®ä¿¡æ¯ã€ç›‘æ§é…ç½®ä¿¡æ¯ç­‰ï¼ŒåæŸ¥æœ‰å“ªäº›é¡µé¢ä¾èµ–ã€‚ å¯¹äºå…³è”å…³ç³»çš„å­˜å‚¨ï¼Œç”¨å…³ç³»å‹DBçš„è¯ï¼Œä¸€èˆ¬åªèƒ½ä½¿ç”¨likeæŸ¥è¯¢ï¼Œå¯èƒ½è¦æ‰«æå…¨è¡¨ï¼Œå› è€Œæ€§èƒ½æ¯”è¾ƒå·®ï¼Œå¯ä»¥è€ƒè™‘å­˜å‚¨åˆ°MongoDBä¸­åˆ›å»ºç´¢å¼•ï¼Œæˆ–è€…å­˜å‚¨åˆ°ElasticSearchä¸­å»ºç«‹ç´¢å¼•ã€‚ 2.6 å…¶ä»–å‰é¢æåˆ°çš„ï¼Œå…¶å®æœ‰ä¸€ä¸ªå‡è®¾çš„å‰æâ€œåªæœ‰ä¸€ä¸ªWebåº”ç”¨ï¼Œä¸”æ¥å£éƒ½æ˜¯å‰ç«¯å‘èµ·çš„â€ï¼Œä½†æ˜¯å¯¹äºå…¶ä»–æƒ…å†µï¼Œæ€è·¯æ˜¯ç±»ä¼¼çš„ï¼š å¤šåº”ç”¨ï¼ˆä¸šåŠ¡ï¼‰ã€‚å¤šåº”ç”¨æƒ…å†µï¼Œé€šå¸¸è¦åœ¨é¡µé¢ç®¡ç†çš„ä¸Šä¸€å±‚åŠ ä¸Šâ€œåº”ç”¨ç®¡ç†â€ï¼Œå³é¡µé¢å±äºå“ªä¸€ä¸ªåº”ç”¨(ä¸šåŠ¡)ã€‚å¯¹äºåŒä¸€ä¸ªé¡µé¢æŠ•æ”¾åœ¨ä¸åŒåº”ç”¨çš„åœºæ™¯ï¼Œå¯èƒ½é¡µé¢è¿˜å¾—åŠ ä¸Šæ¸ é“æ ‡è¯†ã€‚ é¡µé¢ç›´å‡ºï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰ã€‚å¯¹äºé¡µé¢ç›´å‡ºé€»è¾‘çš„ä»£ç ï¼Œåšå‰é¢ç±»ä¼¼çš„åˆ†æå³å¯ã€‚å¦å¤–ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯æ¢è®¨ä»å‰ç«¯è§†è§’è€ƒè™‘é—®é¢˜ï¼Œæ‰€ä»¥å…³è”æ ¸å¿ƒæ˜¯é¡µé¢ç®¡ç†ï¼Œä½†æ˜¯ä»æ•´ä½“æŠ€æœ¯æ¶æ„è§†è§’ï¼Œå¯èƒ½å°±ä¸æ˜¯äº†ã€‚ 3.ç»“è¯­æœ¬æ–‡æ¢è®¨äº†å‰ç«¯èµ„æºæ²»ç†çš„å«ä¹‰ä»¥åŠè¦è§£å†³çš„é—®é¢˜ï¼Œå¹¶ä»‹ç»äº†å®ç°å‰ç«¯èµ„æºæ²»ç†çš„æ€è·¯ï¼Œæ˜¯ç¬”è€…è¿‘æœŸåœ¨å‰ç«¯å·¥ç¨‹åŒ–æ–¹é¢çš„æ€è€ƒï¼Œéƒ¨åˆ†å·²ç»å®Œæˆï¼Œéƒ¨åˆ†æ­£åœ¨æ¨è¿›ã€‚æœ¬æ–‡å¹¶ä¸æ¶‰åŠå®ç°çš„ç»†èŠ‚ï¼Œç»†èŠ‚åœ¨åé¢çš„ç³»åˆ—æ–‡ç« ä¸­è¿›ä¸€æ­¥è®²è§£ã€‚å‰ç«¯æ²»ç†çš„ä¸¤ä¸ªå…³é”®ç‚¹ï¼Œä¸€ä¸ªæ˜¯ç³»ç»Ÿæ•´åˆï¼Œä¸€ä¸ªæ˜¯å…³è”å…³ç³»ç®¡ç†ï¼Œæ•´ä½“ä¸²è”çš„æ ¸å¿ƒæ˜¯é¡µé¢ç®¡ç†ã€‚","link":"/2019/09/24/å‰ç«¯èµ„æºæ²»ç†ï¼ˆä¸€ï¼‰/"},{"title":"è®°ä¸€æ¬¡Node.jsç›´å‡ºæœåŠ¡çš„æ€§èƒ½ä¼˜åŒ–","text":"ä½œè€…ï¼šè‚–ç¦ç¾¤ã€æåˆšæ¾ ä¸€.é—®é¢˜èƒŒæ™¯MPMï¼ˆMarket Page Makerï¼‰æ˜¯äº¬ä¸œç¤¾äº¤ç”µå•†éƒ¨çš„ç»„ä»¶åŒ–çš„é¡µé¢å¯è§†åŒ–æ­å»ºå¹³å°ï¼Œäº2016å¹´9æœˆä»½ä¸Šçº¿ï¼Œå¹³å‡æ¯å‘¨150+ä¸ªé¡µé¢ï¼Œç›®å‰å·²ç»æˆä¸ºç¤¾äº¤ç”µå•†éƒ¨çš„ä¸€ä¸ªæ ¸å¿ƒç³»ç»Ÿã€‚ç³»ç»Ÿä½¿ç”¨Vue.jsä½œä¸ºç»„ä»¶åŒ–çš„åŸºç¡€æ¡†æ¶,å¹¶äº2017å¹´5æœˆä»½ä¸Šçº¿äº†Node.jsç›´å‡ºæœåŠ¡ã€‚MPMçš„é¡µé¢ä¼šè¢«è¿è¥åŒå­¦æ‹¿åˆ°å„ç§æ¸ é“æŠ•æ”¾ï¼Œæ•´ä½“æµé‡å¾ˆä¸ç¨³å®šï¼Œå¯¹äºæµé‡çš„æš´æ¶¨æƒ…å†µè¦èƒ½å¤ŸåŠæ—¶å¤„ç†ï¼Œè¿™å¯¹äºå¼€å‘åŒå­¦æ¥è¯´æ˜¯ä¸€ä¸ªæ¯”è¾ƒçƒ¦çš„å·¥ä½œã€‚ å‰å‡ å¤©çªç„¶æ”¶åˆ°å‘Šè­¦ä¿¡æ¯ï¼Œç”±äºè¿è¥åŒå­¦å°†æŸä¸ªMPMæ´»åŠ¨é¡µé¢æŠ•æ”¾äº†å¤–éƒ¨å¹¿å‘Šï¼Œç›´å‡ºæœåŠ¡æµé‡å¤§æ¶¨ï¼ŒæœåŠ¡å™¨CPUä½¿ç”¨ç‡è¾¾åˆ°äº†80%ä»¥ä¸Šï¼Œäºæ˜¯ç«‹é©¬ç”³è¯·æ‰©å®¹ï¼Œé—®é¢˜è™½è§£å†³ï¼Œä½†æ˜¯ç•™ç»™äº†æˆ‘ä»¬ä¸€ä¸ªé—®é¢˜ï¼šç›´å‡ºæœåŠ¡èƒ½å¦ä¼˜åŒ–ï¼Œè¿™æ¬¡é‡çº§çš„æµé‡è¿›æ¥ä¹‹åï¼Œæ˜¯å¦å¯ä»¥ç¨³å®šæ”¯æ’‘è€Œä¸éœ€è¦æ‰©å®¹ï¼Ÿ äºŒ.åˆ†ææ–¹æ³•åŠé—®é¢˜ç‚¹ç”±äºæœ¬æ¬¡å‘Šè­¦é—®é¢˜ä¸»è¦æ˜¯æµé‡æš´æ¶¨å¯¼è‡´çš„CPUä½¿ç”¨ç‡è¿‡å¤§ï¼Œæˆ‘ä»¬æœ¬æ¬¡é‡ç‚¹ä¼˜åŒ–æœåŠ¡çš„CPUæ¶ˆè€—æ€§èƒ½ã€‚åˆ†æCPUæ¶ˆè€—çš„æ–¹æ³•æœ‰å¤šç§,æˆ‘ä»¬é€‰æ‹©å…¶ä¸­æ“ä½œæ¯”è¾ƒç®€å•çš„v8-profileræ–¹æ¡ˆï¼šå®‰è£…NPMåŒ…v8-profilerï¼Œåœ¨ç›´å‡ºæœåŠ¡ä¸­æ·»åŠ ç›‘æ§ä»£ç ï¼Œæ‰“åŒ…å‘å¸ƒåˆ°é¢„å‘å¸ƒç¯å¢ƒè¿›è¡Œå‹æµ‹ï¼Œæ”¶é›†ç›‘æ§æ•°æ®å†è¿›è¡Œåˆ†æã€‚ç›‘æ§ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516const profiler = require('v8-profiler');const fs = require('fs');(function cpuProf() { setTimeout(function () { console.log('å¼€å§‹æ”¶é›†CPUæ•°æ®'); profiler.startProfiling('CPU profile'); setTimeout(function () { const profile = profiler.stopProfiling(); profile.export(function (err, result) { fs.writeFileSync('profile.json', result); profile.delete(); console.log('CPUæ•°æ®æ”¶é›†å®Œæˆ'); }); }, 1000 * 60 * 5);//ç›‘æ§æ•°æ®é‡‡é›†5åˆ†é’Ÿ }, 1000);})(); ä¸Šè¿°ä»£ç ä¼šé‡‡é›†æœåŠ¡ç«¯5åˆ†é’Ÿçš„CPUæ¶ˆè€—æ•°æ®ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªJSONæ–‡ä»¶ï¼Œå°†æ­¤æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°åï¼Œå¯¼å…¥åˆ°åœ¨çº¿åˆ†æç½‘å€https://www.speedscope.app/ ï¼ˆæˆ–è€…ç”¨Chrome DevToolä¹Ÿå¯ä»¥ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°ç«ç„°å›¾å¦‚ä¸‹ï¼š ä»ç«ç„°å›¾å¯ä»¥çœ‹åˆ°å‡½æ•°çš„è°ƒç”¨æ ˆï¼Œä»ä¸Šè€Œä¸‹å°±æ˜¯è°ƒç”¨æ ˆï¼Œå…¶ä¸­æ¨ªæ¡é•¿åº¦è¶Šé•¿ä»£è¡¨è¿™å ç”¨cpuçš„æ—¶é—´è¶Šé•¿ã€‚å¦‚æœæŸä¸ªæ¨ªæ¡å¾ˆé•¿ï¼Œä½†æ˜¯ä¸‹é¢åˆæ²¡æœ‰å¾ˆç»†å°çš„å­è°ƒç”¨ï¼Œä¸€èˆ¬å°±è¡¨ç¤ºè¯¥è°ƒç”¨æ¶ˆè€—æ—¶é—´æ¯”è¾ƒé•¿ï¼Œå¯ä»¥è€ƒè™‘åšä¼˜åŒ–ã€‚ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¶ˆè€—æ€§èƒ½çš„ä¸»è¦æœ‰å‡ ä¸ªåœ°æ–¹ï¼š1ï¼‰replaceå‡½æ•°2ï¼‰compileå‡½æ•°3ï¼‰parseå‡½æ•°4ï¼‰vueæ¸²æŸ“ ä¸ºäº†æ–¹ä¾¿åæ–‡çš„åˆ†æï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ç›´å‡ºæœåŠ¡çš„å¤„ç†è¿‡ç¨‹ï¼š æ­¥éª¤ å¤„ç†æµç¨‹ èµ„æºæ¶ˆè€—ç±»å‹ å¤‡æ³¨ 1 æœåŠ¡æ”¶åˆ°è¯·æ±‚ï¼Œè§£æé¡µé¢å‚æ•° CPUè®¡ç®— 2 ä»Redisä¸­è¯»å–é¡µé¢æ•°æ®(PageData) ç½‘ç»œIO PageDataåŒ…æ‹¬é¡µé¢çš„å„ç§é…ç½®ä¿¡æ¯ï¼Œå¦‚é¡µé¢å¤´å°¾æ¨¡æ¿ã€é¡µé¢æ¥¼å±‚ä¿¡æ¯ã€èº«ä»½åˆ¤æ–­è¦æ±‚ã€ç»„ä»¶å…ƒæ•°æ®ç­‰ 3 è§£æPageData CPUè®¡ç®— 4 ç»„è£…åç«¯è¯·æ±‚å‚æ•° CPUè®¡ç®— 5 å‘èµ·åç«¯è¯·æ±‚å¹¶ç­‰å¾…è¿”å› ç½‘ç»œIO 6 è§£æåç«¯æ¥å£è¿”å›çš„JSONæ•°æ® CPUè®¡ç®— 7 é¡µé¢æ¨¡æ¿æ„é€  CPUè®¡ç®— ç”±äºå­˜åœ¨ç”¨æˆ·èº«ä»½åˆ¤æ–­ï¼ˆå¦‚æŸäº›ç»„ä»¶ä»…å¯¹æ–°äººå¯è§ï¼‰ã€æ¥¼å±‚BIç­‰åŸå› ï¼Œç»„ä»¶çš„å®¹å™¨æ˜¯åŠ¨æ€æ„é€ çš„ 8 ç»„ä»¶æ¸²æŸ“ CPUè®¡ç®— æ­¤å¤„çš„ç»„ä»¶æ¸²æŸ“æ˜¯Vueç»„ä»¶çš„æœåŠ¡ç«¯æ¸²æŸ“ 9 åå‡ºé¡µé¢HTML ç½‘ç»œIO ä¸‰.replaceå‡½æ•°è°ƒç”¨ä¼˜åŒ–åˆ†æå…·ä½“çš„replaceå‡½æ•°è°ƒç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¯¦ç»†åˆ†æä¸€ä¸‹ä¸Šé¢è¡¨æ ¼çš„ç¬¬7æ­¥:é¡µé¢æ¨¡æ¿æ„é€ ã€‚ 1.é¡µé¢æ¨¡æ¿æ„é€ ç”±äºå­˜åœ¨ç”¨æˆ·èº«ä»½åˆ¤æ–­ï¼ˆå¦‚æŸäº›ç»„ä»¶ä»…å¯¹æ–°äººæˆ–è€…VIPç”¨æˆ·å¯è§ï¼‰ã€æ¥¼å±‚BIï¼ˆæ¯ä¸ªç”¨æˆ·å±•ç¤ºçš„æ¥¼å±‚é¡ºåºéƒ½ä¸ä¸€æ ·ï¼‰ç­‰åŸå› ï¼Œç›¸åŒé¡µé¢å¯¹äºä¸åŒçš„ç”¨æˆ·å±•ç¤ºçš„ç»„ä»¶æ•°é‡ã€é¡ºåºéƒ½æ˜¯ä¸ä¸€æ ·ï¼ˆå³åƒäººåƒé¢ï¼‰ï¼Œå› æ­¤é¡µé¢çš„æ¨¡æ¿æ˜¯åŸºäºå„ä¸ªç»„ä»¶çš„æ¨¡æ¿åŠ¨æ€æ„é€ çš„ã€‚ä¸ºæ–¹ä¾¿å¯¹ç»„ä»¶è¿›è¡Œæ“ä½œï¼Œæ¯ä¸ªç»„ä»¶éƒ½æœ‰ä¸€ä¸ªdivå®¹å™¨ï¼Œå®¹å™¨æ„é€ å¾ˆç®€å•ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 1234&lt;div id='com_1001'&gt;__vue_com_1001_replace__&lt;/div&gt;&lt;div id='com_1002'&gt;__vue_com_1002_replace__&lt;/div&gt;&lt;div id='com_1003'&gt;__vue_com_1003_replace__&lt;/div&gt;&lt;div id='com_1004'&gt;__vue_com_1004_replace__&lt;/div&gt; å…¶ä¸­vue_com_1001_replaceè¿™ç§æ˜¯å ä½ç¬¦ï¼Œéœ€è¦ç”¨ç›¸åº”ä½ç½®çš„ç»„ä»¶çš„å®é™…æ¨¡æ¿æ¥æ›¿æ¢ã€‚ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼ŒVueæ¸²æŸ“çš„æ—¶å€™ï¼Œä½¿ç”¨Render Functionè¿›è¡Œæ¸²æŸ“çš„ï¼Œå¹¶ä¸æ˜¯æ™®é€šçš„å­—ç¬¦ä¸²æ¨¡æ¿æˆ–è€…Vueæ¨¡æ¿ã€‚ä¸‹é¢æ˜¯ä¸€æ®µæ¨¡æ¿ç¼–è¯‘åçš„Render Functionï¼š 1_c('commontag',{ref:\"__uid__replace__str__\",attrs:{\"uid\":\"__uid__replace__str__\",\"params\":params___uid__replace__str__},inlineTemplate:{render:function(){with(this){return _c('div',[(true)?[(params.transparent != 1)?_c('div',{staticClass:\"vueSeparator\",style:({'background-color':params.color, height: params.height + 'px'})}):_c('div',{staticClass:\"vueSeparator\",style:({height: params.height + 'px'})})]:_e()],2)}},staticRenderFns:[]}}) è‹¥ä½¿ç”¨çš„æ˜¯Vueæ¨¡æ¿ï¼Œåˆ™ä¼šåœ¨è¿è¡Œæ—¶åšä¸€æ¬¡ç¼–è¯‘ï¼Œç¼–è¯‘ä¸ºRender Functionï¼Œæ¯”è¾ƒè€—æ€§èƒ½ï¼Œå› æ­¤å®˜æ–¹æ¨èçš„åšæ³•æ˜¯åœ¨æ„å»ºæ—¶é¢„ç¼–è¯‘ï¼Œå¹¶ä¸”è¿è¡Œæ—¶ä½¿ç”¨ä¸åŒ…å«ç¼–è¯‘å‡½æ•°çš„ç²¾ç®€ç‰ˆã€‚ç›®å‰MPMæ¯ä¸ªç»„ä»¶å­˜å‚¨åˆ°Redisä¸­çš„ä¹Ÿæ˜¯Render Functionï¼Œè€Œä¸æ˜¯åŸå§‹çš„Vueæ¨¡æ¿ã€‚æ‰€ä»¥ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œå·²çŸ¥å­ç»„ä»¶ç¼–è¯‘åçš„Render Functionï¼Œå¹¶ä¸”çŸ¥é“å„ä¸ªç»„ä»¶çš„DOMç»“æ„å½¢å¼çš„å®¹å™¨ï¼Œèƒ½å¦æ„é€ å‡ºçˆ¶ç»„ä»¶çš„Render Functionï¼Ÿ ç­”æ¡ˆå½“ç„¶æ˜¯å¯ä»¥ï¼šå¯ä»¥é€šè¿‡å­—ç¬¦ä¸²æ“ä½œï¼Œæ„é€ å‡ºçˆ¶ç»„ä»¶çš„Render Functionï¼ æˆ‘ä»¬ä»¥ä¸‹é¢è¿™æ®µä»£ç ä¸ºä¾‹ï¼Œçœ‹çœ‹æ„é€ è¿‡ç¨‹ï¼ˆä¸ºäº†ç®€å•å¤„ç†ï¼Œæˆ‘ä»¬ç”¨äº†å†…è”æ¨¡æ¿ï¼‰ï¼š 1234567891011&lt;ParentComponent&gt; &lt;SubComponent1 inline-template :param=\"data.sub1\"&gt; &lt;p&gt;this is SubComponent1{{param.name}}&lt;/&gt; &lt;/SubComponent1&gt; &lt;SubComponent2 inline-template :param=\"data.sub2\"&gt; &lt;p&gt;this is SubComponent2{{param.name}}&lt;/&gt; &lt;/SubComponent2&gt; &lt;SubComponent3 inline-template :param=\"data.sub3\"&gt; &lt;p&gt;this is SubComponent3{{param.name}}&lt;/&gt; &lt;/SubComponent3&gt;&lt;/ParentComponent&gt; ä¸Šè¿°ä»£ç ç»è¿‡Vue.compileå‡½æ•°ç¼–è¯‘å¤„ç†åï¼Œä¼šå¾—åˆ°ä¸€ä¸ªåŒ…å«renderå’ŒstaticRenderFnsä¸¤ä¸ªå±æ€§çš„å¯¹è±¡ï¼Œæˆ‘ä»¬ä¸»è¦çœ‹renderå±æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234function anonymous() {with(this){return _c('ParentComponent',[_c('SubComponent1',{attrs:{\"param\":data.sub1},inlineTemplate:{render:function(){with(this){return _c('p',[_v(\"this is SubComponent1\"+_s(param.name)+\"\\n\\t\")])}},staticRenderFns:[]}}),_v(\" \"),_c('SubComponent2',{attrs:{\"param\":data.sub2},inlineTemplate:{render:function(){with(this){return _c('p',[_v(\"this is SubComponent2\"+_s(param.name)+\"\\n\\t\")])}},staticRenderFns:[]}}),_v(\" \"),_c('SubComponent3',{attrs:{\"param\":data.sub3},inlineTemplate:{render:function(){with(this){return _c('p',[_v(\"this is SubComponent3\"+_s(param.name)+\"\\n\\t\")])}},staticRenderFns:[]}})],1)}} å°†ä¸Šé¢çš„ä»£ç å†æ ¼å¼åŒ–ä¸€ä¸‹ï¼š 123456789function anonymous() {with(this){return _c('ParentComponent',[_c('SubComponent1',{attrs:{\"param\":data.sub1},inlineTemplate:{render:function(){with(this){return _c('p',[_v(\"this is SubComponent1\"+_s(param.name)+\"\\n\\t\")])}},staticRenderFns:[]}}),_v(\" \"),_c('SubComponent2',{attrs:{\"param\":data.sub2},inlineTemplate:{render:function(){with(this){return _c('p',[_v(\"this is SubComponent2\"+_s(param.name)+\"\\n\\t\")])}},staticRenderFns:[]}}),_v(\" \"),_c('SubComponent3',{attrs:{\"param\":data.sub3},inlineTemplate:{render:function(){with(this){return _c('p',[_v(\"this is SubComponent3\"+_s(param.name)+\"\\n\\t\")])}},staticRenderFns:[]}})],1)}} å¯ä»¥çœ‹åˆ°ä¸Šé¢ç¬¬4ã€5ã€6è¡Œä»£ç ï¼Œå°±æ˜¯å­ç»„ä»¶çš„Render Functionï¼Œä»–ä»¬åŒ…è£¹åœ¨ä¸€ä¸ªæ•°ç»„é‡Œã€‚å› æ­¤ï¼Œå¦‚æœçŸ¥é“å­ç»„ä»¶çš„Render Functionï¼Œé…åˆå½¢å¦‚ä¸‹é¢çš„æ¨¡æ¿ï¼Œå°±å¯ä»¥åè¿‡æ¥æ„é€ å‡ºçˆ¶ç»„ä»¶çš„Render Functionï¼ˆå½“ç„¶æœ‰ä¸€ä¸ªä»å­—ç¬¦ä¸²åˆ°å‡½æ•°çš„ååºåˆ—åŒ–è¿‡ç¨‹ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„åœºæ™¯è¿™ä¸ªä¸å¯é¿å…ï¼Œå› ä¸ºæ¨¡æ¿æ˜¯ä»Redisä¸­è¯»å–å‡ºæ¥çš„ï¼‰ã€‚ 123456789function anonymous() {with(this){return _c(&apos;ParentComponent&apos;,[__SubComponent1_replace__,__SubComponent2_replace__,__SubComponent3_replace__],1)}} å†å›åˆ°æˆ‘ä»¬çš„é—®é¢˜ï¼Œæˆ‘ä»¬å·²çŸ¥å­ç»„ä»¶çš„Render Functionï¼Œå¹¶ä¸”å·²çŸ¥çˆ¶ç»„ä»¶çš„å®¹å™¨ï¼Œéœ€è¦æ„é€ å‡ºçˆ¶ç»„ä»¶çš„Render Functionã€‚ç°åœ¨æ€è·¯å°±å¾ˆæ¸…æ™°äº†ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠå¼€å¤´é‚£æ®µåŒ…å«å ä½ç¬¦çš„divå®¹å™¨ä»£ç ï¼Œ 1234&lt;div id='com_1001'&gt;__vue_com_1001_replace__&lt;/div&gt;&lt;div id='com_1002'&gt;__vue_com_1002_replace__&lt;/div&gt;&lt;div id='com_1003'&gt;__vue_com_1003_replace__&lt;/div&gt;&lt;div id='com_1004'&gt;__vue_com_1004_replace__&lt;/div&gt; ä½¿ç”¨Vue.compileå‡½æ•°å°†å…¶ç¼–è¯‘æˆRender Functionï¼Œå¤„ç†æˆå­—ç¬¦ä¸²åï¼Œå†é€šè¿‡æ­£åˆ™æ›¿æ¢å…¶ä¸­çš„å­ç»„ä»¶çš„å ä½ç¬¦ï¼Œå˜æˆå­ç»„ä»¶æ¨¡æ¿ï¼Œæœ€åååºåˆ—åŒ–ä¸ºçˆ¶ç»„ä»¶çš„Render Functionå³å¯ã€‚æ•´ä½“å¤„ç†é€»è¾‘å¦‚ä¸‹ï¼š 2.é—®é¢˜ä»£ç åˆ†æäº†è§£äº†ä¸Šè¿°å¤„ç†è¿‡ç¨‹ï¼Œæˆ‘ä»¬å†æ ¹æ®ç«ç„°å›¾ä¸­çš„è°ƒç”¨æ ˆï¼Œæ‰¾åˆ°replaceå‡½æ•°è°ƒç”¨çš„é—®é¢˜ä»£ç ï¼š 12345678910111213141516171819Object.keys(MPM_COM_STYLE_MAP).forEach(function(comId){ var styleKey = MPM_COM_STYLE_MAP[comId]; var code = ''; if(hideComIds.indexOf(comId)!=-1){ code = HIDE_TPL; }else if(loadingComs.indexOf(comId)!=-1){ code = LOADING_TPL; }else if(MPM_STYLE_TPL_MAP[styleKey]) { // ç¬¬ä¸€æ¬¡replaceæ›¿æ¢ code = MPM_STYLE_TPL_MAP[styleKey].replace(/__uid__replace__str__/g, comId); } else{ console.error('æœ€ç»ˆæ›¿æ¢ï¼Œå‘ç°æ— æ¨¡æ¿ç»„ä»¶',comId); } if(code) { //ç¬¬äºŒæ¬¡replaceæ›¿æ¢ compileTpl = compileTpl.replace(`_v(\"__vue__${comId}__replace__\")`,code); } }); å¯ä»¥çœ‹åˆ°æœ‰ä¸¤æ¬¡replaceå‡½æ•°è°ƒç”¨ï¼Œç¬¬ä¸€æ¬¡æ˜¯ç»„ä»¶IDæ›¿æ¢ï¼ˆå³uidæ›¿æ¢ï¼‰ï¼Œç¬¬äºŒæ¬¡æ˜¯ç»„ä»¶æ¨¡æ¿æ›¿æ¢ã€‚ å…ˆåˆ†æç¬¬ä¸€æ¬¡replaceå‡½æ•°è°ƒç”¨ã€‚å‰é¢æåˆ°ï¼Œæ¯ä¸ªç»„ä»¶çš„æ¨¡æ¿å·²ç»ç¼–è¯‘ä¸ºRender Functionå¹¶å­˜åœ¨Redisä¸­ã€‚ä½†æ˜¯åŒä¸€ä¸ªç»„ä»¶åœ¨é¡µé¢ä¸­å¯èƒ½æœ‰å¤šä¸ªå®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹éœ€è¦æœ‰ä¸€ä¸ªIDæ¥åŒºåˆ†ï¼Œæˆ‘ä»¬ç§°ä¸ºuidï¼ˆunique IDçš„æ„æ€ï¼‰ï¼Œuidåªæœ‰åœ¨è¿è¡Œçš„æ—¶å€™æ‰ç”Ÿæˆï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™æ˜¯ä¸çŸ¥é“çš„ï¼Œå› æ­¤ç”¨äº†ä¸€ä¸ªå ä½ç¬¦ï¼ˆå³ä¸‹å›¾ä¸­çš„uidreplace__str__ï¼‰ï¼Œåœ¨ç›´å‡ºæœåŠ¡ä¸­éœ€è¦åšæ›¿æ¢ï¼Œå³ä¸Šé¢ä»£ç ä¸­çš„uidæ›¿æ¢ã€‚ä¸‹é¢æ˜¯ä¸€æ®µç¼–è¯‘åçš„ä»£ç ï¼š æ¯ä¸ªé¡µé¢ä¼šæœ‰å¾ˆå¤šä¸ªç»„ä»¶ï¼ˆæ•°åä¸ªç”šè‡³ä¸Šç™¾ä¸ªï¼‰ï¼Œæ¯æ¬¡æ›¿æ¢éƒ½æ˜¯åœ¨ä¹‹å‰æ›¿æ¢çš„ç»“æœä¹‹ä¸Šè¿›è¡Œçš„ï¼Œå½¢æˆäº†å¾ªç¯æ›¿æ¢ï¼Œå‰é¢å¯¼è‡´å‘Šè­¦çš„é‚£ä¸ªé¡µé¢ç”¨åˆ°çš„ç¼–è¯‘ä¹‹åçš„æ¨¡ç‰ˆæœ€å¤§çš„æœ‰20+KBï¼Œè€Œæ¯æ¬¡æ­£åˆ™æ›¿æ¢ä¹‹åçš„æ¨¡ç‰ˆä¼šè¶Šæ¥è¶Šé•¿ï¼Œæ‰€ä»¥è¿™é‡Œè€—æ—¶è¾ƒå¤šä¹Ÿå°±ä¸å¥‡æ€ªäº†ã€‚ ä»é€»è¾‘ä¸Šè®²ï¼Œè¿™æ®µä»£ç æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œä½†æ˜¯åˆæœ‰æ€§èƒ½ç“¶é¢ˆï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Ÿ 3.uidæ›¿æ¢ä¼˜åŒ–æˆ‘ä»¬ç ”ç©¶å‘ç°ï¼šå¯¹äºæ¯”è¾ƒé•¿çš„å­—ç¬¦ä¸²ï¼Œå…ˆç”¨å­—ç¬¦ä¸²çš„splitæ–¹æ³•åˆ†å‰²æˆæ•°ç»„ï¼Œå†ç”¨æ•°ç»„çš„joinæ–¹æ³•å°†åˆ‡å‰²çš„æ•°ç»„åˆå¹¶ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯”æ­£åˆ™æ›¿æ¢çš„æ•ˆç‡è¦é«˜ã€‚æ­¤æ³•æˆ‘ä»¬ç§°ä¸ºæ•°ç»„ç²˜åˆæ³•ã€‚ä»¥ä¸‹ä¸ºæµ‹è¯•ä»£ç ï¼š 12345678910111213141516171819202122const exeCount = 10000000; //æ‰§è¡Œæ¬¡æ•°,æ­¤å¤„åˆ†åˆ«æ¢æˆ1Wã€10Wã€100Wã€1000W//æµ‹è¯•å­—ç¬¦ä¸²ï¼Œéœ€è¦æ¯”è¾ƒé•¿çš„å­—ç¬¦ä¸²æ‰èƒ½çœ‹åˆ°æ•ˆæœï¼Œä¸‹é¢æ˜¯ä»æˆ‘ä»¬çš„ç»„ä»¶æ¨¡æ¿ä¸­æ‘˜å–çš„ä¸€æ®µconst str = `_c('ds',{ref:\"__uid__replace__str__\",attrs:{\"uid\":\"__uid__replace__str__\",\"params\":params___uid__replace__str__,\"tab-index\":\"3\"},inlineTemplate:{render:function(){with(this){return _c('div',{attrs:{\"stylkey\":data.styleKey,\"pc\":data.pc,\"actid\":data.actid,\"areaid\":data.areaid}},[_c('ul',{directives:[{name:\"getskuad\",rawName:\"v-getskuad\",value:({bindObj:data, appendName:'skuAd', show: params.extend.showAds}),expression:\"{bindObj:data, appendName:'skuAd', show: params.extend.showAds}\"}],staticClass:\"pinlei_g3col\"},[(true)?_l((params.fnObj.translate(data.itemList)),function(item,index){return (!params.shownum || index &lt; params.shownum || data.showMore)?_c('li',{class:['pinlei_g3col_col', (params.extend.imgSize == '1' ? 'size_230x230' : 'size_230x320')],attrs:{\"index\":index}},[_c('div',{staticClass:\"pinlei_g3col_img\"},[_c('a',{attrs:{\"href\":params.extend.buttonType == '5' ? addRd(goPingouUrl(item.sUrl),params.ptag) : addRd(item.sUrl,params.ptag)}},[_c('img',{attrs:{\"init_src\":getImgUrl('//img12.360buyimg.com/mcoss/'+ item.sPicturesUrl),\"data-size\":\"230x230\"}})]),((params.extend.sellOut != '0') &amp;&amp; (item.dwStock - 0 &gt; 0))?_c('div',{staticClass:\"pinlei_g3col_msk\"},[_m(0,true)]):_e()]),_c('div',{staticClass:\"pinlei_g3col_info\"},[_c('div',{class:['pinlei_g3col_t1', 'red', (params.extend.titleHeight == '1' ? 'oneline' : '')]},[_v(\"\\n \"+_s(item.sProductName)+\"\\n \")]),(!params.fnObj.isBeforeActive(params.extend.beginTime))?_c('div',{staticClass:\"pinlei_g3col_price red\",style:({color: params.extend.isShowTokenPrice == '1' &amp;&amp; item.dwTokenPrice &amp;&amp; (Number(item.dwTokenPrice) != 0)?'#888':''})},[_v(\"\\n ï¿¥\"),_c('b',[_v(_s(item.dwRealTimePrice.split('.')[0]))]),_v(\".\"+_s(item.dwRealTimePrice.split('.')[1])+\"\\n \")]):_e(),(params.fnObj.isBeforeActive(params.extend.beginTime))?_c('div',{staticClass:\"pinlei_g3col_price red\",style:({color: params.extend.isShowTokenPrice == '1' &amp;&amp; item.dwTokenPrice &amp;&amp; (Number(item.dwTokenPrice) != 0)?'#888':''})},[_v(\"\\n ï¿¥\"),_c('b',[_v(_s(params.fnObj.getYushouInt(item, params.extend.priceType)))]),_v(_s(params.fnObj.getYushouDecimal(item, params.extend.priceType))+\"\\n \")]):_e(),(params.extend.isShowTokenPrice == '1')?[_c('div',{staticClass:\"pinlei_g3col_token\"},[(item.dwTokenPrice &amp;&amp; (Number(item.dwTokenPrice) != 0))?_c('div',{staticClass:\"pinlei_g3col_token_price\"},[_v(\"ä¸“å±ä»·:ï¿¥\"),_c('b',[_v(_s(parseFloat(item.dwTokenPrice)))])]):_e()])]:_e(),(params.fnObj.isBeforeActive(params.extend.beginTime))?[_c('div',{staticClass:\"pinlei_g3col_desc red\"},[(item.sBackUpWords[0] &amp;&amp; (params.fnObj.getYushouJiaDiff(item,params.extend.priceType) &gt; 0))?[_v(\"æ¯”ç°åœ¨ä¹°çœ\"+_s(params.fnObj.getYushouJiaDiff(item,params.extend.priceType))+\"å…ƒ\")]:(item.sTag)?[_v(_s(item.sTag.split('|')[0]))]:(params.extend.showAds == '1' &amp;&amp; item.skuAd)?[_v(_s(item.skuAd))]:_e()],2)]:_e(),(!params.fnObj.isBeforeActive(params.extend.beginTime))?[_c('div',{staticClass:\"pinlei_g3col_desc red\"},[(item.sTag)?[_v(_s(item.sTag.split('|')[0]))]:(params.extend.showAds == '1' &amp;&amp; item.skuAd)?[_v(_s(item.skuAd))]:_e()],2)]:_e(),(params.fnObj.isBeforeActive(params.extend.beginTime))?[(params.extend.buttonType == '0')?[(params.extend.priceType == '1')?_c('div',{directives:[{name:\"addcart\",rawName:\"v-addcart\",value:({skuId: item.ddwSkuId}),expression:\"{skuId: item.ddwSkuId}\"}],class:{'pinlei_g3col_btn':true, 'blue':params.extend.beginTime, 'red':(!params.extend.beginTime), 'right': item.sBackUpWords[2]},style:(params.extend.priceType == 0?'border-radius: 24px;':'')},[_v(\"\\n \"+_s(params.extend.buttonWording)+\"\\n \")]):_e(),(params.extend.priceType == '0')?_c('div',{directives:[{name:\"addcart\",rawName:\"v-addcart\",value:({skuId: item.ddwSkuId}),expression:\"{skuId: item.ddwSkuId}\"}],class:{'pinlei_g3col_btn':true, 'blue':params.extend.beginTime, 'red':(!params.extend.beginTime), 'right': item.sBackUpWords[2]},style:(params.extend.priceType == 0?'border-radius: 24px;':'')},[_v(\"\\n \"+_s(params.extend.buttonWording)+\"\\n \")]):_e()]:_e(),(params.extend.buttonType == '1')?[_c('a',{attrs:{\"href\":addRd(item.sUrl,params.ptag)}},[_c('div',{class:{'pinlei_g3col_btn':true, 'blue':params.extend.beginTime, 'red':(!params.extend.beginTime)},style:(params.extend.priceType == 0?'border-radius: 24px;':'')},[_v(\"\\n \"+_s(params.extend.buttonWording)+\"\\n \")])])]:_e(),(params.extend.buttonType == '5')?[_c('a',{attrs:{\"href\":addRd(goPingouUrl(item.sUrl),params.ptag)}},[_c('div',{class:{'pinlei_g3col_btn':true, 'blue':params.extend.beginTime, 'red':(!params.extend.beginTime)},style:(params.extend.priceType == 0?'border-radius: 24px;':'')},[_v(\"\\n \"+_s(params.extend.buttonWording)+\"\\n \")])])]:_e(),(params.extend.buttonType == '2')?[_c('a',{attrs:{\"href\":addRd(item.sUrl,params.ptag)}},[_c('div',{class:{'pinlei_g3col_btn':true, 'blue':params.extend.beginTime, 'red':(!params.extend.beginTime)},style:(params.extend.priceType == 0?'border-radius: 24px;':'')},[_v(\"\\n å®šé‡‘\"+_s(item.sBackUpWords[1].split('+')[0])+\"æŠµ\"+_s(parseFloat((item.sBackUpWords[1].split('+')[1] * item.sBackUpWords[1].split('+')[0]).toFixed(2)))+\"\\n \")])])]:_e(),(params.extend.buttonType == '3')?[_c('div',{directives:[{name:\"yuyue\",rawName:\"v-yuyue\",value:({bindObj:data,stop:true, activeId:params.extend.yuyueID,appendTo:item,appendName:'state',msg:[]}),expression:\"{bindObj:data,stop:true, activeId:params.extend.yuyueID,appendTo:item,appendName:'state',msg:[]}\"}],class:['pinlei_g3col_btn','blue', item.state == 1 ? 'disabled' : ''],style:(params.extend.priceType == 0?'border-radius: 24px;':''),attrs:{\"yuyueid\":params.extend.yuyueID}},[_v(\"\\n \"+_s(params.extend.buttonWording)+\"\\n \")])]:_e(),(params.extend.buttonType == '4' )?[((params.fnObj.getYushouJiaDiff(item,params.extend.priceType)&gt; 0))?_c('div',{directives:[{name:\"skuyuyue\",rawName:\"v-skuyuyue\",value:({bindObj:data,stop:true, skuId:item.ddwSkuId,appendTo:item,ignoreHistory:true,msg:{success: 'é¢„çº¦æˆåŠŸï¼Œè¯·ç•™æ„äº¬ä¸œJD.COMæœåŠ¡å·çš„æ´»åŠ¨æé†’',exist: 'å·²è®¾ç½®é¢„çº¦ï¼Œæ— éœ€å†è¿›è¡Œè®¾ç½®',systemError: 'è¯¥å•†å“ä¸æ˜¯é¢„çº¦æ´»åŠ¨å•†å“'},actPrice:params.fnObj.getYushouInt(item, params.extend.priceType)+params.fnObj.getYushouDecimal(item, params.extend.priceType),classId:item.classId1+'_'+item.classId2+'_'+item.classId3}),expression:\"{bindObj:data,stop:true, skuId:item.ddwSkuId,appendTo:item,ignoreHistory:true,msg:{success: 'é¢„çº¦æˆåŠŸï¼Œè¯·ç•™æ„äº¬ä¸œJD.COMæœåŠ¡å·çš„æ´»åŠ¨æé†’',exist: 'å·²è®¾ç½®é¢„çº¦ï¼Œæ— éœ€å†è¿›è¡Œè®¾ç½®',systemError: 'è¯¥å•†å“ä¸æ˜¯é¢„çº¦æ´»åŠ¨å•†å“'},actPrice:params.fnObj.getYushouInt(item, params.extend.priceType)+params.fnObj.getYushouDecimal(item, params.extend.priceType),classId:item.classId1+'_'+item.classId2+'_'+item.classId3}\"}],class:['pinlei_g3col_btn','blue', item.state == 1 ? 'disabled' : ''],style:(params.extend.priceType == 0?'border-radius: 24px;':'')},[_v(\"\\n \"+_s(params.extend.buttonWording)+\"\\n \")]):_c('div',{directives:[{name:\"skuyuyue\",rawName:\"v-skuyuyue\",value:({bindObj:data,stop:true, skuId:item.ddwSkuId,ignoreHistory:true,appendTo:item,msg:{success: 'é¢„çº¦æˆåŠŸï¼Œè¯·ç•™æ„äº¬ä¸œJD.COMæœåŠ¡å·çš„æ´»åŠ¨æé†’',exist: 'å·²è®¾ç½®é¢„çº¦ï¼Œæ— éœ€å†è¿›è¡Œè®¾ç½®',systemError: 'è¯¥å•†å“ä¸æ˜¯é¢„çº¦æ´»åŠ¨å•†å“'}}),expression:\"{bindObj:data,stop:true, skuId:item.ddwSkuId,ignoreHistory:true,appendTo:item,msg:{success: 'é¢„çº¦æˆåŠŸï¼Œè¯·ç•™æ„äº¬ä¸œJD.COMæœåŠ¡å·çš„æ´»åŠ¨æé†’',exist: 'å·²è®¾ç½®é¢„çº¦ï¼Œæ— éœ€å†è¿›è¡Œè®¾ç½®',systemError: 'è¯¥å•†å“ä¸æ˜¯é¢„çº¦æ´»åŠ¨å•†å“'}}\"}],class:['pinlei_g3col_btn','blue', item.state == 1 ? 'disabled' : ''],style:(params.extend.priceType == 0?'border-radius: 24px;':'')},[_v(\"\\n \"+_s(params.extend.buttonWording)+\"\\n \")])]:_e(),(params.extend.buttonType == '6' )?[_c('div',{directives:[{name:\"yuyue\",rawName:\"v-yuyue\",value:({bindObj:data,stop:true,noTip:true,activeId:params.extend.yuyueID,appendTo:item,appendName:'state',msg:[]}),expression:\"{bindObj:data,stop:true,noTip:true,activeId:params.extend.yuyueID,appendTo:item,appendName:'state',msg:[]}\"},{name:\"addcart\",rawName:\"v-addcart\",value:({skuId: {skuId: item.ddwSkuId,successTxt:'é¢„çº¦åŠ è½¦æˆåŠŸ'}}),expression:\"{skuId: {skuId: item.ddwSkuId,successTxt:'é¢„çº¦åŠ è½¦æˆåŠŸ'}}\"}],class:{'pinlei_g3col_btn':true, 'blue':params.extend.beginTime, 'red':(!params.extend.beginTime), 'left': params.fnObj.getCouponInfo(item.sBackUpWords[2])},style:(params.extend.priceType == 0?'border-radius: 24px;':''),attrs:{\"yuyueid\":params.extend.yuyueID}},[_v(\"\\n \"+_s(params.extend.buttonWording)+\"\\n \")])]:_e()]:_e(),(!params.fnObj.isBeforeActive(params.extend.beginTime))?[(params.extend.buttonActiveType == '0')?[_c('div',{directives:[{name:\"addcart\",rawName:\"v-addcart\",value:({skuId: item.ddwSkuId}),expression:\"{skuId: item.ddwSkuId}\"}],staticClass:\"pinlei_g3col_btn\",style:(params.extend.priceType == 0?'border-radius: 24px;background-color: #ea1e54;':'')},[_v(\"\\n \"+_s(params.extend.buttonActiveWording)+\"\\n \")])]:_e(),(params.extend.buttonActiveType == '1')?[_c('a',{attrs:{\"href\":addRd(item.sUrl,params.ptag)}},[_c('div',{staticClass:\"pinlei_g3col_btn red\",style:(params.extend.priceType == 0?'border-radius: 24px;background-color: #ea1e54;':'')},[_v(\"\\n \"+_s(params.extend.buttonActiveWording)+\"\\n \")])])]:_e(),(params.extend.buttonActiveType == '2')?[_c('a',{attrs:{\"href\":addRd(goPingouUrl(item.sUrl),params.ptag)}},[_c('div',{staticClass:\"pinlei_g3col_btn red\",style:(params.extend.priceType == 0?'border-radius: 24px;background-color: #ea1e54;':'')},[_v(\"\\n \"+_s(params.extend.buttonActiveWording)+\"\\n \")])])]:_e(),(params.extend.buttonActiveType == '4')?[_c('div',{directives:[{name:\"addcart\",rawName:\"v-addcart\",value:({skuId: item.ddwSkuId, bindObject: item, bindPropertyName: 'addCartMsg', isPullQuan: true}),expression:\"{skuId: item.ddwSkuId, bindObject: item, bindPropertyName: 'addCartMsg', isPullQuan: true}\"},{name:\"quan\",rawName:\"v-quan\",value:({bindObj:data,key:params.extend.key, level:params.extend.level, num:1, msg:{}, appendTo:item, appendName:'status', ignoreHistory:false, style:2, successUrl:item.successUrl, type:1, coupondes:{value: params.extend.price, gate: params.extend.gate, name: params.extend.name}}),expression:\"{bindObj:data,key:params.extend.key, level:params.extend.level, num:1, msg:{}, appendTo:item, appendName:'status', ignoreHistory:false, style:2, successUrl:item.successUrl, type:1, coupondes:{value: params.extend.price, gate: params.extend.gate, name: params.extend.name}}\"}],staticClass:\"pinlei_g3col_btn\",style:(params.extend.priceType == 0?'border-radius: 24px;background-color: #ea1e54;':'')},[_v(\"\\n \"+_s(params.extend.buttonActiveWording)+\"\\n \")])]:_e()]:_e()],2),(params.extend.corner != '0')?[(isRange(params.extend.cornerBegin, params.extend.cornerEnd) &amp;&amp; params.extend.cornerDes)?_c('div',{staticClass:\"pinlei_g3col_stamp red\"},[_v(_s(params.extend.cornerDes))]):(item.sCopyWriting)?_c('div',{staticClass:\"pinlei_g3col_stamp red\"},[_v(_s(item.sCopyWriting))]):_e()]:_e()],2):_e()}):_e()],2),(params.shownum &amp;&amp; data.itemList.length &gt; params.shownum)?[_c('div',{class:'pinlei_more '+ (data.showMore?'pinlei_more_unfold':''),on:{\"click\":function($event){toggleMore($event)}}},[_v(_s(data.showMore?'æ”¶èµ·æ›´å¤š':'å±•å¼€æ›´å¤š'))])]:_e()],2)}},staticRenderFns:[function(){with(this){return _c('div',{staticClass:\"pinlei_g3col_msk_ico\"},[_c('div',{staticClass:\"pinlei_g3col_msk_text\"},[_v(\"\\n å·²æŠ¢å…‰\\n \"),_c('br'),_v(\"over\\n \")])])}}]}})`//æ­£åˆ™æ›¿æ¢æ³•startconst timeStart = new Date().getTime();for(var i = 0; i &lt; exeCount; i++) { str.replace(/__uid__replace__str__/g, 'com_1001');}const timeEnd = new Date().getTime();console.log('æ­£åˆ™æ›¿æ¢è€—æ—¶ï¼š', timeEnd - timeStart);//æ­£åˆ™æ›¿æ¢æ³•end//æ•°ç»„ç²˜åˆæ³•startconst timeStart2 = new Date().getTime();const segs = str.split('__uid__replace__str__');for(var i = 0; i &lt; exeCount; i++) { segs.join('com_1001');}const timeEnd2 = new Date().getTime();console.log('æ•°ç»„ç²˜è´´è€—æ—¶ï¼š', timeEnd2 - timeStart2);//æ•°ç»„ç²˜åˆæ³•end ç»“æœå¦‚ä¸‹ï¼š æ‰§è¡Œæ¬¡æ•° æ­£åˆ™æ›¿æ¢æ³•è€—æ—¶(ms) æ•°ç»„ç²˜åˆæ³•è€—æ—¶(ms) æ­£åˆ™æ›¿æ¢æ³•è€—æ—¶/æ•°ç»„ç²˜åˆæ³•è€—æ—¶ 1W 42 25 1.68 10W 362 179 2.01 100W 3555 1623 2.2 1000W 36449 18634 1.95 å¯ä»¥çœ‹åˆ°æ•°ç»„ç²˜åˆæ³•çš„è€—æ—¶æ˜¯æ­£åˆ™æ›¿æ¢æ³•çš„ä¸€åŠå·¦å³ã€‚ è€ƒè™‘åˆ°æˆ‘ä»¬çš„åœºæ™¯å°±æ˜¯å­—ç¬¦ä¸²æ¯”è¾ƒå¤§ï¼Œå­˜åœ¨å¾ªç¯æ›¿æ¢ï¼Œä¸”æ˜¯æµ·é‡æœåŠ¡çš„åœºæ™¯ï¼Œå› æ­¤ä¸Šé¢ç¬¬ä¸€æ¬¡æ›¿æ¢ï¼Œç›´æ¥æ”¹æˆæ•°ç»„ç²˜åˆæ³•å³å¯ã€‚ 4.ç»„ä»¶æ¨¡æ¿æ›¿æ¢ä¼˜åŒ–é—®é¢˜ä»£ç ä¸­çš„ç¬¬äºŒæ¬¡æ›¿æ¢ï¼Œæ˜¯å°†å®¹å™¨é‡Œçš„ç»„ä»¶å ä½ç¬¦æ›¿æ¢ä¸ºå­ç»„ä»¶çš„Render Functionã€‚å³ä¸‹å›¾æ‰€ç¤ºï¼šå­æ¨¡æ¿æ›¿æ¢ä¼˜åŒ–çš„æ›¿æ¢æ¬¡æ•°å…¶å®æ˜¯è·Ÿç»„ä»¶çš„æ•°é‡ç›¸å…³çš„ï¼Œå³ä½¿æœ‰150ä¸ªç»„ä»¶ï¼Œç”¨æ•°ç»„ç²˜åˆæ³•ä¹Ÿä¸ä¼šæœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ï¼Œå› æ­¤éœ€è¦è€ƒè™‘åˆ«çš„åŠæ³•ã€‚ æˆ‘ä»¬æŸ¥äº†ä¸€ä¸‹vue-template-compilerçš„æºç (Vueçš„compileèƒ½åŠ›ä¹Ÿæ˜¯ç”¨æ­¤æ¨¡å—)ï¼Œå‘ç°Vue.compileçš„å‡½æ•°æœ‰2ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¾…ç¼–è¯‘çš„Vueæ¨¡æ¿ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªoptionå¯¹è±¡ï¼ŒåŒ…å«ä¸€ä¸ªåä¸ºtansformCodeé’©å­å‡½æ•°(å‚è§èµ„æ–™https://github.com/vuejs/vue/blob/dev/flow/compiler.js#L38-L45 ï¼Œæ­¤å‚æ•°å¹¶æœªåœ¨å®˜ç½‘çš„æ–‡æ¡£ä¸­æš´éœ²ï¼Œå…³äºæ­¤å‡½æ•°çš„ç”¨å¤„åé¢å¯ä»¥å†å†™ä¸€ç¯‡æ–‡ç« ) ï¼Œè¿™ä¸ªé’©å­å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯astèŠ‚ç‚¹ï¼Œç¬¬äºŒä¸ªæ˜¯ç¼–è¯‘è¯¥èŠ‚ç‚¹ä¹‹åçš„render codeï¼Œè€Œè¯¥å‡½æ•°çš„è¿”å›å€¼ä¼šå°±æ˜¯æœ€ç»ˆçš„render codeã€‚äºæ˜¯åœ¨ä¹‹å‰çš„ç”Ÿæˆdomå‡½æ•°é‚£é‡ŒæŠŠcomå ä½ç¬¦æ›¿æ¢ä¸ºä¸€ä¸ªç©ºçš„divå…ƒç´ ï¼Œdivå…ƒç´ çš„idä¸ºä¹‹å‰çš„å ä½ç¬¦ï¼Œç„¶ååœ¨ç¼–è¯‘çš„æ—¶å€™åœ¨transformCodeé’©å­å‡½æ•°è¿™é‡Œåšä¸€ä¸ªæ›¿æ¢ï¼Œå½“å‘ç°astèŠ‚ç‚¹ä¸ºdivå¹¶ä¸”idç¬¦åˆç»„ä»¶å ä½ç¬¦çš„è§„åˆ™ï¼Œé‚£ä¹ˆå°±è¿”å›è¯¥ç»„ä»¶å¯¹åº”çš„ç¼–è¯‘ä¹‹åæ ·å¼æ¨¡ç‰ˆã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314var compileTpl = compiler.compile(`&lt;div&gt;${html}&lt;/div&gt;`, { modules: { transformCode: function (el, code) { if (el.attrsMap &amp;&amp; el.attrsMap['id'] &amp;&amp; el.attrsMap['id'].match(/__vue__com_\\d{4,5}__replace__/)) { var comId = el.attrsMap['id'].match(/com_\\d{4,5}/)[0]; // console.log('--------------------------------', comId); var styleTemplate = compiledComTplMap[comId]; // console.log(styleTemplate); return styleTemplate; } return code; } } }).staticRenderFns.toString(); è¿™æ ·ä¸€æ¥å°±å®Œå…¨çœå»äº†ç¬¬äºŒæ¬¡å­—ç¬¦ä¸²æ›¿æ¢çš„æ“ä½œï¼Œäºæ˜¯ç»„ä»¶ç¼–è¯‘è¿™é‡Œçš„æµç¨‹äº†ä¸‹é¢è¿™æ ·ï¼š è¿™ä¸¤æ¬¡ä¼˜åŒ–ä¹‹åç„¶åé‡æ–°å‹æµ‹å¹¶æ”¶é›†æ€§èƒ½æ•°æ®ï¼Œå¾—åˆ°çš„ç«ç„°å›¾å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°createAppå‡½æ•°é‡Œé¢åŸæ¥çš„é‚£ä¸ªreplaceå‡½æ•°çš„æ¨ªæ¡å·²ç»æ¶ˆå¤±ä¸è§äº†ï¼Œè¯´æ˜å‰é¢çš„ä¼˜åŒ–æ˜¯æœ‰æ•ˆæœçš„ï¼Œæœ€è€—æ—¶çš„æ“ä½œå·²ç»ä¸æ˜¯replaceè€Œæ˜¯vueçš„compileæ–¹æ³•å³æ¨¡ç‰ˆçš„ç¼–è¯‘ã€‚ä»æ­¤æ¬¡ä¼˜åŒ–å‰åçš„æœåŠ¡ç«¯å‹æµ‹çš„CPUæ•°æ®ä¹Ÿèƒ½è¯´æ˜é—®é¢˜ï¼š å››.compileå‡½æ•°è°ƒç”¨ä¼˜åŒ–compileå‡½æ•°è°ƒç”¨ï¼Œå°±æ˜¯å‰é¢â€ç»„ä»¶æ¨¡æ¿æ„é€ â€é‚£ä¸€èŠ‚æåˆ°çš„ï¼Œå°†ç»„ä»¶çš„å®¹å™¨æ¨¡æ¿ç”¨Vue.compileå‡½æ•°ç¼–è¯‘æˆRender Functionï¼Œè™½ç„¶è¿™æ®µå®¹å™¨æ¨¡æ¿å¾ˆç®€å•ï¼Œä½†æ˜¯ä»–æ˜¯ä¸€ä¸ªå¾ˆè€—æ€§èƒ½çš„æ“ä½œã€‚è€Œä¸”è¿™æ˜¯Vueè‡ªèº«æä¾›çš„èƒ½åŠ›ï¼Œä¼¼ä¹å·²ç»æ²¡æœ‰å¤šå¤§çš„ä¼˜åŒ–ä½™åœ°äº†ã€‚æœ‰æ²¡æœ‰å…¶ä»–ä¼˜åŒ–æ–¹æ³•å‘¢ï¼Ÿ ä»”ç»†è§‚å¯Ÿä¸€ä¸‹ç»„ä»¶å®¹å™¨domä»¥åŠç¼–è¯‘ä¹‹åçš„ä»£ç ï¼Œä¼¼ä¹æ˜¯æœ‰è§„å¾‹çš„ã€‚å¦‚æœç»„ä»¶æ ‘çš„ç»“æ„æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š 12345678910[ {id: \"com_1001\"}, { id: \"com_1002\", child: [ {id: \"com_1003\"}, {id: \"com_1004\"} ] }]; æ‹¼æ¥ä¹‹åçš„htmlå†…å®¹å¤§æ¦‚æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š 12345678&lt;div&gt; &lt;div id=\"com_1001_con\"&gt;&lt;/div&gt; &lt;div id=\"com_1002_con\"&gt;&lt;/div&gt; &lt;div mpm_edit_child_box tabpid=\"com_1002\" class=\"childBox\"&gt; &lt;div id=\"com_1003_con\"&gt;&lt;/div&gt; &lt;div id=\"com_1004_con\"&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt; è¿™é‡Œä¸€èˆ¬éƒ½åªæ˜¯ä¸€äº›ç®€å•çš„æ¨¡ç‰ˆï¼Œç¼–è¯‘å‡ºæ¥å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š 1234567891011121314with(this) { return _c('div', [ _c('div', {attrs: {\"id\": \"com_1001_con\"}}), _v(\" \"), _c('div', {attrs: {\"id\": \"com_1002_con\"}}), _v(\" \"), _c('div', {staticClass: \"childBox\", attrs: {\"mpm_edit_child_box\": \"\", \"tabpid\": \"com_1002\"}}, [ _c('div', {attrs: {\"id\": \"com_1003_con\"}}), _v(\" \"), _c('div', {attrs: {\"id\": \"com_1004_con\"}}) ]) ])} é€šè¿‡è§‚å¯Ÿå¯ä»¥å‘ç°ï¼Œè¿™é‡Œéƒ½æ˜¯ç”Ÿæˆçš„divå…ƒç´ ï¼Œdivä¸Šçš„å±æ€§éƒ½æ˜¯é™æ€å±æ€§ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªç®€å•çš„â€œç¼–è¯‘â€å‡½æ•°ï¼Œä¸ç”¨èµ°vueçš„ç¼–è¯‘ï¼š 1234567891011121314151617function simpleCompile(comList) { function genTree(tree) { var html = ''; for (var i = 0, len = tree.length; i &lt; len; i++) { var node = tree[i]; var comId = node.id; html += `_c('div',{attrs:{\"id\":\"${comId}_con\"}},[`; html = html + compiledComTplMap[comId] + '])'; // compiledComTplMap[comId] è¯¥ç»„ä»¶å¯¹åº”çš„ç¼–è¯‘åçš„æ ·å¼æ¨¡ç‰ˆ if (node.child &amp;&amp; node.child.length) { html += `,_c('div',{staticClass:\"childBox\",attrs:{\"mpm_edit_child_box\":\"\",\"tabpid\":\"${comId}\"}},[` + genTree(node.child) + `])`; } html += (i === len - 1) ? '' : ','; } return html; } return genTree(comList); } ç»æµ‹è¯•ï¼Œè¿™æ ·ç®€å•â€œç¼–è¯‘â€ä¹‹åç”Ÿæˆçš„ä»£ç è·Ÿä¹‹å‰ç¼–è¯‘çš„ä»£ç æ˜¯ä¸€æ ·çš„ï¼Œåœ¨é¢„å‘å¸ƒç¯å¢ƒæµ‹è¯•äº†å¤šä¸ªé¡µé¢ä¹‹åï¼Œé¡µé¢æ¸²æŸ“ä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚å»æ‰Vueæ¨¡ç‰ˆç¼–è¯‘ä¹‹åæ•´ä¸ªç»„ä»¶æ¸²æŸ“çš„é€»è¾‘å°±å˜æˆäº†ä¸‹é¢è¿™æ ·ï¼š Vueç¼–è¯‘ä¼˜åŒ–ä¹‹åæ”¶é›†cpuæ•°æ®å¾—åˆ°çš„ç«ç„°å›¾å¦‚ä¸‹ï¼š ä»ç«ç„°å›¾å¯ä»¥çœ‹å‡ºï¼ŒåŸæ¥çš„é‚£ä¸ªcompileå‡½æ•°è°ƒç”¨çš„æ¨ªæ¡ä¹Ÿæ¶ˆå¤±äº†ï¼Œè¯´æ˜ä¼˜åŒ–æœ‰æ•ˆæœã€‚å†çœ‹çœ‹å‹æµ‹çš„CPUæ¶ˆè€—æƒ…å†µï¼š éœ€è¦æåˆ°çš„æ˜¯ï¼Œç”±äºæ˜¯è‡ªå·±å®ç°äº†ä¸€ä¸ªç®€å•ç‰ˆçš„compileå‡½æ•°ï¼Œå‰æ–‡ä¸­å…³äºcompileå‡½æ•°è°ƒç”¨ä¼˜åŒ–çš„ä»£ç ï¼Œä¹Ÿç›´æ¥å»æ‰äº†ï¼Œå½“ç„¶ä¹Ÿåˆ°è¾¾äº†ä¼˜åŒ–çš„æ•ˆæœã€‚ äº”.å…¶ä»–ä¼˜åŒ–ç ”ç©¶ç»è¿‡ä¸Šé¢ä¸¤æ¬¡ä¼˜åŒ–ä¹‹åï¼Œå‰©ä¸‹æœ€è€—æ€§èƒ½çš„åœ°æ–¹æ˜¯JSONè§£æå’ŒVueæ¸²æŸ“äº†ã€‚æˆ‘ä»¬ä¹Ÿåšäº†ä¸€ä¸‹ç ”ç©¶ï¼Œä½†æ˜¯å¾ˆå¯æƒœï¼Œæš‚æ—¶æ²¡ä»€ä¹ˆæˆæœï¼Œä¸è¿‡æˆ‘ä»¬çš„æ¢ç´¢ä¹Ÿå¯ä»¥æä¸€ä¸‹ï¼š1ï¼‰JSONè§£æã€‚æˆ‘ä»¬çš„æœåŠ¡ä»Redisä¸­è¯»å‡ºæ¥çš„PageDataæ¯”è¾ƒå¤§ï¼Œä¸€èˆ¬æœ‰100å¤šKBï¼Œå¾ˆéœ€è¦æœ‰ä¸€ä¸ªé«˜æ€§èƒ½çš„JSONååºåˆ—åŒ–çš„åº“(å³ä»£æ›¿JSON.parse)ã€‚ç›®å‰æœ‰ä¸€ä¸ªé«˜æ€§èƒ½çš„åº“fast-json-stringifyï¼Œä½†æ˜¯å¯æƒœä»–æ˜¯åšåºåˆ—åŒ–çš„ï¼ˆå³åšçš„æ˜¯JSON.stringifyåšçš„äº‹æƒ…ï¼‰ã€‚æˆ‘ä»¬æµ‹è¯•äº†å¤šä¸ªæ–¹æ¡ˆï¼Œç›®å‰åŸç”Ÿçš„JSON.parseå‡½æ•°æ€§èƒ½æ˜¯æœ€å¥½çš„ã€‚2ï¼‰Vueæ¸²æŸ“ã€‚æœ‰ä½è…¾è®¯çš„åŒå­¦æåˆ°ï¼Œç”¨string-basedçš„æ¨¡æ¿ä»£æ›¿VirtualDomçš„æ¸²æŸ“æ–¹æ¡ˆæå‡æ€§èƒ½,ä¸è¿‡ä»–å¿½ç•¥äº†ä¸€ç‚¹ï¼ŒVueæ˜¯å®Œå…¨çš„ç»„ä»¶åŒ–çš„ã€æ˜¯æœ‰ç”Ÿå‘½å‘¨æœŸé’©å­ã€æ–¹æ³•ã€è®¡ç®—å±æ€§ç­‰ï¼Œä¸æ˜¯ä¸€ä¸ªç®€ç®€å•å•çš„æ¨¡æ¿å¼•æ“ï¼ŒæŒ‰ç…§ä»–çš„æ€è·¯æ˜¯éœ€è¦æŠŠç”Ÿå‘½å‘¨æœŸçš„é’©å­ã€æ–¹æ³•ã€è®¡ç®—å±æ€§ç­‰å…¨éƒ¨ç®—å¥½åæ‹¿åˆ°çš„æ•°æ®å¯¹è±¡ï¼Œå†è·Ÿstring-basedæ¨¡æ¿ç»“åˆæ‰èƒ½æ¸²æŸ“ï¼Œè¿™ä¸ªæ˜¾ç„¶æ˜¯å’Œç»„ä»¶åŒ–çš„æ€è·¯èƒŒé“è€Œé©°çš„ã€‚ ä¸Šé¢2ç‚¹ï¼Œå„ä½çœ‹å®˜å¦‚æœæœ‰å¥½çš„æ€è·¯ï¼Œæ¬¢è¿ä¸åèµæ•™ï¼ å…­.æ€»ç»“è¿™æ¬¡ä¼˜åŒ–æ€»çš„æ¥è¯´ï¼ŒCPUæ€§èƒ½æ¶ˆè€—å¾—åˆ°äº†æœ‰æ•ˆä¼˜åŒ–ï¼Œæ•´ä½“æå‡äº†å¤§æ¦‚20%ï¼Œä¸€æ–¹é¢ä¸ºå…¬å¸èŠ‚çœäº†èµ„æºï¼Œå¦å¤–ä¸€æ–¹é¢ä¹Ÿå‡å°‘äº†å› æµé‡æš´æ¶¨å¯¼è‡´æˆ‘ä»¬è¦æ‰©å®¹çš„å‡ ç‡ï¼Œä¸€ä¸¾ä¸¤å¾—ã€‚","link":"/2019/09/27/è®°ä¸€æ¬¡Node-jsç›´å‡ºæœåŠ¡çš„æ€§èƒ½ä¼˜åŒ–/"}],"tags":[{"name":"CSS","slug":"CSS","link":"/tags/CSS/"},{"name":"CSS Houdini","slug":"CSS-Houdini","link":"/tags/CSS-Houdini/"},{"name":"AST","slug":"AST","link":"/tags/AST/"},{"name":"ç¢°æ’æ£€æµ‹","slug":"ç¢°æ’æ£€æµ‹","link":"/tags/ç¢°æ’æ£€æµ‹/"},{"name":"å‘é‡","slug":"å‘é‡","link":"/tags/å‘é‡/"},{"name":"TypeScript","slug":"TypeScript","link":"/tags/TypeScript/"},{"name":"Mocha","slug":"Mocha","link":"/tags/Mocha/"},{"name":"BDD/TDD","slug":"BDD-TDD","link":"/tags/BDD-TDD/"},{"name":"æµ‹è¯•æ¡†æ¶","slug":"æµ‹è¯•æ¡†æ¶","link":"/tags/æµ‹è¯•æ¡†æ¶/"},{"name":"webå†…å®¹","slug":"webå†…å®¹","link":"/tags/webå†…å®¹/"},{"name":"ç”µæ± ç”µé‡","slug":"ç”µæ± ç”µé‡","link":"/tags/ç”µæ± ç”µé‡/"},{"name":"æ€§èƒ½ä¼˜åŒ–","slug":"æ€§èƒ½ä¼˜åŒ–","link":"/tags/æ€§èƒ½ä¼˜åŒ–/"},{"name":"å¼•å¯¼è’™å±‚","slug":"å¼•å¯¼è’™å±‚","link":"/tags/å¼•å¯¼è’™å±‚/"},{"name":"canvas","slug":"canvas","link":"/tags/canvas/"},{"name":"type=\"module\"","slug":"type-module","link":"/tags/type-module/"},{"name":"ä»£ç æ‹†åˆ†","slug":"ä»£ç æ‹†åˆ†","link":"/tags/ä»£ç æ‹†åˆ†/"},{"name":"rollupæ‰“åŒ…","slug":"rollupæ‰“åŒ…","link":"/tags/rollupæ‰“åŒ…/"},{"name":"modulepreload","slug":"modulepreload","link":"/tags/modulepreload/"},{"name":"webpack loader","slug":"webpack-loader","link":"/tags/webpack-loader/"},{"name":"å·¥ç¨‹åŒ–","slug":"å·¥ç¨‹åŒ–","link":"/tags/å·¥ç¨‹åŒ–/"},{"name":"èµ„æºæ²»ç†","slug":"èµ„æºæ²»ç†","link":"/tags/èµ„æºæ²»ç†/"},{"name":"å‰ç«¯å·¥ç¨‹åŒ–","slug":"å‰ç«¯å·¥ç¨‹åŒ–","link":"/tags/å‰ç«¯å·¥ç¨‹åŒ–/"},{"name":"Vue.compile","slug":"Vue-compile","link":"/tags/Vue-compile/"},{"name":"CPUæ€§èƒ½ä¼˜åŒ–","slug":"CPUæ€§èƒ½ä¼˜åŒ–","link":"/tags/CPUæ€§èƒ½ä¼˜åŒ–/"},{"name":"ç«ç„°å›¾","slug":"ç«ç„°å›¾","link":"/tags/ç«ç„°å›¾/"}],"categories":[{"name":"Webå¼€å‘","slug":"Webå¼€å‘","link":"/categories/Webå¼€å‘/"},{"name":"Node.js","slug":"Node-js","link":"/categories/Node-js/"},{"name":"Webå‰ç«¯","slug":"Webå‰ç«¯","link":"/categories/Webå‰ç«¯/"}]}